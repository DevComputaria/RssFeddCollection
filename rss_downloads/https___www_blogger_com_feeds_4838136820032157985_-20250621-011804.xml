<?xml version='1.0' encoding='UTF-8'?><?xml-stylesheet href="http://www.blogger.com/styles/atom.css" type="text/css"?><entry xmlns='http://www.w3.org/2005/Atom' xmlns:blogger='http://schemas.google.com/blogger/2008' xmlns:georss='http://www.georss.org/georss' xmlns:gd='http://schemas.google.com/g/2005' xmlns:thr='http://purl.org/syndication/thread/1.0'><id>tag:blogger.com,1999:blog-4838136820032157985.post-6288849578901159797</id><published>2023-01-19T09:33:00.000-08:00</published><updated>2023-01-19T09:33:48.633-08:00</updated><title type='text'>Exploiting null-dereferences in the Linux kernel</title><content type='html'>&lt;style type=&quot;text/css&quot;&gt;@import url(&#39;https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw&#39;);ol.lst-kix_3558t16xb2i9-3.start{counter-reset:lst-ctn-kix_3558t16xb2i9-3 0}.lst-kix_dt3x5t4funnl-8&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_dt3x5t4funnl-8,lower-roman) &quot;. &quot;}ol.lst-kix_ehkygwr8rii2-3.start{counter-reset:lst-ctn-kix_ehkygwr8rii2-3 0}ol.lst-kix_dt3x5t4funnl-6.start{counter-reset:lst-ctn-kix_dt3x5t4funnl-6 0}.lst-kix_3558t16xb2i9-5&gt;li{counter-increment:lst-ctn-kix_3558t16xb2i9-5}.lst-kix_dt3x5t4funnl-7&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_dt3x5t4funnl-7,lower-latin) &quot;. &quot;}.lst-kix_dt3x5t4funnl-1&gt;li{counter-increment:lst-ctn-kix_dt3x5t4funnl-1}.lst-kix_dt3x5t4funnl-2&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_dt3x5t4funnl-2,lower-roman) &quot;. &quot;}.lst-kix_ehkygwr8rii2-5&gt;li{counter-increment:lst-ctn-kix_ehkygwr8rii2-5}.lst-kix_dt3x5t4funnl-1&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_dt3x5t4funnl-1,lower-latin) &quot;. &quot;}ol.lst-kix_3558t16xb2i9-6.start{counter-reset:lst-ctn-kix_3558t16xb2i9-6 0}.lst-kix_dt3x5t4funnl-2&gt;li{counter-increment:lst-ctn-kix_dt3x5t4funnl-2}ol.lst-kix_ehkygwr8rii2-6.start{counter-reset:lst-ctn-kix_ehkygwr8rii2-6 0}ol.lst-kix_gx9cg4br20pa-1.start{counter-reset:lst-ctn-kix_gx9cg4br20pa-1 0}.lst-kix_dt3x5t4funnl-3&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_dt3x5t4funnl-3,decimal) &quot;. &quot;}.lst-kix_dt3x5t4funnl-4&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_dt3x5t4funnl-4,lower-latin) &quot;. &quot;}.lst-kix_dt3x5t4funnl-6&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_dt3x5t4funnl-6,decimal) &quot;. &quot;}.lst-kix_3558t16xb2i9-8&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_3558t16xb2i9-8,lower-roman) &quot;. &quot;}.lst-kix_dt3x5t4funnl-5&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_dt3x5t4funnl-5,lower-roman) &quot;. &quot;}.lst-kix_3558t16xb2i9-5&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_3558t16xb2i9-5,lower-roman) &quot;. &quot;}.lst-kix_dt3x5t4funnl-0&gt;li{counter-increment:lst-ctn-kix_dt3x5t4funnl-0}.lst-kix_3558t16xb2i9-3&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_3558t16xb2i9-3,decimal) &quot;. &quot;}.lst-kix_3558t16xb2i9-7&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_3558t16xb2i9-7,lower-latin) &quot;. &quot;}.lst-kix_dt3x5t4funnl-3&gt;li{counter-increment:lst-ctn-kix_dt3x5t4funnl-3}.lst-kix_3558t16xb2i9-6&gt;li{counter-increment:lst-ctn-kix_3558t16xb2i9-6}.lst-kix_3558t16xb2i9-2&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_3558t16xb2i9-2,lower-roman) &quot;. &quot;}.lst-kix_3558t16xb2i9-6&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_3558t16xb2i9-6,decimal) &quot;. &quot;}ol.lst-kix_gx9cg4br20pa-4.start{counter-reset:lst-ctn-kix_gx9cg4br20pa-4 0}.lst-kix_3558t16xb2i9-4&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_3558t16xb2i9-4,lower-latin) &quot;. &quot;}ol.lst-kix_ehkygwr8rii2-1{list-style-type:none}.lst-kix_3558t16xb2i9-4&gt;li{counter-increment:lst-ctn-kix_3558t16xb2i9-4}.lst-kix_gx9cg4br20pa-7&gt;li{counter-increment:lst-ctn-kix_gx9cg4br20pa-7}ol.lst-kix_ehkygwr8rii2-0{list-style-type:none}ol.lst-kix_ehkygwr8rii2-3{list-style-type:none}ol.lst-kix_3558t16xb2i9-0.start{counter-reset:lst-ctn-kix_3558t16xb2i9-0 0}ol.lst-kix_ehkygwr8rii2-2{list-style-type:none}ol.lst-kix_ehkygwr8rii2-5{list-style-type:none}ol.lst-kix_ehkygwr8rii2-4{list-style-type:none}ol.lst-kix_ehkygwr8rii2-7{list-style-type:none}.lst-kix_ehkygwr8rii2-3&gt;li{counter-increment:lst-ctn-kix_ehkygwr8rii2-3}ol.lst-kix_ehkygwr8rii2-6{list-style-type:none}.lst-kix_3558t16xb2i9-1&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_3558t16xb2i9-1,lower-latin) &quot;. &quot;}ol.lst-kix_ehkygwr8rii2-8{list-style-type:none}.lst-kix_ehkygwr8rii2-6&gt;li{counter-increment:lst-ctn-kix_ehkygwr8rii2-6}ol.lst-kix_gx9cg4br20pa-7.start{counter-reset:lst-ctn-kix_gx9cg4br20pa-7 0}.lst-kix_3558t16xb2i9-0&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_3558t16xb2i9-0,decimal) &quot;. &quot;}.lst-kix_3558t16xb2i9-2&gt;li{counter-increment:lst-ctn-kix_3558t16xb2i9-2}ol.lst-kix_3558t16xb2i9-8.start{counter-reset:lst-ctn-kix_3558t16xb2i9-8 0}ol.lst-kix_ehkygwr8rii2-8.start{counter-reset:lst-ctn-kix_ehkygwr8rii2-8 0}.lst-kix_ehkygwr8rii2-8&gt;li{counter-increment:lst-ctn-kix_ehkygwr8rii2-8}.lst-kix_gx9cg4br20pa-1&gt;li{counter-increment:lst-ctn-kix_gx9cg4br20pa-1}ol.lst-kix_dt3x5t4funnl-8.start{counter-reset:lst-ctn-kix_dt3x5t4funnl-8 0}.lst-kix_dt3x5t4funnl-5&gt;li{counter-increment:lst-ctn-kix_dt3x5t4funnl-5}ol.lst-kix_gx9cg4br20pa-8{list-style-type:none}ol.lst-kix_dt3x5t4funnl-1.start{counter-reset:lst-ctn-kix_dt3x5t4funnl-1 0}ol.lst-kix_gx9cg4br20pa-4{list-style-type:none}ol.lst-kix_gx9cg4br20pa-5{list-style-type:none}ol.lst-kix_3558t16xb2i9-1.start{counter-reset:lst-ctn-kix_3558t16xb2i9-1 0}ol.lst-kix_gx9cg4br20pa-3.start{counter-reset:lst-ctn-kix_gx9cg4br20pa-3 0}ol.lst-kix_gx9cg4br20pa-6{list-style-type:none}ol.lst-kix_gx9cg4br20pa-7{list-style-type:none}ol.lst-kix_gx9cg4br20pa-0{list-style-type:none}ol.lst-kix_gx9cg4br20pa-1{list-style-type:none}.lst-kix_gx9cg4br20pa-5&gt;li{counter-increment:lst-ctn-kix_gx9cg4br20pa-5}ol.lst-kix_gx9cg4br20pa-2{list-style-type:none}ol.lst-kix_gx9cg4br20pa-3{list-style-type:none}ol.lst-kix_ehkygwr8rii2-1.start{counter-reset:lst-ctn-kix_ehkygwr8rii2-1 0}.lst-kix_gx9cg4br20pa-8&gt;li{counter-increment:lst-ctn-kix_gx9cg4br20pa-8}ol.lst-kix_dt3x5t4funnl-0.start{counter-reset:lst-ctn-kix_dt3x5t4funnl-0 0}ol.lst-kix_dt3x5t4funnl-7.start{counter-reset:lst-ctn-kix_dt3x5t4funnl-7 0}ol.lst-kix_ehkygwr8rii2-7.start{counter-reset:lst-ctn-kix_ehkygwr8rii2-7 0}.lst-kix_dt3x5t4funnl-0&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_dt3x5t4funnl-0,decimal) &quot;. &quot;}ol.lst-kix_ehkygwr8rii2-0.start{counter-reset:lst-ctn-kix_ehkygwr8rii2-0 0}ol.lst-kix_gx9cg4br20pa-2.start{counter-reset:lst-ctn-kix_gx9cg4br20pa-2 0}.lst-kix_ehkygwr8rii2-2&gt;li{counter-increment:lst-ctn-kix_ehkygwr8rii2-2}ol.lst-kix_3558t16xb2i9-2.start{counter-reset:lst-ctn-kix_3558t16xb2i9-2 0}.lst-kix_3558t16xb2i9-8&gt;li{counter-increment:lst-ctn-kix_3558t16xb2i9-8}ol.lst-kix_gx9cg4br20pa-5.start{counter-reset:lst-ctn-kix_gx9cg4br20pa-5 0}.lst-kix_ehkygwr8rii2-8&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_ehkygwr8rii2-8,lower-roman) &quot;. &quot;}.lst-kix_dt3x5t4funnl-7&gt;li{counter-increment:lst-ctn-kix_dt3x5t4funnl-7}.lst-kix_ehkygwr8rii2-7&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_ehkygwr8rii2-7,lower-latin) &quot;. &quot;}.lst-kix_gx9cg4br20pa-3&gt;li{counter-increment:lst-ctn-kix_gx9cg4br20pa-3}.lst-kix_ehkygwr8rii2-6&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_ehkygwr8rii2-6,decimal) &quot;. &quot;}.lst-kix_ehkygwr8rii2-0&gt;li{counter-increment:lst-ctn-kix_ehkygwr8rii2-0}.lst-kix_ehkygwr8rii2-5&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_ehkygwr8rii2-5,lower-roman) &quot;. &quot;}ol.lst-kix_3558t16xb2i9-7{list-style-type:none}ol.lst-kix_gx9cg4br20pa-8.start{counter-reset:lst-ctn-kix_gx9cg4br20pa-8 0}.lst-kix_ehkygwr8rii2-2&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_ehkygwr8rii2-2,lower-roman) &quot;. &quot;}ol.lst-kix_3558t16xb2i9-8{list-style-type:none}.lst-kix_dt3x5t4funnl-8&gt;li{counter-increment:lst-ctn-kix_dt3x5t4funnl-8}ol.lst-kix_3558t16xb2i9-3{list-style-type:none}.lst-kix_ehkygwr8rii2-0&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_ehkygwr8rii2-0,decimal) &quot;. &quot;}.lst-kix_ehkygwr8rii2-4&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_ehkygwr8rii2-4,lower-latin) &quot;. &quot;}ol.lst-kix_3558t16xb2i9-4{list-style-type:none}ol.lst-kix_3558t16xb2i9-5{list-style-type:none}.lst-kix_ehkygwr8rii2-3&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_ehkygwr8rii2-3,decimal) &quot;. &quot;}ol.lst-kix_3558t16xb2i9-6{list-style-type:none}.lst-kix_3558t16xb2i9-0&gt;li{counter-increment:lst-ctn-kix_3558t16xb2i9-0}.lst-kix_ehkygwr8rii2-1&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_ehkygwr8rii2-1,lower-latin) &quot;. &quot;}.lst-kix_ehkygwr8rii2-1&gt;li{counter-increment:lst-ctn-kix_ehkygwr8rii2-1}.lst-kix_gx9cg4br20pa-2&gt;li{counter-increment:lst-ctn-kix_gx9cg4br20pa-2}ol.lst-kix_dt3x5t4funnl-5.start{counter-reset:lst-ctn-kix_dt3x5t4funnl-5 0}ol.lst-kix_dt3x5t4funnl-0{list-style-type:none}ol.lst-kix_dt3x5t4funnl-1{list-style-type:none}ol.lst-kix_ehkygwr8rii2-2.start{counter-reset:lst-ctn-kix_ehkygwr8rii2-2 0}ol.lst-kix_dt3x5t4funnl-2{list-style-type:none}ol.lst-kix_3558t16xb2i9-0{list-style-type:none}ol.lst-kix_dt3x5t4funnl-3{list-style-type:none}ol.lst-kix_3558t16xb2i9-1{list-style-type:none}ol.lst-kix_dt3x5t4funnl-4{list-style-type:none}.lst-kix_dt3x5t4funnl-6&gt;li{counter-increment:lst-ctn-kix_dt3x5t4funnl-6}ol.lst-kix_3558t16xb2i9-2{list-style-type:none}ol.lst-kix_dt3x5t4funnl-5{list-style-type:none}ol.lst-kix_dt3x5t4funnl-6{list-style-type:none}ol.lst-kix_dt3x5t4funnl-7{list-style-type:none}ol.lst-kix_3558t16xb2i9-4.start{counter-reset:lst-ctn-kix_3558t16xb2i9-4 0}ol.lst-kix_dt3x5t4funnl-8{list-style-type:none}.lst-kix_gx9cg4br20pa-4&gt;li{counter-increment:lst-ctn-kix_gx9cg4br20pa-4}.lst-kix_3558t16xb2i9-1&gt;li{counter-increment:lst-ctn-kix_3558t16xb2i9-1}ol.lst-kix_3558t16xb2i9-7.start{counter-reset:lst-ctn-kix_3558t16xb2i9-7 0}ol.lst-kix_dt3x5t4funnl-2.start{counter-reset:lst-ctn-kix_dt3x5t4funnl-2 0}ol.lst-kix_ehkygwr8rii2-5.start{counter-reset:lst-ctn-kix_ehkygwr8rii2-5 0}.lst-kix_gx9cg4br20pa-1&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_gx9cg4br20pa-1,lower-latin) &quot;. &quot;}.lst-kix_gx9cg4br20pa-2&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_gx9cg4br20pa-2,lower-roman) &quot;. &quot;}ol.lst-kix_dt3x5t4funnl-4.start{counter-reset:lst-ctn-kix_dt3x5t4funnl-4 0}.lst-kix_gx9cg4br20pa-6&gt;li{counter-increment:lst-ctn-kix_gx9cg4br20pa-6}.lst-kix_dt3x5t4funnl-4&gt;li{counter-increment:lst-ctn-kix_dt3x5t4funnl-4}ol.lst-kix_gx9cg4br20pa-0.start{counter-reset:lst-ctn-kix_gx9cg4br20pa-0 0}.lst-kix_gx9cg4br20pa-0&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_gx9cg4br20pa-0,decimal) &quot;. &quot;}.lst-kix_3558t16xb2i9-7&gt;li{counter-increment:lst-ctn-kix_3558t16xb2i9-7}.lst-kix_3558t16xb2i9-3&gt;li{counter-increment:lst-ctn-kix_3558t16xb2i9-3}.lst-kix_ehkygwr8rii2-7&gt;li{counter-increment:lst-ctn-kix_ehkygwr8rii2-7}.lst-kix_ehkygwr8rii2-4&gt;li{counter-increment:lst-ctn-kix_ehkygwr8rii2-4}ol.lst-kix_gx9cg4br20pa-6.start{counter-reset:lst-ctn-kix_gx9cg4br20pa-6 0}ol.lst-kix_ehkygwr8rii2-4.start{counter-reset:lst-ctn-kix_ehkygwr8rii2-4 0}ol.lst-kix_dt3x5t4funnl-3.start{counter-reset:lst-ctn-kix_dt3x5t4funnl-3 0}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_gx9cg4br20pa-8&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_gx9cg4br20pa-8,lower-roman) &quot;. &quot;}.lst-kix_gx9cg4br20pa-7&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_gx9cg4br20pa-7,lower-latin) &quot;. &quot;}.lst-kix_gx9cg4br20pa-5&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_gx9cg4br20pa-5,lower-roman) &quot;. &quot;}.lst-kix_gx9cg4br20pa-6&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_gx9cg4br20pa-6,decimal) &quot;. &quot;}ol.lst-kix_3558t16xb2i9-5.start{counter-reset:lst-ctn-kix_3558t16xb2i9-5 0}.lst-kix_gx9cg4br20pa-0&gt;li{counter-increment:lst-ctn-kix_gx9cg4br20pa-0}.lst-kix_gx9cg4br20pa-3&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_gx9cg4br20pa-3,decimal) &quot;. &quot;}.lst-kix_gx9cg4br20pa-4&gt;li:before{content:&quot;&quot; counter(lst-ctn-kix_gx9cg4br20pa-4,lower-latin) &quot;. &quot;}ol{margin:0;padding:0}table td,table th{padding:0}.EakHiGVfAD-c11{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#e0e0e0;border-top-width:1pt;border-right-width:1pt;border-left-color:#e0e0e0;vertical-align:top;border-right-color:#e0e0e0;border-left-width:1pt;border-top-style:solid;background-color:#fafafa;border-left-style:solid;border-bottom-width:1pt;width:468pt;border-top-color:#e0e0e0;border-bottom-style:solid}.EakHiGVfAD-c19{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:&quot;Arial&quot;;font-style:italic}.EakHiGVfAD-c5{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:&quot;Arial&quot;;font-style:normal}.EakHiGVfAD-c12{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:&quot;Arial&quot;;font-style:normal}.EakHiGVfAD-c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:Consolas,&quot;Courier New&quot;;font-style:normal}.EakHiGVfAD-c17{padding-top:18pt;padding-bottom:6pt;line-height:1.5;page-break-after:avoid;text-align:left}.EakHiGVfAD-c26{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.EakHiGVfAD-c1{font-size:10pt;font-family:Consolas,&quot;Courier New&quot;;color:#9c27b0;font-weight:400}.EakHiGVfAD-c0{font-size:10pt;font-family:Consolas,&quot;Courier New&quot;;color:#616161;font-weight:400}.EakHiGVfAD-c7{font-size:10pt;font-family:Consolas,&quot;Courier New&quot;;color:#000000;font-weight:400}.EakHiGVfAD-c4{padding-top:0pt;padding-bottom:0pt;line-height:1.5;text-align:left}.EakHiGVfAD-c27{font-size:10pt;font-family:Consolas,&quot;Courier New&quot;;color:#0f9d58;font-weight:400}.EakHiGVfAD-c13{font-size:10pt;font-family:Consolas,&quot;Courier New&quot;;color:#455a64;font-weight:400}.EakHiGVfAD-c9{font-size:10pt;font-family:Consolas,&quot;Courier New&quot;;color:#c53929;font-weight:400}.EakHiGVfAD-c16{border-spacing:0;border-collapse:collapse;margin-right:auto}.EakHiGVfAD-c22{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.EakHiGVfAD-c25{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.EakHiGVfAD-c10{color:inherit;text-decoration:inherit}.EakHiGVfAD-c8{orphans:2;widows:2}.EakHiGVfAD-c15{margin-left:36pt;padding-left:0pt}.EakHiGVfAD-c20{padding:0;margin:0}.EakHiGVfAD-c3{font-weight:400;font-family:&quot;Courier New&quot;}.EakHiGVfAD-c21{height:0pt}.EakHiGVfAD-c23{margin-left:36pt}.EakHiGVfAD-c18{vertical-align:super}.EakHiGVfAD-c6{height:11pt}.EakHiGVfAD-c24{font-style:italic}.EakHiGVfAD-c14{font-weight:700}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:&quot;Arial&quot;;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:&quot;Arial&quot;;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:&quot;Arial&quot;}p{margin:0;color:#000000;font-size:11pt;font-family:&quot;Arial&quot;}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:&quot;Arial&quot;;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:&quot;Arial&quot;;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:&quot;Arial&quot;;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:&quot;Arial&quot;;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:&quot;Arial&quot;;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:&quot;Arial&quot;;line-height:1.5;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}&lt;/style&gt;&lt;/head&gt;&lt;body class=&quot;c25 doc-content&quot;&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;Posted by Seth Jenkins, Project Zero&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;For a fair amount of time&lt;/span&gt;&lt;span&gt;, null-deref bugs were a highly exploitable kernel bug class. Back when the kernel was able to access userland memory without restriction, and userland programs were still able to map the zero page, there were many easy techniques for exploiting null-deref bugs. However with the introduction of modern exploit mitigations such as SMEP and SMAP, as well as &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmap_min_addr&lt;/span&gt;&lt;span&gt;&amp;nbsp;preventing unprivileged programs from mmap&amp;rsquo;ing low addresses, null-deref bugs are generally not considered &lt;/span&gt;&lt;span&gt;a security issue&lt;/span&gt;&lt;span&gt;&amp;nbsp;in modern kernel versions. &lt;/span&gt;&lt;span&gt;This blog post provides an exploit technique&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;demonstrating that treating these bugs as universally innocuous often leads to faulty evaluations of their relevance to security.&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;h2 class=&quot;EakHiGVfAD-c17 EakHiGVfAD-c8&quot; id=&quot;h.m1bt0m324efm&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c12&quot;&gt;Kernel oops overview&lt;/span&gt;&lt;/h2&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;At present, when the Linux kernel triggers a null-deref from within a process context, it generates an &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c22&quot;&gt;&lt;a class=&quot;EakHiGVfAD-c101&quot; href=&quot;https://en.wikipedia.org/wiki/Linux_kernel_oops&quot;&gt;oops&lt;/a&gt;&lt;/span&gt;&lt;span&gt;, which is distinct from a kernel panic. A panic occurs when the kernel determines that there is no safe way to continue execution, and that therefore all execution must &lt;/span&gt;&lt;span&gt;cease&lt;/span&gt;&lt;span&gt;. However, the kernel does &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c24&quot;&gt;not&lt;/span&gt;&lt;span&gt;&amp;nbsp;stop all execution during an oops - instead the kernel tries to recover as best as it can and continue &lt;/span&gt;&lt;span&gt;execution&lt;/span&gt;&lt;span&gt;. In the case of a task, that involves throwing out the existing kernel stack and going directly to &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;make_task_dead&lt;/span&gt;&lt;span&gt;&amp;nbsp;which calls &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;do_exit&lt;/span&gt;&lt;span&gt;. The kernel will also publish in dmesg a &amp;ldquo;crash&amp;rdquo; log and kernel backtrace depicting what state the kernel was in when the oops occurred. This may seem like an odd choice to make when memory corruption has clearly occurred - however the intention is to allow kernel bugs to more easily be detectable and loggable under the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c22&quot;&gt;&lt;a class=&quot;EakHiGVfAD-c101&quot; href=&quot;https://yarchive.net/comp/linux/BUG.html&quot;&gt;philosophy that a working system is much easier to debug than a dead one.&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;The unfortunate side effect of the oops recovery path is that the kernel is not able to perform any associated cleanup that it would normally perform on a typical syscall error recovery path. This means that any locks that were locked at the moment of the oops stay locked, any refcounts remain taken, any memory otherwise temporarily allocated remains allocated, etc. However, the process that generated the oops, its associated kernel stack, task struct and derivative members etc. can and often will be freed, meaning that depending on the precise circumstances of the oops, it&amp;rsquo;s possible that no memory is actually leaked. This becomes particularly important in regards to exploitation later.&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;h2 class=&quot;EakHiGVfAD-c8 EakHiGVfAD-c17&quot; id=&quot;h.eq2rlvs1528n&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c12&quot;&gt;Reference count mismanagement overview&lt;/span&gt;&lt;/h2&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;Refcount mismanagement is a fairly well-known and exploitable issue. In the case where software improperly decrements a refcount, this can lead to a classic UAF primitive. The case where &lt;/span&gt;&lt;span&gt;software&lt;/span&gt;&lt;span&gt;&amp;nbsp;improperly &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c14&quot;&gt;doesn&amp;rsquo;t&lt;/span&gt;&lt;span&gt;&amp;nbsp;decrement&lt;/span&gt;&lt;span&gt;&amp;nbsp;a refcount (&lt;/span&gt;&lt;span&gt;leaking a &lt;/span&gt;&lt;span&gt;reference) is also often exploitable. If the attacker can cause a refcount to be repeatedly improperly incremented, it is possible that given enough effort the refcount may overflow, at which point the software no longer has any remotely sensible idea of how many refcounts are taken on an object.&lt;/span&gt;&lt;span&gt;&amp;nbsp;In such a case, it is possible for an attacker to destroy the object&lt;/span&gt;&lt;span&gt;&amp;nbsp;by incrementing and decrementing the refcount back to zero after overflowing, while still holding reachable references to the associated memory. &lt;/span&gt;&lt;span&gt;32-bit refcounts are particularly vulnerable to this sort of overflow&lt;/span&gt;&lt;span&gt;. It is important however, that each increment of the refcount allocates little or no &lt;/span&gt;&lt;span&gt;physical memory&lt;/span&gt;&lt;span&gt;. &lt;/span&gt;&lt;span&gt;Even a single byte allocation is quite expensive if it must be performed 2&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c18&quot;&gt;32&lt;/span&gt;&lt;span&gt;&amp;nbsp;times&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;.&lt;/span&gt;&lt;/p&gt;&lt;h2 class=&quot;EakHiGVfAD-c17 EakHiGVfAD-c8&quot; id=&quot;h.35si9vu7f0jz&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c12&quot;&gt;Example null-deref bug&lt;/span&gt;&lt;/h2&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;When a kernel oops unceremoniously ends a task, any refcounts that the task was holding remain held, even though all memory associated with the task may be freed when the task exits. Let&amp;rsquo;s look at &lt;/span&gt;&lt;span&gt;an example&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;- an otherwise unrelated bug I coincidentally discovered in the very recent past:&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;a id=&quot;t.fe2fb833118ca1ee8e3e8160d28a318057211654&quot;&gt;&lt;/a&gt;&lt;a id=&quot;t.0&quot;&gt;&lt;/a&gt;&lt;table class=&quot;EakHiGVfAD-c16&quot;&gt;&lt;tr class=&quot;EakHiGVfAD-c21&quot;&gt;&lt;td class=&quot;EakHiGVfAD-c11&quot; colspan=&quot;1&quot; rowspan=&quot;1&quot;&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;static&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;show_smaps_rollup&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;seq_file &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;{&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;proc_maps_private &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;priv &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;m&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;mem_size_stats mss&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;mm_struct &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;vm_area_struct &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;vma&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;unsigned&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;last_vma_end &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;ret &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;task &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;get_proc_task&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;inode&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c13&quot;&gt;//task reference taken&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;ESRCH&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mm &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c13&quot;&gt;//With no vma&amp;#39;s, mm-&amp;gt;mmap is NULL&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;||&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mmget_not_zero&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c13&quot;&gt;//mm reference taken&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ret &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;ESRCH&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;goto&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;out_put_task&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;}&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; memset&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mss&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mss&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;));&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ret &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;mmap_read_lock_killable&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c13&quot;&gt;//mmap read lock taken&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;goto&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;out_put_mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; hold_task_mempolicy&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;vma &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mmap&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;vma&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;vma &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;vma&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;vm_next&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;{&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; smap_gather_stats&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;vma&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mss&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; last_vma_end &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;vma&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;vm_end&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;}&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; show_vma_header_prefix&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mmap&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;vm_start&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;last_vma_end&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c13&quot;&gt;//the deref of mmap causes a kernel oops here&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; seq_pad&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c27&quot;&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; seq_puts&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c27&quot;&gt;&amp;quot;[rollup]\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; __show_smap&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mss&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; release_task_mempolicy&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mmap_read_unlock&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;out_put_mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;:&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mmput&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;out_put_task&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;:&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; put_task_struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; priv&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;task &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;NULL&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;ret&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;}&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;This file is intended simply to print a set of memory usage statistics for the respective process. Regardless, &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c22&quot;&gt;&lt;a class=&quot;EakHiGVfAD-c101&quot; href=&quot;https://lore.kernel.org/lkml/20221003224531.1930646-1-sethjenkins@google.com/T/&quot;&gt;this bug report&lt;/a&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;reveals a classic and otherwise innocuous null-deref bug within this function. In the case of a task that has no VMA&amp;rsquo;s mapped at all, the task&amp;rsquo;s &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm_struct mmap&lt;/span&gt;&lt;span&gt;&amp;nbsp;member will be equal to NULL. Thus the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;priv-&amp;gt;mm-&amp;gt;mmap-&amp;gt;vm_start&lt;/span&gt;&lt;span&gt;&amp;nbsp;access causes a null dereference and consequently a kernel oops. This bug can be triggered by simply &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;read&lt;/span&gt;&lt;span&gt;&amp;rsquo;ing &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;/proc/[pid]/smaps_rollup&lt;/span&gt;&lt;span&gt;&amp;nbsp;on a task with no VMA&amp;rsquo;s (which itself can be stably created via &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;ptrace&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;):&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;a href=&quot;https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjW-7Gf0dWd5QJfxXYwRAdtMX7uoynsldEgf9C7saF7MLL_iwIUVaagMyOAa8r-e4_KDf33viQn5U2w1LirUQnx7Vk1fJgpACWUijAl8Pgtiu8ZrDTaiEzJYSo3pJUX_nh4Mh4EQ2GPclwSCHcA-OmGfexegm4WykTZyKnIq9ktGTiLcCJo0QW0VKx6/s1138/image1.png&quot; style=&quot;display: block; padding: 1em 0;text-align: center;&quot;&gt;&lt;img src=&quot;https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjW-7Gf0dWd5QJfxXYwRAdtMX7uoynsldEgf9C7saF7MLL_iwIUVaagMyOAa8r-e4_KDf33viQn5U2w1LirUQnx7Vk1fJgpACWUijAl8Pgtiu8ZrDTaiEzJYSo3pJUX_nh4Mh4EQ2GPclwSCHcA-OmGfexegm4WykTZyKnIq9ktGTiLcCJo0QW0VKx6/s1138/image1.png&quot; border=&quot;0&quot; alt=&quot;Kernel log showing the oops condition backtrace&quot; style=&quot;max-height: 750px; max-width: 600px;&quot;title=&quot;Kernel log showing the oops condition backtrace&quot; /&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c19&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;This kernel oops will mean that the following events occur:&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;c20 lst-kix_3558t16xb2i9-0 start&quot; start=&quot;1&quot;&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;The associated &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;struct file &lt;/span&gt;&lt;span&gt;will have a refcount leaked if &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;fdget&lt;/span&gt;&lt;span&gt;&amp;nbsp;took a refcount &lt;/span&gt;&lt;span&gt;(we&amp;rsquo;ll try and make sure this doesn&amp;rsquo;t happen later)&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;The associated &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;seq_file&lt;/span&gt;&lt;span&gt;&amp;nbsp;within the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;struct file&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;has a mutex that will forever be locked (any future reads/writes/lseeks etc. will hang forever).&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;The &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;task struct&lt;/span&gt;&lt;span&gt;&amp;nbsp;associated with the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;smaps_rollup&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;file will have a refcount leaked&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;The &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm_struct&amp;rsquo;s mm_users&lt;/span&gt;&lt;span&gt;&amp;nbsp;refcount&lt;/span&gt;&lt;span&gt;&amp;nbsp;associated with the task will be leaked&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;The &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm_struct&amp;rsquo;s&lt;/span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;span&gt;mmap&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;lock will be permanently readlocked (any future write-lock attempts will hang forever)&lt;/span&gt;&lt;/li&gt;&lt;/ol&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6 EakHiGVfAD-c23&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;Each of these conditions is an unintentional side-effect that leads to buggy behaviors, but not all of those behaviors are useful to an attacker. &lt;/span&gt;&lt;span&gt;The permanent locking of events 2 and 5 only makes exploitation more difficult. Condition 1 is unexploitable because we cannot leak the struct file refcount again without taking a mutex that will never be unlocked. Condition 3 is unexploitable because a task struct uses a safe saturating kernel &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;refcount_t&lt;/span&gt;&lt;span&gt;&amp;nbsp;which prevents the overflow condition. This leaves condition 4. &lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;The &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm_users&lt;/span&gt;&lt;span&gt;&amp;nbsp;refcount still &lt;/span&gt;&lt;span&gt;uses an overflow-unsafe &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;atomic_t&lt;/span&gt;&lt;span&gt;&amp;nbsp;and since we can take a readlock an indefinite number of times, the associated &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmap_read_lock&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;does not prevent us from incrementing the refcount again. There are a couple important roadblocks we need to avoid in order to repeatedly leak this refcount:&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;c20 lst-kix_dt3x5t4funnl-0 start&quot; start=&quot;1&quot;&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;We cannot call this syscall from the task with the empty vma list itself - in other words, we can&amp;rsquo;t call &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;read&lt;/span&gt;&lt;span&gt;&amp;nbsp;from &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;/proc/self/smaps_rollup&lt;/span&gt;&lt;span&gt;. Such a process cannot easily make repeated syscalls since it has no virtual memory mapped. We avoid this by reading &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;smaps_rollup&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;from another process.&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;We must re-open the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;smaps_rollup&lt;/span&gt;&lt;span&gt;&amp;nbsp;file every time because any future reads we perform on a &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;smaps_rollup&lt;/span&gt;&lt;span&gt;&amp;nbsp;instance we already triggered the oops on will deadlock on the local &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;seq_file&lt;/span&gt;&lt;span&gt;&amp;nbsp;mutex lock which is locked forever. We also need to destroy the resulting &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;struct file&lt;/span&gt;&lt;span&gt;&amp;nbsp;(via &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;) after we generate the oops in order to prevent untenable memory usage.&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;If we access the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span&gt;&amp;nbsp;through the same pid every time, we will run into the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;task struct&lt;/span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;span&gt;max refcount before we overflow the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm_users&lt;/span&gt;&lt;span&gt;&amp;nbsp;refcount. Thus we need to create two separate tasks that share the same &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span&gt;&amp;nbsp;and balance the oopses we generate across both tasks so the task refcounts grow half as quickly as the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm_users&lt;/span&gt;&lt;span&gt;&amp;nbsp;refcount. We do this via the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;clone&lt;/span&gt;&lt;span&gt;&amp;nbsp;flag &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;CLONE_VM&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;We must avoid opening/reading the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;smaps_rollup&lt;/span&gt;&lt;span&gt;&amp;nbsp;file from a task that has a shared file descriptor table, as otherwise a refcount will be leaked on the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;struct file&lt;/span&gt;&lt;span&gt;&amp;nbsp;itself. This isn&amp;rsquo;t difficult, just don&amp;rsquo;t &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;the file from a multi-threaded process.&lt;/span&gt;&lt;/li&gt;&lt;/ol&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;Our final refcount leaking overflow strategy is as follows:&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;c20 lst-kix_ehkygwr8rii2-0 start&quot; start=&quot;1&quot;&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;Process A forks a process B&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;Process B issues &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;PTRACE_TRACEME&lt;/span&gt;&lt;span&gt;&amp;nbsp;so that when it segfaults upon return from &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;munmap&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;it won&amp;rsquo;t go away (but rather will enter tracing stop)&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;Proces B clones with &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;CLONE_VM | CLONE_PTRACE&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;another process C&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;Process B &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;munmap&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;rsquo;s its entire virtual memory address space - this also unmaps process C&amp;rsquo;s virtual memory address space.&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;Process A forks new children D and E which will access (B|C)&amp;rsquo;s &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;smaps_rollup&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;file respectively&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;(D|E) opens (B|C)&amp;rsquo;s &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;smaps_rollup&lt;/span&gt;&lt;span&gt;&amp;nbsp;file and performs a read which will oops, causing (D|E) to die. &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm_users&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;will be refcount leaked/incremented once per oops&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span&gt;Process A goes back to step 5 ~2&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c18&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;times&lt;/span&gt;&lt;/li&gt;&lt;/ol&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;The above strategy can be &lt;/span&gt;&lt;span&gt;rearchitected&lt;/span&gt;&lt;span&gt;&amp;nbsp;to run in parallel (across &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c14&quot;&gt;processes&lt;/span&gt;&lt;span&gt;&amp;nbsp;not threads, because of roadblock 4) and improve performance.&lt;/span&gt;&lt;span&gt;&amp;nbsp;On server setups that print kernel logging to a serial console, generating 2&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c18&quot;&gt;32&lt;/span&gt;&lt;span&gt;&amp;nbsp;kernel oopses takes over 2 years. However on a vanilla Kali Linux box using a graphical interface, a demonstrative proof-of-concept takes only about 8 days to complete! At the completion of execution, &lt;/span&gt;&lt;span&gt;the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm_users&lt;/span&gt;&lt;span&gt;&amp;nbsp;refcount will have &lt;/span&gt;&lt;span&gt;overflow&lt;/span&gt;&lt;span&gt;ed&lt;/span&gt;&lt;span&gt;&amp;nbsp;and be set to zero, even though this &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span&gt;&amp;nbsp;is currently in use by&lt;/span&gt;&lt;span&gt;&amp;nbsp;multiple processes and can still be referenced via the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;proc&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;filesystem.&lt;/span&gt;&lt;/p&gt;&lt;h2 class=&quot;EakHiGVfAD-c17 EakHiGVfAD-c8&quot; id=&quot;h.6a9h8qcml5lm&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c12&quot;&gt;Exploitation&lt;/span&gt;&lt;/h2&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;Once the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm_users&lt;/span&gt;&lt;span&gt;&amp;nbsp;refcount has been set to zero, triggering undefined behavior and memory corruption &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c14&quot;&gt;should&lt;/span&gt;&lt;span&gt;&amp;nbsp;be fairly easy. By triggering an &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmget&lt;/span&gt;&lt;span&gt;&amp;nbsp;and an &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmput&lt;/span&gt;&lt;span&gt;&amp;nbsp;(which we can very easily do by opening the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;smaps_rollup&lt;/span&gt;&lt;span&gt;&amp;nbsp;file once more) we should be able to free the entire &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;and cause a UAF condition:&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;a id=&quot;t.b3004923779b4f82824e3ea108c266097d5e31bb&quot;&gt;&lt;/a&gt;&lt;a id=&quot;t.1&quot;&gt;&lt;/a&gt;&lt;table class=&quot;EakHiGVfAD-c16&quot;&gt;&lt;tr class=&quot;EakHiGVfAD-c21&quot;&gt;&lt;td class=&quot;EakHiGVfAD-c11&quot; colspan=&quot;1&quot; rowspan=&quot;1&quot;&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;static&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;inline&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;__mmput&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;mm_struct &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;{&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; VM_BUG_ON&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;atomic_read&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm_users&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;));&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; uprobe_clear_state&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; exit_aio&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ksm_exit&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; khugepaged_exit&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; exit_mmap&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mm_put_huge_zero_page&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; set_mm_exe_file&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;NULL&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;list_empty&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mmlist&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;{&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; spin_lock&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mmlist_lock&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; list_del&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mmlist&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; spin_unlock&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mmlist_lock&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;}&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;binfmt&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; module_put&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;binfmt&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; lru_gen_del_mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mmdrop&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;}&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;Unfortunately, since &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;64591e8605&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;&amp;nbsp;(&amp;ldquo;mm: protect free_pgtables with mmap_lock write lock in exit_mmap&amp;rdquo;)&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;exit_mmap&lt;/span&gt;&lt;span&gt;&amp;nbsp;unconditionally takes the &lt;/span&gt;&lt;span&gt;mmap lock&lt;/span&gt;&lt;span&gt;&amp;nbsp;in write mode. Since this &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&amp;rsquo;s&lt;/span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmap_lock&lt;/span&gt;&lt;span&gt;&amp;nbsp;is permanently readlocked &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c14&quot;&gt;many&lt;/span&gt;&lt;span&gt;&amp;nbsp;times, any calls to &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;__mmput&lt;/span&gt;&lt;span&gt;&amp;nbsp;will manifest as a permanent deadlock inside of &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;exit_mmap&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;.&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;However, before the call permanently deadlocks, it will call several other functions:&lt;/span&gt;&lt;/p&gt;&lt;ol class=&quot;c20 lst-kix_gx9cg4br20pa-0 start&quot; start=&quot;1&quot;&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3 EakHiGVfAD-c26&quot;&gt;probe_clear_state&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c26 EakHiGVfAD-c3&quot;&gt;exit_aio&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c26 EakHiGVfAD-c3&quot;&gt;ksm_exit&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;margin-left: 46pt;&quot; class=&quot;c4 c8 c15 li-bullet-0&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;khugepaged_exit&lt;/span&gt;&lt;/li&gt;&lt;/ol&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;Additionally, we can call &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;__mmput&lt;/span&gt;&lt;span&gt;&amp;nbsp;on this &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span&gt;&amp;nbsp;from several tasks simultaneously by having each of them trigger an &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmget/mmput&lt;/span&gt;&lt;span&gt;&amp;nbsp;on the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span&gt;, generating irregular race conditions. Under normal execution, it should not be possible to trigger multiple &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;__mmput&amp;rsquo;s&lt;/span&gt;&lt;span&gt;&amp;nbsp;on the same &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span&gt;&amp;nbsp;(much less concurrent ones) as &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;__mmput&lt;/span&gt;&lt;span&gt;&amp;nbsp;should only be called on the last and only refcount decrement which sets the refcount to zero. However, after the refcount overflow, all &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmget&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmput&amp;rsquo;s&lt;/span&gt;&lt;span&gt;&amp;nbsp;on the still-referenced &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span&gt;&amp;nbsp;will trigger an &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;__mmput&lt;/span&gt;&lt;span&gt;. This is because each &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmput&lt;/span&gt;&lt;span&gt;&amp;nbsp;that decrements the refcount to zero &lt;/span&gt;&lt;span&gt;(despite the corresponding &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mmget&lt;/span&gt;&lt;span&gt;&amp;nbsp;being why the refcount was above zero in the first place)&lt;/span&gt;&lt;span&gt;&amp;nbsp;believes that it is solely responsible for freeing the associated &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;&lt;a href=&quot;https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj-cmLd84fS7B5_N1JRJKV3ChuYXr24FB8Yfn7ALBrmzk71O7MXZulCtaF6csA9A3021X9bEruV8iJ2aUBK2q16MfhkL5r1ofXrXEpImakAJPFNmMkeDRK1m3IAPYA3xYDOxP236HaRgDBqXsf_V9wcE9xu9sLSrNIh2hmEqbphe6CwOv7Ld9E0nv2c/s836/image3.png&quot; style=&quot;display: block; padding: 1em 0;text-align: center;&quot;&gt;&lt;img src=&quot;https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj-cmLd84fS7B5_N1JRJKV3ChuYXr24FB8Yfn7ALBrmzk71O7MXZulCtaF6csA9A3021X9bEruV8iJ2aUBK2q16MfhkL5r1ofXrXEpImakAJPFNmMkeDRK1m3IAPYA3xYDOxP236HaRgDBqXsf_V9wcE9xu9sLSrNIh2hmEqbphe6CwOv7Ld9E0nv2c/s836/image3.png&quot; border=&quot;0&quot; alt=&quot;Flowchart showing how mmget/mmput on a 0 refcount leads to unsafe concurrent __mmput calls.&quot; style=&quot;max-height: 750px; max-width: 600px;&quot;title=&quot;Flowchart showing how mmget/mmput on a 0 refcount leads to unsafe concurrent __mmput calls.&quot; /&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c19&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;This racy &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;__mmput&lt;/span&gt;&lt;span&gt;&amp;nbsp;primitive extends to its callees as well. &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;exit_aio&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;is a good candidate for taking advantage of this:&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;a id=&quot;t.61bc4bf6fdc2b57f4709e87c8b2c1d92281feb30&quot;&gt;&lt;/a&gt;&lt;a id=&quot;t.2&quot;&gt;&lt;/a&gt;&lt;table class=&quot;EakHiGVfAD-c16&quot;&gt;&lt;tr class=&quot;EakHiGVfAD-c21&quot;&gt;&lt;td class=&quot;EakHiGVfAD-c11&quot; colspan=&quot;1&quot; rowspan=&quot;1&quot;&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;exit_aio&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;mm_struct &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;{&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;kioctx_table &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;table &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;rcu_dereference_raw&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;ioctx_table&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;ctx_rq_wait wait&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;i&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;skipped&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; atomic_set&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;table&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;nr&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; init_completion&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;comp&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; skipped &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;i &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;i &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;table&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;nr&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;{&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;kioctx &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;ctx &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; rcu_dereference_protected&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;{&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; skipped&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;++;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;}&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ctx&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mmap_size &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c9&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; kill_ioctx&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;ctx&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;}&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c1&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;atomic_sub_and_test&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;skipped&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;{&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c13&quot;&gt;/* Wait until all IO for the context are done. */&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; wait_for_completion&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;comp&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;}&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c2&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; RCU_INIT_POINTER&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;mm&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;ioctx_table&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp;NULL&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; kfree&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c7&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;);&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c0&quot;&gt;}&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c6 EakHiGVfAD-c8&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;While the callee function &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;kill_ioctx&lt;/span&gt;&lt;span&gt;&amp;nbsp;is written in such a way to prevent concurrent execution from causing memory corruption (part of the contract of &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c22&quot;&gt;&lt;a class=&quot;EakHiGVfAD-c101&quot; href=&quot;https://man7.org/linux/man-pages/man7/aio.7.html&quot;&gt;aio&lt;/a&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;allows for &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;kill_ioctx&lt;/span&gt;&lt;span&gt;&amp;nbsp;to be called in a concurrent way), &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;exit_aio&lt;/span&gt;&lt;span&gt;&amp;nbsp;itself makes no such guarantees. Two concurrent calls of &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;exit_aio&lt;/span&gt;&lt;span&gt;&amp;nbsp;on the same &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm&lt;/span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;struct&lt;/span&gt;&lt;span&gt;&amp;nbsp;can consequently&lt;/span&gt;&lt;span&gt;&amp;nbsp;&lt;/span&gt;&lt;span&gt;induce&lt;/span&gt;&lt;span&gt;&amp;nbsp;a double free of the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm-&amp;gt;ioctx_table&lt;/span&gt;&lt;span&gt;&amp;nbsp;object, which is fetched at the beginning of the function, while only being freed at the very end. This race window can be widened substantially by creating many &lt;/span&gt;&lt;span&gt;aio&lt;/span&gt;&lt;span&gt;&amp;nbsp;contexts in order to slow down &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;exit_aio&amp;rsquo;s&lt;/span&gt;&lt;span&gt;&amp;nbsp;internal context freeing loop. Successful exploitation will trigger the following kernel &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;BUG&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;indicating that a double free has occurred:&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;&lt;a href=&quot;https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiyX2lmxdi_963UE1t88A8xenzG7zPNT8Ou2Hvspij4S2FIc_L-y1NsdEy5obGxFNaG3W8X0TpL1TubA64elOjSkJ8FAgPrrDp5B9e1dYtRiM53tlGD1eT8m_2Md9GFS_Hoye-VdLvpZfkII_Qh4eKYSaVDefbE4ttCmgrF-Hkft2ILgW2dTdcIUxgG/s1437/image2.png&quot; style=&quot;display: block; padding: 1em 0;text-align: center;&quot;&gt;&lt;img src=&quot;https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiyX2lmxdi_963UE1t88A8xenzG7zPNT8Ou2Hvspij4S2FIc_L-y1NsdEy5obGxFNaG3W8X0TpL1TubA64elOjSkJ8FAgPrrDp5B9e1dYtRiM53tlGD1eT8m_2Md9GFS_Hoye-VdLvpZfkII_Qh4eKYSaVDefbE4ttCmgrF-Hkft2ILgW2dTdcIUxgG/s1200/image2.png&quot; border=&quot;0&quot; alt=&quot;Kernel backtrace showing the double free condition detection&quot; style=&quot;max-height: 750px; max-width: 600px;&quot;title=&quot;Kernel backtrace showing the double free condition detection&quot; /&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8 EakHiGVfAD-c6&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c19&quot;&gt;&lt;/span&gt;&lt;/p&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;Note that as this &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;exit_aio&lt;/span&gt;&lt;span&gt;&amp;nbsp;path is hit from &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;__mmput&lt;/span&gt;&lt;span&gt;, triggering this race will produce at least two permanently deadlocked processes when those processes later try to take the mmap write lock. However, from an exploitation perspective, this is irrelevant as the memory corruption primitive has already occurred before the deadlock occurs. Exploiting the resultant primitive would probably involve racing a reclaiming allocation in between the two frees of the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c3&quot;&gt;mm-&amp;gt;ioctx_table&lt;/span&gt;&lt;span&gt;&amp;nbsp;object, then taking advantage of the resulting UAF condition of the reclaimed allocation. It is &lt;/span&gt;&lt;span&gt;undoubtedly&lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c5&quot;&gt;&amp;nbsp;possible, although I didn&amp;rsquo;t take this all the way to a completed PoC.&lt;/span&gt;&lt;/p&gt;&lt;h2 class=&quot;EakHiGVfAD-c17 EakHiGVfAD-c8&quot; id=&quot;h.hesv56ci2m4m&quot;&gt;&lt;span class=&quot;EakHiGVfAD-c12&quot;&gt;Conclusion&lt;/span&gt;&lt;/h2&gt;
 &lt;p class=&quot;EakHiGVfAD-c4 EakHiGVfAD-c8&quot;&gt;&lt;span&gt;While the null-dereference bug itself was &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c22&quot;&gt;&lt;a class=&quot;EakHiGVfAD-c101&quot; href=&quot;https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/fs/proc/task_mmu.c?h=v5.15.86&amp;id=33fc9e26b7cb39f0d4219c875a2451802249c225&quot;&gt;fixed in October 2022&lt;/a&gt;&lt;/span&gt;&lt;span&gt;, the more important fix was the &lt;/span&gt;&lt;span class=&quot;EakHiGVfAD-c22&quot;&gt;&lt;a class=&quot;EakHiGVfAD-c101&quot; href=&quot;https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?h=v6.2-rc3&amp;id=48ea09cddae0b794cde2070f106ef676703dbcd3&quot;&gt;introduction of an oops limit&lt;/a&gt;&lt;/span&gt;&lt;span&gt;&amp;nbsp;which causes the kernel to panic if too many oopses occur. While this patch is already upstream, it is &lt;/span&gt;&lt;span&gt;important&lt;/span&gt;&lt;span&gt;&amp;nbsp;that distributed kernels also inherit this oops limit and backport it to LTS releases if we want to avoid treating such null-dereference bugs as full-fledged security issues in the future. Even in that best-case scenario, it is nevertheless highly beneficial for security researchers to carefully evaluate the side-effects of bugs discovered in the future that are similarly &amp;ldquo;harmless&amp;rdquo; and ensure that the &lt;/span&gt;&lt;span&gt;abrupt&lt;/span&gt;&lt;span&gt;&amp;nbsp;halt of kernel code execution caused by a kernel oops does not lead to other security-relevant primitives.&lt;/span&gt;&lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='https://googleprojectzero.blogspot.com/feeds/6288849578901159797/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='https://googleprojectzero.blogspot.com/2023/01/exploiting-null-dereferences-in-linux.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/4838136820032157985/posts/default/6288849578901159797'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/4838136820032157985/posts/default/6288849578901159797'/><link rel='alternate' type='text/html' href='https://googleprojectzero.blogspot.com/2023/01/exploiting-null-dereferences-in-linux.html' title='Exploiting null-dereferences in the Linux kernel'/><author><name>Google Project Zero</name><uri>http://www.blogger.com/profile/08975904405228580347</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='https://img1.blogblog.com/img/b16-rounded.gif'/></author><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjW-7Gf0dWd5QJfxXYwRAdtMX7uoynsldEgf9C7saF7MLL_iwIUVaagMyOAa8r-e4_KDf33viQn5U2w1LirUQnx7Vk1fJgpACWUijAl8Pgtiu8ZrDTaiEzJYSo3pJUX_nh4Mh4EQ2GPclwSCHcA-OmGfexegm4WykTZyKnIq9ktGTiLcCJo0QW0VKx6/s72-c/image1.png" height="72" width="72"/><thr:total>0</thr:total></entry>